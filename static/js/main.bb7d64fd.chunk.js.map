{"version":3,"sources":["context/constants/ActionTypes.js","context/constants/ModeView.js","context/constants/Modes2d.js","context/constants/Modes3d.js","context/constants/Modes3droi.js","components/visualization/engine/GlSelector.js","components/visualization/engine/orbitcontrol.js","components/visualization/engine/shaders/backface.vert","components/visualization/engine/shaders/backface.frag","components/visualization/engine/gfx/matbackface.js","components/visualization/engine/shaders/frontface.vert","components/visualization/engine/shaders/frontface.frag","components/visualization/engine/gfx/matfrontface.js","components/visualization/engine/gfx/matwireframecull.js","components/visualization/engine/gfx/matscreentexmapping.js","components/visualization/engine/shaders/clipplane.vert","components/visualization/engine/shaders/clipplane.frag","components/visualization/engine/gfx/matclipplane.js","components/visualization/engine/shaders/rendertotexture.vert","components/visualization/engine/shaders/rendertotexture.frag","components/visualization/engine/gfx/matrendertotexture.js","components/visualization/engine/shaders/interpolation.vert","components/visualization/engine/shaders/interpolation.frag","components/visualization/engine/gfx/matinterpolation.js","components/visualization/engine/shaders/volumerender.vert","components/visualization/engine/shaders/volumerender.frag","components/visualization/engine/gfx/matvolumerender.js","components/visualization/engine/shaders/blur.vert","components/visualization/engine/shaders/blur.frag","components/visualization/engine/gfx/matblur.js","components/visualization/engine/shaders/createAO.vert","components/visualization/engine/shaders/createAO.frag","components/visualization/engine/gfx/matAO.js","components/visualization/engine/actvolume/pointlink.js","components/visualization/engine/actvolume/pointset.js","components/visualization/engine/actvolume/triindices.js","components/visualization/engine/actvolume/triangleset.js","components/visualization/engine/actvolume/trianglesingle.js","components/visualization/engine/actvolume/trianglestack.js","components/visualization/engine/actvolume/tetra.js","components/visualization/engine/ambientTexture.js","components/visualization/engine/transferTexture.js","components/visualization/engine/Eraser.js","components/visualization/engine/volumeFilter3d.js","components/visualization/engine/loaders/roipalette.js","components/visualization/engine/tools23d/canvastext.js","components/visualization/engine/tools23d/text2d.js","components/visualization/engine/gfx/mattplain.js","components/visualization/engine/tools23d/meshtext2d.js","components/visualization/engine/gfx/matcolor2d.js","components/visualization/engine/tools23d/line2d.js","components/visualization/engine/tools23d/distancetool.js","components/visualization/engine/tools23d/graphics23d.js","components/visualization/engine/VolumeRenderer3d.js","components/visualization/engine/Graphics3d.js","components/visualization/engine/Volume.js","components/visualization/engine/LoadResult.js","components/visualization/engine/loaders/FileLoader.js","context/types.ts","components/visualization/engine/loaders/LoaderKtx.js","components/visualization/engine/TransFunc.js","components/visualization/ui/UiHistogram.js","components/visualization/engine/loaders/LoaderNifti.js","components/visualization/engine/loaders/dicomdict.js","components/visualization/engine/loaders/dicominfo.js","components/visualization/engine/loaders/dicomtag.js","components/visualization/engine/utils/Hash.js","components/visualization/engine/loaders/dicomslice.js","components/visualization/engine/loaders/dicomserie.js","components/visualization/engine/loaders/dicomslicesvolume.js","components/visualization/engine/loaders/dicomsliceinfo.js","components/visualization/engine/loaders/dicomtaginfo.js","components/visualization/engine/loaders/FileTools.js","components/visualization/engine/loaders/LoaderDicom.js","components/visualization/engine/loaders/LoadPromise.js","components/visualization/engine/loaders/LoaderHdr.js","components/visualization/engine/VolumeSet.js","context/state.tsx","utils/format.ts","context/reducer.tsx","context/context.tsx","components/visualization/engine/Texture3D.js","assets/module4demoSubset.nii.gz","utils/httpClient.ts","utils/file-worker.ts","utils/fileWorkerUtil.ts","components/shared/LoadingCircle.tsx","components/shared/PatientList.tsx","components/doctor/DoctorView.tsx","components/Home.tsx","components/nurse/NurseView.tsx","components/shared/Checkbox.tsx","components/shared/Input.tsx","components/radiologist/ModuleOptions.tsx","components/radiologist/module-options/ModuleFourOptions.tsx","components/radiologist/module-options/ModuleOneOptions.tsx","components/shared/Dropdown.tsx","components/radiologist/module-options/ModuleThreeOptions.tsx","components/radiologist/module-options/ModuleTwoOptions.tsx","components/radiologist/RadiologistView.tsx","components/visualization/ui/UiModalDemo.js","components/visualization/ui/UiModalWinCW.js","components/visualization/ui/UiModalGoogle.js","components/visualization/engine/loaders/LoaderUrlDicom.js","components/visualization/engine/loaders/LoaderDcmDaikon.js","components/visualization/engine/loaders/LoadDcmUrlDiakon.js","components/visualization/config/config.js","components/visualization/ui/UiOpenMenu.js","components/shared/Navbar.tsx","components/shared/Notification.tsx","App.tsx","index.tsx"],"names":["StoreActionType","SET_IS_LOADED","SET_FILENAME","SET_VOLUME_SET","SET_VOLUME_INDEX","SET_TEXTURE3D","SET_MODE_VIEW","SET_MODE_2D","SET_SLIDER_2D","SET_MODE_3D","SET_SLIDER_3DR","SET_SLIDER_3DG","SET_SLIDER_3DB","SET_SLIDER_Opacity","SET_SLIDER_Isosurface","SET_SLIDER_Brightness","SET_SLIDER_Cut","SET_SLIDER_Quality","SET_SLIDER_ErRadius","SET_SLIDER_ErDepth","SET_VOLUME_Renderer","SET_2D_TOOLS_INDEX","SET_2D_ZOOM","SET_2D_X_POS","SET_2D_Y_POS","SET_GRAPHICS_2D","SET_UI_APP","SET_DICOM_INFO","SET_IS_TOOL3D","SET_SLIDER_Contrast3D","SET_ERR_ARRAY","SET_MODE_3Droi","SET_DICOM_SERIES","SET_LOADER_DICOM","SET_FILENAMES","SET_PATIENT_DATA","UPDATE_PATIENT_DATA","SET_NOTIFICATION","SET_PHASETIMES","UPDATE_BIOMARKER_DATA","SET_SCANID","SET_3D_ZOOM","SET_SPOT_COLOR","SET_VOLUME_OPACITY","SET_SHOW_VENOUS_STRUCTURE","SET_INPUT","SET_LOADER","ModeView","VIEW_NA","VIEW_MPR","VIEW_2D","VIEW_3D_LIGHT","VIEW_3D","VIEW_COUNT","Modes2d","NA","SAGGITAL","CORONAL","TRANSVERSE","Modes3d","ISO","RAYCAST","RAYFAST","EREASER","Modes3droi","GlSelector","this","m_useWebGL2","undefined","canvas","document","createElementNS","context","getContext","console","log","CONTROL_CAMERA_AUTO_ROTATE_SPEED","Math","PI","OrbitControl","domElem","camera","scene","mesh","meshRotationCallback","rotateAmount","m_callback","m_mesh","m_wireMesh","m_camera","m_target","THREE","m_scene","m_button","EVENT_BUTTON_NA","m_pressedLeft","m_pressedRight","m_prevMouse","x","y","m_prevTime","m_deltaTime","m_spherical","m_sphericalDelta","set","m_autoRotate","m_minDistance","m_maxDistance","m_minAzimuthAngle","Infinity","m_maxAzimuthAngle","m_minPolarAngle","m_maxPolarAngle","m_enableDamping","m_dampingFactor","isEraserMode","isOn","wireMesh","xx","offsetLeft","yy","offsetTop","enable","autoRotateInterval","clearInterval","setInterval","_autoSpin","matrix","identity","rotate","makeRotationAxis","multiply","rotation","setFromRotationMatrix","dx","dy","curTimeMs","Date","getTime","rotationY","rotationX","camDir","copy","sub","position","normalize","up","cross","xMouse","yMouse","ctrlKey","updateTime","delta","step","camPos","length","max","min","multiplyScalar","z","lookAt","updateMatrixWorld","zoomVal","EVENT_BUTTON_LEFT","EVENT_BUTTON_CENTER","EVENT_BUTTON_RIGHT","MaterialBF","m_strShaderVertex","m_strShaderFragment","callbackMat","vertexLoader","setResponseType","fragmentLoader","load","BACK_FACE_VERTEX_SHADER","strVertexSh","BACK_FACE_FRAGMENT_SHADER","strFragmentSh","material","vertexShader","fragmentShader","side","depthTest","depthFunc","blending","MaterialFF","m_uniforms","texBF","type","value","PlaneX","PlaneY","PlaneZ","textureBF","FRONT_FACE_VERTEX_SHADER","FRONT_FACE_FRAGMENT_SHADER","uniforms","e","target","status","statusText","MaterialWC","m_defines","backCullMode","texFF","textureFF","defines","wireframe","polygonOffset","polygonOffsetFactor","polygonOffsetUnits","MaterialScreenTexMap","texBuffer","MaterialClipPlane","MVP","CLIP_VERTEX_SHADER","CLIP_FRAGMENT_SHADER","depthWrite","MaterialRenderToTexture","texTF","texVolume","texRoiId","texRoiColor","RoiVolumeTex","texVolumeMask","texVolumeAO","lightDir","t_function1min","t_function1max","t_function2min","t_function2max","stepSize","texSize","isoThreshold","brightness3D","contrast3D","colorMap1D","heatMap1D","opacityBarrier","volumeOpacity","tileCountX","volumeSizeZ","xDim","yDim","zDim","ssaoOffsets","SPOTcolor","showSolids","isoRenderFlag","MaskFlag","useAmbientTex","useWebGL2","texVol2d","texVolMask","texVolAO","texBackface","texFrontface","offsets","RENDER_TEXTURE_VERTEX_SHADER","RENDER_TEXTURE_FRAGMENT_SHADER","MaterialInterpolation","isoSurfTexel","texIsoSurface","renderTexture","INTERP_VERTEX_SHADER","INTERP_FRAGMENT_SHADER","MaterialVolumeRender","VOL_RENDER_VERTEX_SHADER","VOL_RENDER_FRAGMENT_SHADER","MaterialBlur","texVolumeRoi","texSegInUse","texelSize","blurSigma","contrast","brightness","curZ","save_flag","renderRoiMap","texture","texRoi","BLUR_VERTEX_SHADER","BLUR_FRAGMENT_SHADER","MaterialAO","TEXEL_SIZE_1_256","VOL_SIZE_Z","vectorsTex","vectorsSize","AO_VERTEX_SHADER","AO_FRAGMENT_SHADER","PointLink","m_point","m_next","PointSet","numPoints","create","m_numPoints","m_numAllocatedPoints","m_points","Array","m_voxels","PSET_NUM_VOXELS","i","dz","iSlow","findPointSlow","index","TriangleIndices","ia","ib","ic","m_indices","Int32Array","TriangleSet","numTriangles","m_numTriangles","m_numAllocatedTriangles","m_triangles","TriangleSingle","va","vb","vc","TriangleStack","m_numAllocated","m_numStacked","m_stack","depthLevel","numTiEstimate","TetrahedronGenerator","m_pointSet","m_triangleSet","vRadiusEllipse","numSubdividesOfOrigTetra","X","Z","vdata","tindices","i3","addPoint","addTriangle","subDivideMesh","getNumPoints","fileName","strOut","numVertices","strNumVertices","toString","concat","strNumTriangles","vert","strX","strY","strZ","triIndices","strIndices","arr","TextEncoder","encode","blob","Blob","url","URL","createObjectURL","linkGen","createElement","setAttribute","eventGen","createEvent","initMouseEvent","window","dispatchEvent","strNumVerts","i0","i1","i2","strNumTri","triStackSrc","triStackDst","getNumTriangles","t","okPush","push","stackSrc","stackDst","iter","numStacked","getStackDepth","s","triSingle","pop","v1","v2","v3","v12","v23","v31","addVectors","stackTmp","numTrisInStack","estimateNumVertices","floor","isEmpty","indA","indB","indC","okAddTri","numPts","numTris","AmbientTexture","inParams","rendererBlur","renderer","sceneBlur","cameraOrtho","VAL_255","gen","vRadius","numAOVectors","getNumVertices","vectors","Uint8Array","getVertex","wrapS","wrapT","magFilter","minFilter","needsUpdate","_setAOVectorTex","xDimAO","yDimAO","zDimAO","bufferTextureAO","format","depthBuffer","ambientVolumeTexCPU","isWebGL2","xTex","yTex","wrapR","mat","materialAO","zTexDivSqrt","setAmbientTextureWebGL2","frameBuf","gl","overrideMaterial","render","readPixels","RGBA","UNSIGNED_BYTE","zOffs","TransferTexture","selectedROIs","transferFuncRgba","transferFuncTexture","numRois","m_handleColors","r","g","b","isRoiVolume","roiColors","numTfPixels","createSelectedRoiMap","createRoiColorMap","textureOut","alpha","SCALE","a1","A1","a3","A3","a4","a5","A5","pix","A2","colors","transferFuncCtrlPtsRgb","intensities","opacities","curPt","pixStart","pixEnd","lerpVal","colorX","colorY","colorZ","op1","op2","colorArray","colorROIs","selectedROI","roiId","selectedState","initMatBlure","Eraser","bufferBF","bufferFF","bufferRenderToTexture","volTextureMask","geometry","lastSize","lastDepth","lastRotationVector","lastTarget","lastMode","lastBackDistance","resetflag","bufferTextureCPU","params","buff","bufBF","bufFF","bufTex","bufferMask","updatableTextureMask","dispose","windowWidth","startflag","round","eraserMouseDown","cellInd","bigCellInd","dist","vX","vY","vZ","vDir","sqrt","erasePixels","orbitControl","onMouseUp","lockEraserBuffersUpdating","renderState","RENDER_STATE","ONCE","radius","depth","x_","y_","z_","targetX","targetY","targetZ","normal","normalGauss","SIGMA2","nX","nY","nZ","normFactor","offDst","k","j","gZ","gauss","exp","curVal","radiusRatio","axis","quaternion","setFromUnitVectors","clone","prevDistance","abs","point","queue","deleteflag","RotPoint","applyAxisAngle","mainX","mainY","mainZ","isoSurfaceBorder","tan","angleTo","targetLast","lastRotation","rxy","lastback","VolumeFilter3d","transferFunc","eraser","glSelector","createWebGLContext","canvas3d","getCanvas","ambientTexture","geometryBlur","setSize","init","origVolumeTex","add","switchToBlurRender","switchToRoiMapRender","setVolumeTexture","createTransferFuncTexture","ctrlPtsColorsHex","setTransferFuncColors","updateTransferFuncTexture","setVolumeTextureWebGL2","updatableTexture","zVolOff","yVolOff","offSrc","valInt","arrPixels","bufferR","bufferTexture","indxR","indxL","bufferRoi","xVol","valRoi","updateSelectedRoiMap","updateSelectedRoi","volume","m_dataArray","m_xDim","m_yDim","m_zDim","set3DTextureFrom4Bytes","set3DTextureFrom1Byte","volTexFormat","initRenderer","createUpdatableVolumeMask","RoiPalette","m_palette","createBytePalette256","m_palette256","PAL_SIZE","numPalColors","strIndexPalette","arrColor","roiColor","split","rCol","parseFloat","gCol","bCol","ind","parseInt","FONT_FOR_TEXT_RENDER","CanvasText","m_textWidth","m_textHeight","m_canvas","m_ctx","strTextToRender","strTextColor","width","height","fillStyle","fillRect","font","strokeStyle","textAlign","textBaseline","lineWidth","strText","measureText","getFontHeight","ceilPowerOfTwo","fillText","strFont","body","getElementsByTagName","dummy","dummyText","createTextNode","appendChild","result","offsetHeight","removeChild","val","valPwr","Text2D","m_align","m_side","m_antialias","m_text","updateText","m_font","antialias","MaterialTexturePlain2d","texture1","tex","m_material","blendEquation","blendSrc","blendDst","MeshText2D","m_renderedTextHeight","m_xMin","m_xMax","m_yMin","m_yMax","xc","yc","letterHeight","xAlign","yAlign","strTextBackColor","cleanUp","remove","drawText","psy","psx","m_texture","m_matTexturePlain","m_geometry","X_TEXT_COORD_MAX","Y_TEXT_COORD_MAX","getXMin","getXMax","getYMin","getYMax","Z_COORD_TEXT","v0","vertices","faceVertexUvs","getNormal","faces","boxCanvas","boxTexture","m_matTextureBox","m_boxMaterial","Z_COORD_BOX","m_boxGeometry","boxNormal","vb0","vb1","vb2","vb3","m_boxMesh","map","ALIGN_LEFT","ALIGN_RIGHT","ALIGN_CENTER","ALIGN_TOP","ALIGN_BOTTOM","MaterialColor2d","LINE_2D_Z_COORDINATE","Line2D","xs","ys","xe","ye","matColor2d","createWithMaterial","m_xS","m_yS","m_xE","m_yE","m_lineWidth","vLine","vNorm","m_geo","DistanceTool","m_runningState","m_xPixelSize","m_yPixelSize","linesMaterial","m_linesMaterial","m_distances","m_vertexes","m_xStart","m_yStart","m_textWidthScr","m_textColor","m_textBgColor","m_zoom","line","getRenderObject","text","zoom","posX","posY","xS","xZ","yS","yZ","xE","yE","xPixelSize","yPixelSize","strMsg","toFixed","getxS","getyS","getxE","getyE","tools2d","Graphics23d","m_width","m_height","m_materialsTex2d","m_savePosX","m_savePosY","m_posX","m_posY","m_move","m_wProjScreen","m_hProjScreen","m_showTileTexture","xw","yw","m_textTime","m_toolType","m_distanceTool","toolType","clearLines","m_angleTool","m_areaTool","m_rectTool","m_textTool","clear","m_deleteTool","m_editTool","updateLines","fov","degToRad","radToDeg","atan","keyCode","debug","xScr","yScr","m_volumeData","m_volumeHeader","m_levelSetMode","xt","yt","onMouseDown","m_moveTool","m_angles","m_areas","m_textArr","m_vertexes2","m_last_lengths","last_length","m_levelSetCircle","clearLevelSetCenter","drawLevelSetCenter","onMouseMove","updateMove","updateVertexes","wheelDeltaY","m_zoomTool","onMouseWheel","updateZoom","createMarkLinesAndText","updateAll","coord","str","strRet","pnl","strBegin","substring","SHORT_ITEM_PART","strEnd","VOLUME_COLOR1_MIN_R","VOLUME_COLOR1_MAX_R","VOLUME_COLOR1_MAX_G","VOLUME_COLOR1_MAX_B","VOLUME_COLOR2_MIN_R","VOLUME_COLOR2_MIN_G","VOLUME_COLOR2_MIN_B","VOLUME_COLOR2_MAX_R","VOLUME_COLOR2_MAX_G","VOLUME_COLOR2_MAX_B","STEP_SIZE1","STEP_SIZE2","STEP_SIZE3","STEP_SIZE4","OPACITY_SCALE","ANTERIOR_AXIAL","VolumeRenderer3d","props","curFileDataType","sceneReadyCounter","renderCounter","sceneClipPlane","scene23D","graphics23d","sceneSphere","meshSphere","newScene","renderScene","planeGeometry","volTexture","bfTexture","ffTexture","renderToTexture","geometrySphere","geometryWireFrameSphere","matBF","matFF","matScreenTex","matWireFrame","matRenderToTexture","matVolumeRender","volumeUpdater","checkFrameBufferMode","eraserStarted","dispatch","volumeReady","planeCenterPt","preserveDrawingBuffer","autoClearStencil","autoClearColor","windowHeight","camAspect","setClearColor","mount","domElement","updateCutPlanes","updateLightDir","gammaInput","gammaOutput","ENABLED","DISABLED","fps","isEraseMode","eraserRadius","eraserDepth","eraserSrart","m_eraser","isSculptingMode","sculptingCapturedVertex","sculptingSphereCenter","sculptingSphereSize","vBoxVirt","okCreateTetra","positions","indices","normals","vNew","getTriangle","posAttribute","Float32Array","normalsAttribute","indAttribute","addAttribute","setIndex","computeGeometrySphereUVs","screenshotImage","toDataURL","originalAspect","aspect","originalFov","areaOfInterestTanFov2","fov2Tan","shotAspect","tan2Fov","updateProjectionMatrix","isTool23D","Tool23D","sliderValue","show","get","values","colorFlag","nonEmptyBoxMin","nonEmptyBoxMax","computeBoundingBox","boundingBox","offset","range","geo_offset1","geo_offset2","geo_scale","uvw","getAttribute","count","vx","getX","vy","getY","vz","getZ","plane","l2w","getInverse","invPerspective","projectionMatrix","invView","matrixWorld","v","applyMatrix4","s2w","box","isMasked","resetCamera","oldMeshMat","oldCam","sideMax","thresholdIsosurf","removeSphereFromSphereScene","matWCloader","addSphereToSphereScene","matFfThreeGS","matIntetpl","fromGeometry","computeGeometryUVs","scale","roiPalette","palette","getPalette256","BYTES_PER_COLOR","MAGIC_COLOR","OFFS_0","OFFS_1","OFFS_2","palB","palG","palR","VolumeFilter3D","createUpdatableVolumeTex","getExtension","VAL_4","bufferBFTextureCPU","bufferFFTextureCPU","renderfTexture","VAL_3","xSmallTexSize","ySmallTexSize","bufferRenderToTextureCPU","createClipPlaneGeometry","setMesh","setWireMesh","nOffs","random","uniformsToKeep","backupUniforms","ref","reduce","ret","uniformName","restoreUniforms","backup","Object","keys","forEach","oldUniforms","matRenderToTextureThreeGS","colorMapTexture","thresholdTissue1","thresholdTissue2","opacityTissue","lightDirComp","matSkullThreeGS","color","shading","switchToFLATRender","switchToVolumeRender","setAnimate","animateInterval","_animate","bind","mtx","extractRotation","xAxis","yAxis","zAxis","centerPt","w","dot","view","orientation","isReadyToRender","showLoader","updateClipPlaneGeometry","setRenderTarget","state","buffers","setClear","glC","FLOAT","autoClearDepth","h","vPos","vProjScreen","vProj","project","W_HALF","H_HALF","xProj","yProj","vPrj","applyMatrix3","normalMatrix","setEraserMode","setMaskFlag","undoLastErasing","eraserStart","eraseStart","deltaY","detail","onZoom","Graphics3d","onMode","isLoaded","start","stop","animate","setVolRenderToStore","m_mount","m_volumeRenderer3D","m_renderer","m_frameId","m_prevMode","m_fileDataType","startRotX","startRotY","wRender","hRender","VolRender","volumeRenderer","slider3d_r","Number","slider3d_g","slider3d_b","sliderOpacity","sliderIsosurface","sliderBrightness","sliderCut","sliderQuality","requestAnimationFrame","cancelAnimationFrame","indexMode","mode3d","clientWidth","clientHeight","setState","store","volSet","visState","volumeSet","volIndex","volumeIndex","isIso","getVolume","m_bytesPerVoxel","initWithVolume","m_boxSize","doctorView","focus","prevProps","prevStore","vol","setVolumeOpacity","spotColor","setSpotColor","showVenousStructure","getBoundingClientRect","containerX","clientX","left","containerY","clientY","top","ereaseStart","evt","stopPropagation","touches","changedTouches","numTouches","pageX","pageY","getNumVolumes","modeView","switchToTool23D","isTool3D","switchToIsosurfRender","setIsoThresholdValue","setEraserRadius","sliderErRadius","setEraserDepth","sliderErDepth","switchToFullVolumeRender","setOpacityBarrier","updateBrightness","updateZCutPlane","setStepsize","updateContrast","sliderContrast3D","styleObj","opacity","jsxCanvasNonSized","style","_onMouseMove","_onMouseDown","_onMouseUp","onTouchStart","onTouchEnd","onTouchMove","className","onClick","onWheel","_onWheel","jsxCanvasSized","tabIndex","React","Component","Volume","m_dataSize","m_phase","m_xIcon","m_yIcon","m_dataIcon","xyzDim","assert","sizeSrcMax","zOff","numPixelsIcon","wDst","hDst","xDstL","yDstT","yDst","ySrc","xDst","xSrc","xWrite","yWrite","xDimNew","yDimNew","zDimNew","xyzDimNew","bytesPerVoxel","bufSizeBytes","datArrayNew","xyDim","zOffDst","yOff","yOffDst","off","val0","val1","val2","val3","LoadResult","errorCode","SUCCESS","UNKNOWN","BAD_DICOM","BAD_HEADER","UNSUPPORTED_ENDIANNESS","UNSUPPORTED_COLOR_FORMAT","WRONG_HEADER_DATA_SIZE","WRONG_HEADER_DIMENSIONS","WRONG_HEADER_DATA_TYPE","WRONG_HEADER_BITS_PER_PIXEL","WRONG_HEADER_MAGIC","ERROR_PROCESS_HISTOGRAM","WRONG_IMAGE_DIM_X","WRONG_IMAGE_DIM_Y","WRONG_IMAGE_DIM_Z","ERROR_PIXELS_TAG_NOT_FOUND","ERROR_NO_MEMORY","ERROR_CANT_OPEN_URL","ERROR_WRONG_NUM_SLICES","ERROR_HISTOGRAM_DETECT_RIDGES","ERROR_SCALING","ERROR_INVALID_SLICE_INDEX","ERROR_TOO_SMALL_DATA_SIZE","ERROR_TOO_LARGE_DATA_SIZE","ERROR_COMPRESSED_IMAGE_NOT_SUPPORTED","NotificationStatus","GInstanceFileLoader","FileLoader","strUrl","m_url","m_request","readFile","doneCallback","rejectCallback","XMLHttpRequest","open","responseType","addEventListener","event","arrBuf","response","enc","TextDecoder","sz","byteLength","bufHead","slice","strBuf","decode","substr","errMsg","send","KtxHeader","LoaderKtx","m_header","m_id","m_endianness","m_glType","m_glTypeSize","m_glFormat","m_glInternalFormat","m_glBaseInternalFormat","m_pixelWidth","m_pixelHeight","m_pixelDepth","m_numberOfArrayElements","m_numberOfFaces","m_numberOfMipmapLevels","m_bytesOfKeyValueData","volDst","callbackProgress","callbackComplete","bufBytes","bufOff","arrayHeaderSign","lenHeaderSign","isHeaderSignCorrect","String","fromCharCode","ENDIAN_CONST","readInt","strFoundEndns","head","MAX_DIM","xMin","yMin","zMin","xMax","yMax","zMax","udataOff","readFloat","pwr2","dataSizeCalculated","pwrFinish","progressMask","MM_PER_PIXEL","m_isLoadedSuccessfull","m_fileLoader","readFromBuffer","iVal","buf","arBuf","ArrayBuffer","dataArray","DataView","setUint8","getFloat32","TransfFunc","m_mouseDown","m_indexMoved","m_numHandles","m_handleX","m_handleY","m_proj","ctx","wScreen","hScreen","m_wScreen","m_hScreen","xPre","yPre","RAD_CIRCLE","m_radCircle","xFunc","yFunc","beginPath","moveTo","lineTo","stroke","strRCol","strGCol","strBCol","strColor","ellipse","fill","xScrNew","yScrNew","UiHistogram","m_histogram","m_numColors","m_transfFunc","m_transfFuncCallback","m_transfFuncUpdateCallback","updateCanvas","handleResize","removeEventListener","objOwner","m_canvasOwner","valMax","scl","smoothHistogram","getMaxPeak","numColors","histogramArray","valMin","IND_MIN","found","m_peakIndex","hist","maxPeakVal","peakVal","sigma","needNormalize","SIZE_DIV","RAD","SIZE_LARGE","KOEF","newHist","maxVal","sum","sumW","di","ii","refs","canvasHistogram","forceRender","getVolumeHistogram","wRect","hRect","maxHistValue","valMark","closePath","setLineDash","transfFunc","transfFuncUpdate","cw","ch","DEBUG","MAX_BYTE","LoaderNifti","m_littleEndian","phases","mask","bufLen","Error","MIN_BUF_SIZE","NIFTI_HEADER_SIZE","MAX_PHASES","voxelOffsetLocation","vox_offset","readFloatFromBuffer","MAX_BUF_SIZE","error","SIZE_DWORD","SIZE_SHORT","headSize","readIntFromBuffer","numDimensions","readShortFromBuffer","MIN_NUM_DIMS","dataType","bitPix","NIFTI_DATA_TYPE_UINT8","NIFTI_DATA_TYPE_INT16","NIFTI_DATA_TYPE_FLOAT32","NIFTI_DATA_TYPE_INT8","NIFTI_DATA_TYPE_UINT16","isDataTypeCorrect","BIT_PIXELS_8","BIT_PIXELS_16","BIT_PIXELS_32","isSupported","pixdim1","pixdim2","pixdim3","TOO_SMALL_SIZE","SOME_MAGIC_BOX_DIM","MAG_0","MAG_1","MAG_2","isCorrectMagic","numVoxelsPerPhase","numVoxels","dataOff","PHASE_OFFSET","ACC_DEGREE","p","ratio","fval","histArray","TOO_MIN_SCALE","histogram","assignArray","HIST_SMOOTH_SIGMA","NORMALIZATION_APPLY","VAL_MIN","indMax","getLastMaxIndex","BITS_IN_BYTE","dataSize","zOffMin","zOffMax","xOffMin","xOffMax","yOffMin","yOffMax","ONE","KTX_GL_RED","KTX_UNSIGNED_BYTE","header","DicomDictionary","TAGS","group","element","vr","numTags","tagDesc","DicomInfo","m_patientName","m_patientDateOfBirth","m_studyDescr","m_studyDate","m_seriesTime","m_seriesDescr","m_bodyPartExamined","m_institutionName","m_operatorsName","m_physicansName","m_patientId","m_patientGender","m_acquisionTime","m_manufacturerName","m_sliceInfo","TAG_TRANSFER_SYNTAX","TAG_META_LENGTH","TAG_PIXEL_DATA","DicomTag","offsetStart","offsetValue","offsetEnd","littleEndian","m_group","m_element","m_vr","m_value","m_offsetStart","m_offsetValue","m_offsetEnd","Hash","strInp","len","hash","charCodeAt","DicomSlice","m_image","m_sliceNumber","m_sliceLocation","m_hash","strMix","getHash","DicomSerie","m_slices","m_minSlice","m_maxSlice","DicomSlicesVolume","m_series","indSerie","getSerieIndex","serieNew","addSlice","numSeries","DicomSliceInfo","m_sliceName","m_fileName","m_tags","DicomTagInfo","m_tag","m_attrName","m_attrValue","FileTools","isValidA","match","isValidB","idx","lastIndexOf","strFileName","request","strIn","dotFound","sym","c","DEBUG_PRINT_TAGS_INFO","MAGIC_DICM","UNDEFINED_LENGTH","LARGE_NUMBER","TAG_IMAGE_INSTANCE_NUMBER","TAG_BITS_ALLOCATED","TAG_IMAGE_ROWS","TAG_IMAGE_COLS","TAG_IMAGE_HIGH_BIT","TAG_IMAGE_SMALL_PIX_VAL","TAG_IMAGE_LARGE_PIX_VAL","TAG_PIXEL_PADDING_VALUE","TAG_PIXEL_SPACING","TAG_WINDOW_CENTER","TAG_WINDOW_WIDTH","TAG_RESCALE_INTERCEPT","TAG_RESCALE_SLOPE","TAG_RESCALE_TYPE","TAG_PIXEL_REPRESENTATION","TAG_IMAGE_POSITION","TAG_SLICE_LOCATION","TAG_SAMPLES_PER_PIXEL","TAG_SERIES_DESCRIPTION","TAG_SERIES_TIME","TAG_END_OF_ITEMS","TAG_END_OF_SEQUENCE","TAG_SERIES_NUMBER","TAG_SLICE_THICKNESS","TAG_BODY_PART_EXAMINED","TRANSFER_SYNTAX_COMPRESSION_JPEG","TRANSFER_SYNTAX_COMPRESSION_JPEG_LOSSLESS","TRANSFER_SYNTAX_COMPRESSION_JPEG_LOSSLESS_SEL1","TRANSFER_SYNTAX_COMPRESSION_JPEG_BASELINE_8BIT","TRANSFER_SYNTAX_COMPRESSION_JPEG_BASELINE_12BIT","TRANSFER_SYNTAX_COMPRESSION_JPEG_2000_LOSSLESS","TRANSFER_SYNTAX_COMPRESSION_JPEG_2000","TRANSFER_SYNTAX_COMPRESSION_RLE","TAG_PATIENT_NAME","TAG_PATIENT_ID","TAG_PATIENT_BIRTH_DATE","TAG_PATIENT_GENDER","TAG_STUDY_DATE","TAG_STUDY_DESCR","TAG_ACQUISION_TIME","TAG_INSTITUTION_NAME","TAG_PHYSICANS_NAME","TAG_MANUFACTURER_NAME","TAG_OPERATORS_NAME","LoaderDicom","numFiles","needScaleDownTexture","m_needScaleDownTexture","m_folder","m_dictionary","m_imageNumber","m_errors","m_transformSyntax","m_loaders","m_bitsPerPixel","m_padValue","m_windowCenter","m_windowWidth","m_rescaleIntercept","m_rescaleSlope","m_rescaleHounsfield","m_pixelRepresentaionSigned","m_samplesPerPixel","m_seriesNumber","m_nonEmptyBoxMin","m_nonEmptyBoxMax","m_slicesVolume","m_newTagEvent","CustomEvent","desc","imageNumber","m_dicomInfo","m_pixelSpacing","m_filesLoadedCounter","m_numLoadedFiles","m_imagePosMin","m_imagePosMax","m_sliceLocMin","m_sliceLocMax","runLoader","indexSelected","hashSelected","VolumeSet","addVolume","serie","slice0","numSlices","zBox","imagePosBox","TOO_MIN","ser","sl","sliceData16","val16","slicePad","minVal","valData","srcSlices","numSlicesByTags","minSliceNum","maxSliceNum","num","sort","a","sliceSrc","dataSrc16","offZ","winMin","valScaled","numPixelsInVolume","XY_MAX_DIM","xDimDst","yDimDst","VolumeTools","scaleTextureDown","m_callbackComplete","m_patientBirth","createIcon","dataView","byteLengh","little","lenData","m_metaFinished","getUint16","m_metaFinishedOffset","m_metaFound","m_explicit","getStringAt","getVrsStringIndex","getVr","getUint32","getDataVrsStringIndex","dataValue","sqGroup","sqElement","sqLength","getNextTag","buffer","tag","getTextDesc","getAttrValueAsString","isTransformSyntax","tagDataLen","dvTag","strTagVal","m_needsDeflate","isMetaLength","ratioLoaded","strCtx","arrBufWoHead","indexFile","dicomInfo","sliceInfo","strSlice","m_error","getUint8","pixelBitMask","pixelPaddingValue","pixelsTagReaded","isPixelData","numlices","tagInfo","numberToHexString","strTagName","strVal","dataLen","dv","strNum","dataLenPixRep","dvPixRep","highBit","getInt16","getInt32","strArr","xPos","yPos","zPos","strSliceThickness","strSliceLocation","sliceLoc","strDescr","strTimeMerged","strHour","strMinute","strSec","strTimeBuild","getUtf8StringAt","trim","strDateMerged","strM","strD","imageSizeBytes","numPixels","volSlice","Int16Array","Uint16Array","buildHash","imageDst","imageSrc","b0","b1","b2","ft","isValidUrl","getFolderNameFromUrl","urlFileList","fileLoader","m_callbackProgress","m_fileListCounter","readReadyFileList","constructor","name","uint8Arr","strFileContent","apply","strLog","arrFileNames","endsWith","m_numFailsLoad","urlFile","loader","fromGoogle","m_fromGoogle","fileArrBu","readFromGoogleBuffer","series","getSeries","buildSeriesInfo","errStatus","createVolumeFromSlices","VRS","numElems","DATA_VRS","lengthBuf","char2","ch2","ch3","tmp","res","readBytes","toLocaleDateString","getFloat64","numLeadZeros","strZeros","LoadFilePromise","m_file","m_reader","file","Promise","resolve","FileReader","readAsArrayBuffer","reject","strError","loaded","total","LoaderHdr","volumeDst","sizeofHdr","strDataType","m_dataType","iExtents","iRegular","readByteFromBuffer","dim1","dim2","dim3","dataTypeH","bitPixH","pixDim1","pixDim2","pixDim3","m_imageBufferSize","m_arrBuf","bytesPerPixel","estimatedVolSize","dataArray16","volRoi","dataNew","dataArrayRoi8","getFileNameFromUrl","arrGrp","exec","namePrefix","fileNameIntensityHeader","fileNameIntensityImage","fileNameMaskHeader","fileNameMaskImage","arrUrls","readFromUrls","numUrls","urlHdr","urlImg","loaderHdr","loaderImg","indPointH","indexOf","strCopy","readFromUrl","then","arrBufHdr","readFromBufferHeader","arrBufImg","readFromBufferImage","createVolumeFromHeaderAndImage","urlHdrInt","urlImgInt","urlHdrRoi","urlImgRoi","loaderHdrInt","loaderImgInt","loaderHdrRoi","loaderImgRoi","arrBufferHdr","arrBufferImg","createRoiVolumeFromHeaderAndImage","m_numVolumes","m_volumes","isInteger","volumeSizes","currentVol","prevVol","currVol","pixel","maskBuff","PIXDIM_BYTE_OFFSET","initialState","socket","notification","isVisible","icon","spin","timer","loadedScan","patients","rateOfLeakage","volumeOfLeakage","timeOfStroke","title","date","phaseTimes","nurseView","loadingBarRatio","texture3d","mode2d","slider2d","mode3droi","indexTools2d","render2dZoom","render2dxPos","render2dyPos","graphics2d","uiApp","arrErrors","dicomSeries","loaderDicom","options","moduleOne","processTimingData","build4d","build3d","compute4dSummary","saveAvailableData","reloadTimingIndices","stopIfOptionsChange","autoSelectLargest","autoSelectFirstLargest","autoSelectLastLargest","setTimeSeparationMin","setTimeSeparationMax","imageSetIndex","moduleTwo","dataOutput","modality","vendor","scanner","process","region","study","restartEnabled","minimum3d","includeMinThreshold","includeMaxThreshold","useMorphologicalOperations","strfiDisk","strfi3d","imageRegion","minimumConnected","coarseRadius","strfiRadius","imageIndexRange","moduleThree","minimumNumber","numberOfBins","distributionTail","feature","medianMin","medianMax","peakRangeMin","peakRangeMax","probabilityMin","probabilityMax","nonNegativeValues","nonZeroValues","moduleFour","enableRestart","vascularMaskDirectory","outputDataDirectory","formatPatientData","records","record","scanId","startTime","endTime","currentModule","progress","mlStatus","failed","initiator","outputLocation","patientName","patientAge","patientSex","scanTime","formatBiomarkerData","marker","postTime","formatDateString","dateString","timeString","getHours","padStart","getMinutes","massagePatientData","patientData","row","findIndex","o","docRes","newNurseData","newDocData","splice","reducer","action","payload","filter","patient","biomarkerData","module","newState","AppContext","createContext","AppContextProvider","useReducer","Provider","children","Texture3D","httpClient","axios","scan_id","tc","JSON","parse","Worker_fn","Worker","runFileWorker","api","HttpClient","faSpinner","getFileName","FAILURE","faTimesCircle","worker","FileWorker","postMessage","data","onerror","err","terminate","onmessage","tex3d","hydratedTex3d","assign","hydratedVolume","volumeSetWithData","fullyRehydratedVolumeSet","faCheckCircle","LoadingCircle","normalizedRadius","circumference","strokeDashoffset","strokeWidth","strokeDasharray","cx","cy","PatientList","isNurse","useContext","getModuleName","runFileWorkerClick","DoctorView","useState","showProgressBar","setShowProgressBar","strProgressMessage","setMessage","progressBarRatio","setRatio","spinning","toggleSpin","currentOption","setOption","graphics3d","useRef","slider","opacitySlider","zoomSlider","isNormalView","numVolumes","useEffect","app","objPrgBarVis","marginTop","Col","xl","sm","md","lg","ProgressBar","animated","variant","now","label","onChangeZoom","increment","setZoom","setAutoSpin","Dropdown","id","onSelect","key","newViewMode","setPresetView","Toggle","stringify","Menu","option","Item","cursor","current","onSlide","MIN_ZOOM","MAX_ZOOM","connect","tooltips","wNumb","decimals","toDateString","direction","onSet","visible","Home","Button","to","NurseView","useHistory","Checkbox","reset","defaultValue","dispatchValue","Form","Group","controlId","Check","checked","onChange","Input","placeholder","Label","Control","handleChange","ModuleOptions","collapsed","setCollapsed","faChevronCircleDown","faChevronCircleUp","ModuleFourOptions","ModuleOneOptions","href","ModuleThreeOptions","ModuleTwoOptions","RadiologistView","setReset","LoaderUrlDicom","m_store","m_arrFileNames","m_loaderDicom","callbackReadProgress","callbackReadComplete","ratio01","ratioPrc","uiapp","doShowProgressBar","doHideProgressBar","doSetProgressBarRatio","codeResult","strErr","getResultString","finalizeFailedLoadedVolume","m_volume","finalizeSuccessLoadedVolume","fileNameIn","SET_VOLUME","makeDimensions4x","createFromRawVolume","tp","fileTools","fileNameUrl","LoaderDcmDaikon","strContent","dataFile","image","daikon","Series","parseImage","TAG_DIRECTORY_REC","Utils","dec2hex","tagDirRec","tags","numEntries","dirEntry","numSub","elemSub","fold","fname","fileIndex","getRows","getCols","bits","getBitsAllocated","getPatientName","studyDescr","getImageDescription","studyDate","getStudyDate","seriesTime","getStudyTime","seriesDescr","getSeriesDescription","knownTags","Tag","TAG_ROWS","TAG_COLS","TAG_ACQUISITION_MATRIX","TAG_NUMBER_OF_FRAMES","TAG_NUMBER_TEMPORAL_POSITIONS","TAG_SLICE_GAP","TAG_TR","TAG_FRAME_TIME","TAG_BITS_STORED","TAG_HIGH_BIT","TAG_PHOTOMETRIC_INTERPRETATION","TAG_PLANAR_CONFIG","TAG_PALETTE_RED","TAG_PALETTE_GREEN","TAG_PALETTE_BLUE","TAG_DATA_SCALE_SLOPE","TAG_DATA_SCALE_INTERCEPT","TAG_DATA_SCALE_ELSCINT","TAG_PIXEL_BANDWIDTH","TAG_IMAGE_MIN","TAG_IMAGE_MAX","TAG_STUDY_TIME","TAG_STUDY_DES","TAG_IMAGE_TYPE","TAG_IMAGE_COMMENTS","TAG_SEQUENCE_NAME","TAG_MODALITY","TAG_FRAME_OF_REF_UID","TAG_STUDY_UID","TAG_SERIES_INSTANCE_UID","TAG_ECHO_NUMBER","TAG_TEMPORAL_POSITION","TAG_IMAGE_NUM","TAG_IMAGE_ORIENTATION","TAG_SLICE_LOCATION_VECTOR","TAG_LUT_SHAPE","Image","getSingleValueSafely","getTag","numKnownTags","tagSLoc","tagSlNum","sliceNumber","tagSamPerPix","samPerPixel","tagPPV","valPad","tagWinCen","tagWinWid","tagResInt","tagResSlo","tagResTyp","tagPixRep","tagPS","arrSpa","tagSLT","arrThick","tagImPos","tagTraSyn","pixels","getRawData","pixSrc","bVal","gVal","rVal","loadSingleSlice","LoaderDcmUrlDaikon","m_loaderDaikon","demoUrls","googleCloudDemoActivce","arrMenuGoogle","tooltip","demoWomanPelvisPrefix","demoWomanPelvisUrls","demoLungsPrefix","demoLungsUrls","UiOpenMenu","onButtonLocalFile","handleFileSelected","onFileContentReadSingleFile","onFileContentReadMultipleDicom","onFileContentReadMultipleHdr","setErrorString","onModalUrlShow","onModalUrlHide","onClickLoadUrl","callbackReadCompleteUrlKtxNii","onModalDemoOpenShow","onModalDemoOpenHide","onDemoSelected","onModalWindowCWHide","onModalGoogleShow","onModalGoogleHide","onGoogleSelected","onModalDicomSeriesHide","onDicomSerieSelected","callbackReadSingleDicomComplete","callbackReadMultipleComplete","callbackCompleteMultipleDicom","m_fileNameOnLoad","m_fileIndex","m_fileReader","showModalUrl","showModalDemo","showModalGoogle","showModalWindowCW","onLoadCounter","m_volumeSet","m_volumeRoi","m_updateEnable","roiMode","checkVolume","errCode","arrErr","m_loader","childModalWindowCenterWidth","initWindowRange","callbackCompleteSingleDicom","readFromKtx","readFromNifti","m_numFiles","readFromDicom","onFileReadSingleBuffer","readSlice","loaderDcm","readSingleSlice","isHdr","ratioLoad","fnameArr","detectedMask","detectedIntensity","readOk","ok","FAIL","onloadend","m_files","readStatus","readSliceDicomViaDaikon","STEP_PROGRESS","files","m_unzippedBuffer","reader","_this","onload","t0","performance","pako","inflate","sizeBuffer","headTemplate","correctHead0","correctHead1","mskInd","el","toLowerCase","includes","f_reader","handleEach","f_promise","m_promise","all","f_buf","m_buf","catch","from","numFilesNew","fileSelector","onchange","preventDefault","m_fileSelector","click","readFromKtxUrl","readFromNiiUrl","readFromHdrUrl","loadFromUrl","arrNums","numLet","n","config","decodeUrl","strPrefix","strFn","loadFromUrlArray","needShow","gra","forceUpdate","buildFileSelector","fileNameOnLoad","setTimeout","isGoogle","jsGoo","NavDropdown","jsDemo","jsVidiver","Divider","Modal","Title","Header","Body","InputGroup","Prepend","Text","FormControl","onChangeUrlString","Append","Navbar","useLocation","strSearch","location","search","setm_fileNameOnLoad","expand","aria-controls","Collapse","Nav","activeStyle","fontWeight","exact","Notification","App","path","ReactDOM","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.bb7d64fd.chunk.js","sourcesContent":["//\r\n// Action type for redux reducer\r\n//\r\nconst StoreActionType = {\r\n  SET_IS_LOADED: 0,\r\n  SET_FILENAME: 1,\r\n  SET_VOLUME_SET: 2,\r\n  SET_VOLUME_INDEX: 3,\r\n  SET_TEXTURE3D: 4,\r\n  SET_MODE_VIEW: 5,\r\n  SET_MODE_2D: 6,\r\n  SET_SLIDER_2D: 7,\r\n  SET_MODE_3D: 8,\r\n  SET_SLIDER_3DR: 9,\r\n  SET_SLIDER_3DG: 10,\r\n  SET_SLIDER_3DB: 11,\r\n  SET_SLIDER_Opacity: 12,\r\n  SET_SLIDER_Isosurface: 13,\r\n  SET_SLIDER_Brightness: 14,\r\n  SET_SLIDER_Cut: 15,\r\n  SET_SLIDER_Quality: 16,\r\n  SET_SLIDER_ErRadius: 17,\r\n  SET_SLIDER_ErDepth: 18,\r\n  SET_VOLUME_Renderer: 19,\r\n  SET_2D_TOOLS_INDEX: 20,\r\n  SET_2D_ZOOM: 21,\r\n  SET_2D_X_POS: 22,\r\n  SET_2D_Y_POS: 23,\r\n  SET_GRAPHICS_2D: 24,\r\n  SET_UI_APP: 25,\r\n  SET_DICOM_INFO: 26,\r\n  SET_IS_TOOL3D: 27,\r\n  SET_SLIDER_Contrast3D: 28,\r\n  SET_ERR_ARRAY: 29,\r\n  SET_MODE_3Droi: 30,\r\n  SET_DICOM_SERIES: 31,\r\n  SET_LOADER_DICOM: 32,\r\n  SET_FILENAMES: 33,\r\n  SET_PATIENT_DATA: 34,\r\n  UPDATE_PATIENT_DATA: 35,\r\n  SET_NOTIFICATION: 36,\r\n  SET_PHASETIMES: 37,\r\n  UPDATE_BIOMARKER_DATA: 38,\r\n  SET_SCANID: 39,\r\n  SET_3D_ZOOM: 40,\r\n  SET_SPOT_COLOR: 69,      // nice\r\n  SET_VOLUME_OPACITY: 420, // nice\r\n  SET_SHOW_VENOUS_STRUCTURE: '360 no-scope', // nice\r\n  SET_INPUT: 41,\r\n  SET_LOADER: 42\r\n};\r\nexport default StoreActionType;\r\n","const ModeView = {\r\n  VIEW_NA: -1,\r\n  VIEW_MPR: 0,\r\n  VIEW_2D: 1,\r\n  VIEW_3D_LIGHT: 2,\r\n  VIEW_3D: 3,\r\n  VIEW_COUNT: 4\r\n};\r\n\r\nexport default ModeView;\r\n","/**\r\n * @fileOverview Modes2d\r\n * @author Epam\r\n * @version 1.0.0\r\n */\r\n\r\nconst Modes2d = {\r\n  NA: -1,\r\n  SAGGITAL: 0,\r\n  CORONAL: 1,\r\n  TRANSVERSE: 2\r\n};\r\n\r\nexport default Modes2d;","\r\nconst Modes3d = {\r\n  NA: -1,\r\n  ISO: 0,\r\n  RAYCAST: 1,\r\n  RAYFAST: 2,\r\n  EREASER: 3\r\n};\r\n\r\nexport default Modes3d;\r\n","\r\nconst Modes3droi = {\r\n  NA: -1,\r\n  ISO: 0,\r\n  RAYCAST: 1,\r\n};\r\n\r\nexport default Modes3droi;\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n// import * as THREE from 'three';\r\n\r\n/**\r\n* OpenGL, WebGL renderer selector\r\n* @module lib/scripts/graphics3d/glselector\r\n*/\r\n\r\nexport default class GlSelector {\r\n  /** constructor: defines fields\r\n  * @constructor\r\n  */\r\n  constructor() {\r\n    this.m_useWebGL2 = undefined;\r\n  }\r\n  /** Create compatible canvas\r\n   *\r\n   */\r\n  createWebGLContext() {\r\n    this.canvas = document.createElementNS('http://www.w3.org/1999/xhtml', 'canvas');\r\n    let context = this.canvas.getContext('webgl2');\r\n    this.m_useWebGL2 = 1;\r\n    if (context == null) {\r\n      console.log('WebGL 2 not supported, moving to webgl 1');\r\n      context = this.canvas.getContext('webgl');\r\n      this.m_useWebGL2 = 0;\r\n    } else {\r\n      console.log('WebGL 2 context created');\r\n    }\r\n    return context;\r\n  }\r\n  /** return canvas */\r\n  getCanvas() {\r\n    return this.canvas;\r\n  }\r\n  /** Create compatible canvas\r\n   *\r\n   */\r\n  useWebGL2() {\r\n    return this.m_useWebGL2;\r\n  }\r\n}\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Orbit control\r\n* @module lib/scripts/controls/orbitcontrol\r\n*/\r\n\r\n// ******************************************************************\r\n// imports\r\n// ******************************************************************\r\n\r\n// absoulte imports\r\nimport * as THREE from 'three';\r\n\r\n// import MaterialVlm from '../gfx/matvlm';\r\n\r\n// const CONTROL_CAMERA_MIN_ZOOM = 1.1;\r\nconst CONTROL_CAMERA_MIN_ZOOM = 0.3;\r\nconst CONTROL_CAMERA_MAX_ZOOM = 2.5;\r\nconst CONTROL_CAMERA_ROTATION_SPEED = 0.018;\r\nconst CONTROL_CAMERA_ZOOM_SPEED = 0.2;\r\nconst CONTROL_CAMERA_AUTO_ROTATE_SPEED = Math.PI / 720;\r\n\r\n// ******************************************************************\r\n// class\r\n// ******************************************************************\r\n\r\n/** Class Graphics2d is used for simple debug style 2d render */\r\nexport default class OrbitControl {\r\n\r\n  /**\r\n  * Initialize render\r\n  * @return {Object} Intsance of this class (singleton)\r\n  */\r\n  constructor(domElem, camera, scene, mesh, meshRotationCallback) {\r\n    this.rotateAmount = CONTROL_CAMERA_AUTO_ROTATE_SPEED;\r\n    this.m_callback = meshRotationCallback;\r\n    this.m_mesh = mesh;\r\n    this.m_wireMesh = null;\r\n    this.m_camera = camera;\r\n    this.m_target = new THREE.Vector3(0, 0, 0);\r\n    this.m_scene = scene;\r\n    this.m_button = OrbitControl.EVENT_BUTTON_NA;\r\n    this.domElem = domElem;\r\n    this.m_pressedLeft = false;\r\n    this.m_pressedRight = false;\r\n    this.m_prevMouse = { x: -1, y: -1 };\r\n    this.m_prevTime = -1;\r\n    this.m_deltaTime = 0;\r\n    this.m_spherical = new THREE.Spherical();\r\n    this.m_sphericalDelta = new THREE.Spherical();\r\n    this.m_spherical.set(0, 0, 0);\r\n    this.m_sphericalDelta.set(0, 0, 0);\r\n    this.m_autoRotate = false;\r\n\r\n    this.m_minDistance = CONTROL_CAMERA_MIN_ZOOM;\r\n    this.m_maxDistance = CONTROL_CAMERA_MAX_ZOOM;\r\n\r\n    this.m_minAzimuthAngle = -Infinity; // radians\r\n    this.m_maxAzimuthAngle = Infinity; // radians\r\n    // How far you can orbit vertically, upper and lower limits.\r\n    // Range is 0 to Math.PI radians.\r\n    this.m_minPolarAngle = 0; // radians\r\n    // eslint-disable-next-line\r\n    this.m_maxPolarAngle = Math.PI * 2.0; // radians\r\n\r\n    // Set to true to enable damping (inertia)\r\n    // If damping is enabled, you must call controls.update() in your animation loop\r\n    this.m_enableDamping = false;\r\n    this.m_dampingFactor = 0.25;\r\n    //console.log(`Mouse container: ${this.m_container.offsetLeft}, ${this.m_container.offsetTop}`);\r\n    this.isEraserMode = false;\r\n  }\r\n  setEraserMode(isOn) {\r\n    this.isEraserMode = isOn;\r\n  }\r\n  setMesh(mesh) {\r\n    this.m_mesh = mesh;\r\n  }\r\n  setWireMesh(wireMesh) {\r\n    this.m_wireMesh = wireMesh;\r\n  }\r\n  setScene(scene) {\r\n    this.m_scene = scene;\r\n  }\r\n  getX(xx) {\r\n    return xx - this.domElem.offsetLeft;\r\n  }\r\n  getY(yy) {\r\n    return yy - this.domElem.offsetTop;\r\n  }\r\n\r\n  autoSpin(enable = true) {\r\n    if (this.autoRotateInterval) {\r\n      clearInterval(this.autoRotateInterval);\r\n      this.autoRotateInterval = undefined;\r\n    }\r\n\r\n    if (enable)\r\n      this.autoRotateInterval = setInterval(() => this._autoSpin(), 1000/30);\r\n  }\r\n\r\n  _autoSpin() {\r\n    const matrix = new THREE.Matrix4();\r\n    matrix.identity();\r\n    const rotate = new THREE.Matrix4();\r\n    rotate.makeRotationAxis(new THREE.Vector3(0,1,0), CONTROL_CAMERA_AUTO_ROTATE_SPEED);\r\n\r\n    matrix.multiply(rotate).multiply(this.m_mesh.matrix);\r\n\r\n    this.m_mesh.rotation.setFromRotationMatrix(matrix);\r\n\r\n    if (this.m_wireMesh) {\r\n      matrix.identity();\r\n      matrix.multiply(rotate).multiply(this.m_wireMesh.matrix);\r\n      this.m_wireMesh.rotation.setFromRotationMatrix(matrix);\r\n    }\r\n    this.m_callback();\r\n  }\r\n\r\n  // updateTime(dx, dy, useCallback = true) {\r\n  updateTime(dx, dy) {\r\n    if (dx === 0 && dy === 0) {\r\n      return;\r\n    }\r\n    // time update\r\n    const curTimeMs = new Date().getTime();\r\n    this.m_prevTime = (this.m_prevTime > 0) ? this.m_prevTime : curTimeMs;\r\n    this.m_deltaTime = curTimeMs - this.m_prevTime;\r\n    this.m_prevTime = curTimeMs;\r\n    if (!this.m_mesh) {\r\n      return;\r\n    }\r\n\r\n    // this.m_mesh.rotation.y += dx * CONTROL_CAMERA_ROTATION_SPEED;\r\n    // this.m_mesh.rotation.x += dy * CONTROL_CAMERA_ROTATION_SPEED;\r\n\r\n    const rotationY = new THREE.Matrix4();\r\n    const rotationX = new THREE.Matrix4();\r\n    const matrix = new THREE.Matrix4();\r\n    const camDir = new THREE.Vector3();\r\n\r\n    camDir.copy(this.m_target).sub(this.m_camera.position).normalize();\r\n    rotationX.makeRotationAxis(this.m_camera.up, dx * CONTROL_CAMERA_ROTATION_SPEED);\r\n    rotationY.makeRotationAxis(camDir.cross(this.m_camera.up), dy * CONTROL_CAMERA_ROTATION_SPEED);\r\n    matrix.identity();\r\n    matrix.multiply(rotationX).multiply(rotationY).multiply(this.m_mesh.matrix);\r\n    //matrix.multiply((new THREE.Matrix4()).makeRotationAxis(new THREE.Vector3(0,1,0), CONTROL_CAMERA_AUTO_ROTATE_SPEED) );\r\n\r\n    this.m_mesh.rotation.setFromRotationMatrix(matrix);\r\n\r\n    if (this.m_wireMesh) {\r\n      matrix.identity();\r\n      matrix.multiply(rotationX).multiply(rotationY).multiply(this.m_wireMesh.matrix);\r\n      this.m_wireMesh.rotation.setFromRotationMatrix(matrix);\r\n    }\r\n    this.m_callback();\r\n  }\r\n  onMouseDown(xMouse, yMouse, ctrlKey) {\r\n    this.m_pressedLeft = true;\r\n    this.m_prevMouse = { x: xMouse, y: yMouse };\r\n    this.m_spherical.set(0, 0, 0);\r\n    this.m_sphericalDelta.set(0, 0, 0);\r\n    this.m_prevTime = new Date().getTime();// -1;\r\n    this.ctrlKey = ctrlKey;\r\n  }\r\n  onMouseUp() {\r\n    this.m_pressedLeft = false;\r\n    this.m_prevMouse.x = -1;\r\n    this.m_prevMouse.y = -1;\r\n  }\r\n  onMouseMove(x, y) {\r\n    if (this.m_prevMouse.x < 0) {\r\n      this.m_prevMouse.x = x;\r\n      this.m_prevMouse.y = y;\r\n    }\r\n    const dx = x - this.m_prevMouse.x;\r\n    const dy = y - this.m_prevMouse.y;\r\n    // const dx = 1;\r\n    // const dy = 0;\r\n    this.m_prevMouse.x = x;\r\n    this.m_prevMouse.y = y;\r\n\r\n    if (this.m_pressedLeft) {\r\n      this.updateTime(dx, dy);\r\n    }\r\n  }\r\n  /*addCallbacks() {\r\n    this.m_container.on('mousedown', (event) => {\r\n      event = event || window.event;\r\n      const buttonIndex = event.which - 1;\r\n      this.m_button = buttonIndex;\r\n      // const arrButtonNames = ['Left', 'Center', 'Right'];\r\n      // console.log(`Mouse down event: ${arrButtonNames[buttonIndex]}`);\r\n      if (buttonIndex === OrbitControl.EVENT_BUTTON_LEFT) {\r\n      //console.log(\"X,Y: \"+this.getX(event.clientX)+ \" \"+ this.getY(event.clientY));\r\n        if (this.isEraserMode && event.ctrlKey) {\r\n          return;\r\n        }\r\n        this.onMouseDown(this.getX(event.clientX), this.getY(event.clientY));\r\n        // this.m_pressedLeft = true;\r\n        // this.m_prevMouse = { x: this.getX(event.clientX), y: this.getY(event.clientY) };\r\n        // this.m_spherical.set(0, 0, 0);\r\n        // this.m_sphericalDelta.set(0, 0, 0);\r\n        // this.m_prevTime = new Date().getTime();// -1;\r\n      }\r\n    });\r\n\r\n    this.m_container.on('mouseup', (event) => {\r\n      event = event || window.event;\r\n      const buttonIndex = event.which - 1;\r\n      this.m_button = buttonIndex;\r\n      if (buttonIndex === OrbitControl.EVENT_BUTTON_LEFT) {\r\n        if (this.isEraserMode && event.ctrlKey) {\r\n          return;\r\n        }\r\n        this.onMouseUp();\r\n        // this.m_pressedLeft = false;\r\n        // this.m_prevMouse.x = -1;\r\n        // this.m_prevMouse.y = -1;\r\n      }\r\n    });\r\n\r\n    this.m_container.on('mousemove', (event) => {\r\n      const x = this.getX(event.clientX);\r\n      const y = this.getY(event.clientY);\r\n      // console.log(`mouse move event at ${x}, ${y}`);\r\n      if (this.isEraserMode && event.ctrlKey) {\r\n        return;\r\n      }\r\n      this.onMouseMove(x, y);\r\n    });\r\n\r\n    this.m_container.on('mousewheel', (event) => {\r\n      const e = window.event || event; // old IE support\r\n      const delta = Math.max(-1, Math.min(1, (e.wheelDelta || -e.detail)));\r\n      // console.log(`mouse wheel event . delta = ${delta}`);\r\n      this.onZoom(delta);\r\n    });\r\n\r\n    this.m_container.on('touchstart', (event) => {\r\n      if (event.touches.length === 1) {\r\n        const domElem = this.m_container.get(0);\r\n        const box = domElem.getBoundingClientRect();\r\n        const d = domElem.ownerDocument.documentElement;\r\n        const scrLeft = box.left + window.pageXOffset - d.clientLeft;\r\n        const scrTop = box.top + window.pageYOffset - d.clientTop;\r\n        this.onMouseDown(event.touches[0].pageX - scrLeft, event.touches[0].pageY - scrTop);\r\n        // console.log(`touchstart: ${this.m_prevMouse.x},${this.m_prevMouse.y}`);\r\n      }\r\n    });*/\r\n  /*eslint-disable no-unused-vars*/\r\n  /*\r\n    this.m_container.on('touchend', (event) => {\r\n      this.onMouseUp();\r\n    });*/\r\n  /*eslint-enable no-unused-vars*/\r\n  /*\r\n    this.m_container.on('touchmove', (event) => {\r\n      const domElem = this.m_container.get(0);\r\n      const box = domElem.getBoundingClientRect();\r\n      const d = domElem.ownerDocument.documentElement;\r\n      const scrLeft = box.left + window.pageXOffset - d.clientLeft;\r\n      const scrTop = box.top + window.pageYOffset - d.clientTop;\r\n      const x = event.touches[0].pageX - scrLeft;\r\n      const y = event.touches[0].pageY - scrTop;\r\n      this.onMouseMove(x, y);\r\n    });\r\n\r\n    this.m_container.on('DOMMouseScroll', (event) => {\r\n      const e = window.event || event; // old IE support\r\n      const delta = Math.max(-1, Math.min(1, (e.wheelDelta || -e.detail)));\r\n      // console.log(`mouse scroll event . delta = ${delta}`);\r\n      this.onZoom(delta);\r\n    });\r\n  } // addCallbacks\r\n  */\r\n  onZoom(delta) {\r\n    const step = delta * CONTROL_CAMERA_ZOOM_SPEED;\r\n    let camPos = this.m_camera.position.length();\r\n    // console.log(`camPos = ${camPos}`);\r\n    const camDir = this.m_camera.position.sub(this.m_target);\r\n    // console.log(`camDirOld = ${camDir.x}, ${camDir.y}, ${camDir.z}`);\r\n    camDir.normalize();\r\n    camPos += step;\r\n    // console.log(`camPosNew = ${camPos}`);\r\n    camPos = Math.max(camPos, CONTROL_CAMERA_MIN_ZOOM);\r\n    camPos = Math.min(camPos, CONTROL_CAMERA_MAX_ZOOM);\r\n    // console.log(`camPosNewFixed = ${camPos}`);\r\n    camDir.multiplyScalar(camPos);\r\n    // console.log(`camDirNew = ${camDir.x}, ${camDir.y}, ${camDir.z}`);\r\n    this.m_camera.position.set(camDir.x, camDir.y, camDir.z);\r\n    this.m_camera.lookAt(this.m_target);\r\n    this.m_camera.updateMatrixWorld();\r\n  }\r\n\r\n  setZoom(zoomVal) {\r\n    let camPos = zoomVal;\r\n    const camDir = this.m_camera.position.sub(this.m_target);\r\n    camDir.normalize();\r\n    camPos = Math.max(camPos, CONTROL_CAMERA_MIN_ZOOM);\r\n    camPos = Math.min(camPos, CONTROL_CAMERA_MAX_ZOOM);\r\n    camDir.multiplyScalar(camPos);\r\n    this.m_camera.position.set(camDir.x, camDir.y, camDir.z);\r\n    this.m_camera.lookAt(this.m_target);\r\n    this.m_camera.updateMatrixWorld();\r\n  }\r\n\r\n} // class\r\n\r\nOrbitControl.EVENT_BUTTON_NA = -1;\r\nOrbitControl.EVENT_BUTTON_LEFT = 0;\r\nOrbitControl.EVENT_BUTTON_CENTER = 1;\r\nOrbitControl.EVENT_BUTTON_RIGHT = 2;\r\n","export default __webpack_public_path__ + \"static/media/backface.3dc9d515.vert\";","export default __webpack_public_path__ + \"static/media/backface.84a75448.frag\";","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Backface material, used for cube backface rendering\r\n* @module lib/scripts/gfx/matbackface\r\n*/\r\n\r\n// ******************************************************************\r\n// imports\r\n// ******************************************************************\r\n\r\n// absoulte imports\r\nimport * as THREE from 'three';\r\n\r\nimport BACK_FACE_VERTEX_SHADER from '../shaders/backface.vert';\r\nimport BACK_FACE_FRAGMENT_SHADER from '../shaders/backface.frag';\r\n\r\n/** Class @class MaterialBF for volume backface rendering */\r\nexport default class MaterialBF {\r\n  /** Backface material constructor\r\n  * @constructor\r\n  */\r\n  constructor() {\r\n    this.m_strShaderVertex = '';\r\n    this.m_strShaderFragment = '';\r\n  }\r\n  /** Backface material constructor\r\n  * @return {object} Three.js material with this shader\r\n  */\r\n  create(callbackMat) {\r\n    // Init uniforms\r\n\r\n    // create shader loaders\r\n    const vertexLoader = new THREE.FileLoader(THREE.DefaultLoadingManager);\r\n    vertexLoader.setResponseType('text');\r\n    const fragmentLoader = new THREE.FileLoader(THREE.DefaultLoadingManager);\r\n    fragmentLoader.setResponseType('text');\r\n\r\n    vertexLoader.load(BACK_FACE_VERTEX_SHADER, (strVertexSh) => {\r\n      this.m_strShaderVertex = strVertexSh;\r\n      // console.log(`Load callback success. text = : ${strVertexSh} ...`);\r\n      fragmentLoader.load(BACK_FACE_FRAGMENT_SHADER, (strFragmentSh) => {\r\n        this.m_strShaderFragment = strFragmentSh;\r\n\r\n        // log\r\n        // {\r\n        //   const strLoaded = JSON.stringify(this.m_strShaderVertex);\r\n        //   console.log(`Readed vertex shader is: ${strLoaded} ...`);\r\n        // }\r\n\r\n        const material = new THREE.ShaderMaterial({\r\n          vertexShader: this.m_strShaderVertex,\r\n          fragmentShader: this.m_strShaderFragment,\r\n          side: THREE.BackSide,\r\n          depthTest: true,\r\n          depthFunc: THREE.GreaterEqualDepth,\r\n          blending: THREE.NoBlending,\r\n        });\r\n        if (callbackMat) {\r\n          callbackMat(material);\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n","export default __webpack_public_path__ + \"static/media/frontface.6197e7b1.vert\";","export default __webpack_public_path__ + \"static/media/frontface.7ecf0644.frag\";","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Frontface material, used for cube frontface rendering\r\n* @module lib/scripts/gfx/matfrontface\r\n*/\r\n\r\n// ******************************************************************\r\n// imports\r\n// ******************************************************************\r\n\r\n// absoulte imports\r\nimport * as THREE from 'three';\r\nimport FRONT_FACE_VERTEX_SHADER from '../shaders/frontface.vert'\r\nimport FRONT_FACE_FRAGMENT_SHADER from '../shaders/frontface.frag'\r\n\r\n\r\n/** Class @class MaterialFF for volume frontface rendering */\r\nexport default class MaterialFF {\r\n  /** Frontface material constructor\r\n  * @constructor\r\n  */\r\n  constructor() {\r\n    this.m_strShaderVertex = '';\r\n    this.m_strShaderFragment = '';\r\n    this.m_uniforms = {\r\n      texBF: { type: 't', value: null },\r\n      PlaneX: { type: 'v4', value: new THREE.Vector4(-1.0, 0.0, 0.0, 0.5) },\r\n      PlaneY: { type: 'v4', value: new THREE.Vector4(0.0, -1.0, 0.0, 0.5) },\r\n      PlaneZ: { type: 'v4', value: new THREE.Vector4(0.0, 0.0, -1.0, 0.5) },\r\n    };\r\n  }\r\n  /** Frontface material constructor\r\n  * @return {object} Three.js material with this shader\r\n  */\r\n  create(textureBF, callbackMat) {\r\n    // Init uniforms    \r\n    this.m_uniforms.texBF.value = textureBF;\r\n    // create shader loaders\r\n    const vertexLoader = new THREE.FileLoader(THREE.DefaultLoadingManager);\r\n    vertexLoader.setResponseType('text');\r\n    const fragmentLoader = new THREE.FileLoader(THREE.DefaultLoadingManager);\r\n    fragmentLoader.setResponseType('text');\r\n    vertexLoader.load(FRONT_FACE_VERTEX_SHADER, (strVertexSh) => {\r\n      this.m_strShaderVertex = strVertexSh;\r\n      //console.log(`Load callback success. text = : ${strVertexSh} ...`);\r\n      fragmentLoader.load(FRONT_FACE_FRAGMENT_SHADER, (strFragmentSh) => {\r\n        this.m_strShaderFragment = strFragmentSh;\r\n\r\n        const NEED_LOG = false;\r\n        if (NEED_LOG) {\r\n          const strLoadedVert = JSON.stringify(this.m_strShaderVertex);\r\n          console.log(`Readed vertex shader is: ${strLoadedVert} ...`);\r\n          const strLoadedFrag = JSON.stringify(this.m_strShaderFragment);\r\n          console.log(`Readed fragment shader is: ${strLoadedFrag} ...`);\r\n        }\r\n        const material = new THREE.ShaderMaterial({\r\n          uniforms: this.m_uniforms,\r\n          vertexShader: this.m_strShaderVertex,\r\n          fragmentShader: this.m_strShaderFragment,\r\n          side: THREE.FrontSide,\r\n          depthTest: true,\r\n          depthFunc: THREE.LessEqualDepth,\r\n          blending: THREE.NoBlending,\r\n        });\r\n        if (callbackMat) {\r\n          callbackMat(material);\r\n        }\r\n      },\r\n      /*(strFragmentSh) => {},*/\r\n      (e) => {\r\n        console.log(\"Shader load failed! because of error \" + e.target.status + \", \" + e.target.statusText);\r\n      });\r\n    });\r\n  }\r\n}\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Material to enable back/front face culling with wireframe geom\r\n* @module lib/scripts/gfx/matwireframecull\r\n*/\r\n\r\n// ******************************************************************\r\n// imports\r\n// ******************************************************************\r\n\r\n// absoulte imports\r\nimport * as THREE from 'three';\r\n\r\n/** Class @class MaterialWC back/front face culling with wireframe rendering */\r\nexport default class MaterialWC {\r\n\r\n  /** Wireframe material constructor\r\n  * @constructor\r\n  */\r\n  constructor() {\r\n    this.m_strShaderVertex = '';\r\n    this.m_strShaderFragment = '';\r\n    this.m_defines = {\r\n      backCullMode: 1,\r\n    };\r\n    this.m_uniforms = {\r\n      texBF: { type: 't', value: null },\r\n      texFF: { type: 't', value: null },\r\n    };\r\n  }\r\n  /** Wireframe material constructor\r\n  * @return {object} Three.js material with this shader\r\n  */\r\n  create(textureBF, textureFF) {\r\n    // Init uniforms\r\n    this.m_uniforms.texBF.value = textureBF;\r\n    this.m_uniforms.texFF.value = textureFF;\r\n\r\n    this.m_strShaderVertex = `\r\n      varying vec3 pos;\r\n      attribute vec3 uvw;\r\n      varying vec4 screenpos;\r\n      void main() {\r\n        pos = uvw;\r\n        screenpos = (projectionMatrix  * modelViewMatrix * vec4(position, 1.0));\r\n        gl_Position =  screenpos;\r\n      }\r\n    `;\r\n    this.m_strShaderFragment = `\r\n      precision highp float;\r\n      precision highp int;\r\n      uniform sampler2D texFF;\r\n      uniform sampler2D texBF;\r\n\r\n      varying vec3 pos;\r\n      varying vec4 screenpos;\r\n      void main() {\r\n      vec2 tc = screenpos.xy / screenpos.w * 0.5 + 0.5;\r\n      vec3 back  = texture2D(texBF, tc, 0.0).xyz;\r\n      vec3 front = texture2D(texFF, tc, 0.0).xyz;\r\n      float cullvalue = length(pos - back) - length(front - back);\r\n\r\n\r\n      #if backCullMode == 1\r\n        if (cullvalue < -0.001)\r\n          discard;\r\n      #endif\r\n      #if backCullMode == 0\r\n        if (cullvalue > 0.001)\r\n          discard;\r\n      #endif\r\n\r\n        gl_FragColor = vec4(0.5, 0.0, 1.0, 1.0);\r\n        //gl_FragColor = vec4(cullvalue, cullvalue, cullvalue, 1.0);\r\n        //gl_FragColor = vec4(front, 1.0);\r\n      }\r\n    `;\r\n    const material = new THREE.ShaderMaterial({\r\n      uniforms: this.m_uniforms,\r\n      defines: this.m_defines,\r\n      vertexShader: this.m_strShaderVertex,\r\n      fragmentShader: this.m_strShaderFragment,\r\n      side: THREE.FrontSide,\r\n      wireframe: true,\r\n      depthTest: false,\r\n      polygonOffset: false,\r\n      polygonOffsetFactor: -4.0,\r\n      polygonOffsetUnits: -4.0,\r\n    });\r\n    return material;\r\n  }\r\n}\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Material to map texture using screen positions of the fragments\r\n* @module lib/scripts/gfx/matscreentexmapping\r\n*/\r\n\r\n// ******************************************************************\r\n// imports\r\n// ******************************************************************\r\n\r\n// absoulte imports\r\nimport * as THREE from 'three';\r\n\r\n/** Class @class MaterialScreenTexMap to aux backface texture rendering for the\r\n *  frontface geometry to avoid z-fighting\r\n */\r\nexport default class MaterialScreenTexMap {\r\n  /** Wireframe material constructor\r\n  * @constructor\r\n  */\r\n  constructor() {\r\n    this.m_strShaderVertex = '';\r\n    this.m_strShaderFragment = '';\r\n\r\n    this.m_uniforms = {\r\n      texBuffer: { type: 't', value: null },\r\n    };\r\n  }\r\n  /** material constructor\r\n  * @return {object} Three.js material with this shader\r\n  */\r\n  create(texBuffer) {\r\n    // Init uniforms\r\n    this.m_uniforms.texBuffer.value = texBuffer;\r\n    this.m_strShaderVertex = `\r\n      varying vec4 screenpos;\r\n      void main() {\r\n        screenpos = (projectionMatrix  * modelViewMatrix * vec4(position, 1.0));\r\n        gl_Position =  screenpos;\r\n      }\r\n    `;\r\n    this.m_strShaderFragment = `\r\n      precision highp float;\r\n      precision highp int;\r\n      uniform sampler2D texBuffer;\r\n\r\n      varying vec4 screenpos;\r\n      void main() {\r\n        vec2 tc = screenpos.xy / screenpos.w * 0.5 + 0.5;\r\n        gl_FragColor = texture2D(texBuffer, tc, 0.0);\r\n      }\r\n    `;\r\n    const material = new THREE.ShaderMaterial({\r\n      uniforms: this.m_uniforms,\r\n      vertexShader: this.m_strShaderVertex,\r\n      fragmentShader: this.m_strShaderFragment,\r\n      side: THREE.FrontSide,\r\n      depthTest: true,\r\n      depthFunc: THREE.LessEqualDepth,\r\n      blending: THREE.NoBlending,\r\n    });\r\n    return material;\r\n  }\r\n}\r\n","export default __webpack_public_path__ + \"static/media/clipplane.7ba65be0.vert\";","export default __webpack_public_path__ + \"static/media/clipplane.d594e568.frag\";","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Clipping plane material, used for rendering of near camera plane as a part ray-casting pipeline\r\n* @module lib/scripts/gfx/matcliplane\r\n*/\r\n\r\n// ******************************************************************\r\n// imports\r\n// ******************************************************************\r\n\r\n// absoulte imports\r\nimport * as THREE from 'three';\r\n\r\nimport CLIP_VERTEX_SHADER from '../shaders/clipplane.vert';\r\nimport CLIP_FRAGMENT_SHADER from '../shaders/clipplane.frag';\r\n\r\n/** Class @class MaterialClipPlane for volume clip plane rendering */\r\nexport default class MaterialClipPlane {\r\n  /** ClipPlane material constructor\r\n  * @constructor\r\n  */\r\n  constructor() {\r\n    this.m_strShaderVertex = '';\r\n    this.m_strShaderFragment = '';\r\n    this.m_uniforms = {\r\n      MVP: { type: 'm4' },\r\n      texBF: { type: 't' },\r\n    };\r\n  }\r\n  /** Frontface material constructor\r\n  * @return {object} Three.js material with this shader\r\n  */\r\n  create(textureBF, callbackMat) {\r\n    // Init uniforms\r\n    this.m_uniforms.texBF.value = textureBF;\r\n    // create shader loaders\r\n    const vertexLoader = new THREE.FileLoader(THREE.DefaultLoadingManager);\r\n    vertexLoader.setResponseType('text');\r\n    const fragmentLoader = new THREE.FileLoader(THREE.DefaultLoadingManager);\r\n    fragmentLoader.setResponseType('text');\r\n\r\n    vertexLoader.load(CLIP_VERTEX_SHADER, (strVertexSh) => {\r\n      this.m_strShaderVertex = strVertexSh;\r\n      // console.log(`Load callback success. text = : ${strVertexSh} ...`);\r\n      fragmentLoader.load(CLIP_FRAGMENT_SHADER, (strFragmentSh) => {\r\n        this.m_strShaderFragment = strFragmentSh;\r\n\r\n        // log\r\n        // {\r\n        //   const strLoaded = JSON.stringify(this.m_strShaderVertex);\r\n        //   console.log(`Readed vertex shader is: ${strLoaded} ...`);\r\n        // }\r\n\r\n        const material = new THREE.ShaderMaterial({\r\n          uniforms: this.m_uniforms,\r\n          vertexShader: this.m_strShaderVertex,\r\n          fragmentShader: this.m_strShaderFragment,\r\n          side: THREE.DoubleSide,\r\n          depthTest: false,\r\n          depthWrite: false,\r\n        });\r\n        if (callbackMat) {\r\n          callbackMat(material);\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n","export default __webpack_public_path__ + \"static/media/rendertotexture.b51229d9.vert\";","export default __webpack_public_path__ + \"static/media/rendertotexture.1f755ade.frag\";","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Low resolution isosurface rendering material for CT dataset\r\n* @module lib/scripts/gfx/matrendertotexture\r\n*/\r\n\r\n// ******************************************************************\r\n// imports\r\n// ******************************************************************\r\n\r\n// absoulte imports\r\nimport * as THREE from 'three';\r\n\r\nimport RENDER_TEXTURE_VERTEX_SHADER from '../shaders/rendertotexture.vert';\r\nimport RENDER_TEXTURE_FRAGMENT_SHADER from '../shaders/rendertotexture.frag';\r\n\r\n/** Class @class MaterialRenderToTexture for\r\n* rough isosurface computation: a ray-casting optimization\r\n*/\r\nexport default class MaterialRenderToTexture {\r\n  /** Simple material constructor\r\n  * @constructor\r\n  */\r\n  constructor() {\r\n    this.m_strShaderVertex = '';\r\n    this.m_strShaderFragment = '';\r\n    this.m_uniforms = {\r\n      texTF: { type: 't', value: null },\r\n      texVolume: { type: 't', value: null },\r\n      texRoiId: { type: 't', value: null },\r\n      texRoiColor: { type: 't', value: null },\r\n      RoiVolumeTex: { type: 't', value: null },\r\n      texVolumeMask: { type: 't', value: null },\r\n      texVolumeAO: { type: 't', value: null },\r\n      lightDir: { type: 'v3', value: new THREE.Vector3(0.0, 0.0, 0.0) },\r\n      texBF: { type: 't', value: null },\r\n      texFF: { type: 't', value: null },\r\n      t_function1min: { type: 'v4', value: new THREE.Vector4(0.0, 0.0, 0.0, 0.0) },\r\n      t_function1max: { type: 'v4', value: new THREE.Vector4(0.0, 0.0, 0.0, 0.0) },\r\n      t_function2min: { type: 'v4', value: new THREE.Vector4(0.0, 0.0, 0.0, 0.0) },\r\n      t_function2max: { type: 'v4', value: new THREE.Vector4(0.0, 0.0, 0.0, 0.0) },\r\n      stepSize: { type: 'v4', value: new THREE.Vector4(0.0, 0.0, 0.0, 0.0) },\r\n      texSize: { type: 'f', value: 0.0 },\r\n      isoThreshold: { type: 'f', value: 0.0 },\r\n      brightness3D: { type: 'f', value: 0.0 },\r\n      contrast3D: { type: 'f', value: 0.0 },\r\n      colorMap1D: { type: 't', value: null },\r\n      heatMap1D: { type: 't', value: null },\r\n      opacityBarrier: { type: 'f', value: 0.0 },\r\n      volumeOpacity: { type: 'f', value: 1.0 },\r\n      tileCountX: { type: 'f', value: 0.0 },\r\n      volumeSizeZ: { type: 'f', value: 0.0 },\r\n      xDim: { type: 'f', value: 0.0 },\r\n      yDim: { type: 'f', value: 0.0 },\r\n      zDim: { type: 'f', value: 0.0 },\r\n      ssaoOffsets: { type: 'v3v' },\r\n      SPOTcolor: { type: 'v3', value: new THREE.Vector3(1.0, 1.0, 1.0) },\r\n      showSolids: { type: 'b', value: true},\r\n    };\r\n    this.m_defines = {\r\n      isoRenderFlag: 0,\r\n      MaskFlag: 0,\r\n      useAmbientTex: 0,\r\n      useWebGL2: 1,\r\n    };\r\n  }\r\n  /** Simple material constructor\r\n  * @return {object} Three.js material with this shader\r\n  */\r\n  create(texTF, texVol2d, texVolMask, texVolAO, texBackface, texFrontface, offsets, callbackMat) {\r\n    // Init uniforms\r\n    this.m_uniforms.texTF.value = texTF;\r\n    this.m_uniforms.texVolume.value = texVol2d;\r\n    this.m_uniforms.texVolumeMask.value = texVolMask;\r\n    this.m_uniforms.texVolumeAO.value = texVolAO;\r\n    this.m_uniforms.texBF.value = texBackface;\r\n    this.m_uniforms.texFF.value = texFrontface;\r\n    this.m_uniforms.ssaoOffsets.value = offsets;\r\n    // create shader loaders\r\n    const vertexLoader = new THREE.FileLoader(THREE.DefaultLoadingManager);\r\n    vertexLoader.setResponseType('text');\r\n    const fragmentLoader = new THREE.FileLoader(THREE.DefaultLoadingManager);\r\n    fragmentLoader.setResponseType('text');\r\n\r\n    vertexLoader.load(RENDER_TEXTURE_VERTEX_SHADER, (strVertexSh) => {\r\n      this.m_strShaderVertex = strVertexSh;\r\n      // console.log(`Load callback success. text = : ${strVertexSh} ...`);\r\n      fragmentLoader.load(RENDER_TEXTURE_FRAGMENT_SHADER, (strFragmentSh) => {\r\n        this.m_strShaderFragment = strFragmentSh;\r\n\r\n        const material = new THREE.ShaderMaterial({\r\n          uniforms: this.m_uniforms,\r\n          defines: this.m_defines,\r\n          vertexShader: this.m_strShaderVertex,\r\n          fragmentShader: this.m_strShaderFragment,\r\n          side: THREE.BackSide,\r\n          depthTest: true,\r\n          depthFunc: THREE.GreaterEqualDepth,\r\n          blending: THREE.NoBlending,\r\n        });\r\n        if (callbackMat) {\r\n          callbackMat(material);\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n","export default __webpack_public_path__ + \"static/media/interpolation.ae2f2bf4.vert\";","export default __webpack_public_path__ + \"static/media/interpolation.b65fb94f.frag\";","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Final isosurface rendering material for CT dataset\r\n* @module lib/scripts/gfx/matinterpolation\r\n*/\r\n\r\n// ******************************************************************\r\n// imports\r\n// ******************************************************************\r\n\r\n// absoulte imports\r\nimport * as THREE from 'three';\r\n\r\nimport INTERP_VERTEX_SHADER from '../shaders/interpolation.vert';\r\nimport INTERP_FRAGMENT_SHADER from '../shaders/interpolation.frag';\r\n\r\n/** Class @class MaterialVolumeRender for create skull volume render shader material */\r\nexport default class MaterialInterpolation {\r\n\r\n  /** Simple material constructor\r\n  * @constructor\r\n  */\r\n  constructor() {\r\n    this.m_strShaderVertex = '';\r\n    this.m_strShaderFragment = '';\r\n    this.m_uniforms = {\r\n      isoSurfTexel: { type: 'v2', value: null },\r\n      texIsoSurface: { type: 't', value: null },\r\n    };\r\n    this.m_defines = {\r\n      isoRenderFlag: 0,\r\n    };\r\n  }\r\n  /** Simple material constructor\r\n  * @return {object} Three.js material with this shader\r\n  */\r\n  create(renderTexture, callbackMat) {\r\n    // Init uniforms\r\n    this.m_uniforms.texIsoSurface.value = renderTexture;\r\n\r\n    // create shader loaders\r\n    const vertexLoader = new THREE.FileLoader(THREE.DefaultLoadingManager);\r\n    vertexLoader.setResponseType('text');\r\n    const fragmentLoader = new THREE.FileLoader(THREE.DefaultLoadingManager);\r\n    fragmentLoader.setResponseType('text');\r\n\r\n    vertexLoader.load(INTERP_VERTEX_SHADER, (strVertexSh) => {\r\n      this.m_strShaderVertex = strVertexSh;\r\n      // console.log(`Load callback success. text = : ${strVertexSh} ...`);\r\n      fragmentLoader.load(INTERP_FRAGMENT_SHADER, (strFragmentSh) => {\r\n        this.m_strShaderFragment = strFragmentSh;\r\n\r\n        // log\r\n        // {\r\n        //   const strLoaded = JSON.stringify(this.m_strShaderVertex);\r\n        //   console.log(`Readed vertex shader is: ${strLoaded} ...`);\r\n        // }\r\n\r\n        const material = new THREE.ShaderMaterial({\r\n          uniforms: this.m_uniforms,\r\n          defines: this.m_defines,\r\n          vertexShader: this.m_strShaderVertex,\r\n          fragmentShader: this.m_strShaderFragment,\r\n          side: THREE.BackSide\r\n        });\r\n        if (callbackMat) {\r\n          callbackMat(material);\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n","export default __webpack_public_path__ + \"static/media/volumerender.0fdf551f.vert\";","export default __webpack_public_path__ + \"static/media/volumerender.00647b63.frag\";","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Final isosurface rendering material for CT dataset\r\n* @module lib/scripts/gfx/matvolumerender\r\n*/\r\n\r\n// ******************************************************************\r\n// imports\r\n// ******************************************************************\r\n\r\n// absoulte imports\r\nimport * as THREE from 'three';\r\n\r\nimport VOL_RENDER_VERTEX_SHADER from '../shaders/volumerender.vert';\r\nimport VOL_RENDER_FRAGMENT_SHADER from '../shaders/volumerender.frag';\r\n\r\n/** Class @class MaterialVolumeRender for create skull volume render shader material */\r\nexport default class MaterialVolumeRender {\r\n\r\n  /** Simple material constructor\r\n  * @constructor\r\n  */\r\n  constructor() {\r\n    this.m_strShaderVertex = '';\r\n    this.m_strShaderFragment = '';\r\n    this.m_uniforms = {\r\n      isoSurfTexel: { type: 'v2', value: null },\r\n      lightDir: { type: 'v3', value: new THREE.Vector3(0.0, 0.0, 0.0) },\r\n      texTF: { type: 't', value: null },\r\n      texVolume: { value: null },\r\n      texRoiId: { type: 't', value: null },\r\n      texRoiColor: { type: 't', value: null },\r\n      RoiVolumeTex: { type: 't', value: null },\r\n      texVolumeMask: { type: 't', value: null },\r\n      texVolumeAO: { type: 't', value: null },\r\n      texBF: { type: 't', value: null },\r\n      texFF: { type: 't', value: null },\r\n      texIsoSurface: { type: 't', value: null },\r\n      colorMap1D: { type: 't', value: null },\r\n      heatMap1D: { type: 't', value: null },\r\n      t_function1min: { type: 'v4', value: new THREE.Vector4(0.0, 0.0, 0.0, 0.0) },\r\n      t_function1max: { type: 'v4', value: new THREE.Vector4(0.0, 0.0, 0.0, 0.0) },\r\n      t_function2min: { type: 'v4', value: new THREE.Vector4(0.0, 0.0, 0.0, 0.0) },\r\n      t_function2max: { type: 'v4', value: new THREE.Vector4(0.0, 0.0, 0.0, 0.0) },\r\n      stepSize: { type: 'v4', value: new THREE.Vector4(0.0, 0.0, 0.0, 0.0) },\r\n      texSize: { type: 'f', value: 0.0 },\r\n      isoThreshold: { type: 'f', value: 0.0 },\r\n      brightness3D: { type: 'f', value: 0.0 },\r\n      contrast3D: { type: 'f', value: 0.0 },\r\n      tileCountX: { type: 'f', value: 0.0 },\r\n      volumeSizeZ: { type: 'f', value: 0.0 },\r\n      opacityBarrier: { type: 'f', value: 0.0 },\r\n      volumeOpacity: { type: 'f', value: 1.0 },\r\n      xDim: { type: 'f', value: 0.0 },\r\n      yDim: { type: 'f', value: 0.0 },\r\n      zDim: { type: 'f', value: 0.0 },\r\n      ssaoOffsets: { type: 'v3v' },\r\n      SPOTcolor: { type: 'v3', value: new THREE.Vector3(1.0, 1.0, 1.0) },\r\n      showSolids: { type: 'b', value: true},\r\n    };\r\n    this.m_defines = {\r\n      isoRenderFlag: 0,\r\n      MaskFlag: 0,\r\n      useAmbientTex: 0,\r\n      useWebGL2: 1,\r\n    };\r\n  }\r\n  /** Simple material constructor\r\n  * @return {object} Three.js material with this shader\r\n  */\r\n  create(texTF, texVol2d,\r\n    texVolMask, texVolAO, texBackface, texFrontface, renderTexture, offsets, callbackMat) {\r\n    // Init uniforms\r\n    this.m_uniforms.texTF.value = texTF;\r\n    this.m_uniforms.texVolume.value = texVol2d;\r\n    this.m_uniforms.texVolumeMask.value = texVolMask;\r\n    this.m_uniforms.texVolumeAO.value = texVolAO;\r\n    this.m_uniforms.texBF.value = texBackface;\r\n    this.m_uniforms.texFF.value = texFrontface;\r\n    this.m_uniforms.texIsoSurface.value = renderTexture;\r\n    this.m_uniforms.ssaoOffsets.value = offsets;\r\n\r\n    // create shader loaders\r\n    const vertexLoader = new THREE.FileLoader(THREE.DefaultLoadingManager);\r\n    vertexLoader.setResponseType('text');\r\n    const fragmentLoader = new THREE.FileLoader(THREE.DefaultLoadingManager);\r\n    fragmentLoader.setResponseType('text');\r\n\r\n    vertexLoader.load(VOL_RENDER_VERTEX_SHADER, (strVertexSh) => {\r\n      this.m_strShaderVertex = strVertexSh;\r\n      // console.log(`Load callback success. text = : ${strVertexSh} ...`);\r\n      fragmentLoader.load(VOL_RENDER_FRAGMENT_SHADER, (strFragmentSh) => {\r\n        this.m_strShaderFragment = strFragmentSh;\r\n\r\n        const material = new THREE.ShaderMaterial({\r\n          uniforms: this.m_uniforms,\r\n          defines: this.m_defines,\r\n          vertexShader: this.m_strShaderVertex,\r\n          fragmentShader: this.m_strShaderFragment,\r\n          side: THREE.BackSide,\r\n          depthTest: true,\r\n          depthFunc: THREE.GreaterEqualDepth,\r\n          blending: THREE.NoBlending,\r\n        });\r\n        if (callbackMat) {\r\n          callbackMat(material);\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n","export default __webpack_public_path__ + \"static/media/blur.a62df0a0.vert\";","export default __webpack_public_path__ + \"static/media/blur.d95db93c.frag\";","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Blur material, used for rendering of blurred volume slices\r\n* @module lib/scripts/gfx/matblur\r\n*/\r\n\r\n// ******************************************************************\r\n// imports\r\n// ******************************************************************\r\n\r\n// absoulte imports\r\nimport * as THREE from 'three';\r\n\r\nimport BLUR_VERTEX_SHADER from '../shaders/blur.vert';\r\nimport BLUR_FRAGMENT_SHADER from '../shaders/blur.frag';\r\n\r\n/** Class @class MaterialBlur for volume slice blurring */\r\nexport default class MaterialBlur {\r\n  /** Backface material constructor\r\n  * @constructor\r\n  */\r\n  constructor() {\r\n    this.m_strShaderVertex = '';\r\n    this.m_strShaderFragment = '';\r\n    const TILE_COUNT_X = 16.0;\r\n    const VOL_SIZE_Z = 256.0;\r\n    const BLUR_SIGMA = 0.8;\r\n    const CONTRAST = 1.0;\r\n    const BRIGHTNESS = 0.0;\r\n    const SAVE_FLAG = true;\r\n    this.m_uniforms = {\r\n      texVolume: { type: 't', value: null },\r\n      texVolumeRoi: { type: 't', value: null },\r\n      texRoiColor: { type: 't', value: null },\r\n      texSegInUse: { type: 't', value: null },\r\n      texelSize: { type: 'v3', value: null },\r\n      tileCountX: { type: 'f', value: TILE_COUNT_X },\r\n      volumeSizeZ: { type: 'f', value: VOL_SIZE_Z },\r\n      xDim: { type: 'f', value: VOL_SIZE_Z },\r\n      yDim: { type: 'f', value: VOL_SIZE_Z },\r\n      blurSigma:   { type: 'f', value: BLUR_SIGMA },\r\n      contrast: { type: 'f', value: CONTRAST },\r\n      brightness: { type: 'f', value: BRIGHTNESS },\r\n      curZ: { type: 'f', value: 0.0 },\r\n      save_flag: { type: 'b', value: SAVE_FLAG }\r\n    };\r\n    this.m_defines = {\r\n      renderRoiMap: 0,\r\n      useWebGL2: 1,\r\n    };\r\n  }\r\n  /** Backface material constructor\r\n  * @return {object} Three.js material with this shader\r\n  */\r\n  create(texture, texRoi, texelSize, texRoiColor, texRoiId, callbackMat) {\r\n    // Init uniforms\r\n    this.m_uniforms.texVolume.value = texture;\r\n    this.m_uniforms.texVolume.value = texture;\r\n    this.m_uniforms.texVolumeRoi.value = texRoi;\r\n    this.m_uniforms.texRoiColor.value = texRoiColor;\r\n    this.m_uniforms.texSegInUse.value = texRoiId;\r\n    this.m_uniforms.texelSize.value = texelSize;\r\n    // create shader loaders\r\n    const vertexLoader = new THREE.FileLoader(THREE.DefaultLoadingManager);\r\n    vertexLoader.setResponseType('text');\r\n    const fragmentLoader = new THREE.FileLoader(THREE.DefaultLoadingManager);\r\n    fragmentLoader.setResponseType('text');\r\n\r\n    vertexLoader.load(BLUR_VERTEX_SHADER, (strVertexSh) => {\r\n      this.m_strShaderVertex = strVertexSh;\r\n      // console.log(`Load callback success. text = : ${strVertexSh} ...`);\r\n      fragmentLoader.load(BLUR_FRAGMENT_SHADER, (strFragmentSh) => {\r\n        this.m_strShaderFragment = strFragmentSh;\r\n\r\n        const material = new THREE.ShaderMaterial({\r\n          uniforms: this.m_uniforms,\r\n          defines: this.m_defines,\r\n          vertexShader: this.m_strShaderVertex,\r\n          fragmentShader: this.m_strShaderFragment\r\n        });\r\n        if (callbackMat) {\r\n          callbackMat(material);\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n","export default __webpack_public_path__ + \"static/media/createAO.a62df0a0.vert\";","export default __webpack_public_path__ + \"static/media/createAO.bae764f9.frag\";","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Blur material, used for rendering of blurred volume slices\r\n* @module lib/scripts/gfx/matblur\r\n*/\r\n\r\n// ******************************************************************\r\n// imports\r\n// ******************************************************************\r\n\r\n// absoulte imports\r\nimport * as THREE from 'three';\r\n\r\nimport AO_VERTEX_SHADER from '../shaders/createAO.vert';\r\nimport AO_FRAGMENT_SHADER from '../shaders/createAO.frag';\r\n\r\n/** Class @class MaterialBlur for volume slice blurring */\r\nexport default class MaterialAO {\r\n\r\n  /** Backface material constructor\r\n  * @constructor\r\n  */\r\n  constructor() {\r\n    this.m_strShaderVertex = '';\r\n    this.m_strShaderFragment = '';\r\n    const TEX_SIZE = 256.0;\r\n    const TEXEL_SIZE_1_256 = 1.0 / TEX_SIZE;\r\n    const TILE_COUNT_X = 16.0;\r\n    const VOL_SIZE_Z = 256.0;\r\n    this.m_uniforms = {\r\n      texVolume: { type: 't', value: null },\r\n      vectorsTex: { type: 't', value: null },\r\n      texelSize: { type: 'v3', value: new THREE.Vector3(TEXEL_SIZE_1_256, TEXEL_SIZE_1_256, TEXEL_SIZE_1_256) },\r\n      tileCountX: { type: 'f', value: TILE_COUNT_X },\r\n      volumeSizeZ: { type: 'f', value: VOL_SIZE_Z },\r\n      xDim: { type: 'f', value: VOL_SIZE_Z },\r\n      yDim: { type: 'f', value: VOL_SIZE_Z },\r\n      curZ: { type: 'f', value: VOL_SIZE_Z },\r\n      isoThreshold: { type: 'f', value: VOL_SIZE_Z },\r\n      vectorsSize: { type: 'i', value: null },\r\n    };\r\n    this.m_defines = {\r\n      useWebGL2: 1,\r\n    };\r\n  }\r\n  /** Backface material constructor\r\n  * @return {object} Three.js material with this shader\r\n  */\r\n  create(texture, texelSize, vectorsTex, vectorsSize, isoThreshold, callbackMat) {\r\n    // Init uniforms\r\n    this.m_uniforms.texVolume.value = texture;\r\n    this.m_uniforms.vectorsTex.value = vectorsTex;\r\n    this.m_uniforms.texelSize.value = texelSize;\r\n    this.m_uniforms.vectorsSize.value = vectorsSize;\r\n    this.m_uniforms.isoThreshold.value = isoThreshold;\r\n    // create shader loaders\r\n    const vertexLoader = new THREE.FileLoader(THREE.DefaultLoadingManager);\r\n    vertexLoader.setResponseType('text');\r\n    const fragmentLoader = new THREE.FileLoader(THREE.DefaultLoadingManager);\r\n    fragmentLoader.setResponseType('text');\r\n\r\n    vertexLoader.load(AO_VERTEX_SHADER, (strVertexSh) => {\r\n      this.m_strShaderVertex = strVertexSh;\r\n      // console.log(`Load callback success. text = : ${strVertexSh} ...`);\r\n      fragmentLoader.load(AO_FRAGMENT_SHADER, (strFragmentSh) => {\r\n        this.m_strShaderFragment = strFragmentSh;\r\n\r\n        const material = new THREE.ShaderMaterial({\r\n          uniforms: this.m_uniforms,\r\n          defines: this.m_defines,\r\n          vertexShader: this.m_strShaderVertex,\r\n          fragmentShader: this.m_strShaderFragment\r\n        });\r\n        if (callbackMat) {\r\n          callbackMat(material);\r\n        }\r\n      });\r\n    });\r\n  }\r\n}\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Simple point link\r\n* @module lib/scripts/actvolume/pointlink\r\n*/\r\n\r\n// absolute imports\r\nimport * as THREE from 'three';\r\n\r\n// relative imports\r\n// import PointLink from './pointlink';\r\n\r\n/**\r\n* Class PointLink define link entry\r\n* @class PointLink\r\n*/\r\nexport default class PointLink {\r\n  /**\r\n  * Init all internal data\r\n  * @constructs PointLink\r\n  */\r\n  constructor() {\r\n    this.m_point = new THREE.Vector3();\r\n    this.m_next = null;\r\n  }\r\n}\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Simple point set with voxelization\r\n* @module lib/scripts/actvolume/pointset\r\n*/\r\n\r\n// absolute imports\r\n// import TetrahedronGenerator from 'tetra';\r\n\r\n// relative imports\r\nimport PointLink from './pointlink';\r\n\r\nconst PSET_NUM_VOXELS = 16;\r\nconst PSET_NUM_LINKS = (PSET_NUM_VOXELS * PSET_NUM_VOXELS * PSET_NUM_VOXELS);\r\n\r\n/**\r\n* Class PointSet define set of 3d points\r\n* @class PointSet\r\n*/\r\nexport default class PointSet {\r\n  /**\r\n  * Init all internal data\r\n  * @constructs PointSet\r\n  */\r\n  constructor(numPoints) {\r\n    this.create(numPoints);\r\n  }\r\n  /**\r\n  * create points set, not initialized\r\n  * @param {number} numPoints Number of points in set estimated\r\n  */\r\n  create(numPoints) {\r\n    this.m_numPoints = 0;\r\n    this.m_numAllocatedPoints = numPoints;\r\n    this.m_points = new Array(numPoints);\r\n    this.m_voxels = new Array(PSET_NUM_LINKS);\r\n    for (let i = 0; i < numPoints; i++) {\r\n      this.m_points[i] = new PointLink();\r\n      this.m_points[i].m_point.set(0.0, 0.0, 0.0);\r\n      this.m_points[i].m_next = null;\r\n    } // for (i) all points\r\n  }\r\n  getNumPoints() {\r\n    return this.m_numPoints;\r\n  }\r\n  findPointSlow(x, y, z) {\r\n    for (let i = 0; i < this.m_numPoints; i++) {\r\n      const dx = x - this.m_points[i].m_point.x;\r\n      const dy = y - this.m_points[i].m_point.y;\r\n      const dz = z - this.m_points[i].m_point.z;\r\n      const dist2 = dx * dx + dy * dy + dz * dz;\r\n      const TOO_SMALL = 1.0e-8;\r\n      if (dist2 < TOO_SMALL) {\r\n        return i;\r\n      }\r\n    }\r\n    return -1;\r\n  }\r\n  /**\r\n  * Add point to set\r\n  * @param {number} x coordinate x\r\n  * @param {number} y coordinate y\r\n  * @param {number} z coordinate z\r\n  */\r\n  addPoint(x, y, z) {\r\n    const iSlow = this.findPointSlow(x, y, z);\r\n    // check if exist\r\n    if (iSlow >= 0) {\r\n      return iSlow;\r\n    }\r\n    // check allocated space\r\n    if (this.m_numPoints >= this.m_numAllocatedPoints) {\r\n      return -1;\r\n    }\r\n    // add new point\r\n    const index = this.m_numPoints;\r\n    this.m_points[index] = new PointLink();\r\n    this.m_points[index].m_point.set(x, y, z);\r\n    this.m_points[index].m_next = null;\r\n    this.m_numPoints++;\r\n    return index;\r\n  } // addPoint\r\n\r\n}\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Triangle indices\r\n* @module lib/scripts/actvolume/triindices\r\n*/\r\n\r\n// absolute imports\r\n// import TetrahedronGenerator from 'tetra';\r\n\r\n// relative imports\r\n// import TriangleIndices from './triindices';\r\n\r\n/**\r\n* Class TriangleIndices define 3 indices of triangle\r\n* @class TriangleIndices\r\n*/\r\nexport default class TriangleIndices {\r\n  /**\r\n  * Init all internal data\r\n  * @constructs TriangleIndices\r\n  */\r\n  constructor(ia, ib, ic) {\r\n    const NUM_VERTS_IN_TRIANGLE = 3;\r\n    this.m_indices = new Int32Array(NUM_VERTS_IN_TRIANGLE);\r\n    this.m_indices[0] = ia;\r\n    this.m_indices[1] = ib;\r\n    this.m_indices[2] = ic;\r\n  }\r\n}  // TriangleIndices\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Triangle set\r\n* @module lib/scripts/actvolume/triangleset\r\n*/\r\n\r\n// absolute imports\r\n// import TetrahedronGenerator from 'tetra';\r\n\r\n// relative imports\r\nimport TriangleIndices from './triindices';\r\n\r\n/**\r\n* Class TriangleSet define set of trinagles\r\n* @class TriangleSet\r\n*/\r\nexport default class TriangleSet {\r\n  /**\r\n  * Init all internal data\r\n  * @constructs TriangleSet\r\n  */\r\n  constructor(numTriangles) {\r\n    this.create(numTriangles);\r\n  } // constructor\r\n  create(numTriangles) {\r\n    this.m_numTriangles = 0;\r\n    this.m_numAllocatedTriangles = numTriangles;\r\n    this.m_triangles = new Array(numTriangles);\r\n    const STRANGE_VALUE = -1;\r\n    for (let i = 0; i < numTriangles; i++) {\r\n      this.m_triangles[i] = new TriangleIndices(STRANGE_VALUE, STRANGE_VALUE, STRANGE_VALUE);\r\n    }\r\n  } // create\r\n  /**\r\n  * Get number of triangles\r\n  * @return {number}\r\n  */\r\n  getNumTriangles() {\r\n    return this.m_numTriangles;\r\n  }\r\n  /**\r\n  * Add triangle to set\r\n  * @return 1, if success\r\n  */\r\n  addTriangle(ia, ib, ic) {\r\n    if (this.m_numTriangles >= this.m_numAllocatedTriangles) {\r\n      return -1;\r\n    }\r\n    this.m_triangles[this.m_numTriangles].m_indices[0] = ia;\r\n    this.m_triangles[this.m_numTriangles].m_indices[1] = ib;\r\n    this.m_triangles[this.m_numTriangles].m_indices[2] = ic;\r\n    this.m_numTriangles++;\r\n    return 1;\r\n  }\r\n}\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Single triagle\r\n* @module lib/scripts/actvolume/trianglesingle\r\n*/\r\n\r\n// absolute imports\r\nimport * as THREE from 'three';\r\n\r\n// relative imports\r\n\r\n/**\r\n* Class TriangleSingle is one triangle\r\n* @class TriangleSingle\r\n*/\r\nexport default class TriangleSingle {\r\n  constructor() {\r\n    this.va = new THREE.Vector3();\r\n    this.vb = new THREE.Vector3();\r\n    this.vc = new THREE.Vector3();\r\n  }\r\n}\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Triagle stack\r\n* @module lib/scripts/actvolume/trianglestack\r\n*/\r\n\r\n\r\n// relative imports\r\nimport TriangleSingle from './trianglesingle';\r\n\r\n/**\r\n* Class TriangleStack builds stack for triangles\r\n* @class TriangleStack\r\n*/\r\nexport default class TriangleStack {\r\n  constructor() {\r\n    this.m_numAllocated = 0;\r\n    this.m_numStacked = 0;\r\n    this.m_stack = null;\r\n  }\r\n  /*\r\n  * Create triangle stack\r\n  * @param {number} depthLevel number of triangles in stack\r\n  */\r\n  create(depthLevel) {\r\n    const ESTIM = 20;\r\n    const MUL_INCREMENT = 4;\r\n    let numTiEstimate = ESTIM;\r\n    for (let i = 0; i < depthLevel; i++) {\r\n      numTiEstimate *= MUL_INCREMENT;\r\n    }\r\n    this.m_numAllocated  = numTiEstimate;\r\n    this.m_stack         = new Array(this.m_numAllocated);\r\n    for (let i = 0; i < this.m_numAllocated; i++) {\r\n      this.m_stack[i] = new TriangleSingle();\r\n    }\r\n    this.m_numStacked    = 0;\r\n  } // create\r\n  /*\r\n  * Get stack depth\r\n  * @return {number} number of triangles in stack\r\n  */\r\n  getStackDepth() {\r\n    return this.m_numStacked;\r\n  }\r\n  /*\r\n  * Chech is stack empty\r\n  * @return {boolean} true, if empty\r\n  */\r\n  isEmpty() {\r\n    return (this.m_numStacked === 0);\r\n  }\r\n  /*\r\n  * Push triangle onto stack\r\n  * @param {object} va triangle a (THREE.Vector3)\r\n  * @param {object} vb triangle b (THREE.Vector3)\r\n  * @param {object} vc triangle c (THREE.Vector3)\r\n  */\r\n  push(va, vb, vc) {\r\n    if (this.m_numStacked >= this.m_numAllocated) {\r\n      return -1;\r\n    }\r\n    this.m_stack[this.m_numStacked].va = va;\r\n    this.m_stack[this.m_numStacked].vb = vb;\r\n    this.m_stack[this.m_numStacked].vc = vc;\r\n    this.m_numStacked++;\r\n    return 1;\r\n  } // push triangle\r\n  /*\r\n  * Pop triangle from stack\r\n  * @return {object} TriangleSingle object\r\n  */\r\n  pop() {\r\n    if (this.m_numStacked <= 0) {\r\n      return null;\r\n    }\r\n    this.m_numStacked--;\r\n    return this.m_stack[this.m_numStacked];\r\n  } // pop triangle\r\n\r\n}\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Tetrahedron generator\r\n* @module lib/scripts/actvolume/tetra\r\n*/\r\n\r\n// absolute imports\r\nimport * as THREE from 'three';\r\n\r\n// relative imports\r\nimport PointSet from './pointset';\r\nimport TriangleSet from './triangleset';\r\nimport TriangleStack from './trianglestack';\r\n\r\nconst NUM_VERTICES_TETRA = 12;\r\nconst NUM_TRIANGLES_TETRA = 20;\r\n\r\n/**\r\n* Class TetrahedronGenerator builds good sphere-looked tri mesh\r\n* @class TetrahedronGenerator\r\n*/\r\nexport default class TetrahedronGenerator {\r\n  /**\r\n  * Init all internal data\r\n  * @constructs TetrahedronGenerator\r\n  */\r\n  constructor() {\r\n    this.m_pointSet = null;\r\n    this.m_triangleSet = null;\r\n  }\r\n  /**\r\n  * Create triangle mesh structure\r\n  * @param {number} vRadiusEllipse Ellipse radius\r\n  * @param {number} numSubdividesOfOrigTetra number of sub divides\r\n  */\r\n  create(vRadiusEllipse, numSubdividesOfOrigTetra) {\r\n    // console.log(`vRadiusEllipse = ${vRadiusEllipse}`);\r\n    // console.log(`numSubdividesOfOrigTetra = ${numSubdividesOfOrigTetra}`);\r\n    const X = 0.5257311121;\r\n    const Z = 0.8506508083;\r\n    // { -X, 0.0f, Z },{ X, 0.0f, Z },{ -X, 0.0f, -Z },{ X, 0.0f, -Z },\r\n    // { 0.0f, Z, X },{ 0.0f, Z, -X },{ 0.0f, -Z, X },{ 0.0f, -Z, -X },\r\n    // { Z, X, 0.0f },{ -Z, X, 0.0f },{ Z, -X, 0.0f },{ -Z, -X, 0.0f }\r\n    const vdata = [\r\n      -X, 0.0, +Z,\r\n      +X, 0.0, +Z,\r\n      -X, 0.0, -Z,\r\n      +X, 0.0, -Z,\r\n      0.0, +Z, +X,\r\n      0.0, +Z, -X,\r\n      0.0, -Z, +X,\r\n      0.0, -Z, -X,\r\n      +Z, +X, 0.0,\r\n      -Z, +X, 0.0,\r\n      +Z, -X, 0.0,\r\n      -Z, -X, 0.0,\r\n    ];\r\n    /*eslint-disable no-magic-numbers*/\r\n    const tindices = [\r\n      0, 4, 1, 0, 9, 4, 9, 5, 4, 4, 5, 8, 4, 8, 1,\r\n      8, 10, 1, 8, 3, 10, 5, 3, 8, 5, 2, 3, 2, 7, 3,\r\n      7, 10, 3, 7, 6, 10, 7, 11, 6, 11, 0, 6, 0, 1, 6,\r\n      6, 1, 10, 9, 0, 11, 9, 11, 2, 9, 2, 5, 7, 2, 11\r\n    ];\r\n    this.m_pointSet = new PointSet(NUM_VERTICES_TETRA);\r\n    let i3 = 0;\r\n    for (let i = 0; i < NUM_VERTICES_TETRA; i++, i3 += 3) {\r\n      const x = vdata[i3 + 0];\r\n      const y = vdata[i3 + 1];\r\n      const z = vdata[i3 + 2];\r\n      this.m_pointSet.addPoint(x, y, z);\r\n    } // for (i) all vertices in tetrahedron structure\r\n    // m_triangleSet.create(NUM_TRIANGLES_TETRA);\r\n    this.m_triangleSet = new TriangleSet(NUM_TRIANGLES_TETRA);\r\n    i3 = 0;\r\n    for (let i = 0; i < NUM_TRIANGLES_TETRA; i++, i3 += 3) {\r\n      const ia = tindices[i3 + 0];\r\n      const ib = tindices[i3 + 1];\r\n      const ic = tindices[i3 + 2];\r\n      // use inverse points order to reach correct plane visibility and correct normal directions\r\n      this.m_triangleSet.addTriangle(ia, ic, ib);\r\n    }\r\n    this.subDivideMesh(numSubdividesOfOrigTetra);\r\n\r\n    // scale to given input ellipse\r\n    const numPoints = this.m_pointSet.getNumPoints();\r\n    for (let i = 0; i < numPoints; i++) {\r\n      this.m_pointSet.m_points[i].m_point.x *= vRadiusEllipse.x;\r\n      this.m_pointSet.m_points[i].m_point.y *= vRadiusEllipse.y;\r\n      this.m_pointSet.m_points[i].m_point.z *= vRadiusEllipse.z;\r\n      // console.log(`DEEP DEB. x = ${this.m_pointSet.m_points[i].m_point.x}`);\r\n    } // for (i) all points in set\r\n\r\n    // test save geo into file\r\n    // const TEST_FILE_NAME = 'tetra.obj';\r\n    // this.saveGeoToObjFile(TEST_FILE_NAME);\r\n\r\n    return 1;\r\n  } // create\r\n  getNumTriangles() {\r\n    return this.m_triangleSet.m_numTriangles;\r\n  }\r\n  getNumVertices() {\r\n    return this.m_pointSet.m_numPoints;\r\n  }\r\n  getVertex(i) {\r\n    return this.m_pointSet.m_points[i].m_point;\r\n  }\r\n  getTriangle(i) {\r\n    return this.m_triangleSet.m_triangles[i].m_indices;\r\n  }\r\n  /**\r\n  * Save tetrahedron geometry into given file (PLY type)\r\n  * see PLY format description here:\r\n  * https://en.wikipedia.org/wiki/PLY_(file_format)\r\n  */\r\n  saveGeoToPlyFile(fileName) {\r\n    let strOut = 'ply\\nformat ascii 1.0\\ncomment tetrahedron mesh\\n';\r\n    const numVertices = this.m_pointSet.m_numPoints;\r\n    const strNumVertices = numVertices.toString();\r\n    strOut = strOut.concat('element vertex ');\r\n    strOut = strOut.concat(strNumVertices);\r\n    strOut = strOut.concat('\\n');\r\n    strOut = strOut.concat('property float x\\nproperty float y\\nproperty float z\\n');\r\n    strOut = strOut.concat('element face ');\r\n    const numTriangles = this.m_triangleSet.m_numTriangles;\r\n    const strNumTriangles = numTriangles.toString();\r\n    strOut = strOut.concat(strNumTriangles);\r\n    strOut = strOut.concat('\\n');\r\n    strOut = strOut.concat('property list uchar int vertex_indices\\n');\r\n    strOut = strOut.concat('end_header\\n');\r\n\r\n    // Write vertices\r\n    for (let i = 0; i < numVertices; i++) {\r\n      const vert = this.m_pointSet.m_points[i].m_point;\r\n      const strX = vert.x.toString();\r\n      const strY = vert.y.toString();\r\n      const strZ = vert.z.toString();\r\n      // console.log(`DEEP DEB. xyz = ${strX} ${strY} ${strZ} `);\r\n      strOut = strOut.concat(strX);\r\n      strOut = strOut.concat(' ');\r\n      strOut = strOut.concat(strY);\r\n      strOut = strOut.concat(' ');\r\n      strOut = strOut.concat(strZ);\r\n      strOut = strOut.concat(' 1.0\\n');\r\n    }\r\n    // Write triangles\r\n    for (let i = 0; i < numTriangles; i++) {\r\n      const triIndices = this.m_triangleSet.m_triangles[i].m_indices;\r\n      // console.log(`DEEP DEB. indices = ${triIndices[0]} ${triIndices[1]} ${triIndices[2]} `);\r\n      const strIndices = `3 ${triIndices[0]} ${triIndices[1]} ${triIndices[2]}\\n`;\r\n      strOut = strOut.concat(strIndices);\r\n    }\r\n\r\n    const encoder = new TextEncoder();\r\n    const arr = encoder.encode(strOut);\r\n\r\n    const blob = new Blob([arr], { type: 'application/octet-stream' });\r\n    // saveAs(blob, TEST_FILE_NAME);\r\n    const url = URL.createObjectURL(blob);\r\n    const linkGen = document.createElement('a');\r\n    linkGen.setAttribute('href', url);\r\n    linkGen.setAttribute('download', fileName);\r\n    const eventGen = document.createEvent('MouseEvents');\r\n    eventGen.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\r\n    linkGen.dispatchEvent(eventGen);\r\n  } // saveGeoToPlyFile\r\n  /**\r\n  * Save tetrahedron geometry into given file (OBJ type)\r\n  */\r\n  saveGeoToObjFile(fileName) {\r\n    let strOut = '# Tetrahedron test geo\\n';\r\n    const numVertices = this.m_pointSet.m_numPoints;\r\n    const strNumVertices = numVertices.toString();\r\n    const numTriangles = this.m_triangleSet.m_numTriangles;\r\n    const strNumTriangles = numTriangles.toString();\r\n\r\n    // Write vertices\r\n    for (let i = 0; i < numVertices; i++) {\r\n      const vert = this.m_pointSet.m_points[i].m_point;\r\n      const strX = vert.x.toString();\r\n      const strY = vert.y.toString();\r\n      const strZ = vert.z.toString();\r\n      strOut = strOut.concat('v  ');\r\n      strOut = strOut.concat(strX);\r\n      strOut = strOut.concat(' ');\r\n      strOut = strOut.concat(strY);\r\n      strOut = strOut.concat(' ');\r\n      strOut = strOut.concat(strZ);\r\n      strOut = strOut.concat('\\n');\r\n    }\r\n    // write num verts\r\n    const strNumVerts = `# ${strNumVertices} vertices\\n`;\r\n    strOut = strOut.concat(strNumVerts);\r\n    strOut = strOut.concat('g TetraObj\\n');\r\n\r\n    // Write triangles\r\n    for (let i = 0; i < numTriangles; i++) {\r\n      const triIndices = this.m_triangleSet.m_triangles[i].m_indices;\r\n      // console.log(`DEEP DEB. indices = ${triIndices[0]} ${triIndices[1]} ${triIndices[2]} `);\r\n      const i0 = 1 + triIndices[0];\r\n      const i1 = 1 + triIndices[1];\r\n      const i2 = 1 + triIndices[2];\r\n      const strIndices = `f ${i0} ${i1} ${i2}\\n`;\r\n      strOut = strOut.concat(strIndices);\r\n    }\r\n    // write num tri\r\n    const strNumTri = `# ${strNumTriangles} triangles\\n`;\r\n    strOut = strOut.concat(strNumTri);\r\n\r\n    const encoder = new TextEncoder();\r\n    const arr = encoder.encode(strOut);\r\n\r\n    const blob = new Blob([arr], { type: 'application/octet-stream' });\r\n    // saveAs(blob, TEST_FILE_NAME);\r\n    const url = URL.createObjectURL(blob);\r\n    const linkGen = document.createElement('a');\r\n    linkGen.setAttribute('href', url);\r\n    linkGen.setAttribute('download', fileName);\r\n    const eventGen = document.createEvent('MouseEvents');\r\n    eventGen.initMouseEvent('click', true, true, window, 1, 0, 0, 0, 0, false, false, false, false, 0, null);\r\n    linkGen.dispatchEvent(eventGen);\r\n  } // saveGeoToObjFile\r\n  /*\r\n  * Sub divide source mesh\r\n  * @param {number} numSubdividesOfOrigTetra number of sub divides\r\n  */\r\n  subDivideMesh(numSubdividesOfOrigTetra) {\r\n    if (numSubdividesOfOrigTetra === 0) {\r\n      return 1;\r\n    }\r\n    const triStackSrc = new TriangleStack();\r\n    triStackSrc.create(numSubdividesOfOrigTetra);\r\n    const triStackDst = new TriangleStack();\r\n    triStackDst.create(numSubdividesOfOrigTetra);\r\n\r\n    const numTriangles = this.m_triangleSet.getNumTriangles();\r\n    for (let t = 0; t < numTriangles; t++) {\r\n      const triIndices = this.m_triangleSet.m_triangles[t].m_indices;\r\n      const ia = triIndices[0];\r\n      const ib = triIndices[1];\r\n      const ic = triIndices[2];\r\n      const va = this.m_pointSet.m_points[ia].m_point;\r\n      const vb = this.m_pointSet.m_points[ib].m_point;\r\n      const vc = this.m_pointSet.m_points[ic].m_point;\r\n      const okPush = triStackSrc.push(va, vb, vc);\r\n      if (okPush < 1) {\r\n        return okPush;\r\n      }\r\n    } // for (t) all triangles, push em all\r\n    let stackSrc = triStackSrc;\r\n    let stackDst = triStackDst;\r\n    for (let iter = 0; iter < numSubdividesOfOrigTetra; iter++) {\r\n      const numStacked = stackSrc.getStackDepth();\r\n      for (let s = 0; s < numStacked; s++) {\r\n        // pop tri from stack\r\n        const triSingle = stackSrc.pop();\r\n        if (triSingle === null) {\r\n          return -1;\r\n        }\r\n        const v1 = triSingle.va;\r\n        const v2 = triSingle.vb;\r\n        const v3 = triSingle.vc;\r\n\r\n        // create additional vertices\r\n        const v12 = new THREE.Vector3();\r\n        const v23 = new THREE.Vector3();\r\n        const v31 = new THREE.Vector3();\r\n        v12.addVectors(v1, v2);\r\n        v12.normalize();\r\n        v23.addVectors(v2, v3);\r\n        v23.normalize();\r\n        v31.addVectors(v3, v1);\r\n        v31.normalize();\r\n\r\n        stackDst.push(v1, v12, v31);\r\n        stackDst.push(v2, v23, v12);\r\n        stackDst.push(v3, v31, v23);\r\n        stackDst.push(v12, v23, v31);\r\n      } // for (s) stacked triangles\r\n      // exchange stack\r\n      const stackTmp = stackSrc;\r\n      stackSrc = stackDst;\r\n      stackDst = stackTmp;\r\n    } // for (iter) all stack depth, subdivide iterations\r\n    // now we have stack src\r\n    const numTrisInStack = stackSrc.getStackDepth();\r\n    // vertices should not be more than 12/20 == 0.6\r\n    const estimateNumVertices = Math.floor(numTrisInStack * 3 * 0.6);\r\n    this.m_triangleSet.create(numTrisInStack);\r\n    this.m_pointSet.create(estimateNumVertices);\r\n    // let numTrisFromStack = 0;\r\n    while (!stackSrc.isEmpty()) {\r\n      // V3f va, vb, vc;\r\n      // stackSrc->pop(va, vb, vc);\r\n      const triSingle = stackSrc.pop();\r\n      const va = triSingle.va;\r\n      const vb = triSingle.vb;\r\n      const vc = triSingle.vc;\r\n      const indA = this.m_pointSet.addPoint(va.x, va.y, va.z);\r\n      const indB = this.m_pointSet.addPoint(vb.x, vb.y, vb.z);\r\n      const indC = this.m_pointSet.addPoint(vc.x, vc.y, vc.z);\r\n\r\n      const okAddTri = this.m_triangleSet.addTriangle(indA, indB, indC);\r\n      if (okAddTri !== 1) {\r\n        return okAddTri;\r\n      }\r\n      // numTrisFromStack++;\r\n    } // while\r\n    // assert(m_pointsSet.getNumPoints() <= estimateNumVertices);\r\n    // assert(m_triangleSet.getNumTriangles() <= numTrisInStack);\r\n    const numPts = this.m_pointSet.getNumPoints();\r\n    const numTris = this.m_triangleSet.getNumTriangles();\r\n    const ERR_ESTIMATE = -10;\r\n    if (numPts > estimateNumVertices) {\r\n      return ERR_ESTIMATE;\r\n    }\r\n    if (numTris > numTrisInStack) {\r\n      return ERR_ESTIMATE;\r\n    }\r\n    return 1;\r\n  }\r\n\r\n}\r\n","import MaterialAO from './gfx/matAO';\r\nimport TetrahedronGenerator from './actvolume/tetra';\r\nimport * as THREE from 'three';\r\n\r\n/**\r\n * 3D ambient texture processing engine\r\n * @module lib/scripts/graphics3d/ambientTexture\r\n */\r\nexport default class AmbientTexture {\r\n  constructor(inParams) {\r\n    //this.rendererBlur.render(this.sceneBlur, this.cameraOrtho\r\n    this.rendererBlur = inParams.renderer;\r\n    this.sceneBlur = inParams.scene;\r\n    this.cameraOrtho = inParams.camera;\r\n    this.xDim = inParams.xDim;\r\n    this.yDim = inParams.yDim;\r\n    this.zDim = inParams.zDim;\r\n    this.texVolumeAO = null;\r\n    this.vectorsTex = null;\r\n  }\r\n  _setAOVectorTex() {\r\n    const VAL_4 = 4;\r\n    const VAL_255 = 255;\r\n    const gen = new TetrahedronGenerator();\r\n    const vRadius = new THREE.Vector3(0.5, 0.5, 0.5);\r\n    const NUM_SUBDIVIDES = 2;\r\n    const okCreateTetra = gen.create(vRadius, NUM_SUBDIVIDES);\r\n    if (okCreateTetra < 1) {\r\n      return;\r\n    }\r\n    this.numAOVectors = gen.getNumVertices();\r\n\r\n    this.vectors = new Uint8Array(VAL_4 * this.numAOVectors);\r\n\r\n    for (let i = 0; i < this.numAOVectors; i++) {\r\n      const vert = gen.getVertex(i);\r\n      this.vectors[i * VAL_4 + 0] = (vert.x + 0.5) * VAL_255;\r\n      this.vectors[i * VAL_4 + 1] = (vert.y + 0.5) * VAL_255;\r\n      this.vectors[i * VAL_4 + 2] = (vert.z + 0.5) * VAL_255;\r\n      this.vectors[i * VAL_4 + 3] = VAL_255;\r\n    }\r\n\r\n    this.vectorsTex = new THREE.DataTexture(this.vectors, this.numAOVectors, 1, THREE.RGBAFormat);\r\n    this.vectorsTex.wrapS = THREE.ClampToEdgeWrapping;\r\n    this.vectorsTex.wrapT = THREE.ClampToEdgeWrapping;\r\n    this.vectorsTex.magFilter = THREE.NearestFilter;\r\n    this.vectorsTex.minFilter = THREE.NearestFilter;\r\n    this.vectorsTex.needsUpdate = true;\r\n  }\r\n  set(texVolume, isoThreshold) {\r\n    if (this.vectorsTex === null) {\r\n      this._setAOVectorTex();\r\n    }\r\n    this.xDimAO = this.xDim;\r\n    this.yDimAO = this.yDim;\r\n    this.zDimAO = this.zDim;\r\n    this.bufferTextureAO = new THREE.WebGLRenderTarget(this.xDimAO,\r\n      this.yDimAO, {\r\n        minFilter: THREE.LinearFilter,\r\n        magFilter: THREE.LinearFilter,\r\n        format: THREE.RGBAFormat,\r\n        type: THREE.UnsignedByteType,\r\n        depthBuffer: false,\r\n      });\r\n\r\n    this.ambientVolumeTexCPU = new Uint8Array(this.xDimAO * this.yDimAO * this.zDimAO);\r\n    if (this.isWebGL2 === 0) {\r\n      this.texVolumeAO = new THREE.DataTexture(this.ambientVolumeTexCPU, this.xTex, this.yTex, THREE.AlphaFormat);\r\n    } else {\r\n      this.texVolumeAO = new THREE.DataTexture3D(this.ambientVolumeTexCPU, this.xDimAO, this.yDimAO, this.zDimAO);\r\n      this.texVolumeAO.format = THREE.RedFormat;\r\n      //this.texVolumeAO.type = THREE.UnsignedByteType;\r\n    }\r\n    this.texVolumeAO.wrapS = THREE.ClampToEdgeWrapping;\r\n    this.texVolumeAO.wrapT = THREE.ClampToEdgeWrapping;\r\n    this.texVolumeAO.wrapR = THREE.ClampToEdgeWrapping;\r\n    this.texVolumeAO.magFilter = THREE.LinearFilter;\r\n    this.texVolumeAO.minFilter = THREE.LinearFilter;\r\n    this.texVolumeAO.needsUpdate = true;\r\n\r\n    const texelSize = new THREE.Vector3(1.0 / this.xDim, 1.0 / this.yDim, 1.0 / this.zDim);\r\n    const matAO = new MaterialAO();\r\n    matAO.create(texVolume, texelSize, this.vectorsTex, this.numAOVectors, isoThreshold, (mat) => {\r\n      this.materialAO = mat;\r\n      mat.uniforms.tileCountX.value = this.zTexDivSqrt;\r\n      mat.uniforms.volumeSizeZ.value = this.zDim;\r\n      this.setAmbientTextureWebGL2();\r\n      this.texVolumeAO.needsUpdate = true;\r\n    });\r\n  }\r\n  setAmbientTextureWebGL2() {\r\n    const VAL_4 = 4;\r\n    const frameBuf = new Uint8Array(VAL_4 * this.xDimAO * this.yDimAO);\r\n    const gl = this.rendererBlur.getContext();\r\n    console.log('AO WebGL2');\r\n    for (let z = 0; z < this.zDimAO; ++z) {\r\n      this.materialAO.uniforms.curZ.value = z / (this.zDimAO - 1);\r\n      this.materialAO.uniforms.curZ.needsUpdate = true;\r\n      this.sceneBlur.overrideMaterial = this.materialAO;\r\n      this.rendererBlur.render(this.sceneBlur, this.cameraOrtho, this.bufferTextureAO);\r\n      this.sceneBlur.overrideMaterial = null;\r\n      gl.readPixels(0, 0, this.xDimAO, this.yDimAO, gl.RGBA, gl.UNSIGNED_BYTE, frameBuf);\r\n      const zOffs = z * this.xDimAO * this.yDimAO;\r\n      for (let y = 0; y < this.yDimAO; y++) {\r\n        for (let x = 0; x < this.xDimAO; x++) {\r\n          this.ambientVolumeTexCPU[x + y * this.xDimAO + zOffs] = \r\n            frameBuf[VAL_4 * (x + y * this.xDimAO)]; //256.0 * k / this.zDim;\r\n        }\r\n      }\r\n    }\r\n    console.log('AO WebGL2 End');\r\n  }\r\n  get() {\r\n    return this.texVolumeAO;\r\n  }\r\n}","/* eslint-disable no-magic-numbers */\r\n/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n * 3D volume processing engine: transfer texture\r\n * @module lib/scripts/graphics3d/transferTexture\r\n */\r\nimport * as THREE from 'three';\r\n/** Class for transfer texture computation and rendering */\r\nexport default class TransferTexture {\r\n  constructor() {    \r\n    this.selectedROIs = null;\r\n    this.transferFuncRgba = null;\r\n    this.transferFuncTexture = null;\r\n    this.texRoiColor = null;\r\n    this.texRoiId = null;    \r\n    this.numRois = 256;\r\n    this.m_handleColors = [\r\n      { r: 0, g: 0, b: 0 },\r\n      { r: 255, g: 128, b: 64 },\r\n      { r: 255, g: 0, b: 0 },\r\n      { r: 128, g: 64, b: 64 },\r\n      { r: 128, g: 0, b: 0 },\r\n      { r: 64, g: 64, b: 64 },\r\n      { r: 128, g: 128, b: 128 },\r\n      { r: 192, g: 192, b: 192 },\r\n      { r: 255, g: 255, b: 255 },\r\n      { r: 255, g: 255, b: 255 },\r\n    ];\r\n  }\r\n  /**\r\n   * Filtering the source data and building the normals on the GPU\r\n   * @param isRoiVolume\r\n   * @param roiColors Array of roi colors in RGBA format\r\n   */\r\n  init(isRoiVolume, roiColors) {\r\n    const c4 = 4; \r\n    // eslint-disable-next-line\r\n    this.selectedROIs = new Uint8Array(c4 * this.numRois);\r\n    this.numTfPixels = 256;\r\n    // eslint-disable-next-line\r\n    this.transferFuncRgba = new Uint8Array(c4 * this.numTfPixels);\r\n    this.texRoiColor = null;\r\n    if (isRoiVolume) {\r\n      this.texRoiId = this.createSelectedRoiMap();\r\n      this.texRoiColor = this.createRoiColorMap(roiColors);\r\n    }    \r\n  }\r\n  /**\r\n   * Create 2D texture containing transfer func colors\r\n  */\r\n  createTransferFuncTexture() {\r\n    let textureOut = null;\r\n    let alpha = 0;\r\n    const SCALE = 255;\r\n    const SCALE1 = 12.0;\r\n    const SCALE2 = 3.0;\r\n    const A1 = 0.09;\r\n    const A2 = 0.2;\r\n    const A3 = 0.3;\r\n    const A4 = 0.43;\r\n    const A5 = 0.53;\r\n    const a1 = A1 * SCALE;\r\n    const a2 = A2 * SCALE;\r\n    const a3 = A3 * SCALE;\r\n    const a4 = A4 * SCALE;\r\n    const a5 = A5 * SCALE;\r\n    const COLOR_R = 255;\r\n    const COLOR_G = 210;\r\n    const COLOR_B = 180;\r\n    const FOUR = 4;\r\n    for (let pix = 0; pix < this.numTfPixels; pix++) {\r\n      if (pix > a1 && pix < a2) {\r\n        alpha = (pix - a1) / (a2 - a1);\r\n      }\r\n      if (pix > a2 && pix < a3) {\r\n        alpha = (a3 - pix) / (a3 - a2);\r\n      }\r\n      if (pix > a4 && pix < a5) {\r\n        alpha = (pix - a4) / (a5 - a4);\r\n      }\r\n      if (pix > a5) {\r\n        alpha = 1;\r\n      }\r\n      // eslint-disable-next-line\r\n      this.transferFuncRgba[pix * FOUR + 0] = SCALE;\r\n      // eslint-disable-next-line\r\n      this.transferFuncRgba[pix * FOUR + 1] = 0;\r\n      // eslint-disable-next-line\r\n      this.transferFuncRgba[pix * FOUR + 1 + 1] = 0;\r\n      // eslint-disable-next-line\r\n      this.transferFuncRgba[pix * FOUR + 1 + 1 + 1] = SCALE * alpha / SCALE1;\r\n      if (pix > a4) {\r\n        this.transferFuncRgba[pix * FOUR + 0] = COLOR_R;\r\n        // eslint-disable-next-line\r\n        this.transferFuncRgba[pix * FOUR + 1] = COLOR_G;\r\n        // eslint-disable-next-line\r\n        this.transferFuncRgba[pix * FOUR + 1 + 1] = COLOR_B;\r\n        this.transferFuncRgba[pix * FOUR + 1 + 1 + 1] = SCALE * alpha / SCALE2;\r\n      }\r\n    }\r\n    textureOut = new THREE.DataTexture(this.transferFuncRgba, this.numTfPixels, 1, THREE.RGBAFormat);\r\n    textureOut.wrapS = THREE.ClampToEdgeWrapping;\r\n    textureOut.wrapT = THREE.ClampToEdgeWrapping;\r\n    textureOut.magFilter = THREE.NearestFilter;\r\n    textureOut.minFilter = THREE.NearestFilter;\r\n    textureOut.needsUpdate = true;\r\n    this.transferFuncTexture = textureOut;\r\n    return textureOut;\r\n  }\r\n  /**\r\n   * Creates transfer function color map\r\n   * @param ctrlPts Array of control points of type HEX  = color value\r\n   */\r\n  setTransferFuncColors(colors) {\r\n    this.transferFuncCtrlPtsRgb = [];\r\n    for (let i = 0; i < colors.length; i++) {\r\n      this.transferFuncCtrlPtsRgb.push(new THREE.Vector3(colors[i].r, colors[i].g, colors[i].b));\r\n    }\r\n  }\r\n  /**\r\n   * Creates transfer function color map\r\n   * @param ctrlPts Array of Vector2 where (x,y) = x coordinate in [0, 1], alpha value in [0, 1]\r\n   */\r\n  updateTransferFuncTexture(intensities, opacities) {\r\n    if (this.transferFuncRgba === null) {\r\n      return null;\r\n    }\r\n    for (let curPt = 0; curPt < intensities.length - 1; curPt++) {\r\n      const pixStart = Math.floor(intensities[curPt]);\r\n      const pixEnd = Math.floor(intensities[curPt + 1]);\r\n      for (let pix = pixStart; pix < pixEnd; pix++) {\r\n        const lerpVal = (pix - pixStart) / (pixEnd - pixStart);\r\n        const colorX = (1.0 - lerpVal) * this.m_handleColors[curPt].r + lerpVal * this.m_handleColors[curPt + 1].r\r\n        const colorY = (1.0 - lerpVal) * this.m_handleColors[curPt].g + lerpVal * this.m_handleColors[curPt + 1].g;\r\n        const colorZ = (1.0 - lerpVal) * this.m_handleColors[curPt].b + lerpVal * this.m_handleColors[curPt + 1].b;\r\n        // eslint-disable-next-line\r\n        this.transferFuncRgba[pix * 4 + 0] = colorX;\r\n        // eslint-disable-next-line\r\n        this.transferFuncRgba[pix * 4 + 1] = colorY;\r\n        // eslint-disable-next-line\r\n        this.transferFuncRgba[pix * 4 + 2] = colorZ;\r\n        // eslint-disable-next-line\r\n        const op1 = (opacities[curPt] > 0.0) ? opacities[curPt] : 0.0;\r\n        const op2 = (opacities[curPt + 1] > 0.0) ? opacities[curPt + 1] : 0.0;\r\n        this.transferFuncRgba[pix * 4 + 3] = (op2 * lerpVal + (1.0 - lerpVal) * op1) * 255;\r\n      }\r\n    }\r\n    this.transferFuncTexture.needsUpdate = true;\r\n    return this.transferFuncRgba;\r\n  }\r\n  /**\r\n   * Create 2D texture containing roi color map\r\n   * @param colorArray 256 RGBA roi colors\r\n   */\r\n  createRoiColorMap(colorArray) {\r\n    let textureOut = null;\r\n    if (colorArray !== null) {\r\n      //textureOut = new THREE.DataTexture(colorArray, this.numRois, 1, THREE.RGBAFormat);\r\n      textureOut = new THREE.DataTexture(colorArray, 256, 1, THREE.RGBAFormat);\r\n    } else {\r\n      // eslint-disable-next-line\r\n      const colorROIs = new Uint8Array(4 * this.numRois);\r\n      for (let pix = 0; pix < this.numRois; pix++) {\r\n        // eslint-disable-next-line\r\n        colorROIs[pix * 4 + 0] = 255;\r\n        // eslint-disable-next-line\r\n        colorROIs[pix * 4 + 1] = 0;\r\n        // eslint-disable-next-line\r\n        colorROIs[pix * 4 + 2] = 0;\r\n        // eslint-disable-next-line\r\n        colorROIs[pix * 4 + 3] = 255;\r\n      }\r\n      textureOut = new THREE.DataTexture(colorROIs, this.numRois, 1, THREE.RGBAFormat);\r\n    }\r\n    textureOut.wrapS = THREE.ClampToEdgeWrapping;\r\n    textureOut.wrapT = THREE.ClampToEdgeWrapping;\r\n    textureOut.magFilter = THREE.NearestFilter;\r\n    textureOut.minFilter = THREE.NearestFilter;\r\n    textureOut.needsUpdate = true;\r\n    return textureOut;\r\n  }\r\n  /**\r\n   * Create 2D texture containing selected ROIs\r\n   */\r\n  createSelectedRoiMap() {\r\n    const a1 = 50;\r\n    const a2 = 240;\r\n    const c1 = 1;\r\n    const c2 = 2;\r\n    const c3 = 3;\r\n    const BYTES_IN_COLOR = 4;\r\n    for (let pix = 0; pix < this.numRois; pix++) {\r\n      if (pix < a1 || pix > a2) {\r\n        this.selectedROIs[pix * BYTES_IN_COLOR] = 0;\r\n      } else {\r\n        this.selectedROIs[pix * BYTES_IN_COLOR] = 255;\r\n      }\r\n      this.selectedROIs[pix * BYTES_IN_COLOR + c1] = 0;\r\n      this.selectedROIs[pix * BYTES_IN_COLOR + c2] = 0;\r\n      this.selectedROIs[pix * BYTES_IN_COLOR + c3] = 0;\r\n    }\r\n    //const textureOut = new THREE.DataTexture(this.selectedROIs, this.numRois, 1, THREE.RGBAFormat);\r\n    const textureOut = new THREE.DataTexture(this.selectedROIs, 256, 1, THREE.RGBAFormat);\r\n    textureOut.wrapS = THREE.ClampToEdgeWrapping;\r\n    textureOut.wrapT = THREE.ClampToEdgeWrapping;\r\n    textureOut.magFilter = THREE.NearestFilter;\r\n    textureOut.minFilter = THREE.NearestFilter;\r\n    textureOut.needsUpdate = true;\r\n    return textureOut;\r\n  }\r\n  /**\r\n   * Create 2D texture containing selected ROIs\r\n   * @param selectedROIs 256 byte roi values\r\n   */\r\n  updateSelectedRoiMap(selectedROI) {\r\n    const roiTexelBpp = 4;\r\n    const roiSelectedTrue = 255;\r\n    const roiSelectedFalse = 0;\r\n    for (let pix = 0; pix < this.numRois; pix++) {\r\n      if (selectedROI[pix]) {\r\n        this.selectedROIs[pix * roiTexelBpp] = roiSelectedTrue;\r\n      } else {\r\n        this.selectedROIs[pix * roiTexelBpp] = roiSelectedFalse;\r\n      }\r\n    }\r\n    this.texRoiId.needsUpdate = true;\r\n    //this.setVolumeTexture(1.0);\r\n  }\r\n  /**\r\n   * Update roi selection map\r\n   * @param roiId ROI id from 0..255\r\n   * @param selectedState True if roi must be visible\r\n   */\r\n  // eslint-disable-next-line\r\n  updateSelectedRoi(roiId, selectedState) {\r\n    const roiTexelBpp = 4;\r\n    const roiChecked = 255;\r\n    const roiUnchecked = 0;\r\n    if (selectedState) {\r\n      this.selectedROIs[roiTexelBpp * roiId] = roiChecked;\r\n    } else {\r\n      this.selectedROIs[roiTexelBpp * roiId] = roiUnchecked;\r\n    }\r\n    console.log(`initMatBlure: ${this.initMatBlure}`);\r\n    this.texRoiId.needsUpdate = true;\r\n    //this.setVolumeTexture(1.0);\r\n  }\r\n} // class TransferTexture","/**\r\n * @fileOverview Eraser\r\n * @author Epam\r\n * @version 1.0.0\r\n */\r\n// ********************************************************\r\n// Imports\r\n// ********************************************************/**\r\nimport * as THREE from 'three';\r\n// ********************************************************\r\n// Class Eraser is used for erasing of volume data part\r\n// ********************************************************\r\nexport default class Eraser {\r\n  constructor() {\r\n    this.bufferBF = null;\r\n    this.bufferFF = null;\r\n    this.bufferRenderToTexture = null;\r\n    this.isoThreshold = 0;\r\n    this.volTextureMask = null;\r\n    this.geometry = null;\r\n    this.lastSize = [];\r\n    this.lastDepth = [];\r\n    this.lastRotationVector = [];\r\n    this.lastTarget = [];\r\n    this.lastMode = [];\r\n    this.lastBackDistance = [];\r\n    this.resetflag = false;\r\n    this.bufferTextureCPU = null;\r\n  }\r\n  createUpdatableVolumeMask(params, buff) {\r\n    this.xDim = params.xDim;\r\n    this.yDim = params.yDim;\r\n    this.zDim = params.zDim;\r\n    this.bufferBF = params.bufBF;\r\n    this.bufferFF = params.bufFF;\r\n    this.bufferRenderToTexture = params.bufTex;\r\n    this.bufferMask = new Uint8Array(this.xDim * this.yDim * this.zDim);\r\n    this.bufferTextureCPU = buff;\r\n    for (let z = 0; z < this.zDim; z++) {\r\n      for (let y = 0; y < this.yDim; y++) {\r\n        for (let x = 0; x < this.xDim; x++) {\r\n          this.bufferMask[x + y * this.xDim + z * this.xDim * this.yDim] = 255;\r\n        }\r\n      }\r\n    }\r\n    if (this.updatableTextureMask) {\r\n      this.updatableTextureMask.dispose();\r\n    }\r\n    this.updatableTextureMask = new THREE.DataTexture3D(this.bufferMask, this.xDim, this.yDim, this.zDim);\r\n    this.updatableTextureMask.format = THREE.RedFormat;\r\n    this.updatableTextureMask.type = THREE.UnsignedByteType;\r\n    this.updatableTextureMask.wrapS = THREE.ClampToEdgeWrapping;\r\n    this.updatableTextureMask.wrapT = THREE.ClampToEdgeWrapping;\r\n    this.updatableTextureMask.magFilter = THREE.LinearFilter;\r\n    this.updatableTextureMask.minFilter = THREE.LinearFilter;\r\n    this.updatableTextureMask.needsUpdate = true;\r\n    return this.updatableTextureMask;\r\n  }\r\n  eraseStart(xx, yy, windowWidth, isoThreshold, startflag) {\r\n    this.isoThreshold = isoThreshold;\r\n    const x = Math.round(xx);\r\n    const y = Math.round(yy);\r\n    this.eraserMouseDown = true;\r\n    const OFF0 = 0;\r\n    const OFF1 = 1;\r\n    const OFF2 = 2;\r\n    const OFF3 = 3;\r\n    const GPU_CELL_SIZE = 4;\r\n    const cellInd = (y * windowWidth + x) * GPU_CELL_SIZE;\r\n    const THREE3 = 3;\r\n    const bigCellInd = (Math.floor(y / THREE3) * Math.floor(windowWidth / THREE3) +\r\n      Math.floor(x / THREE3)) * GPU_CELL_SIZE;\r\n    const dist = this.bufferRenderToTexture[bigCellInd + OFF3];\r\n    const NO_MATERIAL = 2;\r\n    if (dist === NO_MATERIAL) {\r\n      return;\r\n    }\r\n    let vX = this.bufferBF[cellInd + OFF0] - this.bufferFF[cellInd + OFF0];\r\n    let vY = this.bufferBF[cellInd + OFF1] - this.bufferFF[cellInd + OFF1];\r\n    let vZ = this.bufferBF[cellInd + OFF2] - this.bufferFF[cellInd + OFF2];\r\n    const vDir = new THREE.Vector3(vX, vY, vZ);\r\n    const length = Math.sqrt(vX * vX + vY * vY + vZ * vZ);\r\n    const COORD_SHIFT = 0.5;\r\n    vX = vX / length * dist + COORD_SHIFT + this.bufferFF[cellInd + OFF0];\r\n    vY = vY / length * dist + COORD_SHIFT + this.bufferFF[cellInd + OFF1];\r\n    vZ = vZ / length * dist + COORD_SHIFT + this.bufferFF[cellInd + OFF2];\r\n    this.erasePixels(vX, vY, vZ, vDir, startflag, dist);\r\n    this.updatableTextureMask.needsUpdate = true;\r\n  }\r\n  onMouseUp() {\r\n    this.orbitControl.onMouseUp();\r\n    this.lockEraserBuffersUpdating = false;\r\n    this.eraserMouseDown = false;\r\n    this.renderState = this.RENDER_STATE.ONCE;\r\n  }\r\n  setEraserRadius(radius) {\r\n    this.radius = radius;\r\n  }\r\n  setEraserDepth(depth) {\r\n    this.depth = depth;\r\n  }\r\n  erasePixels(x_, y_, z_, vDir, startflag, length) {\r\n    const targetX = Math.floor(x_ * this.xDim);\r\n    const targetY = Math.floor(y_ * this.yDim);\r\n    const targetZ = Math.floor(z_ * this.zDim);\r\n    const normal = new THREE.Vector3();\r\n    const normalGauss = new THREE.Vector3();\r\n    const GAUSS_R = 2;\r\n    const SIGMA = 1.4;\r\n    const SIGMA2 = SIGMA * SIGMA;\r\n    let nX = 0;\r\n    let nY = 0;\r\n    let nZ = 0;\r\n    let normFactor = 0;\r\n    let offDst = 0;\r\n    const VAL_2 = 2; // getting normal of surface\r\n    for (let k = -Math.min(GAUSS_R, targetZ); k <= Math.min(GAUSS_R, this.zDim - 1 - targetZ); k++) {\r\n      for (let j = -Math.min(GAUSS_R, targetY); j <= Math.min(GAUSS_R, this.yDim - 1 - targetY); j++) {\r\n        for (let i = -Math.min(GAUSS_R, targetX); i <= Math.min(GAUSS_R, this.xDim - 1 - targetX); i++) {\r\n          // handling voxel: (targetX + i; ,targetY+ j; targetZ + k);\r\n          const gX = targetX + i;\r\n          const gY = targetY + j;\r\n          const gZ = targetZ + k;\r\n          offDst = gX + gY * this.xDim + gZ * this.xDim * this.yDim;\r\n          const gauss = 1 - Math.exp(-(i * i + j * j + k * k) / (VAL_2 * SIGMA2));\r\n          normFactor += gauss;\r\n          const curVal = this.bufferTextureCPU[offDst];\r\n          nX += curVal * gauss * (-i / SIGMA2);\r\n          nY += curVal * gauss * (-j / SIGMA2);\r\n          nZ += curVal * gauss * (-k / SIGMA2);\r\n        }\r\n      }\r\n    }// end gauss summation\r\n    normalGauss.set(nX / normFactor, nY / normFactor, nZ / normFactor);\r\n    normal.copy(normalGauss);\r\n    normal.normalize();\r\n    const pi = 180;// pi (just for console output)\r\n    const radiusRatio = this.xDim / this.zDim;\r\n    const geometry = new THREE.CylinderGeometry(this.radius, this.radius, this.depth, pi, this.depth);\r\n    const mesh = new THREE.Mesh(geometry, null);\r\n    const axis = new THREE.Vector3(0, 0, 1);\r\n    mesh.quaternion.setFromUnitVectors(axis, normal.clone().normalize().multiplyScalar(-1));\r\n    mesh.position.copy(new THREE.Vector3(targetX, targetY, targetZ));\r\n\r\n    if (startflag === true) {\r\n      this.prevDistance = length;\r\n      this.resetflag = false;\r\n    }\r\n    const radius = 0.05;\r\n    if (this.resetflag === false) {\r\n      if (Math.abs(this.prevDistance - length) < radius) {\r\n        this.prevDistance = length;\r\n        this.point = new THREE.Vector3(0, 0, 0);\r\n        this.queue = [];\r\n        this.queue.push(this.point);\r\n        const normalBack = -5;\r\n        let backZ = 0;\r\n        backZ = normalBack;\r\n        let deleteflag = false;\r\n        while (this.queue.length > 0) {\r\n          this.point = this.queue.pop();\r\n          const RotPoint = this.point.clone();\r\n          RotPoint.z *= radiusRatio;\r\n          RotPoint.applyAxisAngle(new THREE.Vector3(1, 0, 0), -mesh.rotation.x);\r\n          RotPoint.applyAxisAngle(new THREE.Vector3(0, 1, 0), -mesh.rotation.y);\r\n          RotPoint.applyAxisAngle(new THREE.Vector3(0, 0, 1), mesh.rotation.z);\r\n          if (Math.sqrt(RotPoint.x * RotPoint.x + RotPoint.y * RotPoint.y) > this.radius ||\r\n            Math.abs(RotPoint.z) > this.depth || RotPoint.z < backZ) {\r\n            continue;\r\n          }\r\n          for (let x = this.point.x - 1; x <= this.point.x + 1; x++) {\r\n            for (let y = this.point.y - 1; y <= this.point.y + 1; y++) {\r\n              for (let z = this.point.z - 1; z <= this.point.z + 1; z++) {\r\n                const mainX = targetX + Math.round(x);\r\n                const mainY = targetY + Math.round(y);\r\n                const mainZ = targetZ + Math.round(z);\r\n                offDst = mainX + mainY * this.xDim + mainZ * this.xDim * this.yDim;\r\n                if (this.bufferMask[offDst] === 0) {\r\n                  continue;\r\n                }\r\n                const bitconst = 255.0;\r\n                const borderinclude = 0.01;\r\n                const isoSurfaceBorder = this.isoThreshold * bitconst - borderinclude * bitconst;\r\n                if (this.bufferTextureCPU[offDst] >= isoSurfaceBorder) {\r\n                  deleteflag = true;\r\n                  this.bufferMask[offDst] = 0;\r\n                  this.queue.push(new THREE.Vector3(x, y, z));\r\n                }\r\n              }\r\n            }\r\n          }\r\n        }\r\n        if (deleteflag === true) {\r\n          this.lastSize.push(this.radius);\r\n          this.lastDepth.push(this.depth);\r\n          this.lastRotationVector.push(new THREE.Vector3(-mesh.rotation.x, -mesh.rotation.y, mesh.rotation.z));\r\n          this.lastTarget.push(new THREE.Vector3(targetX, targetY, targetZ));\r\n          this.lastBackDistance.push(-Math.round(Math.abs(Math.tan(vDir.normalize().angleTo(normalGauss.normalize())))\r\n            * (this.radius)));\r\n        } \r\n        this.updatableTextureMask.needsUpdate = true;\r\n        \r\n      } else {\r\n        this.resetflag = false;\r\n      }\r\n    }\r\n  }\r\n  undoLastErasing() {\r\n    if (this.lastSize.length === 0) {\r\n      return;\r\n    }\r\n    const targetLast = this.lastTarget.pop();\r\n    const lastRotation = this.lastRotationVector.pop();\r\n    const rxy = Math.round(this.lastSize.pop());\r\n    const lastDepth = this.lastDepth.pop();\r\n    const lastback = this.lastBackDistance.pop();\r\n    const radiusRatio = this.xDim / this.zDim;\r\n    this.point = new THREE.Vector3(0, 0, 0);\r\n    this.queue = [];\r\n    this.queue.push(this.point);\r\n    while (this.queue.length > 0) {\r\n      this.point = this.queue.pop();\r\n      const RotPoint = this.point.clone();\r\n      RotPoint.z *= radiusRatio;\r\n      RotPoint.applyAxisAngle(new THREE.Vector3(1, 0, 0), lastRotation.x);\r\n      RotPoint.applyAxisAngle(new THREE.Vector3(0, 1, 0), lastRotation.y);\r\n      RotPoint.applyAxisAngle(new THREE.Vector3(0, 0, 1), lastRotation.z);\r\n      if (Math.sqrt(RotPoint.x * RotPoint.x + RotPoint.y * RotPoint.y) > rxy ||\r\n        RotPoint.z > lastDepth || RotPoint.z < lastback) {\r\n        continue;\r\n      }\r\n      let offDst = 0;\r\n      for (let x = this.point.x - 1; x <= this.point.x + 1; x++) {\r\n        for (let y = this.point.y - 1; y <= this.point.y + 1; y++) {\r\n          for (let z = this.point.z - 1; z <= this.point.z + 1; z++) {\r\n            const mainX = targetLast.x + Math.round(x);\r\n            const mainY = targetLast.y + Math.round(y);\r\n            const mainZ = targetLast.z + Math.round(z);\r\n            offDst = mainX + mainY * this.xDim + mainZ * this.xDim * this.xDim;\r\n            if (this.bufferMask[offDst] === 0) {\r\n              this.bufferMask[offDst] = 255.0;\r\n              this.queue.push(new THREE.Vector3(x, y, z));\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    this.updatableTextureMask.needsUpdate = true;\r\n  }\r\n} // class Eraser\r\n","\r\n/**\r\n * 3D volume processing engine: blur, contrast filter\r\n * @module lib/scripts/graphics3d/volumeFilter3d\r\n */\r\n\r\nimport * as THREE from 'three';\r\nimport MaterialBlur from './gfx/matblur';\r\nimport GlSelector from './GlSelector';\r\nimport AmbientTexture from './ambientTexture';\r\nimport TransferTexture from './transferTexture'\r\nimport Eraser from './Eraser';\r\n/** Class VolumeFilter3d is used for 3d render */\r\nexport default class VolumeFilter3d {\r\n  constructor() {\r\n    this.transferFunc = null;\r\n    this.xDim = 0;\r\n    this.yDim = 0;\r\n    this.zDim = 0;\r\n    this.bufferTextureCPU = null;\r\n    this.eraser = null;\r\n  }\r\n  /**\r\n   * Filtering the source data and building the normals on the GPU\r\n   * @param isRoiVolume\r\n   * @param roiColors Array of roi colors in RGBA format\r\n   */\r\n  initRenderer(isRoiVolume, roiColors) {\r\n    this.sceneBlur = new THREE.Scene();\r\n    const blurSigma = 0.8;\r\n    this.numRois = 256;\r\n    // eslint-disable-next-line\r\n    this.cameraOrtho = new THREE.OrthographicCamera(this.xDim / -2, this.xDim / 2, this.yDim / 2, this.yDim / -2, 0.1, 100);\r\n    const glSelector = new GlSelector();\r\n    this.context = glSelector.createWebGLContext();\r\n    this.canvas3d = glSelector.getCanvas();\r\n    this.rendererBlur = new THREE.WebGLRenderer({\r\n      canvas: this.canvas3d,\r\n      context: this.context\r\n    });\r\n    this.ambientTexture = new AmbientTexture({\r\n      xDim: this.xDim,\r\n      yDim: this.yDim,\r\n      zDim: this.zDim,\r\n      renderer: this.rendererBlur,\r\n      scene: this.sceneBlur,\r\n      camera: this.cameraOrtho,\r\n    });\r\n\r\n    console.log('rendererBlur done');\r\n    const geometryBlur = new THREE.PlaneGeometry(1.0, 1.0);\r\n    this.rendererBlur.setSize(this.xDim, this.yDim);\r\n    //\r\n    this.transferFunc = new TransferTexture();\r\n    this.transferFunc.init(isRoiVolume, roiColors);\r\n    const texelSize = new THREE.Vector3(1.0 / this.xDim, 1.0 / this.yDim, 1.0 / this.zDim);\r\n    const matBlur = new MaterialBlur();\r\n\r\n    matBlur.create(this.origVolumeTex, this.RoiVolumeTex, texelSize, this.transferFunc.texRoiColor, this.transferFunc.texRoiId, (mat) => {\r\n      const mesh = new THREE.Mesh(geometryBlur, mat);\r\n      mat.uniforms.volumeSizeZ.value = this.zDim;\r\n      mat.uniforms.xDim.value = this.xDim;\r\n      mat.uniforms.yDim.value = this.yDim;\r\n      mat.defines.useWebGL2 = this.isWebGL2;\r\n      this.material = mat;\r\n      this.sceneBlur.add(mesh);\r\n      if (isRoiVolume === false) {\r\n        this.switchToBlurRender();\r\n      } else {\r\n        this.switchToRoiMapRender();\r\n      }\r\n      // render with blur and copy pixels back to this.bufferRgba\r\n      console.log(`isRoiVolume: ${isRoiVolume}`);\r\n      this.setVolumeTexture(blurSigma);\r\n    });\r\n    this.vectorsTex = null;\r\n  }\r\n  /**\r\n   * Create 2D texture containing transfer func colors\r\n  */\r\n  createTransferFuncTexture() {\r\n    if (this.transferFunc !== null) {\r\n      return this.transferFunc.createTransferFuncTexture();\r\n    }\r\n    return null;\r\n  }\r\n  /**\r\n   * Creates transfer function color map\r\n   * @param ctrlPts Array of control points of type HEX  = color value\r\n   */\r\n  setTransferFuncColors(ctrlPtsColorsHex) {\r\n    this.transferFunc.setTransferFuncColors(ctrlPtsColorsHex);\r\n  }\r\n  /**\r\n   * Creates transfer function color map\r\n   * @param ctrlPts Array of Vector2 where (x,y) = x coordinate in [0, 1], alpha value in [0, 1]\r\n   * //intensity [0,255] opacity [0,1]\r\n   */\r\n  updateTransferFuncTexture(intensities, opacities) {\r\n    return this.transferFunc.updateTransferFuncTexture(intensities, opacities);\r\n  }\r\n  /**\r\n   * Setting a variable for conditional compilation (Roi Render)\r\n   */\r\n  switchToRoiMapRender() {\r\n    this.material.defines.renderRoiMap = 1;\r\n    this.material.needsUpdate = true;\r\n  }\r\n  /**\r\n   * Setting a variable for conditional compilation (Blur)\r\n   */\r\n  switchToBlurRender() {\r\n    this.material.defines.renderRoiMap = 0;\r\n    this.material.needsUpdate = true;\r\n  }\r\n  /**\r\n   * Filtering the source data and building the normals on the GPU\r\n   * @param blurSigma Gauss sigma parameter\r\n   */\r\n  setVolumeTexture(blurSigma) {\r\n    if ((!this.material) || (typeof this.material === 'undefined')) {\r\n      console.log('blur material null');\r\n      return;\r\n    }\r\n    console.log('blur material NOT null');\r\n    this.setVolumeTextureWebGL2(blurSigma);\r\n    this.updatableTexture.needsUpdate = true;\r\n  }\r\n  updateVolumeTextureWithMask() {\r\n    if (this.eraser.bufferMask === null){\r\n      console.log('volTextureMask null');\r\n    }\r\n    for (let z = 0; z < this.zDim; z++) {\r\n      const zVolOff = z * this.xDim * this.yDim;\r\n      for (let y = 0; y < this.yDim; y++) {\r\n        const yVol = y;\r\n        const yVolOff = yVol * this.xDim;\r\n        for (let x = 0; x < this.xDim; x++) {\r\n          const xVol = x;\r\n          const offSrc = (xVol + yVolOff + zVolOff);\r\n          let valInt = this.arrPixels[offSrc];\r\n          const offDst = offSrc;\r\n          if ((this.zDim > 5) && ((z === 0) || (z === this.zDim - 1) || (this.eraser.bufferMask[offSrc] === 0))) {\r\n            valInt = 0;\r\n          }\r\n          this.bufferR[offDst] = valInt;\r\n        }\r\n      }\r\n    }\r\n    this.origVolumeTex.needsUpdate = true;\r\n    this.setVolumeTexture(1.0);\r\n  }\r\n  setVolumeTextureWebGL2(blurSigma) {\r\n    this.material.uniforms.blurSigma.value = blurSigma;\r\n    this.material.uniforms.blurSigma.needsUpdate = true;\r\n    const VAL_1 = 1;\r\n    const VAL_2 = 2;\r\n    const VAL_3 = 3;\r\n    const VAL_4 = 4;\r\n    const frameBuf = new Uint8Array(VAL_4 * this.xDim * this.yDim);\r\n    const gl = this.rendererBlur.getContext();\r\n    for (let z = 1; z < this.zDim - 1; ++z) {\r\n      this.material.uniforms.curZ.value = z / this.zDim;\r\n      this.material.uniforms.curZ.needsUpdate = true;\r\n\r\n      this.rendererBlur.render(this.sceneBlur, this.cameraOrtho, this.bufferTexture);\r\n      gl.readPixels(0, 0, this.xDim, this.yDim, gl.RGBA, gl.UNSIGNED_BYTE, frameBuf);\r\n      const zOffs = z * this.xDim * this.yDim;\r\n      if (this.isRoiVolume) {\r\n        for (let y = 0; y < this.yDim; y++) {\r\n          for (let x = 0; x < this.xDim; x++) {\r\n            const indxR = VAL_4 * (x + y * this.xDim);\r\n            const indxL = indxR + zOffs * VAL_4;\r\n            this.bufferTextureCPU[indxL] = frameBuf[indxR];\r\n            this.bufferTextureCPU[indxL + VAL_1] = frameBuf[indxR + VAL_1];\r\n            this.bufferTextureCPU[indxL + VAL_2] = frameBuf[indxR + VAL_2];\r\n            this.bufferTextureCPU[indxL + VAL_3] = frameBuf[indxR + VAL_3];\r\n          }\r\n        }\r\n      } else {\r\n        for (let y = 0; y < this.yDim; y++) {\r\n          for (let x = 0; x < this.xDim; x++) {\r\n            this.bufferTextureCPU[x + y * this.xDim + zOffs] =\r\n            frameBuf[VAL_4 * (x + y * this.xDim)]; //256.0 * k / this.zDim;\r\n          }\r\n        }\r\n      }\r\n      // for (let y = 0; y < this.yDim; y++) {\r\n      //   for (let x = 0; x < this.xDim; x++) {\r\n      //     if (this.isRoiVolume) {\r\n      //       const indxR = VAL_4 * (x + y * this.xDim);\r\n      //       const indxL = indxR + zOffs * VAL_4;\r\n      //       this.bufferTextureCPU[indxL] = frameBuf[indxR];\r\n      //       this.bufferTextureCPU[indxL + VAL_1] = frameBuf[indxR + VAL_1];\r\n      //       this.bufferTextureCPU[indxL + VAL_2] = frameBuf[indxR + VAL_2];\r\n      //       this.bufferTextureCPU[indxL + VAL_3] = frameBuf[indxR + VAL_3];\r\n      //     } else {\r\n      //       this.bufferTextureCPU[x + y * this.xDim + zOffs] =\r\n      //       frameBuf[VAL_4 * (x + y * this.xDim)]; //256.0 * k / this.zDim;\r\n      //     }\r\n      //   }\r\n      // }\r\n    }\r\n  }\r\n  /**\r\n   * Copies the source data into the buffer (bufferRgba) from which the 3� texture is created\r\n   */\r\n  set3DTextureFrom1Byte() {\r\n    const OFF0 = 0;\r\n    this.bufferTextureCPU = new Uint8Array(this.xDim * this.yDim * this.zDim);\r\n    this.bufferR = new Uint8Array(this.xDim * this.yDim * this.zDim);\r\n    // Fill initial rgba array\r\n    for (let z = 0; z < this.zDim; z++) {\r\n      const zVolOff = z * this.xDim * this.yDim;\r\n      for (let y = 0; y < this.yDim; y++) {\r\n        const yVol = y;\r\n        const yVolOff = yVol * this.xDim;\r\n        for (let x = 0; x < this.xDim; x++) {\r\n          const xVol = x;\r\n          const offSrc = (xVol + yVolOff + zVolOff);\r\n          let valInt = this.arrPixels[offSrc + 0];\r\n          const offDst = offSrc;\r\n          if (this.zDim > 5 && (z === 0 || z === this.zDim - 1)) {\r\n            valInt = 0;\r\n          }\r\n          this.bufferR[offDst + OFF0] = valInt;\r\n          this.bufferTextureCPU[offDst + OFF0] = valInt;\r\n        }\r\n      }\r\n    }\r\n    console.log('setBufferRgbaFrom1Bytes for 3d texture');\r\n  }\r\n  /**\r\n   * Copies the source data into the buffer (bufferRgba) from which the 3� texture is created\r\n   */\r\n  set3DTextureFrom4Bytes() {\r\n    const OFF0 = 0;\r\n    const OFF1 = 1;\r\n    const OFF2 = 2;\r\n    const OFF3 = 3;\r\n    const BID = 4;\r\n    if (this.isRoiVolume) {\r\n      this.bufferRoi = new Uint8Array(this.xDim * this.yDim * this.zDim);\r\n      this.bufferTextureCPU = new Uint8Array(BID * this.xDim * this.yDim * this.zDim);\r\n      console.log('ROI');\r\n    }\r\n    this.bufferR = new Uint8Array(this.xDim * this.yDim * this.zDim);\r\n    // Fill initial rgba array\r\n    for (let z = 0; z < this.zDim; z++) {\r\n      const zVolOff = z * this.xDim * this.yDim;\r\n      for (let y = 0; y < this.yDim; y++) {\r\n        const yVol = y;\r\n        const yVolOff = yVol * this.xDim;\r\n        for (let x = 0; x < this.xDim; x++) {\r\n          const xVol = x;\r\n\r\n          const offSrc = (xVol + yVolOff + zVolOff) * BID;\r\n          const valInt = this.arrPixels[offSrc + 0];\r\n          const valRoi = this.arrPixels[offSrc + OFF3];\r\n          //const valRoi = this.arrPixels[offSrc + 0];\r\n          //const valInt = this.arrPixels[offSrc + OFF3];\r\n          const offDst = xVol + yVolOff + zVolOff;\r\n          //if (x === 0 || x === this.xDim - 1 || y === 0 || y === this.yDim - 1 || z === 0 || z === this.zDim - 1)\r\n          if (x < 2 || x > this.xDim - 4 || y < 2 || y > this.yDim - 4 || z < 2 || z > this.zDim - 4)\r\n            this.bufferR[offDst + OFF0] = 0;\r\n          else\r\n            this.bufferR[offDst + OFF0] = valInt;\r\n          this.bufferTextureCPU[BID * offDst + OFF0] = valInt;\r\n          this.bufferTextureCPU[BID * offDst + OFF1] = valInt;\r\n          this.bufferTextureCPU[BID * offDst + OFF2] = valInt;\r\n          this.bufferTextureCPU[BID * offDst + OFF3] = valInt;\r\n          this.bufferRoi[offDst + OFF0] = valRoi;\r\n        }\r\n      }\r\n    }\r\n    console.log('setBufferRgbaFrom4Bytes for 3D texture');\r\n  }\r\n  /**\r\n   * Create 2D texture containing roi color map\r\n   * @param colorArray 256 RGBA roi colors\r\n   */\r\n  createRoiColorMap(colorArray) {\r\n    return this.transferFunc.createRoiColorMap(colorArray);\r\n  }\r\n  /**\r\n   * Create 2D texture containing selected ROIs\r\n   * @param colorArray 256 RGBA roi colors\r\n   */\r\n  createSelectedRoiMap() {\r\n    return this.createSelectedRoiMap();\r\n  }\r\n  /**\r\n   * Create 2D texture containing selected ROIs\r\n   * @param selectedROIs 256 byte roi values\r\n   */\r\n  updateSelectedRoiMap(selectedROIs) {\r\n    this.transferFunc.updateSelectedRoiMap(selectedROIs);\r\n    this.setVolumeTexture(1.0);\r\n  }\r\n  /**\r\n   * Update roi selection map\r\n   * @param roiId ROI id from 0..255\r\n   * @param selectedState True if roi must be visible\r\n   */\r\n  // eslint-disable-next-line\r\n  updateSelectedRoi(roiId, selectedState) {\r\n    this.transferFunc.updateSelectedRoi(roiId, selectedState);\r\n    this.setVolumeTexture(1.0);\r\n  }\r\n  /**\r\n   * Create 3D texture containing filtered source data and calculated normal values\r\n   * @param props An object that contains all volume-related info\r\n   * @param\r\n\r\n   * @param roiColors Array of roi colors in RGBA format\r\n   * @return (object) Created texture\r\n   */\r\n  createUpdatableVolumeTex(volume, isRoiVolume, roiColors) {\r\n    this.isWebGL2 = 1;\r\n    this.arrPixels = volume.m_dataArray;\r\n    const xDim = volume.m_xDim;\r\n    const yDim = volume.m_yDim;\r\n    const zDim = volume.m_zDim;\r\n    this.xDim = xDim;\r\n    this.yDim = yDim;\r\n    this.zDim = zDim;\r\n    this.isRoiVolume = isRoiVolume;\r\n\r\n    this.RoiVolumeTex = null;\r\n    if (!isRoiVolume) {\r\n      this.set3DTextureFrom1Byte();\r\n    } else {\r\n      this.set3DTextureFrom4Bytes();\r\n      this.RoiVolumeTex = new THREE.DataTexture3D(this.bufferRoi, this.xDim, this.yDim, this.zDim);\r\n      this.RoiVolumeTex.format = THREE.RedFormat; //RedFormat?\r\n      this.RoiVolumeTex.type = THREE.UnsignedByteType;\r\n      this.RoiVolumeTex.wrapS = THREE.ClampToEdgeWrapping;\r\n      this.RoiVolumeTex.wrapT = THREE.ClampToEdgeWrapping;\r\n      this.RoiVolumeTex.magFilter = THREE.NearestFilter;\r\n      this.RoiVolumeTex.minFilter = THREE.NearestFilter;\r\n      this.RoiVolumeTex.needsUpdate = true;\r\n    }\r\n    this.bufferTexture = new THREE.WebGLRenderTarget(this.xDim,\r\n      this.yDim, {\r\n        minFilter: THREE.LinearFilter,\r\n        magFilter: THREE.LinearFilter,\r\n        format: THREE.RGBAFormat,\r\n        type: THREE.UnsignedByteType,\r\n        depthBuffer: false,\r\n      });\r\n\r\n    if (this.origVolumeTex) {\r\n      this.origVolumeTex.dispose();\r\n    }\r\n\r\n    this.origVolumeTex = new THREE.DataTexture3D(this.bufferR, this.xDim, this.yDim, this.zDim);\r\n    this.origVolumeTex.format = THREE.RedFormat;\r\n    this.origVolumeTex.type = THREE.UnsignedByteType;\r\n    this.origVolumeTex.wrapR = THREE.ClampToEdgeWrapping;\r\n    this.origVolumeTex.wrapS = THREE.ClampToEdgeWrapping;\r\n    this.origVolumeTex.wrapT = THREE.ClampToEdgeWrapping;\r\n    this.origVolumeTex.magFilter = THREE.NearestFilter;//THREE.LinearFilter;\r\n    this.origVolumeTex.minFilter = THREE.NearestFilter;//THREE.LinearFilter;\r\n    this.origVolumeTex.needsUpdate = true;\r\n\r\n    let volTexFormat = THREE.RedFormat;\r\n    if (isRoiVolume) {\r\n      volTexFormat = THREE.RGBAFormat;\r\n    }\r\n    this.updatableTexture = new THREE.DataTexture3D(this.bufferTextureCPU, this.xDim, this.yDim, this.zDim);\r\n    this.updatableTexture.format = volTexFormat;\r\n    this.updatableTexture.type = THREE.UnsignedByteType;\r\n    this.updatableTexture.wrapR = THREE.ClampToEdgeWrapping;\r\n    this.updatableTexture.wrapS = THREE.ClampToEdgeWrapping;\r\n    this.updatableTexture.wrapT = THREE.ClampToEdgeWrapping;\r\n    this.updatableTexture.magFilter = THREE.LinearFilter;\r\n    this.updatableTexture.minFilter = THREE.LinearFilter;\r\n    if (this.zDim > 1) {\r\n      this.initRenderer(isRoiVolume, roiColors);\r\n    }\r\n    this.updatableTexture.needsUpdate = true;\r\n    this.eraser = new Eraser();\r\n    return this.updatableTexture;\r\n  }\r\n  /**\r\n   * Create 3D texture containing mask of data which were erase\r\n   * @param volume An object that contains all volume-related info\r\n   * @return (object) Created texture\r\n   */\r\n  createUpdatableVolumeMask(params) {\r\n    return this.eraser.createUpdatableVolumeMask(params, this.bufferTextureCPU);\r\n  }\r\n} // class VolumeFilter3d\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n'License'); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n'AS IS' BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n/**\r\n* Nifti file loader\r\n* @module lib/scripts/loaders/roipalette\r\n*/\r\n\r\n// ******************************************************************\r\n// imports\r\n// ******************************************************************\r\n\r\n// ******************************************************************\r\n// Class\r\n// ******************************************************************\r\n\r\nexport default class RoiPalette {\r\n  /**\r\n  * Create loader\r\n  */\r\n  constructor() {\r\n    this.m_palette = [\r\n      {\r\n        'name': 'amygdala',\r\n        'roiColor': '0.247059 0.584314 0.270588 1',\r\n        'roiId': 139,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'amygdala',\r\n        'roiColor': '0.309804 0.929412 0.054902 1',\r\n        'roiId': 118,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'angular gyrus',\r\n        'roiColor': '0.686275 0.231373 0.152941 1',\r\n        'roiId': 19,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'angular gyrus',\r\n        'roiColor': '0.811765 0.486275 0.117647 1',\r\n        'roiId': 159,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'anterior limb of internal capsule',\r\n        'roiColor': '0.309804 0.203922 0.462745 1',\r\n        'roiId': 128,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'anterior limb of internal capsule',\r\n        'roiColor': '0.435294 0.733333 0.027451 1',\r\n        'roiId': 43,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'roiColor': '0.937255 0.94902 0.513725 1',\r\n        'roiId': 20,\r\n        'name': 'brain stem',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'caudate nucleus',\r\n        'roiColor': '0.74902 0.278431 0.141176 1',\r\n        'roiId': 53,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'caudate nucleus',\r\n        'roiColor': '0.184314 0.0745098 0.356863 1',\r\n        'roiId': 39,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'cerebellum',\r\n        'roiColor': '0.811765 0.458824 0.952941 1',\r\n        'roiId': 76,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'cerebellum',\r\n        'roiColor': '0.247059 0.113725 0.843137 1',\r\n        'roiId': 67,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'cingulate region',\r\n        'roiColor': '0.623529 0.45098 0.666667 1',\r\n        'roiId': 7,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'cingulate region',\r\n        'roiColor': '0.937255 0.631373 0.505882 1',\r\n        'roiId': 27,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'roiColor': '0.937255 0.301961 0.470588 1',\r\n        'roiId': 133,\r\n        'name': 'corpus callosum',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'cuneus',\r\n        'roiColor': '0.435294 0.513725 0.768627 1',\r\n        'roiId': 175,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'cuneus',\r\n        'roiColor': '0.937255 0.729412 0.192157 1',\r\n        'roiId': 54,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'fornix',\r\n        'roiColor': '0.937255 0.415686 0.847059 1',\r\n        'roiId': 254,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'fornix',\r\n        'roiColor': '0.811765 0.67451 0.980392 1',\r\n        'roiId': 29,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'roiColor': '0.247059 0.466667 0.105882 1',\r\n        'roiId': 233,\r\n        'name': 'fourth ventricle',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'frontal lobe WM',\r\n        'roiColor': '0.560784 0.290196 0.215686 1',\r\n        'roiId': 17,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'frontal lobe WM',\r\n        'roiColor': '0.498039 0.662745 0.101961 1',\r\n        'roiId': 30,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'globus palladus',\r\n        'roiColor': '0.0588235 0.843137 0.168627 1',\r\n        'roiId': 11,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'globus palladus',\r\n        'roiColor': '0.247059 0.74902 0.447059 1',\r\n        'roiId': 12,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'hippocampal formation',\r\n        'roiColor': '0.498039 0.709804 0.619608 1',\r\n        'roiId': 36,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'hippocampal formation',\r\n        'roiColor': '0.121569 0.4 0.972549 1',\r\n        'roiId': 101,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'inferior frontal gyrus',\r\n        'roiColor': '0.247059 0.85098 0.0666667 1',\r\n        'roiId': 75,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'inferior frontal gyrus',\r\n        'roiColor': '0.937255 0.662745 0.329412 1',\r\n        'roiId': 15,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'inferior occipital gyrus',\r\n        'roiColor': '0.0588235 0.643137 0.643137 1',\r\n        'roiId': 97,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'inferior occipital gyrus',\r\n        'roiColor': '0.247059 0.411765 0.568627 1',\r\n        'roiId': 37,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'inferior temporal gyrus',\r\n        'roiColor': '0.247059 0.00392157 0.796078 1',\r\n        'roiId': 140,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'inferior temporal gyrus',\r\n        'roiColor': '0.87451 0.819608 0.541176 1',\r\n        'roiId': 164,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'insula',\r\n        'roiColor': '0.623529 0.886275 0.356863 1',\r\n        'roiId': 4,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'insula',\r\n        'roiColor': '0.560784 0.698039 0.12549 1',\r\n        'roiId': 108,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'lateral front-orbital gyrus',\r\n        'roiColor': '0.435294 0.501961 0.203922 1',\r\n        'roiId': 6,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'lateral front-orbital gyrus',\r\n        'roiColor': '1 0.8 0.00784314 1',\r\n        'roiId': 90,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'lateral occipitotemporal gyrus',\r\n        'roiColor': '0.0588235 0.027451 0.470588 1',\r\n        'roiId': 99,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'lateral occipitotemporal gyrus',\r\n        'roiColor': '0.937255 0.101961 0.913725 1',\r\n        'roiId': 196,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'lateral ventricle',\r\n        'roiColor': '0.435294 0.176471 0.568627 1',\r\n        'roiId': 8,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'lateral ventricle',\r\n        'roiColor': '0.74902 0.764706 0.247059 1',\r\n        'roiId': 3,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'lingual gyrus',\r\n        'roiColor': '0.435294 0.458824 0.47451 1',\r\n        'roiId': 112,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'lingual gyrus',\r\n        'roiColor': '0.811765 0.0941176 0.301961 1',\r\n        'roiId': 69,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'medial front-orbital gyrus',\r\n        'roiColor': '0.87451 0.364706 0.384314 1',\r\n        'roiId': 1,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'medial front-orbital gyrus',\r\n        'roiColor': '0.811765 0.160784 0.247059 1',\r\n        'roiId': 85,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'medial frontal gyrus',\r\n        'roiColor': '0.435294 0.615686 0.0705882 1',\r\n        'roiId': 114,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'medial frontal gyrus',\r\n        'roiColor': '0.184314 0.372549 0.423529 1',\r\n        'roiId': 9,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'medial occipitotemporal gyrus',\r\n        'roiColor': '0.247059 0.368627 0.211765 1',\r\n        'roiId': 165,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'medial occipitotemporal gyrus',\r\n        'roiColor': '1 0.843137 0.254902 1',\r\n        'roiId': 119,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'middle frontal gyrus',\r\n        'roiColor': '0.623529 0.905882 0.113725 1',\r\n        'roiId': 2,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'middle frontal gyrus',\r\n        'roiColor': '0.686275 0.0901961 0.811765 1',\r\n        'roiId': 50,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'middle occipital gyrus',\r\n        'roiColor': '0.686275 0.933333 0.698039 1',\r\n        'roiId': 63,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'middle occipital gyrus',\r\n        'roiColor': '0.435294 0.0588235 0.964706 1',\r\n        'roiId': 154,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'middle temporal gyrus',\r\n        'roiColor': '0.937255 0.498039 0.67451 1',\r\n        'roiId': 130,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'middle temporal gyrus',\r\n        'roiColor': '0.498039 0.768627 0.439216 1',\r\n        'roiId': 64,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'nucleus accumbens',\r\n        'roiColor': '1 0.807843 0.529412 1',\r\n        'roiId': 25,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'nucleus accumbens',\r\n        'roiColor': '0.0588235 0.65098 0.0509804 1',\r\n        'roiId': 72,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'occipital lobe WM',\r\n        'roiColor': '0.0588235 0.368627 0.552941 1',\r\n        'roiId': 45,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'occipital lobe WM',\r\n        'roiColor': '0.0588235 0.639216 0.839216 1',\r\n        'roiId': 73,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'occipital pole',\r\n        'roiColor': '0.74902 0.494118 0.419608 1',\r\n        'roiId': 132,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'occipital pole',\r\n        'roiColor': '0.247059 0.807843 0.74902 1',\r\n        'roiId': 251,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'parahippocampal gyrus',\r\n        'roiColor': '0.121569 0.847059 0.00392157 1',\r\n        'roiId': 125,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'parahippocampal gyrus',\r\n        'roiColor': '0.247059 0.0705882 0.321569 1',\r\n        'roiId': 18,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'parietal lobe WM',\r\n        'roiColor': '1 0.4 0.223529 1',\r\n        'roiId': 105,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'parietal lobe WM',\r\n        'roiColor': '0.309804 0.678431 0.639216 1',\r\n        'roiId': 57,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'postcentral gyrus',\r\n        'roiColor': '0.560784 0.478431 0.2 1',\r\n        'roiId': 110,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'postcentral gyrus',\r\n        'roiColor': '0.498039 0.576471 0.027451 1',\r\n        'roiId': 74,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'posterior limb of internal capsule inc. cerebral peduncle',\r\n        'roiColor': '1 0.917647 0.576471 1',\r\n        'roiId': 35,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'posterior limb of internal capsule inc. cerebral peduncle',\r\n        'roiColor': '0.435294 0.490196 0.0784314 1',\r\n        'roiId': 34,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'precentral gyrus',\r\n        'roiColor': '0.184314 0.709804 0.615686 1',\r\n        'roiId': 5,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'precentral gyrus',\r\n        'roiColor': '0.87451 0.560784 1 1',\r\n        'roiId': 80,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'precuneus',\r\n        'roiColor': '1 0.654902 0.223529 1',\r\n        'roiId': 32,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'precuneus',\r\n        'roiColor': '1 0 0.211765 1',\r\n        'roiId': 56,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'putamen',\r\n        'roiColor': '1 0.831373 0.227451 1',\r\n        'roiId': 16,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'putamen',\r\n        'roiColor': '0.372549 0.678431 0.32549 1',\r\n        'roiId': 14,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'subthalamic nucleus',\r\n        'roiColor': '0.184314 0.545098 0.619608 1',\r\n        'roiId': 23,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'subthalamic nucleus',\r\n        'roiColor': '0.309804 0.686275 0.243137 1',\r\n        'roiId': 33,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'superior frontal gyrus',\r\n        'roiColor': '0.87451 0.380392 0.768627 1',\r\n        'roiId': 10,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'superior frontal gyrus',\r\n        'roiColor': '1 0.113725 0.396078 1',\r\n        'roiId': 70,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'superior occipital gyrus',\r\n        'roiColor': '0.372549 0.0431373 0.537255 1',\r\n        'roiId': 38,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'superior occipital gyrus',\r\n        'roiColor': '0.623529 0.301961 0.2 1',\r\n        'roiId': 98,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'superior parietal lobule',\r\n        'roiColor': '0.247059 0.843137 0.407843 1',\r\n        'roiId': 88,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'superior parietal lobule',\r\n        'roiColor': '0.87451 0.533333 0.254902 1',\r\n        'roiId': 52,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'superior temporal gyrus',\r\n        'roiColor': '0.498039 0.721569 0.996078 1',\r\n        'roiId': 145,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'superior temporal gyrus',\r\n        'roiColor': '1 0.67451 0.45098 1',\r\n        'roiId': 61,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'supramarginal gyrus',\r\n        'roiColor': '0.87451 0.45098 0.270588 1',\r\n        'roiId': 60,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'supramarginal gyrus',\r\n        'roiColor': '0.623529 0.0235294 0.654902 1',\r\n        'roiId': 41,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'temporal lobe WM',\r\n        'roiColor': '0.498039 0.603922 0.768627 1',\r\n        'roiId': 59,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'temporal lobe WM',\r\n        'roiColor': '0.87451 0.411765 0.368627 1',\r\n        'roiId': 83,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'thalamus',\r\n        'roiColor': '0.0588235 0.796078 0.866667 1',\r\n        'roiId': 203,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'thalamus',\r\n        'roiColor': '0.74902 0.984314 0.341176 1',\r\n        'roiId': 102,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'roiColor': '0.811765 0.258824 0.823529 1',\r\n        'roiId': 232,\r\n        'name': 'third ventricle',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'uncus',\r\n        'roiColor': '0.121569 0.352941 0.196078 1',\r\n        'roiId': 26,\r\n        'position': 'right',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'uncus',\r\n        'roiColor': '0.623529 0.117647 0.14902 1',\r\n        'roiId': 62,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'xxx_brain_internal',\r\n        'roiColor': '0.8 0.8 0.1 1',\r\n        'roiId': 150,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n      {\r\n        'name': 'xxx_brain_core',\r\n        'roiColor': '0.2 0.8 0.2 1',\r\n        'roiId': 250,\r\n        'position': 'left',\r\n        'isBrain': true,\r\n      },\r\n    ];\r\n    this.createBytePalette256();\r\n  }\r\n  /**\r\n  * Transform array of objects into uint32 color array with 256 entries\r\n  */\r\n  createBytePalette256() {\r\n    const PAL_SIZE = 256;\r\n    const MAX_PAL_COLOR = 255.0;\r\n    const BYTES_PER_COLOR = 4;\r\n    const OFFS_0 = 0;\r\n    const OFFS_1 = 1;\r\n    const OFFS_2 = 2;\r\n    const OFFS_3 = 3;\r\n    this.m_palette256 = new Uint8Array(PAL_SIZE * BYTES_PER_COLOR);\r\n    let i;\r\n    // init palette with black colors\r\n    for (i = 0; i < PAL_SIZE * BYTES_PER_COLOR; i++) {\r\n      this.m_palette256[i] = 0;\r\n    }\r\n    // load colors\r\n    const numPalColors = this.m_palette.length;\r\n    for (i = 0; i < numPalColors; i++) {\r\n      const strIndexPalette = this.m_palette[i].roiId;\r\n      const strColor = this.m_palette[i].roiColor;\r\n      const arrColor = strColor.split(' ');\r\n      const rCol = Math.floor(parseFloat(arrColor[OFFS_0]) * MAX_PAL_COLOR);\r\n      const gCol = Math.floor(parseFloat(arrColor[OFFS_1]) * MAX_PAL_COLOR);\r\n      const bCol = Math.floor(parseFloat(arrColor[OFFS_2]) * MAX_PAL_COLOR);\r\n      const aCol = 255;\r\n      const ind = parseInt(strIndexPalette, 10) * BYTES_PER_COLOR;\r\n      this.m_palette256[ind + OFFS_0] = rCol;\r\n      this.m_palette256[ind + OFFS_1] = gCol;\r\n      this.m_palette256[ind + OFFS_2] = bCol;\r\n      this.m_palette256[ind + OFFS_3] = aCol;\r\n    }\r\n  }\r\n  /**\r\n  * Return palette array of objects\r\n  */\r\n  getPalette() {\r\n    return this.m_palette;\r\n  }\r\n  /**\r\n  * Return array of uints8 with 256 entries * 4\r\n  */\r\n  getPalette256() {\r\n    return this.m_palette256;\r\n  }\r\n}\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Text rendering to canvas\r\n* @module lib/scripts/graphics2d/canvastext\r\n*/\r\n\r\n// import * as THREE from 'three';\r\n\r\nconst FONT_FOR_TEXT_RENDER = '72px Arial';\r\n\r\n/** Class CanvasText is used for render text to canvas via HTML5 interface */\r\nexport default class CanvasText {\r\n  /**\r\n  * Initialize Canvas text renderer\r\n  */\r\n  constructor() {\r\n    this.m_textWidth = 0;\r\n    this.m_textHeight = 0;\r\n    this.m_canvas = document.createElement('canvas');\r\n    this.m_ctx = this.m_canvas.getContext('2d');\r\n  }\r\n  get width() {\r\n    return this.m_canvas.width;\r\n  }\r\n  get height() {\r\n    return this.m_canvas.height;\r\n  }\r\n  get textWidth() {\r\n    return this.m_textWidth;\r\n  }\r\n  get textHeight() {\r\n    return this.m_textHeight;\r\n  }\r\n  static getFontHeight(strFont) {\r\n    const body = document.getElementsByTagName('body')[0];\r\n    const dummy = document.createElement('div');\r\n    const dummyText = document.createTextNode('GyW~ig^');\r\n    dummy.appendChild(dummyText);\r\n    dummy.setAttribute('style', `font:${strFont};position:absolute;top:0;left:0`);\r\n    body.appendChild(dummy);\r\n    const result = dummy.offsetHeight;\r\n    // fontHeightCache[fontStyle] = result;\r\n    body.removeChild(dummy);\r\n    return result;\r\n  }\r\n  /**\r\n  * Returns the smallest power of 2 that is greater than or equal to val.\r\n  * @param (number) val - value to search closest power of 2.\r\n  * @return {number} the smallest power of 2 that is greater than or equal to val\r\n  */\r\n  static ceilPowerOfTwo(val) {\r\n    const FAIL = -1;\r\n    const MAX_PWR = 30;\r\n    for (let i = 1; i < MAX_PWR; i++) {\r\n      const valPwr = 1 << i;\r\n      if (valPwr >= val) {\r\n        return valPwr;\r\n      }\r\n    }\r\n    return FAIL;\r\n  }\r\n  /**\r\n  * Initialize Canvas text renderer\r\n  * @param (strint) strTextToRender - text to render\r\n  * @return {Object} Canvas with rendered text\r\n  */\r\n  drawText(strTextToRender, strTextColor) {\r\n    // clear screen\r\n    this.m_canvas.width = 1024;\r\n    this.m_canvas.height = 512;\r\n    this.m_ctx.fillStyle = 'rgba(255, 255, 255, 0)';\r\n    const MAX_EXTENT_X = 512;\r\n    const MAX_EXTENT_Y = 128;\r\n    this.m_ctx.fillRect(0, 0, MAX_EXTENT_X, MAX_EXTENT_Y);\r\n\r\n    this.m_ctx.font = FONT_FOR_TEXT_RENDER;\r\n    this.m_ctx.fillStyle = strTextColor;\r\n    this.m_ctx.strokeStyle = strTextColor;\r\n    this.m_ctx.textAlign = 'left';\r\n    this.m_ctx.textBaseline = 'top';\r\n    this.m_ctx.lineWidth = 2;\r\n\r\n    const strText = (strTextToRender.length === 0) ? '?' : strTextToRender;\r\n\r\n    this.m_textWidth = Math.floor(this.m_ctx.measureText(strText).width);\r\n    this.m_textHeight = CanvasText.getFontHeight(FONT_FOR_TEXT_RENDER);\r\n\r\n\r\n    // set canvas size to desired dimension\r\n    // this.m_canvas.width = THREE.Math.ceilPowerOfTwo(this.m_textWidth);\r\n    // this.m_canvas.height = THREE.Math.ceilPowerOfTwo(this.m_textHeight);\r\n    this.m_canvas.width = CanvasText.ceilPowerOfTwo(this.m_textWidth);\r\n    this.m_canvas.height = CanvasText.ceilPowerOfTwo(this.m_textHeight);\r\n\r\n    // console.log(`CanvasText canvas size = ${this.m_canvas.width} * ${this.m_canvas.height}`);\r\n    // console.log(`CanvasText  text size = ${this.m_textWidth} * ${this.m_textHeight}`);\r\n\r\n    // clear screen\r\n    this.m_ctx.fillStyle = 'rgba(255, 255, 255, 0)';\r\n    this.m_ctx.fillRect(0, 0, this.m_canvas.width, this.m_canvas.height);\r\n\r\n    // render text string\r\n    this.m_ctx.font = FONT_FOR_TEXT_RENDER;\r\n    this.m_ctx.fillStyle = strTextColor;\r\n    this.m_ctx.strokeStyle = strTextColor;\r\n    this.m_ctx.textAlign = 'left';\r\n    this.m_ctx.textBaseline = 'top';\r\n    this.m_ctx.fillText(strText, 0, 0);\r\n  }\r\n}\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* 2d text render\r\n* @module lib/scripts/graphics2d/text2d\r\n*/\r\n\r\nimport * as THREE from 'three';\r\n\r\nimport CanvasText from './canvastext';\r\n\r\n/** Class Text2D is used for render text to canvas via HTML5 interface */\r\nexport default class Text2D extends THREE.Object3D {\r\n  constructor(strText) {\r\n    super();\r\n    this.m_canvas = new CanvasText();\r\n    this.m_align = new THREE.Vector2(0, 0);\r\n    this.m_side = THREE.DoubleSide;\r\n    this.m_antialias = true;\r\n    this.m_text = strText;\r\n  }\r\n  getText() {\r\n    return this.m_text;\r\n  }\r\n  setText(val) {\r\n    if (this.m_text !== val) {\r\n      this.m_text = val;\r\n      this.updateText();\r\n    }\r\n  }\r\n  getFont() {\r\n    return this.m_font;\r\n  }\r\n  updateText() {\r\n    console.log(`Use virtual method for ${this.m_text}`);\r\n  }\r\n  cleanUp() {\r\n    if (this.texture) {\r\n      this.texture.dispose();\r\n    }\r\n  }\r\n  applyAntiAlias() {\r\n    if (this.antialias === false) {\r\n      this.texture.magFilter = THREE.NearestFilter;\r\n      this.texture.minFilter = THREE.LinearMipMapLinearFilter;\r\n    }\r\n  }\r\n}\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* 2d texture simplest render\r\n* @module lib/scripts/gfx/mattplain\r\n*/\r\n\r\n// ******************************************************************\r\n// imports\r\n// ******************************************************************\r\n\r\n// absoulte imports\r\nimport * as THREE from 'three';\r\n\r\n/** Class @class MaterialTexturePlain2d for create artifical volume */\r\nexport default class MaterialTexturePlain2d {\r\n\r\n  /** Simple material constructor\r\n  * @constructor\r\n  */\r\n  constructor() {\r\n    this.m_strShaderVertex = '';\r\n    this.m_strShaderFragment = '';\r\n    this.m_uniforms = {\r\n      texture1: { type: 't', value: null },\r\n    };\r\n    this.m_strShaderVertex = `\r\n      varying vec3 vecNormal;\r\n      varying vec3 vecPos;\r\n      varying vec2 vecUV;\r\n      void main() {\r\n        vecPos = position;\r\n        vecNormal = normal;\r\n        vecUV = uv;\r\n        gl_Position = vec4(position, 1.0);\r\n      }\r\n    `;\r\n    this.m_strShaderFragment = `\r\n      varying vec3 vecNormal;\r\n      varying vec3 vecPos;\r\n      varying vec2 vecUV;\r\n\r\n      uniform sampler2D texture1;\r\n\r\n      void main() {\r\n        vec2 texCoord = vecUV;\r\n        vec4 vColTex = texture2D(texture1, texCoord, 0.0);\r\n        float sum = (vColTex.x + vColTex.y + vColTex.z) / 3.0;\r\n        if (sum < 20.0 / 256.0)\r\n          discard;\r\n        gl_FragColor = vec4(vColTex.x, vColTex.y, vColTex.z, sum);\r\n      }\r\n    `;\r\n  }\r\n  /** Simple material constructor\r\n  * @return {object} Three.js material with this shader\r\n  */\r\n  create(tex) {\r\n    // Init uniforms\r\n    this.m_uniforms.texture1.value = tex;\r\n\r\n    this.m_material = new THREE.ShaderMaterial({\r\n      blending: THREE.CustomBlending,\r\n      blendEquation: THREE.AddEquation,\r\n      blendSrc: THREE.SrcAlphaFactor,\r\n      blendDst: THREE.OneMinusSrcAlphaFactor,\r\n      uniforms: this.m_uniforms,\r\n      vertexShader: this.m_strShaderVertex,\r\n      fragmentShader: this.m_strShaderFragment\r\n    });\r\n    this.m_material.needsUpdate = true;\r\n  }\r\n}\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Mesh with 2d text\r\n* @module lib/scripts/graphics2d/meshtext2d\r\n*/\r\n\r\nimport * as THREE from 'three';\r\n\r\nimport Text2D from './text2d';\r\nimport MaterialTexturePlain2d from '../gfx/mattplain';\r\n\r\nexport default class MeshText2D extends Text2D {\r\n  constructor(strText) {\r\n    super(strText);\r\n    this.m_mesh = null;\r\n    this.m_material = null;\r\n    this.m_renderedTextHeight = 0.0;\r\n    this.m_xMin = 3.0;\r\n    this.m_xMax = -3.0;\r\n    this.m_yMin = 3.0;\r\n    this.m_yMax = -3.0;\r\n  }\r\n  static getXMin(xc, xAlign, psx) {\r\n    if (xAlign === MeshText2D.ALIGN_LEFT) {\r\n      return xc;\r\n    } else if (xAlign === MeshText2D.ALIGN_RIGHT) {\r\n      return xc - psx;\r\n    } else if (xAlign === MeshText2D.ALIGN_CENTER) {\r\n      return xc - psx * 0.5;\r\n    }\r\n    return 0.0;\r\n  }\r\n  static getXMax(xc, xAlign, psx) {\r\n    if (xAlign === MeshText2D.ALIGN_LEFT) {\r\n      return xc + psx;\r\n    } else if (xAlign === MeshText2D.ALIGN_RIGHT) {\r\n      return xc;\r\n    } else if (xAlign === MeshText2D.ALIGN_CENTER) {\r\n      return xc + psx * 0.5;\r\n    }\r\n    return 0.0;\r\n  }\r\n  static getYMin(yc, yAlign, psy) {\r\n    if (yAlign === MeshText2D.ALIGN_TOP) {\r\n      return yc - psy;\r\n    } else if (yAlign === MeshText2D.ALIGN_BOTTOM) {\r\n      return yc;\r\n    } else if (yAlign === MeshText2D.ALIGN_CENTER) {\r\n      return yc - psy * 0.5;\r\n    }\r\n    return 0.0;\r\n  }\r\n  static getYMax(yc, yAlign, psy) {\r\n    if (yAlign === MeshText2D.ALIGN_TOP) {\r\n      return yc;\r\n    } else if (yAlign === MeshText2D.ALIGN_BOTTOM) {\r\n      return yc + psy;\r\n    } else if (yAlign === MeshText2D.ALIGN_CENTER) {\r\n      return yc + psy * 0.5;\r\n    }\r\n    return 0.0;\r\n  }\r\n  getRenderedTextHeight() {\r\n    return this.m_renderedTextHeight;\r\n  }\r\n  /**\r\n  * Update text 2d object: create mesh in desired position, content and width\r\n  * @param (object) container - object container for 3d rendering\r\n  * @param (int) xc - text anchor x coordinate\r\n  * @param (int) yc - text anchor y coordinate\r\n  * @param (float) letterHeight - single letter height in range [-1..+1]\r\n  * @param (string ) strTextBackColor - Background color, like rgba(255, 0, 0, 255), i.e. red color\r\n  */\r\n  updateText(xc, yc, letterHeight, xAlign, yAlign, strTextBackColor, strTextColor) {\r\n    // console.log('MeshText2D.updateText()...');\r\n    this.cleanUp();\r\n\r\n    if (this.m_mesh !== null) {\r\n      this.remove(this.m_mesh);\r\n      this.m_mesh = null;\r\n      this.m_material = null;\r\n    }\r\n\r\n    this.m_canvas.drawText(this.m_text, strTextColor);\r\n\r\n    this.m_renderedTextHeight = letterHeight;\r\n    const wPerHRatio = this.m_canvas.m_textWidth / this.m_canvas.m_textHeight;\r\n    const psy = letterHeight;\r\n    const psx = psy * wPerHRatio;\r\n\r\n    // console.log(`2dtext. text box = ${psx} * ${psy}, Ratio = ${wPerHRatio}`);\r\n\r\n    this.m_texture = new THREE.Texture(this.m_canvas.m_canvas);\r\n    this.m_texture.needsUpdate = true;\r\n    if (this.m_material === null) {\r\n      this.m_matTexturePlain = new MaterialTexturePlain2d();\r\n      this.m_matTexturePlain.create(this.m_texture);\r\n\r\n      this.m_material = this.m_matTexturePlain.m_material;\r\n\r\n      this.m_material.blending = THREE.CustomBlending;\r\n      this.m_material.blendEquation = THREE.AddEquation; // default\r\n      this.m_material.blendSrc = THREE.SrcAlphaFactor; // default\r\n      this.m_material.blendDst = THREE.OneMinusSrcAlphaFactor; // default\r\n\r\n      // create quad geometry\r\n      this.m_geometry = new THREE.Geometry();\r\n      // v2 ----- v3\r\n      // |        |\r\n      // |        |\r\n      // v0 ----- v1\r\n\r\n      // tex coordinate max\r\n      const X_TEXT_COORD_MAX = this.m_canvas.m_textWidth / this.m_canvas.m_canvas.width;\r\n      const Y_TEXT_COORD_MAX = this.m_canvas.m_textHeight / this.m_canvas.m_canvas.height;\r\n\r\n      // console.log(`2dtext. texture coord max = ${X_TEXT_COORD_MAX} * ${Y_TEXT_COORD_MAX}`);\r\n      // console.log(`text canvas dim on screen = ${this.m_canvas.m_textWidth} * ${this.m_canvas.m_textHeight}`);\r\n      // console.log(`psx = ${psx}, psy = ${psy}`);\r\n\r\n      this.m_xMin = MeshText2D.getXMin(xc, xAlign, psx);\r\n      this.m_xMax = MeshText2D.getXMax(xc, xAlign, psx);\r\n      this.m_yMin = MeshText2D.getYMin(yc, yAlign, psy);\r\n      this.m_yMax = MeshText2D.getYMax(yc, yAlign, psy);\r\n\r\n      const Z_COORD_TEXT = 0.05;\r\n      const v0 = new THREE.Vector3(this.m_xMin, this.m_yMin, Z_COORD_TEXT);\r\n      const v1 = new THREE.Vector3(this.m_xMax, this.m_yMin, Z_COORD_TEXT);\r\n      const v2 = new THREE.Vector3(this.m_xMin, this.m_yMax, Z_COORD_TEXT);\r\n      const v3 = new THREE.Vector3(this.m_xMax, this.m_yMax, Z_COORD_TEXT);\r\n\r\n      this.m_geometry.vertices.push(v0);\r\n      this.m_geometry.vertices.push(v1);\r\n      this.m_geometry.vertices.push(v2);\r\n      this.m_geometry.vertices.push(v3);\r\n\r\n      // console.log(`Texture text render max = ${X_TEXT_COORD_MAX} , ${Y_TEXT_COORD_MAX}`);\r\n\r\n      // add texture coordinates\r\n      this.m_geometry.faceVertexUvs[0].push([\r\n        new THREE.Vector2(0.0, 1.0 - Y_TEXT_COORD_MAX),\r\n        new THREE.Vector2(X_TEXT_COORD_MAX, 1.0 - Y_TEXT_COORD_MAX),\r\n        new THREE.Vector2(0.0, 1.0),\r\n      ]);\r\n      this.m_geometry.faceVertexUvs[0].push([\r\n        new THREE.Vector2(X_TEXT_COORD_MAX, 1.0),\r\n        new THREE.Vector2(0.0, 1.0),\r\n        new THREE.Vector2(X_TEXT_COORD_MAX, 1.0 - Y_TEXT_COORD_MAX),\r\n      ]);\r\n      const normal = new THREE.Vector3();\r\n      THREE.Triangle.getNormal(v0, v1, v2, normal);\r\n\r\n      // eslint-disable-next-line\r\n      this.m_geometry.faces.push(new THREE.Face3(0, 1, 2, normal));\r\n      // eslint-disable-next-line\r\n      this.m_geometry.faces.push(new THREE.Face3(3, 2, 1, normal));\r\n\r\n      this.m_mesh = new THREE.Mesh(this.m_geometry, this.m_material);\r\n      this.add(this.m_mesh);\r\n\r\n      // create text box with solid fill\r\n      const boxCanvas = document.createElement('canvas');\r\n      const context = boxCanvas.getContext('2d');\r\n      boxCanvas.width = 32;\r\n      boxCanvas.height = 32;\r\n      // green color as box background\r\n      context.fillStyle = strTextBackColor;\r\n      context.fillRect(0, 0, boxCanvas.width, boxCanvas.height);\r\n      const boxTexture = new THREE.Texture(boxCanvas);\r\n      boxTexture.needsUpdate = true;\r\n      this.m_matTextureBox = new MaterialTexturePlain2d();\r\n      this.m_matTextureBox.create(boxTexture, (mat) => {\r\n        this.m_boxMaterial = mat;\r\n\r\n        // box geometry and mesh with this 2d simple texture material\r\n        const Z_COORD_BOX = 0.06;\r\n        this.m_boxGeometry = new THREE.Geometry();\r\n        const vb0 = new THREE.Vector3(this.m_xMin, this.m_yMin, Z_COORD_BOX);\r\n        const vb1 = new THREE.Vector3(this.m_xMax, this.m_yMin, Z_COORD_BOX);\r\n        const vb2 = new THREE.Vector3(this.m_xMin, this.m_yMax, Z_COORD_BOX);\r\n        const vb3 = new THREE.Vector3(this.m_xMax, this.m_yMax, Z_COORD_BOX);\r\n        this.m_boxGeometry.vertices.push(vb0);\r\n        this.m_boxGeometry.vertices.push(vb1);\r\n        this.m_boxGeometry.vertices.push(vb2);\r\n        this.m_boxGeometry.vertices.push(vb3);\r\n        let boxNormal;\r\n        THREE.Triangle.getNormal(vb0, vb1, vb2, boxNormal);\r\n\r\n        // eslint-disable-next-line\r\n        this.m_boxGeometry.faces.push(new THREE.Face3(0, 1, 2, boxNormal));\r\n        // eslint-disable-next-line\r\n        this.m_boxGeometry.faces.push(new THREE.Face3(3, 2, 1, boxNormal));\r\n        this.m_boxMesh = new THREE.Mesh(this.m_boxGeometry, this.m_boxMaterial);\r\n        this.add(this.m_boxMesh);\r\n      });\r\n    } else {\r\n      this.m_material.map = this.m_texture;\r\n    }\r\n  } // updateText\r\n}\r\n// consts\r\nMeshText2D.ALIGN_LEFT = 0;\r\nMeshText2D.ALIGN_RIGHT = 1;\r\nMeshText2D.ALIGN_TOP = 2;\r\nMeshText2D.ALIGN_BOTTOM = 3;\r\nMeshText2D.ALIGN_CENTER = 4;\r\n\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Simple 2d mode material wiithout texture and lighting, only ambient color used\r\n* @module lib/scripts/gfx/matcolor2d\r\n*/\r\n\r\n// ******************************************************************\r\n// imports\r\n// ******************************************************************\r\n\r\n// absoulte imports\r\nimport * as THREE from 'three';\r\n\r\n/** Class @class MaterialColor2d for create 2d lines, etc */\r\nexport default class MaterialColor2d {\r\n  /** Simple material constructor\r\n  * @constructor\r\n  * @param (float) r - color component(red) in [0..1]\r\n  * @param (float) g - color component(green) in [0..1]\r\n  * @param (float) b - color component(blue) in [0..1]\r\n  */\r\n  constructor() {\r\n    this.m_strShaderVertex = '';\r\n    this.m_strShaderFragment = '';\r\n  }\r\n  create() {\r\n    this.m_strShaderVertex = `\r\n      void main() {\r\n        gl_Position = vec4(position, 1.0);\r\n      }\r\n    `;\r\n    this.m_strShaderFragment = `\r\n      void main() {\r\n        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\r\n      }\r\n    `;\r\n    const material = new THREE.ShaderMaterial({\r\n      vertexShader: this.m_strShaderVertex,\r\n      fragmentShader: this.m_strShaderFragment,\r\n      //side: THREE.FrontSide,\r\n      wireframe: true,\r\n      //depthTest: false\r\n      //clipping: false,\r\n    });\r\n    return material;\r\n  }\r\n}\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Render 2d lines in scene\r\n* @module app/scripts/graphics2d/line2d\r\n*/\r\n\r\nimport * as THREE from 'three';\r\n\r\n// image z coord == 0.8\r\nconst LINE_2D_Z_COORDINATE = 0.11;\r\n\r\n/** Class LineD is used for render lines in 2d mode */\r\nexport default class Line2D {\r\n  /**\r\n  * Constructor. Create line 2d mode and add to scene on render\r\n  * @param (object) scene - Scene where object will be rendered\r\n  * @param (float) lineWidth - Line width in scale [-1..+1]\r\n  * @param (float) xs - Line start, x coordinate\r\n  * @param (float) ys - Line start, y coordinate\r\n  * @param (float) xe - Line end, x coordinate\r\n  * @param (float) ye - Line end, y coordinate\r\n  * @param (object) matColor2d - MaterialColor2d\r\n  */\r\n  constructor(scene, lineWidth, xs, ys, xe, ye, matColor2d) {\r\n    this.createWithMaterial(scene, lineWidth, xs, ys, xe, ye, matColor2d);\r\n    this.m_xS = xs;\r\n    this.m_yS = ys;\r\n    this.m_xE = xe;\r\n    this.m_yE = ye;\r\n  }\r\n  createWithMaterial(scene,\r\n    lineWidth,\r\n    xs, ys, xe, ye,\r\n    matColor2d) {\r\n    this.m_scene = scene;\r\n    this.m_lineWidth = lineWidth;\r\n\r\n    const vLine = new THREE.Vector2(xe - xs, ye - ys);\r\n    const vNorm = new THREE.Vector2(+vLine.y, -vLine.x);\r\n    vNorm.normalize();\r\n    vNorm.multiplyScalar(lineWidth);\r\n\r\n    //      0   start    1\r\n    //      +-----+------+    ----> vNorm\r\n    //      |\\           |\r\n    //      | \\          |\r\n    //      |  \\         |\r\n    //      |   \\        |\r\n    //      |    \\       |\r\n    //      |     \\      |\r\n    //      |      \\     |\r\n    //      |       \\    |\r\n    //      |        \\   |\r\n    //      |         \\  |\r\n    //      |          \\ |\r\n    //      |           \\|\r\n    //      +-----+------+\r\n    //      2    end     3\r\n    //\r\n    const v0 = new THREE.Vector3(xs - vNorm.x, ys - vNorm.y, LINE_2D_Z_COORDINATE);\r\n    const v1 = new THREE.Vector3(xs + vNorm.x, ys + vNorm.y, LINE_2D_Z_COORDINATE);\r\n    const v2 = new THREE.Vector3(xe - vNorm.x, ye - vNorm.y, LINE_2D_Z_COORDINATE);\r\n    const v3 = new THREE.Vector3(xe + vNorm.x, ye + vNorm.y, LINE_2D_Z_COORDINATE);\r\n\r\n    this.m_geo = new THREE.Geometry();\r\n    this.m_geo.vertices.push(v0);\r\n    this.m_geo.vertices.push(v1);\r\n    this.m_geo.vertices.push(v2);\r\n    this.m_geo.vertices.push(v3);\r\n\r\n    const normal = new THREE.Vector3(0.0, 0.0, 1.0);\r\n    // eslint-disable-next-line\r\n    this.m_geo.faces.push(new THREE.Face3(0, 1, 3, normal));\r\n    // eslint-disable-next-line\r\n    this.m_geo.faces.push(new THREE.Face3(3, 2, 0, normal));\r\n\r\n    //this.planeGeometry = new THREE.PlaneBufferGeometry(0.5, 0.5);\r\n    //const plane = new THREE.Mesh(this.planeGeometry, matColor2d.m_material);\r\n    //this.m_scene.add(plane);\r\n\r\n    //this.m_mesh = new THREE.Mesh(this.m_geo, matColor2d.m_material);\r\n    this.m_mesh = new THREE.Mesh(this.m_geo, matColor2d);\r\n    this.m_scene.add(this.m_mesh);\r\n    console.log(`Line added to scene: ${xs},${ys} -> ${xe},${ye} `);\r\n  }\r\n  /**\r\n  * Get object for further scene addition. Need to remove old line from scene\r\n  * @return (object) line object\r\n  */\r\n  getRenderObject() {\r\n    return this.m_mesh;\r\n  }\r\n  /**\r\n  * Return coordinate x of start point\r\n  * @return (float) x\r\n  */\r\n  getxS() {\r\n    return this.m_xS;\r\n  }\r\n  /**\r\n  * Return coordinate y of start point\r\n  * @return (float) y\r\n  */\r\n  getyS() {\r\n    return this.m_yS;\r\n  }\r\n  /**\r\n  * Return coordinate x of end point\r\n  * @return (float) x\r\n  */\r\n  getxE() {\r\n    return this.m_xE;\r\n  }\r\n  /**\r\n  * Return coordinate y of end point\r\n  * @return (float) y\r\n  */\r\n  getyE() {\r\n    return this.m_yE;\r\n  }\r\n}\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n * 2d distance tool\r\n * @module app/scripts/graphics2d/distancetool\r\n */\r\n\r\nimport MeshText2D from './meshtext2d';\r\nimport MaterialColor2d from '../gfx/matcolor2d';\r\nimport Line2D from './line2d';\r\n\r\nexport default class DistanceTool {\r\n\r\n  /**\r\n   * Initialize distance tool\r\n   * @param (object) scene - scene object\r\n   * @param (object) lineWidth - width of all lines\r\n   */\r\n  constructor(scene, lineWidth) {\r\n    /** @property {Object} m_scene - scene object */\r\n    this.m_scene = scene;\r\n    /** @property {float} m_lineWidth - width for all lines */\r\n    this.m_lineWidth = lineWidth;\r\n    /** @property {boolean} m_runningState - true if last line has not been fixed yet */\r\n    this.m_runningState = false;\r\n    /** @property {float} m_xPixelSize - canvas pixel size in mm for x axis */\r\n    this.m_xPixelSize = -1; // in mm\r\n    /** @property {float} yPixelSize - canvas pixel size in mm for y axis */\r\n    this.m_yPixelSize = -1; // in mm\r\n    /** @property {Object} m_linesMaterial - line material object */\r\n    //const R_MATERIAL = 0.86;\r\n    //const G_MATERIAL = 0.59;\r\n    //const B_MATERIAL = 0.17;\r\n    //this.m_linesMaterial = new MaterialColor2d(R_MATERIAL, G_MATERIAL, B_MATERIAL);\r\n    const linesMaterial = new MaterialColor2d();\r\n    this.m_linesMaterial = linesMaterial.create();\r\n    /** @property {Array} m_distances - array of pairs (line, text), contains all visible measurements */\r\n    this.m_distances = [];\r\n    /** @property {Array} m_vertexes - array of pairs (x, y) */\r\n    this.m_vertexes = [];\r\n    /** @property {float} m_xStart - start x coordinate for current not fixed line */\r\n    this.m_xStart = -1;\r\n    /** @property {float} m_yStart - start y coordinate for current not fixed line */\r\n    this.m_yStart = -1;\r\n    /** @property {float} m_textWidthScr - text width in [0..2] */\r\n    this.m_textWidthScr = 0.03;\r\n    /** @property {Object} m_textColor - text color */\r\n    this.m_textColor = 'rgba(255, 255, 255, 255)';\r\n    /** @property {Object} m_textBgColor - text background color */\r\n    this.m_textBgColor = 'rgb(65, 65, 65)';\r\n    /** @property {float} m_zoom - size zoom */\r\n    this.m_zoom = 1;\r\n  }\r\n  /**\r\n   * Remove all distance lines from scene\r\n   */\r\n  clearLines() {\r\n    const length = this.m_distances.length;\r\n    for (let i = 0; i < length; ++i) {\r\n      const dist = this.m_distances.pop();\r\n      this.m_scene.remove(dist.line.getRenderObject());\r\n      this.m_scene.remove(dist.text);\r\n    }\r\n    this.m_runningState = false;\r\n    this.m_vertexes = [];\r\n  }\r\n  /**\r\n   * Redraw all lines\r\n   */\r\n  updateLines(zoom, posX, posY) {\r\n    const COUNT_POINTS = 2;\r\n    const MODULO_1 = 1;\r\n    const length = this.m_distances.length;\r\n    for (let i = 0; i < length; ++i) {\r\n      this.m_scene.remove(this.m_distances[i].line.getRenderObject());\r\n      this.m_scene.remove(this.m_distances[i].text);\r\n      const xS = (this.m_vertexes[COUNT_POINTS * i].xZ - posX) / zoom - (1 - 1 / zoom);\r\n      const yS = (this.m_vertexes[COUNT_POINTS * i].yZ - posY) / zoom + (1 - 1 / zoom);\r\n      if (this.m_vertexes[COUNT_POINTS * i + 1] == null) {\r\n        break;\r\n      }\r\n      const xE = (this.m_vertexes[COUNT_POINTS * i + MODULO_1].xZ - posX) / zoom - (1 - 1 / zoom);\r\n      const yE = (this.m_vertexes[COUNT_POINTS * i + MODULO_1].yZ - posY) / zoom + (1 - 1 / zoom);\r\n      const line = new Line2D(this.m_scene, this.m_lineWidth, xS, yS, xE, yE, this.m_linesMaterial);\r\n      this.m_distances[i].line = line;\r\n      this.m_distances[i].text.updateText(0.5 * (xS + xE) - 0.00, 0.5 * (yS + yE) - 0.00, this.m_textWidthScr,\r\n        MeshText2D.ALIGN_CENTER, MeshText2D.ALIGN_CENTER, this.m_textBgColor, this.m_textColor);\r\n      this.m_scene.add(this.m_distances[i].text);\r\n    }\r\n  }\r\n  /**\r\n   * Update zoom\r\n   */\r\n  updateZoom(zoom) {\r\n    this.m_zoom = zoom;\r\n  }\r\n  /**\r\n   * Set pixel size in mm\r\n   * @param (float) xPixelSize - canvas pixel size in mm for x axis\r\n   * @param (float) yPixelSize - canvas pixel size in mm for y axis\r\n   */\r\n  setPixelSize(xPixelSize, yPixelSize) { // in mm\r\n    this.m_xPixelSize = xPixelSize;\r\n    this.m_yPixelSize = yPixelSize;\r\n  }\r\n  /**\r\n   * Return running state\r\n   * @return {boolean} True if last line has not been fixed yet\r\n   */\r\n  isRunning() {\r\n    return this.m_runningState;\r\n  }\r\n  /**\r\n   * Mouse down events handler\r\n   * @param (float) x - mouse x coordinate\r\n   * @param (float) y - mouse y coordinate\r\n   */\r\n  onMouseDown(x, y, zoom, posX, posY) {\r\n    this.m_runningState = !this.m_runningState;\r\n    const xZ = (x + (1 - 1 / zoom)) * zoom + posX;\r\n    const yZ = (y - (1 - 1 / zoom)) * zoom + posY;\r\n    if (this.m_runningState) {\r\n      this.m_xStart = x;\r\n      this.m_yStart = y;\r\n\r\n      const line = new Line2D(this.m_scene, this.m_lineWidth, x, y, x, y, this.m_linesMaterial);\r\n      const strMsg = '0 mm';\r\n      const text = new MeshText2D(strMsg);\r\n      text.updateText(x, y, this.m_textWidthScr, MeshText2D.ALIGN_CENTER,\r\n        MeshText2D.ALIGN_CENTER, this.m_textBgColor, this.m_textColor);\r\n      this.m_scene.add(text);\r\n      this.m_distances.push({ line, text });\r\n      this.m_vertexes.push({ xZ, yZ });\r\n    } else {\r\n      this.m_vertexes.push({ xZ, yZ });\r\n      this.m_xStart = -1;\r\n      this.m_yStart = -1;\r\n    }\r\n  }\r\n  test() {\r\n    new Line2D(this.m_scene, this.m_lineWidth, -1.0, 1.0, -0.5, 0.5, this.m_linesMaterial);\r\n  }\r\n  /**\r\n   * Mouse move events handler\r\n   * @param (float) x - mouse x coordinate\r\n   * @param (float) y - mouse y coordinate\r\n   */\r\n  onMouseMove(x, y, zoom) {\r\n    if (this.m_runningState) {\r\n      const dist = this.m_distances.pop();\r\n      this.m_scene.remove(dist.line.getRenderObject());\r\n      const line = new Line2D(this.m_scene, this.m_lineWidth, this.m_xStart, this.m_yStart, x, y, this.m_linesMaterial);\r\n      this.m_scene.remove(dist.text);\r\n      const strMsg = `${(zoom * (Math.sqrt((x - this.m_xStart) * (x - this.m_xStart)\r\n        * this.m_xPixelSize * this.m_xPixelSize +\r\n        // eslint-disable-next-line\r\n        (y - this.m_yStart) * (y - this.m_yStart) * this.m_yPixelSize * this.m_yPixelSize))).toFixed(2)} mm`;\r\n      const text = new MeshText2D(strMsg);\r\n      text.updateText(0.5 * (x + this.m_xStart) - 0.00, 0.5 * (y + this.m_yStart) - 0.00, this.m_textWidthScr,\r\n        MeshText2D.ALIGN_CENTER, MeshText2D.ALIGN_CENTER, this.m_textBgColor, this.m_textColor);\r\n      this.m_scene.add(text);\r\n      this.m_distances.push({ line, text });\r\n    }\r\n  }\r\n  updateVertexes(zoom, posX, posY) {\r\n    this.m_vertexes = [];\r\n    for (let i = 0; i < this.m_distances.length; ++i) {\r\n      let xZ = (this.m_distances[i].line.getxS() + (1 - 1 / zoom)) * zoom + posX;\r\n      let yZ = (this.m_distances[i].line.getyS() - (1 - 1 / zoom)) * zoom + posY;\r\n      this.m_vertexes.push({ xZ, yZ });\r\n      xZ = (this.m_distances[i].line.getxE() + (1 - 1 / zoom)) * zoom + posX;\r\n      yZ = (this.m_distances[i].line.getyE() - (1 - 1 / zoom)) * zoom + posY;\r\n      this.m_vertexes.push({ xZ, yZ });\r\n    }\r\n  }\r\n}\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* 2d simplest graphics engine\r\n* @module app/scripts/graphics2d/graphics23d\r\n*/\r\n\r\nimport * as THREE from 'three';\r\n\r\n// import MaterialTex2d from '../gfx/mattex2d';\r\n// import MaterialColor2d from '../gfx/matcolor2d';\r\n// import MeshText2D from './meshtext2d';\r\n// import Line2D from './line2d';\r\n// import Circle2D from './circle2d';\r\nimport DistanceTool from './distancetool';\r\n// import AngleTool from './angletool';\r\n// import AreaTool from './areatool';\r\n// import ZoomTool from './zoomtool';\r\n// import RectTool from './recttool';\r\n// import MoveTool from './movetool';\r\n// import DeleteTool from './deletetool';\r\n// import EditTool from './edittool';\r\n// import TextTool from './texttool';\r\n\r\n/**  @constant {number} SCENE_3D_BACKGROUND_COLOR - backgroudn color for 3d window */\r\n// const SCENE_2D_BACKGROUND_COLOR = 0xbbbbff; // 0x00\r\n\r\n/** Possible 2d tools */\r\nconst tools2d = {\r\n  INTENSITY: 'intensity',\r\n  DISTANCE: 'distance',\r\n  ANGLE: 'angle',\r\n  AREA: 'area',\r\n  RECT: 'rect',\r\n  TEXT: 'text',\r\n  GRAD: 'grad',\r\n  COBR: 'cobr',\r\n  BIFI: 'bifi',\r\n  ZOOM: 'zoom',\r\n  DELETE: 'delete',\r\n  EDIT: 'edit',\r\n};\r\n\r\n/** Class Graphics2d is used for simple debug style 2d render */\r\nexport default class Graphics23d {\r\n\r\n  /**\r\n  * Initialize render\r\n  * @param (object) container - object container for 3d rendering\r\n  * @param (int) width - 2d canvas width\r\n  * @param (int) height - 2d canvas height\r\n  * @return {Object} Intsance of this class (singleton)\r\n  */\r\n  constructor(scene, width, height) {\r\n    this.m_width = width;\r\n    this.m_height = height;\r\n    this.m_material = null;\r\n    this.m_mesh = null;\r\n    console.log(`Graphics2d create size = ${width} * ${height}`);\r\n    this.m_scene = scene;\r\n\r\n    this.m_materialsTex2d = null;\r\n    this.m_material = null;\r\n\r\n    //construct edit and move tools\r\n    this.m_zoom = 1;\r\n    this.m_savePosX = 0;\r\n    this.m_savePosY = 0;\r\n    this.m_posX = 0;\r\n    this.m_posY = 0;\r\n    this.m_move = false;\r\n    this.m_wProjScreen = width;\r\n    this.m_hProjScreen = height;\r\n\r\n    this.m_showTileTexture = false;\r\n\r\n    // prepare for render 2d lines on screen\r\n    const xw = 1.0 / width;\r\n    const yw = 1.0 / height;\r\n    const TWICE = 2.0;\r\n    this.m_lineWidth = TWICE * ((xw > yw) ? xw : yw);\r\n    this.m_lineWidth = 0.002;\r\n\r\n    this.m_textTime = -1000;\r\n    this.m_text = null;\r\n    this.m_toolType = tools2d.DISTANCE;\r\n    //this.m_toolType = tools2d.INTENSITY;\r\n    this.m_distanceTool = new DistanceTool(this.m_scene, this.m_lineWidth);\r\n    /*this.m_angleTool = new AngleTool(this.m_scene, this.m_lineWidth);\r\n    this.m_areaTool = new AreaTool(this.m_scene, this.m_lineWidth);\r\n    this.m_rectTool = new RectTool(this.m_scene, this.m_lineWidth);\r\n    this.m_textTool = new TextTool(this.m_scene);\r\n    this.m_zoomTool = new ZoomTool(this.m_zoom);\r\n    this.m_moveTool = new MoveTool(this.m_zoom, this.m_posX, this.m_posY);\r\n    this.m_deleteTool = new DeleteTool(this.m_scene, this.m_lineWidth);\r\n    this.m_editTool = new EditTool(this.m_scene, this.m_lineWidth);\r\n    */\r\n    //this.m_distanceTool.test();\r\n  } // end of constructor\r\n  set2dToolType(toolType) {\r\n    this.m_toolType = toolType;\r\n  }\r\n  /**\r\n   * Callback on file loaded\r\n   */\r\n  onFileLoaded() {\r\n    this.m_distanceTool.clearLines();\r\n    this.m_angleTool.clearLines();\r\n    this.m_areaTool.clearLines();\r\n    this.m_rectTool.clearLines();\r\n    this.m_textTool.clear();\r\n    this.m_deleteTool.clearLines();\r\n    this.m_editTool.clearLines();\r\n  }\r\n  clear2DTools() {\r\n    this.m_distanceTool.clearLines();\r\n    this.m_angleTool.clearLines();\r\n    this.m_areaTool.clearLines();\r\n    this.m_rectTool.clearLines();\r\n    this.m_textTool.clear();\r\n    this.m_deleteTool.clearLines();\r\n    this.m_editTool.clearLines();\r\n  }\r\n  default2DTools() {\r\n    this.m_zoom = 1;\r\n    this.m_posX = 0;\r\n    this.m_posY = 0;\r\n    this.m_savePosX = 0;\r\n    this.m_savePosY = 0;\r\n    this.m_materialsTex2d.m_uniforms.posX.value = this.m_posX;\r\n    this.m_materialsTex2d.m_uniforms.posY.value = this.m_posY;\r\n    this.m_materialsTex2d.m_uniforms.zoom.value = this.m_zoom;\r\n    this.updateLines();\r\n  }\r\n  fov2Tan(fov) {\r\n    const HALF = 0.5;\r\n    return Math.tan(THREE.Math.degToRad(HALF * fov));\r\n  }\r\n  tan2Fov(tan) {\r\n    const TWICE = 2.0;\r\n    return THREE.Math.radToDeg(Math.atan(tan)) * TWICE;\r\n  }\r\n  /**\r\n  * Keyboard event handler\r\n  * @param (number) keyCode - keyboard code\r\n  * @param (Boolean) debug - true if debug false otherwise\r\n  */\r\n  onKeyDown(keyCode, debug) {\r\n    // console.log(`onKeyDown: ${keyCode}`);\r\n    // const KEY_CODE_G = 71;\r\n    if (debug) {\r\n      // if (keyCode === KEY_CODE_G) {\r\n      //   this.debugShowSliceFrom2dTiles();\r\n      // }\r\n    }\r\n  }\r\n  /**\r\n  * Mouse events handler\r\n  * xScr, yScr in [0..1] is normalized mouse coordinate in screen\r\n  */\r\n  onMouseDown(xScr, yScr) {\r\n    if ((this.m_volumeData === null) || (this.m_volumeHeader === null)) {\r\n      return;\r\n    }\r\n    if ((xScr > this.m_wProjScreen) || (yScr > this.m_hProjScreen)) {\r\n      // out of image\r\n      return;\r\n    }\r\n    if (this.m_levelSetMode) {\r\n      return;\r\n    }\r\n\r\n    const TWICE = 2.0;\r\n    const xt = xScr * TWICE - 1.0;\r\n    const yt = yScr * TWICE - 1.0;\r\n    //const yt = (1.0 - yScr) * TWICE - 1.0;\r\n\r\n    switch (this.m_toolType) {\r\n    case tools2d.DISTANCE:\r\n      this.m_distanceTool.onMouseDown(xt, yt, this.m_zoom, this.m_posX * (this.m_wProjScreen),\r\n        this.m_posY * (this.m_hProjScreen));\r\n      break;\r\n    case tools2d.ANGLE:\r\n      this.m_angleTool.onMouseDown(xt, yt, this.m_zoom, this.m_posX * (this.m_wProjScreen),\r\n        this.m_posY * (this.m_hProjScreen));\r\n      break;\r\n    case tools2d.TEXT:\r\n      this.m_textTool.onMouseDown(xt, yt, this.m_zoom, this.m_posX * (this.m_wProjScreen),\r\n        this.m_posY * (this.m_hProjScreen));\r\n      break;\r\n    case tools2d.AREA:\r\n      this.m_areaTool.onMouseDown(xt, yt, this.m_zoom, this.m_posX * (this.m_wProjScreen),\r\n        this.m_posY * (this.m_hProjScreen));\r\n      break;\r\n    case tools2d.RECT:\r\n      this.m_rectTool.onMouseDown(xt, yt, this.m_zoom, this.m_posX * (this.m_wProjScreen),\r\n        this.m_posY * (this.m_hProjScreen));\r\n      break;\r\n    case tools2d.GRAD:\r\n      break;\r\n    case tools2d.COBR:\r\n    /*this.m_contrastBrightTool.onMouseDown(xt, yt);\r\n          this.m_materialsTex2d.m_uniforms.contrast.value = this.m_contrastBrightTool.m_contrast;\r\n          this.m_materialsTex2d.m_uniforms.brightness.value = this.m_contrastBrightTool.m_brightness;\r\n          this.m_materialsTex2d.m_uniforms.COBRflag.value = this.m_contrastBrightTool.m_COBRflag;*/\r\n      break;\r\n    case tools2d.BIFI:\r\n      /*this.m_filterTool.onMouseDown(xt, yt);\r\n          this.m_materialsTex2d.m_uniforms.sigma.value = this.m_filterTool.m_sigma;\r\n          this.m_materialsTex2d.m_uniforms.sigmaB.value = this.m_filterTool.m_sigmaB;\r\n          this.m_materialsTex2d.m_uniforms.BIFIflag.value = this.m_filterTool.m_BIFIflag;*/\r\n      break;\r\n    case tools2d.ZOOM:\r\n      this.m_move = true;\r\n      this.m_moveTool.onMouseDown(xt, yt);\r\n      break;\r\n    case tools2d.DELETE:\r\n      this.m_deleteTool.onMouseDown(xt, yt, this.m_distanceTool.m_distances, this.m_angleTool.m_angles,\r\n        this.m_rectTool.m_areas, this.m_areaTool.m_distances, this.m_textTool.m_textArr,\r\n        this.m_distanceTool.m_vertexes, this.m_angleTool.m_vertexes, this.m_rectTool.m_vertexes,\r\n        this.m_areaTool.m_vertexes2, this.m_areaTool.m_last_lengths, this.m_areaTool.m_vertexes, this.m_areaTool,\r\n        this.m_textTool.m_vertexes);\r\n      console.log(`${this.m_areaTool.last_length}`);\r\n      break;\r\n    case tools2d.EDIT:\r\n      this.m_editTool.onMouseDown();\r\n      break;\r\n    default:\r\n      console.log('Unexpected 2d tool');\r\n      break;\r\n    }\r\n  }\r\n  /**\r\n   * Mouse events handler\r\n   * xScr, yScr in [0..1] is normalized mouse coordinate in screen\r\n   */\r\n  onMouseUp(xScr, yScr) {\r\n    if ((this.m_volumeData === null) || (this.m_volumeHeader === null)) {\r\n      return;\r\n    }\r\n    if ((xScr > this.m_wProjScreen) || (yScr > this.m_hProjScreen)) {\r\n      // out of image\r\n      return;\r\n    }\r\n    const TWICE = 2.0;\r\n    const xt = xScr * TWICE - 1.0;\r\n    const yt = yScr * TWICE - 1.0;\r\n    //const yt = (1.0 - yScr) * TWICE - 1.0;\r\n\r\n    if (this.m_levelSetMode) {\r\n      // only for first step of level set\r\n      if (this.m_levelSetCircle !== null) {\r\n        this.clearLevelSetCenter();\r\n      }\r\n      this.drawLevelSetCenter(xt, yt);\r\n      return;\r\n    }\r\n    switch (this.m_toolType) {\r\n    case tools2d.DISTANCE:\r\n      break;\r\n    case tools2d.ANGLE:\r\n      break;\r\n    case tools2d.AREA:\r\n      break;\r\n    case tools2d.RECT:\r\n      break;\r\n    case tools2d.TEXT:\r\n      break;\r\n    case tools2d.COBR:\r\n      break;\r\n    case tools2d.BIFI:\r\n      break;\r\n    case tools2d.ZOOM:\r\n      this.m_move = false;\r\n      this.m_moveTool.onMouseUp();\r\n      this.m_savePosX = this.m_posX;\r\n      this.m_savePosY = this.m_posY;\r\n      break;\r\n    case tools2d.DELETE:\r\n      break;\r\n    case tools2d.EDIT:\r\n      this.m_editTool.onMouseUp();\r\n      break;\r\n    default:\r\n      console.log('Unexpected 2d tool');\r\n      break;\r\n    }\r\n  }\r\n  /**\r\n   * Mouse move event handler\r\n   * @param (float) xScr - normalized mouse x coordinate in screen\r\n   * @param (float) yScr - normalized mouse y coordinate in screen\r\n   */\r\n  onMouseMove(xScr, yScr) {\r\n    if ((this.m_volumeData === null) || (this.m_volumeHeader === null)) {\r\n      return;\r\n    }\r\n    if ((xScr > this.m_wProjScreen) || (yScr > this.m_hProjScreen)) {\r\n      // out of image\r\n      return;\r\n    }\r\n    const TWICE = 2.0;\r\n    const xt = xScr * TWICE - 1.0;\r\n    const yt = yScr * TWICE - 1.0;\r\n    //const yt = (1.0 - yScr) * TWICE - 1.0;\r\n\r\n    switch (this.m_toolType) {\r\n    case tools2d.DISTANCE:\r\n      this.m_distanceTool.onMouseMove(xt, yt, this.m_zoom);\r\n      break;\r\n    case tools2d.ANGLE:\r\n      this.m_angleTool.onMouseMove(xt, yt);\r\n      break;\r\n    case tools2d.AREA:\r\n      this.m_areaTool.onMouseMove(xt, yt);\r\n      break;\r\n    case tools2d.RECT:\r\n      this.m_rectTool.onMouseMove(xt, yt, this.m_zoom);\r\n      break;\r\n    case tools2d.TEXT:\r\n      break;\r\n    case tools2d.GRAD:\r\n      break;\r\n    case tools2d.COBR:\r\n      /*this.m_contrastBrightTool.onMouseMove(xt, yt);\r\n        this.m_materialsTex2d.m_uniforms.contrast.value = this.m_contrastBrightTool.m_contrast;\r\n        this.m_materialsTex2d.m_uniforms.brightness.value = this.m_contrastBrightTool.m_brightness;\r\n        this.m_materialsTex2d.m_uniforms.COBRflag.value = this.m_contrastBrightTool.m_COBRflag;*/\r\n      break;\r\n    case tools2d.BIFI:\r\n      /*this.m_filterTool.onMouseMove(xt, yt);\r\n        this.m_materialsTex2d.m_uniforms.sigma.value = this.m_filterTool.m_sigma;\r\n        this.m_materialsTex2d.m_uniforms.sigmaB.value = this.m_filterTool.m_sigmaB;\r\n        this.m_materialsTex2d.m_uniforms.BIFIflag.value = this.m_filterTool.m_BIFIflag;*/\r\n      break;\r\n    case tools2d.ZOOM:\r\n      if (this.m_move) {\r\n        this.updateMove(xt, yt);\r\n      }\r\n      break;\r\n    case tools2d.DELETE:\r\n      this.m_deleteTool.onMouseMove(xt, yt, this.m_zoom, this.m_distanceTool.m_distances, this.m_angleTool.m_angles,\r\n        this.m_rectTool.m_areas, this.m_areaTool.m_distances, this.m_textTool.m_textArr);\r\n      break;\r\n    case tools2d.EDIT: // TO DO: add text tool\r\n      this.m_editTool.onMouseMove(xt, yt, this.m_zoom, this.m_distanceTool.m_distances, this.m_angleTool.m_angles,\r\n        this.m_rectTool.m_areas, this.m_areaTool.m_distances, this.m_areaTool, this.m_textTool,\r\n        this.m_posX * (this.m_wProjScreen), this.m_posY * (this.m_hProjScreen));\r\n      //this.m_areaTool.updateVertexes(this.m_zoom, this.m_posX * (this.m_wProjScreen), this.m_posY *\r\n      // (this.m_hProjScreen));\r\n      this.m_distanceTool.updateVertexes(this.m_zoom, this.m_posX * (this.m_wProjScreen),\r\n        this.m_posY * (this.m_hProjScreen));\r\n      this.m_angleTool.updateVertexes(this.m_zoom, this.m_posX * (this.m_wProjScreen),\r\n        this.m_posY * (this.m_hProjScreen));\r\n      break;\r\n    default:\r\n      console.log('Unexpected 2d tool');\r\n      break;\r\n    }\r\n  }\r\n  /**\r\n   * Mouse events handler\r\n   * xScr, yScr in [0..1] is normalized mouse coordinate in screen\r\n   */\r\n  onMouseWheel(wheelDeltaY) {\r\n    switch (this.m_toolType) {\r\n    case tools2d.DISTANCE:\r\n      break;\r\n    case tools2d.ANGLE:\r\n      break;\r\n    case tools2d.AREA:\r\n      break;\r\n    case tools2d.RECT:\r\n      break;\r\n    case tools2d.TEXT:\r\n      break;\r\n    case tools2d.COBR:\r\n      break;\r\n    case tools2d.BIFI:\r\n      break;\r\n    case tools2d.ZOOM:\r\n      this.m_zoomTool.onMouseWheel(wheelDeltaY);\r\n      this.updateZoom();\r\n      this.createMarkLinesAndText();\r\n      break;\r\n    case tools2d.DELETE:\r\n      break;\r\n    case tools2d.EDIT:\r\n      break;\r\n    default:\r\n      console.log('Unexpected 2d tool');\r\n      break;\r\n    }\r\n  }\r\n  updateLines() {\r\n    this.m_distanceTool.updateLines(this.m_zoom, this.m_posX * this.m_wProjScreen, this.m_posY * this.m_hProjScreen);\r\n    this.m_angleTool.updateLines(this.m_zoom, this.m_posX * this.m_wProjScreen, this.m_posY * this.m_hProjScreen);\r\n    this.m_rectTool.updateLines(this.m_zoom, this.m_posX * this.m_wProjScreen, this.m_posY * this.m_hProjScreen);\r\n    this.m_textTool.updateAll(this.m_zoom, this.m_posX * this.m_wProjScreen, this.m_posY * this.m_hProjScreen);\r\n    this.m_areaTool.updateLines(this.m_zoom, this.m_posX * this.m_wProjScreen, this.m_posY * this.m_hProjScreen);\r\n    this.m_deleteTool.updateLines(this.m_zoom, this.m_posX * this.m_wProjScreen, this.m_posY * this.m_hProjScreen);\r\n    this.m_editTool.updateLines(this.m_zoom, this.m_posX * this.m_wProjScreen, this.m_posY * this.m_hProjScreen);\r\n  }\r\n  updateMove(xt, yt) {\r\n    const TWICE = 2;\r\n    const delta = (TWICE - TWICE * this.m_zoom);\r\n    const coord = this.m_moveTool.onMouseMove(xt, yt);\r\n    if (((this.m_savePosX + coord.x) <= Math.abs(delta)) && ((this.m_savePosX + coord.x) > 0)) {\r\n      this.m_posX = this.m_savePosX + coord.x;\r\n      this.m_materialsTex2d.m_uniforms.posX.value = this.m_posX;\r\n    } else if (this.m_savePosX + coord.x > Math.abs(delta)) {\r\n      this.m_posX = Math.abs(delta);\r\n      this.m_materialsTex2d.m_uniforms.posX.value = this.m_posX;\r\n    } else {\r\n      this.m_posX = 0;\r\n      this.m_materialsTex2d.m_uniforms.posX.value = this.m_posX;\r\n    }\r\n\r\n    if (((this.m_savePosY + coord.y) >= (-1) * Math.abs(delta)) && ((this.m_savePosY + coord.y) < 0)) {\r\n      this.m_posY = this.m_savePosY + coord.y;\r\n      this.m_materialsTex2d.m_uniforms.posY.value = this.m_posY;\r\n    } else if (this.m_savePosY + coord.y < (-1) * Math.abs(delta)) {\r\n      this.m_posY = (-1) * Math.abs(delta);\r\n      this.m_materialsTex2d.m_uniforms.posY.value = this.m_posY;\r\n    } else {\r\n      this.m_posY = 0;\r\n      this.m_materialsTex2d.m_uniforms.posY.value = this.m_posY;\r\n    }\r\n    this.updateLines();\r\n  }\r\n  updateZoom() {\r\n    const TWICE = 2;\r\n    this.m_materialsTex2d.m_uniforms.zoom.value = this.m_zoomTool.m_zoom;\r\n    this.m_zoom = this.m_zoomTool.m_zoom;\r\n    const delta = (TWICE - TWICE * this.m_zoom);\r\n    if (this.m_posX > delta) {\r\n      this.m_posX = delta;\r\n      this.m_materialsTex2d.m_uniforms.posX.value = this.m_posX;\r\n    }\r\n    if ((this.m_posY < (-1) * delta) && (this.m_posY < 0)) {\r\n      this.m_posY = (-1) * delta;\r\n      this.m_materialsTex2d.m_uniforms.posY.value = this.m_posY;\r\n    }\r\n    this.updateLines();\r\n  }\r\n  updateText() {\r\n    //this.m_pickTool.update();\r\n  }\r\n  static shortenString(str) {\r\n    const MAX_ITEM_LEN = 20;\r\n    const SHORT_ITEM_PART = 5;\r\n    let strRet = str;\r\n    const pnl = str.length;\r\n    if (pnl > MAX_ITEM_LEN) {\r\n      const strBegin = str.substring(0, SHORT_ITEM_PART + 1);\r\n      const strEnd = str.substring(pnl - SHORT_ITEM_PART, pnl);\r\n      strRet = `${strBegin}...${strEnd}`;\r\n    }\r\n    return strRet;\r\n  }\r\n}","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n * 3D volume/isosurface rendering engine\r\n * @module app/scripts/engine/VolumeRenderer3d\r\n */\r\n\r\nimport * as THREE from 'three';\r\n//import {ThreeCSG} from '../../../THREE.CSG.js'\r\n// import swal from 'sweetalert';\r\n\r\nimport GlSelector from './GlSelector';\r\nimport OrbitControl from './orbitcontrol';\r\nimport MaterialBF from './gfx/matbackface';\r\nimport MaterialFF from './gfx/matfrontface';\r\nimport MaterialWC from './gfx/matwireframecull';\r\nimport MaterialScreenTexMap from './gfx/matscreentexmapping';\r\nimport MaterialClipPlane from './gfx/matclipplane';\r\nimport MaterialRenderToTexture from './gfx/matrendertotexture';\r\nimport MaterialInterpolation from './gfx/matinterpolation';\r\nimport MaterialVolumeRender from './gfx/matvolumerender';\r\nimport VolumeFilter3D from './volumeFilter3d';\r\nimport RoiPalette from './loaders/roipalette';\r\nimport TetrahedronGenerator from './actvolume/tetra';\r\nimport Graphics23d from './tools23d/graphics23d';\r\nimport { StoreActionType } from '../../../context/constants';\r\n// import MaterialColor2d from './gfx/matcolor2d';\r\n\r\n\r\n// import GlCheck from './glcheck';\r\n// import GeoRender from '../actvolume/georender';\r\n\r\n/**  @constant {number} SCENE_3D_BACKGROUND_COLOR - backgroudn color for 3d window */\r\nconst SCENE_3D_BACKGROUND_COLOR = 0x0;\r\n// our blue: rgb(14, 15, 18) - rgb(149, 175, 205)\r\nconst VOLUME_COLOR1_MIN_R =  0.1;\r\nconst VOLUME_COLOR1_MIN_G =  0.0;\r\nconst VOLUME_COLOR1_MIN_B =  0.0;\r\n\r\nconst VOLUME_COLOR3_MIN_R = 0.0;\r\nconst VOLUME_COLOR3_MIN_G = 0.8;\r\nconst VOLUME_COLOR3_MIN_B = 0.0;\r\n\r\nconst VOLUME_COLOR1_MAX_R = 149.0 / 255.0;// 1.0;\r\nconst VOLUME_COLOR1_MAX_G = 175.0 / 255.0;// 0.0;\r\nconst VOLUME_COLOR1_MAX_B = 205.0 / 255.0;// 0.0;\r\n\r\n//our red = rgb(205, 149, 149)\r\nconst VOLUME_COLOR2_MIN_R = 205 / 255.0;\r\nconst VOLUME_COLOR2_MIN_G = 149 / 255.0;\r\nconst VOLUME_COLOR2_MIN_B = 149 / 255.0;\r\nconst VOLUME_COLOR2_MAX_R = 108 / 255.0;\r\nconst VOLUME_COLOR2_MAX_G = 78 / 255.0;\r\nconst VOLUME_COLOR2_MAX_B = 78 / 255.0;\r\n\r\nconst STEP_SIZE1 = 0.0025;\r\nconst STEP_SIZE2 = 0.0033;\r\nconst STEP_SIZE3 = 0.0025;\r\nconst STEP_SIZE4 = 0.0029;\r\n\r\n// const STEP_SIZE1 = 250.0/255.0;\r\n// const STEP_SIZE2 = 250.0/255.0;\r\n// const STEP_SIZE3 = 250.0/255.0;\r\n// const STEP_SIZE4 = 250.0/255.0;\r\n\r\nconst OPACITY_SCALE = 175.0;\r\n//const MIN_FPS = 10;\r\n\r\n// Special values to check frame buffer\r\nconst CHECK_MODE_NOT_CHECKED = 0;\r\nconst CHECK_MODE_RESULT_OK = 1;\r\n// const CHECK_MODE_RESULT_BAD = 2;\r\n\r\n// When scene is ready (how much materials are created via arrow functions)\r\nconst SCENE_READY_COUNTER_OK = 5;\r\n\r\n// Scene render type\r\nconst SCENE_TYPE_RAYCAST = 0;\r\nconst SCENE_TYPE_SPHERE = 1;\r\n\r\n//4d matrix orientations\r\nconst ANTERIOR_AXIAL = [-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];\r\nconst CORONAL = [-1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1];\r\n\r\n/** Class Graphics3d is used for 3d render */\r\nexport default class VolumeRenderer3d {\r\n\r\n  /**\r\n   * Initialize render\r\n   * @param (object) props - object container for various properties\r\n   * @param (object) curFileDataType - file type\r\n   * @return {Object} Instance of this class (singleton)\r\n   */\r\n  constructor(props) {\r\n    this.curFileDataType = props.curFileDataType;\r\n    this.sceneReadyCounter = 0;\r\n    this.renderCounter = 0;\r\n    this.scene = new THREE.Scene();\r\n    this.sceneClipPlane = new THREE.Scene();\r\n\r\n    // tetra scene seems to be unused!\r\n    // this.sceneTetra = new THREE.Scene();\r\n\r\n    this.scene23D = new THREE.Scene();\r\n    this.graphics23d = null;\r\n    this.sceneSphere = new THREE.Scene();\r\n    this.meshSphere = null;\r\n    this.newScene = new THREE.Scene();\r\n    this.renderScene = SCENE_TYPE_RAYCAST;\r\n\r\n    this.planeGeometry = null;\r\n    this.props = props;\r\n    this.mesh = null;\r\n    this.renderer = null;\r\n    this.texTF = null;\r\n    this.volTexture = null;\r\n    this.origVolumeTex = null;\r\n    this.texRoiId = null;\r\n    this.texRoiColor = null;\r\n    this.RoiVolumeTex = null;\r\n    this.volTextureMask = null;\r\n    this.texVolumeAO = null;\r\n    this.bfTexture = null;\r\n    this.ffTexture = null;\r\n    this.renderToTexture = null;\r\n    this.geometry = null;\r\n    this.geometrySphere = null;\r\n    this.geometryWireFrameSphere = null;\r\n    this.matBF = null;\r\n    this.matFF = null;\r\n    this.matScreenTex = null;\r\n    this.matWireFrame = null;\r\n    this.matRenderToTexture = null;\r\n    //this.matInterpolation = null;\r\n    this.matVolumeRender = null;\r\n    this.volumeUpdater = null;\r\n    this.checkFrameBufferMode = CHECK_MODE_NOT_CHECKED;\r\n    this.eraserStarted = false;\r\n    this.lockEraserBuffersUpdating = false;\r\n\r\n    this.SPOTcolor = new THREE.Vector3(1,0,0);\r\n    this.volumeOpacity = 1;\r\n    this.showSolids = true;\r\n\r\n    this.dispatch = props.dispatch;\r\n    this.volumeReady = false;\r\n\r\n    // eslint-disable-next-line\r\n    this.planeCenterPt = new THREE.Vector3(-0.5, -0.5, 0.5 * 1.4);\r\n    // this.renderer = new THREE.WebGLRenderer({ antialias: false, logarithmicDepthBuffer: false });\r\n    // this.renderer = new THREE.WebGLRenderer({ antialias: false }\r\n    // this.canvas3d = document.createElementNS('http://www.w3.org/1999/xhtml', 'canvas');\r\n    const glSelector = new GlSelector();\r\n    this.context = glSelector.createWebGLContext();\r\n    this.isWebGL2 = glSelector.useWebGL2();\r\n    this.canvas3d = glSelector.getCanvas();\r\n    this.renderer = new THREE.WebGLRenderer({\r\n      antialias: false, canvas: this.canvas3d,\r\n      preserveDrawingBuffer: true, context: this.context\r\n    });\r\n    this.renderer.autoClearStencil = false;\r\n    this.renderer.autoClearColor = false;\r\n    if (!this.renderer) {\r\n      console.log('cant create 3d renderer');\r\n    }\r\n\r\n    // Assign current window to render area\r\n    this.windowWidth = Math.floor(props.width);\r\n    // eslint-disable-next-line\r\n    this.windowHeight = Math.floor(props.height);\r\n    // console.log(\"Window: \" + this.windowWidth + \"x\" + this.windowHeight);\r\n    console.log(`Window: ${this.windowWidth} x ${this.windowHeight}`);\r\n    const camAspect = this.windowWidth / this.windowHeight;\r\n    // eslint-disable-next-line\r\n    this.camera = new THREE.PerspectiveCamera(60, camAspect, 0.01, 3);\r\n    this.camera.position.z = 10;\r\n    this.renderer.setSize(this.windowWidth, this.windowHeight);\r\n\r\n    this.renderer.setClearColor(SCENE_3D_BACKGROUND_COLOR);\r\n\r\n    /*if (root3dContainer.length === 1) {\r\n      root3dContainer.append(this.renderer.domElement);\r\n    } else {\r\n      console.log('containter with id=med3web-container-3d not found in scene');\r\n    }*/\r\n    props.mount.appendChild(this.renderer.domElement);\r\n    // When rotating an object, it is necessary to reverse the rotation of\r\n    // the cutting plane and the direction vector onto the light source\r\n    // this.orbitControl = new OrbitControl(root3dContainer, this.camera, this.scene, this.meshSphere, () => {\r\n    this.orbitControl = new OrbitControl(this.renderer.domElement, this.camera, this.scene, this.mesh, () => {\r\n      if (true) {\r\n      //  if (this.checkFrameBufferMode === CHECK_MODE_RESULT_OK) {\r\n        this.updateCutPlanes();\r\n        this.updateLightDir();\r\n        //this.updateMeshSphere();\r\n      }\r\n    });\r\n    //this.orbitControl.addCallbacks();\r\n\r\n    // tetra geometry seems to be unused!\r\n    // this.createTetraGeometry();\r\n\r\n    this.renderer.gammaInput = true;\r\n    this.renderer.gammaOutput = true;\r\n\r\n    this.RENDER_STATE = {\r\n      ENABLED : 0,\r\n      ONCE : 1,\r\n      DISABLED : 2\r\n    };\r\n\r\n    this.renderState = this.RENDER_STATE.ENABLED;\r\n    this.fps = 0;\r\n    this.isoThreshold = 0.0;\r\n    /*root3dContainer.on('mousedown', (event) => {\r\n      const domElem = root3dContainer.get(0);\r\n      const box = domElem.getBoundingClientRect();\r\n      const containerX = event.clientX - box.left;\r\n      const containerY = event.clientY - box.top;\r\n      this.onMouseDown(containerX, this.windowHeight - containerY, event.ctrlKey);\r\n    });\r\n    root3dContainer.on('mouseup', () => { this.onMouseUp(); });\r\n    root3dContainer.on('mousemove', (event) => {\r\n      const domElem = root3dContainer.get(0);\r\n      const box = domElem.getBoundingClientRect();\r\n      const containerX = event.clientX - box.left;\r\n      const containerY = event.clientY - box.top;\r\n      this.onMouseMove(containerX, this.windowHeight - containerY, event.ctrlKey);\r\n    });\r\n    root3dContainer.on('DOMMouseScroll', (e) => { this.onMouseWheel(e); });\r\n    root3dContainer.on('mousewheel', (e) => { this.onMouseWheel(e); });*/\r\n    this.isEraseMode = false;\r\n    this.eraserRadius = 10;\r\n    this.eraserDepth = 20;\r\n    this.eraserSrart = false;\r\n    this.lockEraserBuffersUpdating = false;\r\n    this.eraserMouseDown = false;\r\n    this.m_eraser = null;\r\n\r\n    this.isSculptingMode = false;\r\n    this.sculptingCapturedVertex = null;\r\n    this.sculptingSphereCenter = new THREE.Vector3(0.0, 0.0, 0.0);\r\n    this.sculptingSphereSize = 1.0;\r\n    this.vBoxVirt = {\r\n      x: 1.0,\r\n      y: 1.0,\r\n      z: 1.0,\r\n    };\r\n\r\n  }\r\n  setFileDataType(curFileDataType) {\r\n    this.curFileDataType = curFileDataType;\r\n  }\r\n  /**\r\n  * Special scene with sphere: remove old before adding new one\r\n  */\r\n  removeSphereFromSphereScene() {\r\n    if (this.meshSphere !== null) {\r\n      this.sceneSphere.remove(this.meshSphere);\r\n    }\r\n    this.meshSphere = null;\r\n    this.geometrySphere = null;\r\n  }\r\n  /**\r\n  * Special scene with sphere: add new generated Three js geometry (sphere)\r\n  */\r\n  addSphereToSphereScene() {\r\n    const gen = new TetrahedronGenerator();\r\n    const vRadius = new THREE.Vector3(0.5, 0.5, 0.5);\r\n    const NUM_SUBDIVIDES = 2;\r\n    const okCreateTetra = gen.create(vRadius, NUM_SUBDIVIDES);\r\n    if (okCreateTetra < 1) {\r\n      return okCreateTetra;\r\n    }\r\n    const numVertices = gen.getNumVertices();\r\n    const numTriangles = gen.getNumTriangles();\r\n    const INDICES_IN_TRI = 3;\r\n\r\n    // console.log(`TetrahedronGenerator. numVertices = ${numVertices}, numTriangles = ${numTriangles}`);\r\n\r\n    const NUM_0 = 0;\r\n    const NUM_1 = 1;\r\n    const NUM_2 = 2;\r\n    const NUM_3 = 3;\r\n    const positions = [];\r\n    const indices = [];\r\n    const normals = [];\r\n    // copy vertices from generator\r\n    for (let i = 0; i < numVertices; i++) {\r\n      const vert = gen.getVertex(i);\r\n      const vNew = new THREE.Vector3(vert.x, vert.y, vert.z);\r\n      positions.push(vert.x, vert.y, vert.z);\r\n      vNew.normalize();\r\n      normals.push(vNew.x, vNew.y, vNew.z);\r\n    } // for (i) all vertices\r\n    // copy triangles from generator\r\n    for (let i = 0, j = 0; i < numTriangles; i++, j += INDICES_IN_TRI) {\r\n      const triIndices = gen.getTriangle(i);\r\n      //const faceNew = new THREE.Face3(triIndices[NUM_0], triIndices[NUM_1], triIndices[NUM_2]);\r\n      indices.push(triIndices[NUM_0], triIndices[NUM_1], triIndices[NUM_2]);\r\n    } // for (i) all triangles\r\n    // old style: buffered geometry\r\n    this.geometrySphere = new THREE.BufferGeometry();\r\n    const posAttribute = new Float32Array(positions);\r\n    const normalsAttribute = new Float32Array(normals);\r\n    const indAttribute = new Uint8Array(indices);\r\n\r\n    this.geometrySphere.addAttribute('position', new THREE.BufferAttribute(posAttribute, NUM_3));\r\n    this.geometrySphere.addAttribute('normal', new THREE.BufferAttribute(normalsAttribute, NUM_3));\r\n    this.geometrySphere.setIndex(new THREE.BufferAttribute(indAttribute, 1));\r\n    this.computeGeometrySphereUVs();\r\n    this.meshSphere = new THREE.Mesh(this.geometrySphere);\r\n    this.sceneSphere.add(this.meshSphere);\r\n    return this.meshSphere;\r\n  }\r\n  /**\r\n  * Special scene with sphere: copy rotated (by mouse) orientation from\r\n  * main mesh to sphere mesh\r\n  */\r\n  updateMeshSphere() {\r\n  /*\r\n    if (this.meshSphere !== null) {\r\n      const pos = this.mesh.position;\r\n      const quat = this.mesh.quaternion;\r\n      this.meshSphere.position.copy(pos);\r\n      this.meshSphere.quaternion.copy(quat);\r\n      this.meshSphere.updateMatrix();\r\n    }\r\n  */\r\n  }\r\n  /**\r\n   * Returns true if the maderial for VolumeRender is set\r\n   */\r\n  isVolumeLoaded() {\r\n    return (this.matVolumeRender !== null);\r\n  }\r\n  fov2Tan(fov) {\r\n    const HALF = 0.5;\r\n    return Math.tan(THREE.Math.degToRad(HALF * fov));\r\n  }\r\n  tan2Fov(tan) {\r\n    const TWICE = 2.0;\r\n    return THREE.Math.radToDeg(Math.atan(tan)) * TWICE;\r\n  }\r\n  /**\r\n   * Get screen copy image from current render\r\n   *\r\n   * @param {number} width Desired image width\r\n   * @param {number} height Desired image height\r\n   * @return {Object} Image with 3d renderer output (as URI string)\r\n   */\r\n  screenshot(width, height) {\r\n    if (this.renderer === null) {\r\n      return null;\r\n    }\r\n    let screenshotImage = null;\r\n    if (typeof width === 'undefined') {\r\n      screenshotImage = this.renderer.domElement.toDataURL('image/png');\r\n    } else {\r\n      // width and height are specified\r\n      const originalAspect = this.camera.aspect;\r\n      const originalFov = this.camera.fov;\r\n      const originalTanFov2 = this.fov2Tan(this.camera.fov);\r\n\r\n      // screen shot should contain the principal area of interest (a centered square touching screen sides)\r\n      const areaOfInterestSize = Math.min(this.windowWidth, this.windowHeight);\r\n      const areaOfInterestTanFov2 = originalTanFov2 * areaOfInterestSize / this.windowHeight;\r\n\r\n      // set appropriate camera aspect & FOV\r\n      const shotAspect = width / height;\r\n      this.camera.aspect = shotAspect;\r\n      this.camera.fov = this.tan2Fov(areaOfInterestTanFov2 / Math.min(shotAspect, 1.0));\r\n      this.camera.updateProjectionMatrix();\r\n\r\n      // resize canvas to the required size of screen shot\r\n      this.renderer.setSize(width, height);\r\n\r\n      // make screen shot\r\n      this.render();\r\n      screenshotImage = this.renderer.domElement.toDataURL('image/png');\r\n\r\n      // restore original camera & canvas proportions\r\n      this.camera.aspect = originalAspect;\r\n      this.camera.fov = originalFov;\r\n      this.camera.updateProjectionMatrix();\r\n      this.renderer.setSize(this.windowWidth, this.windowHeight);\r\n      this.render();\r\n    }\r\n    return screenshotImage;\r\n  }\r\n  /**\r\n   * Setting a MaskFlag\r\n   */\r\n  setMaskFlag(MaskFlag) {\r\n    this.matVolumeRender.defines.MaskFlag = MaskFlag;\r\n    this.matVolumeRender.needsUpdate = true;\r\n    this.matRenderToTexture.defines.MaskFlag = MaskFlag;\r\n    this.matRenderToTexture.needsUpdate = true;\r\n  }\r\n  /**\r\n   * Setting a variable for conditional compilation (Volume Render)\r\n   */\r\n  switchToTool23D(isTool23D) {\r\n    this.Tool23D = isTool23D;\r\n    if (this.Tool23D) {\r\n      this.graphics23d = new Graphics23d(this.scene23D, this.windowWidth, this.windowHeight);\r\n    }\r\n    else {\r\n      this.graphics23d = null;\r\n    }\r\n  }\r\n  switchToVolumeRender() {\r\n    if (this.matVolumeRender !== null && this.matRenderToTexture !== null) {\r\n      if (this.isRoiVolume > 0) {\r\n        this.matVolumeRender.defines.isoRenderFlag = 4;\r\n        this.matVolumeRender.needsUpdate = true;\r\n        //this.matInterpolation.defines.isoRenderFlag = 4;\r\n        //this.matInterpolation.needsUpdate = true;\r\n        this.matRenderToTexture.defines.isoRenderFlag = 4;\r\n        this.matRenderToTexture.needsUpdate = true;\r\n        this.renderState = this.RENDER_STATE.ONCE;\r\n      } else {\r\n        this.matVolumeRender.defines.isoRenderFlag = 0;\r\n        this.matVolumeRender.needsUpdate = true;\r\n        //this.matInterpolation.defines.isoRenderFlag = 0;\r\n        //this.matInterpolation.needsUpdate = true;\r\n        this.matRenderToTexture.defines.isoRenderFlag = 0;\r\n        this.matRenderToTexture.needsUpdate = true;\r\n        this.renderState = this.RENDER_STATE.ONCE;\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * Setting a variable for conditional compilation (Full Volume Render)\r\n   */\r\n  switchToFullVolumeRender() {\r\n    if (this.matVolumeRender !== null && this.matRenderToTexture !== null) {\r\n      if (this.isRoiVolume > 0) {\r\n        this.matVolumeRender.defines.isoRenderFlag = 4;\r\n        this.matVolumeRender.needsUpdate = true;\r\n        //this.matInterpolation.defines.isoRenderFlag = 4;\r\n        //this.matInterpolation.needsUpdate = true;\r\n        this.matRenderToTexture.defines.isoRenderFlag = 4;\r\n        this.matRenderToTexture.needsUpdate = true;\r\n        this.renderState = this.RENDER_STATE.ONCE;\r\n      } else {\r\n        this.matVolumeRender.defines.isoRenderFlag = 3;\r\n        this.matVolumeRender.needsUpdate = true;\r\n        //this.matInterpolation.defines.isoRenderFlag = 3;\r\n        //this.matInterpolation.needsUpdate = true;\r\n        this.matRenderToTexture.defines.isoRenderFlag = 3;\r\n        this.matRenderToTexture.needsUpdate = true;\r\n        this.renderState = this.RENDER_STATE.ONCE;\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * Setting a variable for conditional compilation (Isosurface render)\r\n   */\r\n  switchToIsosurfRender() {\r\n    if (this.matVolumeRender !== null && this.matRenderToTexture !== null) {\r\n      if (this.isRoiVolume > 0) {\r\n        this.matVolumeRender.defines.isoRenderFlag = 5;\r\n        this.matVolumeRender.needsUpdate = true;\r\n        //this.matInterpolation.defines.isoRenderFlag = 5;\r\n        //this.matInterpolation.needsUpdate = true;\r\n        this.matRenderToTexture.defines.isoRenderFlag = 5;\r\n        this.matRenderToTexture.needsUpdate = true;\r\n        this.renderState = this.RENDER_STATE.ONCE;\r\n        this.volumeUpdater.switchToRoiMapRender();\r\n      } else {\r\n        this.matVolumeRender.defines.isoRenderFlag = 1;\r\n        this.matVolumeRender.needsUpdate = true;\r\n        //this.matInterpolation.defines.isoRenderFlag = 1;\r\n        //this.matInterpolation.needsUpdate = true;\r\n        this.matRenderToTexture.defines.isoRenderFlag = 1;\r\n        this.matRenderToTexture.needsUpdate = true;\r\n        this.renderState = this.RENDER_STATE.ONCE;\r\n      }\r\n    }\r\n  }\r\n  /**\r\n   * Setting a variable for conditional compilation (Max projection render)\r\n   */\r\n  switchToFLATRender() {\r\n    if (this.matVolumeRender !== null && this.matRenderToTexture !== null) {\r\n      this.matVolumeRender.defines.isoRenderFlag = 2;\r\n      this.matVolumeRender.needsUpdate = true;\r\n      //this.matInterpolation.defines.isoRenderFlag = 2;\r\n      //this.matInterpolation.needsUpdate = true;\r\n      this.matRenderToTexture.defines.isoRenderFlag = 2;\r\n      this.matRenderToTexture.needsUpdate = true;\r\n      this.renderState = this.RENDER_STATE.ONCE;\r\n    }\r\n  }\r\n  /**\r\n   * Setting isosurface threshold\r\n   */\r\n  setIsoThresholdValue(sliderValue) {\r\n    if (this.matVolumeRender !== null && this.matRenderToTexture !== null) {\r\n      this.matRenderToTexture.uniforms.isoThreshold.value = sliderValue;\r\n      this.matRenderToTexture.uniforms.isoThreshold.needsUpdate = true;\r\n      this.matVolumeRender.uniforms.isoThreshold.value = sliderValue;\r\n      this.matVolumeRender.uniforms.isoThreshold.needsUpdate = true;\r\n      this.isoThreshold = sliderValue;\r\n      this.renderState = this.RENDER_STATE.ONCE;\r\n    }\r\n  }\r\n  setVolumeOpacity(value) {\r\n    if (this.matVolumeRender !== null && this.matRenderToTexture !== null) {\r\n      this.matRenderToTexture.uniforms.volumeOpacity.value = value;\r\n      this.matRenderToTexture.uniforms.volumeOpacity.needsUpdate = true;\r\n      this.matVolumeRender.uniforms.volumeOpacity.value = value;\r\n      this.matVolumeRender.uniforms.volumeOpacity.needsUpdate = true;\r\n      this.volumeOpacity = value;\r\n      this.renderState = this.RENDER_STATE.ONCE;\r\n    }\r\n  }\r\n  setSpotColor(r,g,b) {\r\n    if (this.matVolumeRender !== null && this.matRenderToTexture !== null) {\r\n      this.matRenderToTexture.uniforms.SPOTcolor.value = new THREE.Vector3(r,g,b);\r\n      this.matRenderToTexture.uniforms.SPOTcolor.needsUpdate = true;\r\n      this.matVolumeRender.uniforms.SPOTcolor.value = new THREE.Vector3(r,g,b);\r\n      this.matVolumeRender.uniforms.SPOTcolor.needsUpdate = true;\r\n      this.SPOTcolor = new THREE.Vector3(r,g,b);\r\n      this.renderState = this.RENDER_STATE.ONCE;\r\n    }\r\n  }\r\n  showVenousStructure(show) {\r\n    if (this.matVolumeRender !== null && this.matRenderToTexture !== null) {\r\n      this.matRenderToTexture.uniforms.showSolids.value = show;\r\n      this.matRenderToTexture.uniforms.showSolids.needsUpdate = true;\r\n      this.matVolumeRender.uniforms.showSolids.value = show;\r\n      this.matVolumeRender.uniforms.showSolids.needsUpdate = true;\r\n      this.showSolids = show;\r\n      this.renderState = this.RENDER_STATE.ONCE;\r\n    }\r\n  }\r\n  /**\r\n   * Setting volume opacity\r\n   * @param (number) sliderValue - slider ration in 0..1\r\n   */\r\n  setOpacityBarrier(sliderValue) {\r\n    if (this.matVolumeRender !== null && this.matRenderToTexture !== null) {\r\n      this.matVolumeRender.uniforms.opacityBarrier.value = OPACITY_SCALE * sliderValue;\r\n      this.matVolumeRender.uniforms.opacityBarrier.needsUpdate = true;\r\n      this.matRenderToTexture.uniforms.opacityBarrier.value = OPACITY_SCALE * sliderValue;\r\n      this.matRenderToTexture.uniforms.opacityBarrier.needsUpdate = true;\r\n    }\r\n  }\r\n  /**\r\n   * Setting Brightness\r\n   * @param (number) value - brightness of ???\r\n   */\r\n  updateBrightness(value) {\r\n    if (this.matRenderToTexture !== null) {\r\n      this.matRenderToTexture.uniforms.brightness3D.value = value;\r\n      this.matRenderToTexture.uniforms.brightness3D.needsUpdate = true;\r\n    }\r\n    if (this.matVolumeRender !== null) {\r\n      this.matVolumeRender.uniforms.brightness3D.value = value;\r\n      this.matVolumeRender.uniforms.brightness3D.needsUpdate = true;\r\n      // this.volumeUpdater.updateVolumeTexture(0.1 + 1.5*value);\r\n    }\r\n  }\r\n  /**\r\n   * Setting Contrast\r\n   * @param (number) value - constrast of ???\r\n   */\r\n  updateContrast(value) {\r\n    if (this.matVolumeRender !== null && this.matRenderToTexture !== null) {\r\n      this.matRenderToTexture.uniforms.contrast3D.value = value;\r\n      this.matVolumeRender.uniforms.contrast3D.value = value;\r\n      this.matRenderToTexture.uniforms.contrast3D.needsUpdate = true;\r\n      this.matVolumeRender.uniforms.contrast3D.needsUpdate = true;\r\n    }\r\n  }\r\n  setAmbientTextureMode(isoThreshold) {\r\n    if (this.texVolumeAO) {\r\n      this.texVolumeAO.dispose();\r\n    }\r\n    this.volumeUpdater.ambientTexture.set(this.volTexture, isoThreshold);\r\n    this.texVolumeAO = this.volumeUpdater.ambientTexture.get();\r\n    this.matRenderToTexture.defines.useAmbientTex = 1;\r\n    this.matVolumeRender.defines.useAmbientTex = 1;\r\n    this.matRenderToTexture.needsUpdate = true;\r\n    this.matVolumeRender.needsUpdate = true;\r\n    this.matRenderToTexture.uniforms.texVolumeAO.value = this.texVolumeAO;\r\n    this.matRenderToTexture.uniforms.texVolumeAO.needsUpdate = true;\r\n    this.matVolumeRender.uniforms.texVolumeAO.value = this.texVolumeAO;\r\n    this.matVolumeRender.uniforms.texVolumeAO.needsUpdate = true;\r\n  }\r\n  offAmbientTextureMode() {\r\n    if (this.texVolumeAO) {\r\n      this.texVolumeAO.dispose();\r\n    }\r\n    this.matRenderToTexture.defines.useAmbientTex = 0;\r\n    this.matVolumeRender.defines.useAmbientTex = 0;\r\n    this.matRenderToTexture.needsUpdate = true;\r\n    this.matVolumeRender.needsUpdate = true;\r\n  }\r\n  /**\r\n   * Setting Cut Plane\r\n   * @param (number) value - ???\r\n   */\r\n  updateZCutPlane(value) {\r\n    const Z_MULTIPLIER = 1.4;\r\n    this.planeCenterPt.z = Z_MULTIPLIER * value;\r\n    this.updateCutPlanes();\r\n  }\r\n  /**\r\n   * Setting Transfer Function Params\r\n   * @param (array) values - 3 threshold values for volumetric render\r\n   */\r\n  setTransferFuncVec3(values, colorFlag) {\r\n    if (this.matRenderToTexture !== null) {\r\n      if (colorFlag === 0) {\r\n        this.matRenderToTexture.uniforms.t_function1min.value =\r\n          new THREE.Vector4(VOLUME_COLOR1_MIN_R, VOLUME_COLOR1_MIN_G, VOLUME_COLOR1_MIN_B, values[0]);\r\n      } else {\r\n        this.matRenderToTexture.uniforms.t_function1min.value =\r\n          new THREE.Vector4(VOLUME_COLOR3_MIN_R, VOLUME_COLOR3_MIN_G, VOLUME_COLOR3_MIN_B, values[0]);\r\n      }\r\n      this.matRenderToTexture.uniforms.t_function1min.needsUpdate = true;\r\n      this.matRenderToTexture.uniforms.t_function1max.value =\r\n        new THREE.Vector4(VOLUME_COLOR1_MAX_R, VOLUME_COLOR1_MAX_G, VOLUME_COLOR1_MAX_B, values[1]);\r\n      this.matRenderToTexture.uniforms.t_function1max.needsUpdate = true;\r\n      this.matRenderToTexture.uniforms.t_function2min.value =\r\n        new THREE.Vector4(VOLUME_COLOR2_MIN_R, VOLUME_COLOR2_MIN_G, VOLUME_COLOR2_MIN_B, values[2]);\r\n      this.matRenderToTexture.uniforms.t_function2min.needsUpdate = true;\r\n      this.matRenderToTexture.uniforms.t_function2max.value =\r\n        new THREE.Vector4(VOLUME_COLOR2_MAX_R, VOLUME_COLOR2_MAX_G, VOLUME_COLOR2_MAX_B, values[2]);\r\n      this.matRenderToTexture.uniforms.t_function2max.needsUpdate = true;\r\n      this.matRenderToTexture.uniforms.stepSize.value =\r\n        new THREE.Vector4(STEP_SIZE1, STEP_SIZE2, STEP_SIZE3, STEP_SIZE4);\r\n      this.matRenderToTexture.uniforms.stepSize.needsUpdate = true;\r\n      if (colorFlag === 0) {\r\n        this.matVolumeRender.uniforms.t_function1min.value =\r\n          new THREE.Vector4(VOLUME_COLOR1_MIN_R, VOLUME_COLOR1_MIN_G, VOLUME_COLOR1_MIN_B, values[0]);\r\n      } else {\r\n        this.matVolumeRender.uniforms.t_function1min.value =\r\n          new THREE.Vector4(VOLUME_COLOR3_MIN_R, VOLUME_COLOR3_MIN_G, VOLUME_COLOR3_MIN_B, values[0]);\r\n      }\r\n      this.matVolumeRender.uniforms.t_function1min.needsUpdate = true;\r\n      this.matVolumeRender.uniforms.t_function1max.value =\r\n        new THREE.Vector4(VOLUME_COLOR1_MAX_R, VOLUME_COLOR1_MAX_G, VOLUME_COLOR1_MAX_B, values[1]);\r\n      this.matVolumeRender.uniforms.t_function1max.needsUpdate = true;\r\n      this.matVolumeRender.uniforms.t_function2min.value =\r\n        new THREE.Vector4(VOLUME_COLOR2_MIN_R, VOLUME_COLOR2_MIN_G, VOLUME_COLOR2_MIN_B, values[2]);\r\n      this.matVolumeRender.uniforms.t_function2min.needsUpdate = true;\r\n      this.matVolumeRender.uniforms.t_function2max.value =\r\n        new THREE.Vector4(VOLUME_COLOR2_MAX_R, VOLUME_COLOR2_MAX_G, VOLUME_COLOR2_MAX_B, values[2]);\r\n      this.matVolumeRender.uniforms.t_function2max.needsUpdate = true;\r\n      this.matVolumeRender.uniforms.stepSize.value =\r\n        new THREE.Vector4(STEP_SIZE1, STEP_SIZE2, STEP_SIZE3, STEP_SIZE4);\r\n      this.matVolumeRender.uniforms.stepSize.needsUpdate = true;\r\n    }\r\n  }\r\n  /**\r\n   * Compute 3D texture coordinates on BBOX\r\n   * @param (object) nonEmptyBoxMin - Min corner for non empty box in volume\r\n   * @param (object) nonEmptyBoxMax - Max corner for non empty box in volume\r\n   */\r\n  computeGeometryUVs(nonEmptyBoxMin, nonEmptyBoxMax) {\r\n    this.geometry.computeBoundingBox();\r\n    const VAL_3 = 3;\r\n    const HALF = 0.5;\r\n\r\n    const max = this.geometry.boundingBox.max;\r\n    const min = this.geometry.boundingBox.min;\r\n    const offset = new THREE.Vector3(0 - min.x, 0 - min.y, 0 - min.z);\r\n    const range = new THREE.Vector3(max.x - min.x, max.y - min.y, max.z - min.z);\r\n    this.geo_offset1 = new THREE.Vector3(0, 0, 0);\r\n    this.geo_offset1 = offset;\r\n    this.geo_offset2 = new THREE.Vector3(0, 0, 0);\r\n    this.geo_offset2.x = nonEmptyBoxMin.x + HALF;\r\n    this.geo_offset2.y = nonEmptyBoxMin.y - HALF;\r\n    this.geo_offset2.z = nonEmptyBoxMin.z - HALF;\r\n    this.geo_scale = new THREE.Vector3(0, 0, 0);\r\n    this.geo_scale.x = (nonEmptyBoxMax.x - nonEmptyBoxMin.x) / range.x;\r\n    this.geo_scale.y = (nonEmptyBoxMax.y - nonEmptyBoxMin.y) / range.y;\r\n    this.geo_scale.z = (nonEmptyBoxMax.z - nonEmptyBoxMin.z) / range.z;\r\n\r\n    const NEED_GEO_UVW = true;\r\n    if (NEED_GEO_UVW) {\r\n      const uvw = new Float32Array(this.geometry.getAttribute('position').count * VAL_3);\r\n      for (let i = 0; i < this.geometry.getAttribute('position').count; i++) {\r\n        const vx = this.geometry.getAttribute('position').getX(i);\r\n        const vy = this.geometry.getAttribute('position').getY(i);\r\n        const vz = this.geometry.getAttribute('position').getZ(i);\r\n        // eslint-disable-next-line\r\n        uvw[i * VAL_3 + 0] = -vx;\r\n        // eslint-disable-next-line\r\n        uvw[i * VAL_3 + 1] = vy;\r\n        // eslint-disable-next-line\r\n        uvw[i * VAL_3 + 2] = vz;\r\n      }\r\n      this.geometry.addAttribute('uvw', new THREE.BufferAttribute(uvw, VAL_3));\r\n      this.geometry.getAttribute('uvw').needsUpdate = true;\r\n    }\r\n  }\r\n  computeGeometrySphereUVs() {\r\n    const VAL_3 = 3;\r\n    // Need calculate uvw coords for sphere geo\r\n    const NEED_SPHERE_UVW = true;\r\n    if (NEED_SPHERE_UVW) {\r\n      // console.log(`vBoxVirt = ${this.vBoxVirt.x}, ${this.vBoxVirt.y}, ${this.vBoxVirt.z}`);\r\n      const uvw = new Float32Array(this.geometrySphere.getAttribute('position').count * VAL_3);\r\n      for (let i = 0; i < this.geometrySphere.getAttribute('position').count; i++) {\r\n        const vx = this.geometrySphere.getAttribute('position').getX(i);\r\n        const vy = this.geometrySphere.getAttribute('position').getY(i);\r\n        const vz = this.geometrySphere.getAttribute('position').getZ(i);\r\n        // eslint-disable-next-line\r\n        uvw[i * VAL_3 + 0] = -vx / this.vBoxVirt.x;// / this.vBoxVirt.x; //-(vx + this.geo_offset1.x) * this.geo_scale.x  + this.geo_offset2.x;\r\n        // eslint-disable-next-line\r\n        uvw[i * VAL_3 + 1] = +vy / this.vBoxVirt.y;// / this.vBoxVirt.y; //(vy + this.geo_offset1.y) * this.geo_scale.y  + this.geo_offset2.y;\r\n        // eslint-disable-next-line\r\n        uvw[i * VAL_3 + 2] = +vz / this.vBoxVirt.z;// / this.vBoxVirt.z; //(vz + this.geo_offset1.z) * this.geo_scale.z  + this.geo_offset2.z;\r\n      }\r\n      this.geometrySphere.addAttribute('uvw', new THREE.BufferAttribute(uvw, VAL_3));\r\n      this.geometrySphere.getAttribute('uvw').needsUpdate = true;\r\n    }\r\n\r\n    const NEED_FACE_VERTEX_UVW = false;\r\n    if (NEED_FACE_VERTEX_UVW) {\r\n      this.geometrySphere.faceVertexUvs = [];\r\n      const numVertices = this.geometrySphere.vertices.count;\r\n      const OFF_0 = 0, OFF_1 = 1, OFF_2 = 2;\r\n      const uvw = new Float32Array(numVertices * VAL_3);\r\n      let j = 0;\r\n      for (let i = 0; i < numVertices; i++, j += VAL_3) {\r\n        const vx = this.geometrySphere.vertices[i].x;\r\n        const vy = this.geometrySphere.vertices[i].y;\r\n        const vz = this.geometrySphere.vertices[i].z;\r\n        // this.geometrySphere.faceVertexUvs.push(new THREE.Vector2(vx, vy));\r\n        uvw[j + OFF_0] = -vx;\r\n        uvw[j + OFF_1] = vy;\r\n        uvw[j + OFF_2] = vz;\r\n      } // for (i)\r\n      // this.geometrySphere.addAttribute('uvw', new THREE.BufferAttribute(uvw, VAL_3));\r\n      this.geometrySphere.uvw = uvw;\r\n    } // if need face uv\r\n  }\r\n  createClipPlaneGeometry() {\r\n    const matClipPlane = new MaterialClipPlane();\r\n    matClipPlane.create(this.bfTexture, (mat) => {\r\n      // eslint-disable-next-line\r\n      this.planeGeometry = new THREE.PlaneBufferGeometry(2, 2);\r\n      const plane = new THREE.Mesh(this.planeGeometry, mat);\r\n      this.sceneClipPlane.add(plane);\r\n    });\r\n  }\r\n  updateClipPlaneGeometry() {\r\n    const VAL_3 = 3;\r\n    const uvw = new Float32Array(this.planeGeometry.getAttribute('position').count * VAL_3);\r\n    const l2w = new THREE.Matrix4();\r\n    l2w.getInverse(this.mesh.matrix);\r\n    const invPerspective = new THREE.Matrix4();\r\n    invPerspective.getInverse(this.camera.projectionMatrix);\r\n    const invView = new THREE.Matrix4();\r\n    invView.copy(this.camera.matrixWorld);\r\n    for (let i = 0; i < this.planeGeometry.getAttribute('position').count; i++) {\r\n      const v = new THREE.Vector3();\r\n      const SOME_SMALL_ADD = 0.001;\r\n      v.x = this.planeGeometry.getAttribute('position').getX(i);\r\n      v.y = this.planeGeometry.getAttribute('position').getY(i);\r\n      v.z = this.planeGeometry.getAttribute('position').getZ(i) + SOME_SMALL_ADD;\r\n      v.applyMatrix4(invPerspective);\r\n      v.applyMatrix4(invView);\r\n      v.applyMatrix4(l2w);\r\n      //v.applyMatrix4(this.getScreen2WorldTransform());\r\n      //uvw[i * VAL_3 + 1] = (v.y + this.geo_offset1.y) * this.geo_scale.y + this.geo_offset2.y;\r\n      //uvw[i * VAL_3 + 0] = -(v.x + this.geo_offset1.x) * this.geo_scale.x + this.geo_offset2.x;\r\n      //// eslint-disable-next-line\r\n      //uvw[i * VAL_3 + 1] = (v.y + this.geo_offset1.y) * this.geo_scale.y + this.geo_offset2.y;\r\n      //// eslint-disable-next-line\r\n      //uvw[i * VAL_3 + 2] = (v.z + this.geo_offset1.z) * this.geo_scale.z + this.geo_offset2.z;\r\n\r\n      // eslint-disable-next-line\r\n      uvw[i * VAL_3 + 0] = -v.x;\r\n      // eslint-disable-next-line\r\n      uvw[i * VAL_3 + 1] = v.y;\r\n      // eslint-disable-next-line\r\n      uvw[i * VAL_3 + 2] = v.z;\r\n\r\n    }\r\n    this.planeGeometry.addAttribute('uvw', new THREE.BufferAttribute(uvw, VAL_3));\r\n    this.planeGeometry.getAttribute('uvw').needsUpdate = true;\r\n  }\r\n  getScreen2WorldTransform() {\r\n    const l2w = new THREE.Matrix4();\r\n    l2w.getInverse(this.mesh.matrix);\r\n    const s2w = new THREE.Matrix4();\r\n    s2w.getInverse(this.camera.projectionMatrix);\r\n    const invView = new THREE.Matrix4();\r\n    invView.copy(this.camera.matrixWorld);\r\n    s2w.multiply(invView);\r\n    s2w.multiply(l2w);\r\n    return s2w;\r\n  }\r\n  /**\r\n   * Create geometry and materials for 3D rendering\r\n   * @param (object) box - physic volume box dimensions\r\n   * @param (object) nonEmptyBoxMin - Min corner for non empty box in volume\r\n   * @param (object) nonEmptyBoxMin - Min corner for non empty box in volume\r\n   * @param (bool) isRoiVolume) - is roi volume\r\n   */\r\n  initWithVolume(volume, box, nonEmptyBoxMin, nonEmptyBoxMax, isRoiVolume, isMasked, resetCamera = false, zoom = 0.9, volOpacity = 1.0) {\r\n    const oldMeshMat = this.mesh?.matrix;\r\n    const oldCam = this.camera.clone();\r\n\r\n    let sideMax = (box.x > box.y) ? box.x : box.y;\r\n    sideMax = (box.z > sideMax) ? box.z : sideMax;\r\n    this.vBoxVirt.x = box.x / sideMax;\r\n    this.vBoxVirt.y = box.y / sideMax;\r\n    this.vBoxVirt.z = box.z / sideMax;\r\n    this.isoThreshold = this.curFileDataType.thresholdIsosurf;\r\n    this.volume = volume;\r\n    this.nonEmptyBoxMin = nonEmptyBoxMin;\r\n    this.nonEmptyBoxMax = nonEmptyBoxMax;\r\n    // remove old sphere\r\n    this.matWireFrame = null;\r\n    this.removeSphereFromSphereScene();\r\n\r\n    // create new sphere\r\n    const matWCloader = new MaterialWC();\r\n    this.matWireFrame = matWCloader.create(this.bfTexture, this.ffTexture);\r\n    // const matColor = new MaterialColor2d();\r\n    // this.matColor23d = matColor.create();\r\n\r\n    /*\r\n    console.log(`this.bfTexture`);\r\n    if (this.bfTexture === null) {\r\n      console.log(`this.bfTexture === null`);\r\n      return 1;\r\n    }\r\n    */\r\n    this.addSphereToSphereScene();\r\n\r\n    this.renderScene = SCENE_TYPE_RAYCAST;\r\n    this.sceneReadyCounter = 0;\r\n    this.renderCounter = 0;\r\n    let matBfThreeGS = null;\r\n    let matFfThreeGS = null;\r\n    let matIntetpl = null;\r\n    let matScreenTex = null;\r\n    if (this.sceneClipPlane) {\r\n      this.sceneClipPlane = new THREE.Scene();\r\n    }\r\n    if (!this.scene) {\r\n      return;\r\n    }\r\n    // remove old mesh\r\n    if (this.mesh !== null) {\r\n      this.scene.remove(this.mesh);\r\n    }\r\n\r\n    if (this.geometry !== null) {\r\n      this.geometry.dispose();\r\n    }\r\n    this.mesh = null;\r\n    // Create geometry\r\n    this.geometry = new THREE.BufferGeometry();\r\n    //this.geometry.fromGeometry(new THREE.BoxGeometry(this.vBoxVirt.x, this.vBoxVirt.y, this.vBoxVirt.z));\r\n    this.geometry.fromGeometry(new THREE.BoxGeometry(1.0, 1.0, 1.0));\r\n    // Compute texture coordinates\r\n\r\n    // compute UVW\r\n    this.computeGeometryUVs(nonEmptyBoxMin, nonEmptyBoxMax);\r\n    this.geometry.scale(this.vBoxVirt.x, this.vBoxVirt.y, this.vBoxVirt.z);\r\n\r\n    // Set camera\r\n    // eslint-disable-next-line\r\n    this.camera.position.set(0.0, 0.0, zoom);\r\n    // eslint-disable-next-line\r\n    this.camera.lookAt(new THREE.Vector3(0.0, 0.0, 0.0));\r\n    // Create 3D texture\r\n    const xDim = this.volume.m_xDim;\r\n    const yDim = this.volume.m_yDim;\r\n    const zDim = this.volume.m_zDim;\r\n    console.log(`3D tex size = ${xDim} ${yDim} ${zDim}`);\r\n    if (this.volTexture) {\r\n      this.volTexture.dispose();\r\n    }\r\n    this.eraserStarted = false;\r\n    this.isRoiVolume = isRoiVolume;\r\n    this.roiPalette = null;\r\n    //if (isRoiVolume === true) {\r\n      const palette = new RoiPalette();\r\n      this.roiPalette = palette.getPalette256();\r\n      const BYTES_PER_COLOR = 4;\r\n      const MAGIC_COLOR = 250;\r\n      const OFFS_0 = 0;\r\n      const OFFS_1 = 1;\r\n      const OFFS_2 = 2;\r\n\r\n      const palB = this.roiPalette[MAGIC_COLOR * BYTES_PER_COLOR + OFFS_0];\r\n      const palG = this.roiPalette[MAGIC_COLOR * BYTES_PER_COLOR + OFFS_1];\r\n      const palR = this.roiPalette[MAGIC_COLOR * BYTES_PER_COLOR + OFFS_2];\r\n      console.log(`RoiPalette: pal[250] = ${palR}, ${palG}, ${palB}`);\r\n   // }\r\n    this.volumeUpdater = new VolumeFilter3D();\r\n    // this.engine2d.volumeUpdater = this.volumeUpdater;\r\n    /*const props = {\r\n      volume: this.volume,\r\n      isWebGL2: this.isWebGL2\r\n    };*/\r\n    this.volTexture = this.volumeUpdater.createUpdatableVolumeTex(this.volume, isRoiVolume, this.roiPalette);\r\n    this.origVolumeTex = this.volumeUpdater.origVolumeTex;\r\n    this.texTF = this.volumeUpdater.createTransferFuncTexture();\r\n    //this.volTextureMask = this.volumeUpdater.createUpdatableVolumeMask(this.volume);\r\n\r\n    if (this.volTextureMask) {\r\n      this.volTextureMask.dispose();\r\n    }\r\n    if (this.texVolumeAO) {\r\n      this.texVolumeAO.dispose();\r\n    }\r\n    //this.texVolumeAO = this.volumeUpdater.gettexVolumeAO();\r\n\r\n    if (this.renderer.getContext().getExtension('EXT_color_buffer_float')) {\r\n      if (this.bfTexture) {\r\n        this.bfTexture.dispose();\r\n      }\r\n      // Create Render Target for back face render\r\n      //this.bfTexture = new THREE.WebGLRenderTarget(this.windowWidth * window.devicePixelRatio,\r\n      //this.windowHeight * window.devicePixelRatio, {\r\n      this.bfTexture = new THREE.WebGLRenderTarget(this.windowWidth, this.windowHeight, {\r\n        minFilter: THREE.LinearFilter,\r\n        magFilter: THREE.LinearFilter,\r\n        format: THREE.RGBAFormat,\r\n        type: THREE.FloatType,\r\n        depthBuffer: true,\r\n      });\r\n      const VAL_4 = 4;\r\n      this.bufferBFTextureCPU = new Float32Array(VAL_4 * this.windowWidth * this.windowHeight);\r\n\r\n      if (this.ffTexture) {\r\n        this.ffTexture.dispose();\r\n      }\r\n      // Create Render Target for front face render\r\n      //this.ffTexture = new THREE.WebGLRenderTarget(this.windowWidth * window.devicePixelRatio,\r\n      //this.windowHeight * window.devicePixelRatio, {\r\n      this.ffTexture = new THREE.WebGLRenderTarget(this.windowWidth,\r\n        this.windowHeight, {\r\n          minFilter: THREE.LinearFilter,\r\n          magFilter: THREE.LinearFilter,\r\n          format: THREE.RGBAFormat,\r\n          type: THREE.FloatType,\r\n          depthBuffer: true,\r\n        });\r\n      this.bufferFFTextureCPU = new Float32Array(VAL_4 * this.windowWidth * this.windowHeight);\r\n\r\n      if (this.renderfTexture) {\r\n        this.renderToTexture.dispose();\r\n      }\r\n      // Create Render Target for volume render to texture\r\n      const VAL_3 = 3;\r\n      this.xSmallTexSize = Math.floor(this.windowWidth / VAL_3);\r\n      this.ySmallTexSize = Math.floor(this.windowHeight / VAL_3);\r\n      //this.renderToTexture = new THREE.WebGLRenderTarget((this.windowWidth * window.devicePixelRatio) / VAL_3,\r\n      //(this.windowHeight * window.devicePixelRatio) / VAL_3, {\r\n      this.renderToTexture = new THREE.WebGLRenderTarget(this.xSmallTexSize,\r\n        this.ySmallTexSize, {\r\n          minFilter: THREE.NearestFilter,\r\n          magFilter: THREE.NearestFilter,\r\n          format: THREE.RGBAFormat,\r\n          type: THREE.FloatType,\r\n          depthBuffer: true,\r\n        });\r\n      this.bufferRenderToTextureCPU = new Float32Array(VAL_4 * this.xSmallTexSize * this.ySmallTexSize);\r\n    } else {\r\n      console.log('cant create float texture');\r\n    }\r\n\r\n    this.createClipPlaneGeometry();\r\n\r\n    if (this.matWireFrame) {\r\n      this.matWireFrame.uniforms.texBF.value = this.bfTexture;\r\n      this.matWireFrame.uniforms.texBF.needsUpdate = true;\r\n      this.matWireFrame.uniforms.texFF.value = this.ffTexture;\r\n      this.matWireFrame.uniforms.texFF.needsUpdate = true;\r\n    }\r\n\r\n    // create material for screen texture mapping\r\n    // Used to map backface texture to frontface geom\r\n    matScreenTex = new MaterialScreenTexMap();\r\n    this.matScreenTex = matScreenTex.create(this.ffTexture);\r\n    // Create material for back face render\r\n    matBfThreeGS = new MaterialBF();\r\n    matBfThreeGS.create((mat) => {\r\n      this.matBF = mat;\r\n      this.sceneReadyCounter++;\r\n    });\r\n\r\n    // Create material for front face render\r\n    matFfThreeGS = new MaterialFF();\r\n    matFfThreeGS.m_uniforms.PlaneX.value = new THREE.Vector4(-1.0, 0.0, 0.0, 0.5);\r\n    matFfThreeGS.m_uniforms.PlaneY.value = new THREE.Vector4(0.0, -1.0, 0.0, 0.5);\r\n    matFfThreeGS.m_uniforms.PlaneZ.value = new THREE.Vector4(0.0, 0.0, -1.0, 0.5);\r\n    matFfThreeGS.create(this.bfTexture.texture, (mat) => {\r\n      this.matFF = mat;\r\n      this.sceneReadyCounter++;\r\n    });\r\n\r\n    // this.scene.background = new THREE.Color( 0xf0f0f0 );\r\n\r\n    //     this.scene.add( new THREE.AmbientLight( 0xffffff, 0.3 ) );\r\n\r\n    // Create mesh\r\n    this.mesh = new THREE.Mesh(this.geometry);\r\n\r\n\r\n    if (resetCamera && oldMeshMat) {\r\n      //set camera stuff to what it was before\r\n      this.mesh.rotation.setFromRotationMatrix(oldMeshMat);\r\n\r\n      this.camera.copy(oldCam, true);\r\n      this.camera.updateMatrixWorld();\r\n    } else {\r\n        //set to anterior axial by default\r\n        const matrix = new THREE.Matrix4();\r\n        matrix.identity();\r\n        matrix.set(...ANTERIOR_AXIAL);\r\n        this.mesh.rotation.setFromRotationMatrix(matrix);\r\n        if (this.meshSphere) {\r\n            this.meshSphere.rotation.setFromRotationMatrix(matrix);\r\n        }\r\n    }\r\n\r\n    //console.log(`startRot = ${this.curFileDataType.startRotX} ${this.curFileDataType.startRotY}`);\r\n    this.orbitControl.setMesh(this.mesh);\r\n    this.orbitControl.setWireMesh(this.meshSphere);\r\n\r\n    // Create material for volume render to texture\r\n    const offsets = [];\r\n    const nOffs = 64;\r\n    // create offsets for ssao\r\n    for (let i = 0; i < nOffs; ++i) {\r\n      // eslint-disable-next-line\r\n      const x = Math.random() * 2 - 1;\r\n      // eslint-disable-next-line\r\n      const y = Math.random() * 2 - 1;\r\n      // eslint-disable-next-line\r\n//      const z = Math.random() * 2 - 1;\r\n      const z = -Math.random();\r\n      offsets.push(new THREE.Vector3(x, y, z));\r\n    }\r\n\r\n    const uniformsToKeep = ['volumeOpacity', 'SPOTcolor', 'showSolids'];\r\n    const backupUniforms = (ref) =>\r\n      ref && uniformsToKeep.reduce( (ret, uniformName) => ({...ret, [uniformName]: ref.m_uniforms[uniformName]}), {});\r\n\r\n    const restoreUniforms = (ref, backup) =>\r\n      backup && Object.keys(backup).forEach(uniformName => ref.m_uniforms[uniformName] = backup[uniformName]);\r\n\r\n    let oldUniforms = backupUniforms(this.matRenderToTextureThreeGS);\r\n\r\n    this.matRenderToTextureThreeGS = new MaterialRenderToTexture();\r\n\r\n    restoreUniforms(this.matRenderToTextureThreeGS, oldUniforms);\r\n\r\n    this.matRenderToTextureThreeGS.m_uniforms.colorMap1D.value = this.colorMapTexture;\r\n    this.matRenderToTextureThreeGS.create(this.texTF, this.volTexture,\r\n      null, this.texVolumeAO, this.bfTexture.texture, this.ffTexture.texture, offsets,\r\n      //this.volTextureMask, this.texVolumeAO, this.bfTexture.texture, this.ffTexture.texture, offsets,\r\n      (mat) => {\r\n        mat.uniforms.t_function1min.value =\r\n          new THREE.Vector4(VOLUME_COLOR1_MIN_R, VOLUME_COLOR1_MIN_G, VOLUME_COLOR1_MIN_B,\r\n            this.curFileDataType.thresholdTissue1);\r\n        mat.uniforms.t_function1max.value =\r\n          new THREE.Vector4(VOLUME_COLOR1_MAX_R, VOLUME_COLOR1_MAX_G, VOLUME_COLOR1_MAX_B,\r\n            this.curFileDataType.thresholdTissue2);\r\n        mat.uniforms.t_function2min.value =\r\n          new THREE.Vector4(VOLUME_COLOR2_MIN_R, VOLUME_COLOR2_MIN_G, VOLUME_COLOR2_MIN_B,\r\n            this.curFileDataType.thresholdIsosurf);\r\n        mat.uniforms.t_function2max.value =\r\n          new THREE.Vector4(VOLUME_COLOR2_MAX_R, VOLUME_COLOR2_MAX_G, VOLUME_COLOR2_MAX_B,\r\n            this.curFileDataType.thresholdIsosurf);\r\n        mat.uniforms.stepSize.value =\r\n          new THREE.Vector4(STEP_SIZE1, STEP_SIZE2, STEP_SIZE3, STEP_SIZE4);\r\n        mat.uniforms.texSize.value = xDim;//this.engine2d.m_volumeHeader.m_pixelWidth;\r\n        mat.uniforms.isoThreshold.value = this.curFileDataType.thresholdIsosurf;\r\n        mat.uniforms.brightness3D.value = this.curFileDataType.brightness;\r\n        mat.uniforms.opacityBarrier.value = OPACITY_SCALE * this.curFileDataType.opacityTissue;\r\n        //mat.uniforms.volumeOpacity.value = volOpacity;\r\n        mat.uniforms.volumeSizeZ.value = zDim;\r\n\r\n        mat.uniforms.xDim.value = xDim;\r\n        mat.uniforms.yDim.value = yDim;\r\n\r\n        mat.uniforms.lightDir.value = new THREE.Vector3(this.curFileDataType.lightDirComp,\r\n          this.curFileDataType.lightDirComp, this.curFileDataType.lightDirComp);\r\n        mat.uniforms.needsUpdate = true;\r\n        this.matRenderToTexture = mat;\r\n        this.sceneReadyCounter++;\r\n      });\r\n\r\n    // Create material for interpolation\r\n    matIntetpl = new MaterialInterpolation();\r\n    const VAL_3 = 3.0;\r\n    matIntetpl.m_uniforms.isoSurfTexel.value = new THREE.Vector2(VAL_3 / this.windowWidth,\r\n      VAL_3 / this.windowHeight);\r\n    matIntetpl.create(this.renderToTexture.texture, (mat) => {\r\n      mat.uniforms.needsUpdate = true;\r\n      //this.matInterpolation = mat;\r\n      this.sceneReadyCounter++;\r\n    });\r\n\r\n    // more save view options\r\n    oldUniforms = backupUniforms(this.matSkullThreeGS);\r\n\r\n    // Create material for main pass of volume render\r\n    this.matSkullThreeGS = new MaterialVolumeRender();\r\n\r\n    restoreUniforms(this.matSkullThreeGS, oldUniforms);\r\n\r\n    this.matSkullThreeGS.m_uniforms.isoSurfTexel.value = new THREE.Vector2(VAL_3 / this.windowWidth,\r\n      VAL_3 / this.windowHeight);\r\n    this.matSkullThreeGS.m_uniforms.colorMap1D.value = this.colorMapTexture;\r\n    this.matSkullThreeGS.create(this.texTF, this.volTexture,\r\n      null, this.texVolumeAO, this.bfTexture.texture, this.ffTexture.texture,\r\n      //this.volTextureMask, this.texVolumeAO, this.bfTexture.texture, this.ffTexture.texture,\r\n      this.renderToTexture.texture, offsets, (mat) => {\r\n        mat.uniforms.t_function1min.value =\r\n          new THREE.Vector4(VOLUME_COLOR1_MIN_R, VOLUME_COLOR1_MIN_G, VOLUME_COLOR1_MIN_B, this.curFileDataType.thresholdTissue1);\r\n        mat.uniforms.t_function1max.value =\r\n          new THREE.Vector4(VOLUME_COLOR1_MAX_R, VOLUME_COLOR1_MAX_G, VOLUME_COLOR1_MAX_B, this.curFileDataType.thresholdTissue2);\r\n        mat.uniforms.t_function2min.value =\r\n          new THREE.Vector4(VOLUME_COLOR2_MIN_R, VOLUME_COLOR2_MIN_G, VOLUME_COLOR2_MIN_B, this.curFileDataType.thresholdIsosurf);\r\n        mat.uniforms.t_function2max.value =\r\n          new THREE.Vector4(VOLUME_COLOR2_MAX_R, VOLUME_COLOR2_MAX_G, VOLUME_COLOR2_MAX_B, this.curFileDataType.thresholdIsosurf);\r\n        mat.uniforms.stepSize.value =\r\n          new THREE.Vector4(STEP_SIZE1, STEP_SIZE2, STEP_SIZE3, STEP_SIZE4);\r\n        mat.uniforms.texSize.value = xDim;\r\n        mat.uniforms.isoThreshold.value = this.curFileDataType.thresholdIsosurf;\r\n        mat.uniforms.brightness3D.value = this.curFileDataType.brightness;\r\n        //mat.uniforms.volumeOpacity.value = volOpacity;\r\n        mat.uniforms.volumeSizeZ.value = zDim;\r\n\r\n        mat.uniforms.xDim.value = xDim;\r\n        mat.uniforms.yDim.value = yDim;\r\n\r\n        mat.uniforms.opacityBarrier.value = OPACITY_SCALE * this.curFileDataType.opacityTissue;\r\n        mat.uniforms.lightDir.value = new THREE.Vector3(this.curFileDataType.lightDirComp,\r\n          this.curFileDataType.lightDirComp, this.curFileDataType.lightDirComp);\r\n        mat.uniforms.needsUpdate = true;\r\n        var material = new THREE.MeshLambertMaterial({\r\n            color: 0xff0000,\r\n            shading: THREE.SmoothShading\r\n          })\r\n          var cubeMesh = new THREE.Mesh(new THREE.CubeGeometry(300, 300, 300), material)\r\n          cubeMesh.position.set(0, 0, 0)\r\n          //cubeCSG = ThreeCSGfromMesh(cubeMesh)\r\n        //this.mesh = cubeMesh\r\n        // let meshCSG = ThreeCSG.fromMesh(this.mesh);\r\n        // let cubeMeshCSG = ThreeCSG.fromMesh(cubeMesh);\r\n        // let newmesh = meshCSG.intersect(cubeMeshCSG);\r\n        // this.mesh = newmesh.toMesh(mat);\r\n          this.scene.add(this.mesh);\r\n        //   const geometry = new THREE.BoxGeometry( 20, 20, 20 );\r\n\r\n        //   for ( let i = 0; i < 1500; i ++ ) {\r\n\r\n        //     const object = new THREE.Mesh( geometry, new THREE.MeshLambertMaterial( { color: Math.random() * 0xffffff } ) );\r\n\r\n        //     object.position.x = Math.random() * 800 - 400;\r\n        //     object.position.y = Math.random() * 800 - 400;\r\n        //     object.position.z = Math.random() * 800 - 400;\r\n\r\n        //     this.scene.add( object );\r\n\r\n        // }\r\n        this.matVolumeRender = mat;\r\n        if (isMasked) {\r\n          this.switchToFLATRender();\r\n        } else {\r\n          this.switchToVolumeRender();\r\n        }\r\n        this.mesh.material = this.matVolumeRender;\r\n        this.meshSphere.material = this.matVolumeRender;\r\n        this.sceneReadyCounter++;\r\n      });\r\n    //this.tools23d.set2dToolType(toolType);\r\n    //matSkullThreeGS.m_uniforms.texVolumeMask.value = this.volTextureMask;\r\n  } // callbackCreateCubeVolume\r\n\r\n  isSpinning() {\r\n    return !this.orbitControl.autoRotateInterval;\r\n  }\r\n  setAutoSpin(enable = true) {\r\n    // this.orbitControl.autoSpin(enable);\r\n    this.setAnimate(enable);\r\n    return enable;\r\n  }\r\n\r\n  setAnimate(enable = true) {\r\n    if (this.animateInterval) {\r\n      clearInterval(this.animateInterval);\r\n      this.animateInterval = undefined;\r\n    }\r\n\r\n    if (enable)\r\n      this.animateInterval = setInterval(this._animate.bind(this), 1000/30);\r\n  }\r\n\r\n  _animate() {\r\n    this.orbitControl._autoSpin()\r\n  }\r\n  /**\r\n   * Creates transfer function color map\r\n   * @param ctrlPts Array of control points of type HEX  = color value\r\n   */\r\n  setTransferFuncColors(ctrlPtsColorsHex) {\r\n    this.volumeUpdater.setTransferFuncColors(ctrlPtsColorsHex);\r\n  }\r\n  /**\r\n   * Creates transfer function color map\r\n   * @param ctrlPts Array of Vector2 where (x,y) = x coordinate in [0, 1], alpha value in [0, 1]\r\n   * //intensity [0,255] opacity [0,1]\r\n   */\r\n  updateTransferFuncTexture(intensities, opacities) {\r\n    return this.volumeUpdater.updateTransferFuncTexture(intensities, opacities);\r\n  }\r\n  /**\r\n   * Create 2D texture containing selected ROIs\r\n   * @param selectedROIs 256 byte roi values\r\n   */\r\n  updateSelectedRoiMap(selectedROIs) {\r\n    this.volumeUpdater.updateSelectedRoiMap(selectedROIs);\r\n  }  /**\r\n   * Rotate Cut Plane (Rotation is inverse to the object)\r\n   */\r\n  updateCutPlanes() {\r\n    if (!this.mesh) {\r\n      return;\r\n    }\r\n    const mtx = new THREE.Matrix4();\r\n    if (this.renderScene === SCENE_TYPE_SPHERE) {\r\n      mtx.getInverse(mtx.extractRotation(this.meshSphere.matrix));\r\n    } else {\r\n      mtx.getInverse(mtx.extractRotation(this.mesh.matrix));\r\n    }\r\n    const xAxis = new THREE.Vector3(-1.0, 0.0, 0.0);\r\n    const yAxis = new THREE.Vector3(0.0, -1.0, 0.0);\r\n    const zAxis = new THREE.Vector3(0.0, 0.0, -1.0);\r\n    const centerPt = new THREE.Vector3().copy(this.planeCenterPt);\r\n    centerPt.applyMatrix4(mtx);\r\n    xAxis.applyMatrix4(mtx);\r\n    yAxis.applyMatrix4(mtx);\r\n    zAxis.applyMatrix4(mtx);\r\n    if (this.matFF !== null) {\r\n      this.matFF.uniforms.PlaneX.value.x = xAxis.x;\r\n      this.matFF.uniforms.PlaneX.value.y = xAxis.y;\r\n      this.matFF.uniforms.PlaneX.value.z = xAxis.z;\r\n      this.matFF.uniforms.PlaneX.value.w = -centerPt.dot(xAxis);\r\n\r\n      this.matFF.uniforms.PlaneY.value.x = yAxis.x;\r\n      this.matFF.uniforms.PlaneY.value.y = yAxis.y;\r\n      this.matFF.uniforms.PlaneY.value.z = yAxis.z;\r\n      this.matFF.uniforms.PlaneY.value.w = -centerPt.dot(yAxis);\r\n\r\n      this.matFF.uniforms.PlaneZ.value.x = -zAxis.x;\r\n      this.matFF.uniforms.PlaneZ.value.y = zAxis.y;\r\n      this.matFF.uniforms.PlaneZ.value.z = zAxis.z;\r\n      this.matFF.uniforms.PlaneZ.value.w = -centerPt.dot(zAxis);\r\n    }\r\n  }\r\n  /**\r\n   * Rotate light direction (Rotation is inverse to the object)\r\n   */\r\n  updateLightDir() {\r\n    if (!this.mesh) {\r\n      console.log('UpdateLightDir call mesh is not created');\r\n      return;\r\n    }\r\n\r\n    const mtx = new THREE.Matrix4();\r\n    //mtx.getInverse(mtx.extractRotation(this.mesh.matrix));\r\n    if (this.renderScene === SCENE_TYPE_RAYCAST) {\r\n      mtx.getInverse(mtx.extractRotation(this.mesh.matrix));\r\n    } else {\r\n      mtx.getInverse(mtx.extractRotation(this.meshSphere.matrix));\r\n    }\r\n    const lightDir = new THREE.Vector3(1.0, 1.0, 1.0);\r\n    lightDir.normalize();\r\n    lightDir.applyMatrix4(mtx);\r\n    lightDir.x = -lightDir.x;\r\n    this.matRenderToTexture.uniforms.lightDir.value = lightDir;\r\n    this.matRenderToTexture.uniforms.lightDir.needsUpdate = true;\r\n    this.matVolumeRender.uniforms.lightDir.value = lightDir;\r\n    this.matVolumeRender.uniforms.lightDir.needsUpdate = true;\r\n  }\r\n  setPresetView(view) {\r\n        let orientation = ANTERIOR_AXIAL;\r\n        const matrix = new THREE.Matrix4();\r\n        matrix.identity();\r\n        if (view === 1) {\r\n            orientation = CORONAL\r\n        }\r\n        matrix.set(...orientation);\r\n        this.mesh.rotation.setFromRotationMatrix(matrix);\r\n        if (this.meshSphere) {\r\n            this.meshSphere.rotation.setFromRotationMatrix(matrix);\r\n        }\r\n  }\r\n  /** Check is scene ready to render */\r\n  isReadyToRender() {\r\n    if (this.sceneReadyCounter !== SCENE_READY_COUNTER_OK) {\r\n      return false;\r\n    }\r\n    const matReady = (this.matVolumeRender !== null) && (this.matBF !== null) &&\r\n      (this.matFF !== null) && (this.matRenderToTexture !== null);\r\n    if (!matReady) {\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n  /** Render 3d scene */\r\n  render() {\r\n    if (!this.isReadyToRender()) {\r\n      return;\r\n    }\r\n    if (!this.volumeReady) {\r\n        this.dispatch({ type: StoreActionType.SET_LOADER, showLoader: false});\r\n        this.volumeReady = true;\r\n    }\r\n    const matReady = (this.matVolumeRender !== null) && (this.matBF !== null) &&\r\n      (this.matFF !== null) && (this.matRenderToTexture !== null);\r\n    if (!matReady) {\r\n      // do nothing\r\n    } else {\r\n      // check once render target\r\n      if (this.checkFrameBufferMode === CHECK_MODE_NOT_CHECKED) {\r\n        // const isGood = true;// GlCheck.checkFrameBuffer(this.renderer, this.bfTexture);\r\n        this.checkFrameBufferMode = CHECK_MODE_RESULT_OK;\r\n      }\r\n\r\n      if (this.renderScene === SCENE_TYPE_RAYCAST) {\r\n        this.updateLightDir();\r\n        this.updateClipPlaneGeometry();\r\n        this.updateCutPlanes();\r\n\r\n        this.renderer.setRenderTarget(this.bfTexture);\r\n        this.renderer.clear();\r\n        this.renderer.state.buffers.depth.setClear(0);\r\n        this.scene.overrideMaterial = this.matBF;\r\n        this.renderer.render(this.scene, this.camera, this.bfTexture);\r\n        const glC = this.renderer.getContext();\r\n        if (this.isEraseMode && !this.lockEraserBuffersUpdating) {\r\n          glC.readPixels(0, 0, this.windowWidth, this.windowHeight, glC.RGBA, glC.FLOAT, this.bufferBFTextureCPU);\r\n        }\r\n        this.renderer.setRenderTarget(this.ffTexture);\r\n       this.renderer.clear();\r\n        this.renderer.state.buffers.depth.setClear(1);\r\n        // render clip plane without depth test\r\n        this.renderer.render(this.sceneClipPlane, this.camera, this.ffTexture);\r\n        // enable test again\r\n        this.scene.overrideMaterial = this.matFF;\r\n        this.renderer.render(this.scene, this.camera, this.ffTexture);\r\n        if (this.isEraseMode && !this.lockEraserBuffersUpdating) {\r\n          glC.readPixels(0, 0, this.windowWidth, this.windowHeight, glC.RGBA, glC.FLOAT, this.bufferFFTextureCPU);\r\n        }\r\n\r\n        this.renderer.setRenderTarget();\r\n        this.renderer.clear();\r\n        this.renderer.state.buffers.depth.setClear(0);\r\n\r\n        this.scene.overrideMaterial = this.matRenderToTexture;\r\n        this.renderer.render(this.scene, this.camera, this.renderToTexture);\r\n        if (this.isEraseMode && !this.lockEraserBuffersUpdating) {\r\n          glC.readPixels(0, 0, this.xSmallTexSize, this.ySmallTexSize, glC.RGBA, glC.FLOAT,\r\n            this.bufferRenderToTextureCPU);\r\n        }\r\n        // get a reference to the internal WebGL rendering context\r\n        this.scene.overrideMaterial = null;\r\n        this.renderer.render(this.scene, this.camera);\r\n        // Render wireframe mesh\r\n        this.renderer.autoClearDepth = false;\r\n\r\n        //this.matWireFrame\r\n        //this.renderer.clear();\r\n        if (this.Tool23D) {\r\n          this.renderer.render(this.scene23D, this.camera);\r\n        }\r\n        //this.renderer.render(this.sceneSphereWireFrame, this.camera);\r\n        this.renderer.autoClearDepth = true;\r\n        //this.renderer.clear();\r\n        /*\r\n        this.renderer.clear();\r\n        this.renderer.render(this.scene23D, this.camera);\r\n        */\r\n      }\r\n      this.renderCounter++;\r\n    }\r\n  }\r\n  setStepsize(sliderValue) {\r\n    const A = 100.0;\r\n    const B = 700.0;\r\n    const h = 1.0 / (A + B * sliderValue);\r\n    if (this.matRenderToTexture !== null) {\r\n      this.matRenderToTexture.uniforms.stepSize.value = new THREE.Vector4(h, h, h, h);\r\n      this.matRenderToTexture.uniforms.needsUpdate = true;\r\n    }\r\n    if (this.matVolumeRender !== null) {\r\n      this.matVolumeRender.uniforms.stepSize.value = new THREE.Vector4(h, h, h, h);\r\n      this.matVolumeRender.uniforms.needsUpdate = true;\r\n    }\r\n  }\r\n  /**\r\n  * Get object's vertex (3d) projection on screen, using current object transformation\r\n  *\r\n  * param vPos(THREE.Vector3) - sphere vertex of object\r\n  * param vProjScreen(THREE.Vector2) - screen projection of vertex above\r\n  * return z coordinate of projection on screen. If > 0, then visible\r\n  */\r\n  getVertexProjectionToScreen(vPos, vProjScreen) {\r\n    const vProj = vPos.clone();\r\n    vProj.applyMatrix4(this.meshSphere.matrixWorld);\r\n    vProj.project(this.camera);\r\n    const W_HALF = this.windowWidth * 0.5;\r\n    const H_HALF = this.windowHeight * 0.5;\r\n    const xProj = W_HALF + (W_HALF * vProj.x);\r\n    // it should be H_HALF - (...\r\n    // but we have y axis up in mouse coord system\r\n    const yProj = H_HALF + (H_HALF * vProj.y);\r\n    vProjScreen.x = xProj;\r\n    vProjScreen.y = yProj;\r\n\r\n    const vPrj = vPos.clone();\r\n    vPrj.applyMatrix4(this.meshSphere.matrixWorld);\r\n    vPrj.applyMatrix3(this.camera.normalMatrix);\r\n    // return vProj.z;\r\n    return vPrj.z;\r\n  }\r\n  setEraserMode(isOn) {\r\n    this.isEraseMode = isOn;\r\n    this.orbitControl.setEraserMode(isOn);\r\n    if (!this.eraserStarted && isOn) {\r\n      this.eraserStarted = true;\r\n      const params = {\r\n        xDim: this.volume.m_xDim,\r\n        yDim: this.volume.m_yDim,\r\n        zDim: this.volume.m_zDim,\r\n        bufBF: this.bufferBFTextureCPU,\r\n        bufFF: this.bufferFFTextureCPU,\r\n        bufTex: this.bufferRenderToTextureCPU,\r\n      };\r\n      this.volTextureMask = this.volumeUpdater.createUpdatableVolumeMask(params);\r\n      this.matSkullThreeGS.m_uniforms.texVolumeMask.value = this.volTextureMask;\r\n      this.matRenderToTextureThreeGS.m_uniforms.texVolumeMask.value = this.volTextureMask;\r\n    }\r\n    if (isOn) {\r\n      this.setMaskFlag(1);\r\n    } else {\r\n      this.setMaskFlag(0);\r\n    }\r\n  }\r\n  undoEraser() {\r\n    this.volumeUpdater.eraser.undoLastErasing();\r\n  }\r\n  setEraserStart(isOn) {\r\n    this.eraserStart = isOn;\r\n  }\r\n  onMouseDown(xx, yy) {\r\n    if (this.Tool23D) {\r\n      this.graphics23d.onMouseDown(xx / this.windowWidth, yy / this.windowHeight);\r\n      return;\r\n    }\r\n    this.orbitControl.onMouseDown(xx, yy);\r\n    //this.tools23d.onMouseDown(xx /this.windowWidth, yy / this.windowHeight);\r\n    if (this.checkFrameBufferMode !== CHECK_MODE_RESULT_OK) {\r\n      return;\r\n    }\r\n    this.renderState = this.RENDER_STATE.ENABLED;\r\n    this.eraserMouseDown = true;\r\n    if (this.isEraseMode && this.eraserStart) {\r\n      this.lockEraserBuffersUpdating = true;\r\n      this.volumeUpdater.eraser.eraseStart(xx, yy, this.windowWidth, this.matVolumeRender.uniforms.isoThreshold.value, true);\r\n    }\r\n  }\r\n  onMouseMove(xx, yy) {\r\n    //this.tools23d.onMouseMove(xx / this.windowWidth, yy / this.windowHeight);\r\n    if (this.Tool23D) {\r\n      this.graphics23d.onMouseMove(xx / this.windowWidth, yy / this.windowHeight);\r\n      return;\r\n    }\r\n    if (this.checkFrameBufferMode !== CHECK_MODE_RESULT_OK) {\r\n      return;\r\n    }\r\n    this.renderState = this.RENDER_STATE.ENABLED;\r\n    if (!(this.isEraseMode && this.eraserMouseDown && this.eraserStart)) {\r\n      this.orbitControl.onMouseMove(xx, yy);\r\n    }\r\n    else {\r\n      this.volumeUpdater.eraser.eraseStart(xx, yy, this.windowWidth, this.matVolumeRender.uniforms.isoThreshold.value, false);\r\n    }\r\n  }\r\n  onMouseUp( xx, yy ) {\r\n    if (this.Tool23D) {\r\n      this.graphics23d.onMouseUp(xx / this.windowWidth, yy / this.windowHeight);\r\n      return;\r\n    }\r\n    //this.tools23d.onMouseUp(xx / this.windowWidth, yy / this.windowHeight);\r\n    this.orbitControl.onMouseUp();\r\n    if (this.checkFrameBufferMode !== CHECK_MODE_RESULT_OK) {\r\n      return;\r\n    }\r\n    this.lockEraserBuffersUpdating = false;\r\n    this.eraserMouseDown = false;\r\n    this.renderState = this.RENDER_STATE.ONCE;\r\n  }\r\n  onMouseWheel(e) {\r\n    //const e = window.event || event; // old IE support\r\n    const delta = Math.max(-1, Math.min(1, (e.deltaY || -e.detail)));\r\n    // console.log(`mouse wheel event . delta = ${delta}`);\r\n    this.orbitControl.onZoom(-delta);\r\n    if (this.checkFrameBufferMode !== CHECK_MODE_RESULT_OK) {\r\n      return;\r\n    }\r\n    this.renderState = this.RENDER_STATE.ONCE;\r\n    // e.preventDefault();\r\n  }\r\n} // class Graphics3d\r\n","/**\r\n * @fileOverview Graphics3d\r\n * @author Epam\r\n * @version 1.0.0\r\n */\r\n\r\n\r\n// ********************************************************\r\n// Imports\r\n// ********************************************************\r\n\r\nimport React from 'react';\r\n\r\nimport { StoreActionType, ModeView, Modes3d } from '../../../context/constants';\r\nimport VolumeRenderer3d from './VolumeRenderer3d'\r\n//import DistanceTool from '../tools23d/distancetool'\r\n\r\n// ********************************************************\r\n// Const\r\n// ********************************************************\r\n\r\n// ********************************************************\r\n// Class\r\n// ********************************************************\r\n\r\n/**\r\n * Class Graphics2d some text later...\r\n */\r\nclass Graphics3d extends React.Component {\r\n  /**\r\n   * @param {object} props - props from up level object\r\n   */\r\n  constructor(props) {\r\n    super(props);\r\n    this.onMode = this.onMode.bind(this);\r\n    this.isLoaded = false;\r\n    this.volume = null;\r\n\r\n    this.start = this.start.bind(this);\r\n    this.stop = this.stop.bind(this);\r\n    this.animate = this.animate.bind(this);\r\n    this.renderScene = this.renderScene.bind(this);\r\n    this.setVolRenderToStore = this.setVolRenderToStore.bind(this);\r\n\r\n    this.m_mount = null;\r\n    this.m_volumeRenderer3D = null;\r\n    this.m_distanceTool = null;\r\n    this.m_renderer = null;\r\n    // animation\r\n    this.m_frameId = null;\r\n    this.m_prevMode = Modes3d.RAYCAST;\r\n    // settings\r\n    this.m_fileDataType = {\r\n      thresholdIsosurf: 0.46,\r\n      thresholdTissue1: 0.09,\r\n      thresholdTissue2: 0.30,\r\n      opacityTissue: 0.53,\r\n      startRotX: -Math.PI * 0.5,\r\n      startRotY: Math.PI,\r\n      lightDirComp: -0.5773,\r\n      brightness: 0.56,\r\n    };\r\n    // actual render window dimenison\r\n    this.state = {\r\n      wRender: 0,\r\n      hRender: 0,\r\n    };\r\n  }\r\n  setVolRenderToStore(VolRender) {\r\n    const {dispatch} = this.props;\r\n    dispatch({ type: StoreActionType.SET_VOLUME_Renderer, volumeRenderer: VolRender });\r\n    dispatch({ type: StoreActionType.SET_SLIDER_3DR, slider3d_r: Number.parseFloat(0.09) });\r\n    dispatch({ type: StoreActionType.SET_SLIDER_3DG, slider3d_g: Number.parseFloat(0.3) });\r\n    dispatch({ type: StoreActionType.SET_SLIDER_3DB, slider3d_b: Number.parseFloat(0.46) });\r\n    dispatch({ type: StoreActionType.SET_SLIDER_Opacity, sliderOpacity: Number.parseFloat(0.53) });\r\n    dispatch({ type: StoreActionType.SET_SLIDER_Isosurface, sliderIsosurface: Number.parseFloat(0.46) });\r\n    dispatch({ type: StoreActionType.SET_SLIDER_Brightness, sliderBrightness: Number.parseFloat(0.56) });\r\n    dispatch({ type: StoreActionType.SET_SLIDER_Cut, sliderCut: Number.parseFloat(1.0) });\r\n    dispatch({ type: StoreActionType.SET_SLIDER_Quality, sliderQuality: Number.parseFloat(0.35) });\r\n  }\r\n  start() {\r\n    if (this.m_frameId === null) {\r\n      this.m_frameId = requestAnimationFrame(this.animate);\r\n    }\r\n  }\r\n  stop() {\r\n    cancelAnimationFrame(this.m_frameId);\r\n    this.m_frameId = null;\r\n  }\r\n  animate() {\r\n    /*this.m_mesh.rotation.x += 0.01;\r\n    this.m_mesh.rotation.y += 0.01;\r\n    this.m_material.color.setRGB(this.m_slider3dr, this.m_slider3dg, this.m_slider3db);\r\n    this.m_material.wireframe = (this.m_mode3d === Modes3d.ISO);*/\r\n\r\n    this.renderScene();\r\n    this.m_frameId = window.requestAnimationFrame(this.animate);\r\n  }\r\n  renderScene() {\r\n    // this.m_renderer.render(this.m_scene, this.m_camera);\r\n    if (this.m_volumeRenderer3D !== null) {\r\n      this.m_volumeRenderer3D.render();\r\n    }\r\n  }\r\n  onMode(indexMode) {\r\n    //this.m_updateEnable = true;\r\n    this.props.dispatch({ type: StoreActionType.SET_MODE_3D, mode3d: indexMode });\r\n  }\r\n  componentDidMount() {\r\n    // detect actual render window dims\r\n    this.props.dispatch({ type: StoreActionType.SET_LOADER, showLoader: true});\r\n    const MIN_DIM = 200;\r\n    const w = (this.m_mount.clientWidth > 0) ? this.m_mount.clientWidth : MIN_DIM;\r\n    const h = (this.m_mount.clientHeight > 0) ? this.m_mount.clientHeight : MIN_DIM;\r\n    if (this.state.wRender === 0) {\r\n      this.setState({ wRender: w });\r\n      this.setState({ hRender: h });\r\n    }\r\n\r\n    /*const w = this.m_mount.clientWidth;\r\n    const h = this.m_mount.clientHeight;\r\n    this.m_scene = new THREE.Scene();\r\n    this.m_camera = new THREE.PerspectiveCamera(75, w / h, 0.1, 1000);\r\n    this.m_camera.position.z = 4;\r\n\r\n    this.m_renderer = new THREE.WebGLRenderer({ antialias: true });\r\n    this.m_renderer.setClearColor('#000000');\r\n    this.m_renderer.setSize(w, h);\r\n    this.m_mount.appendChild(this.m_renderer.domElement);\r\n\r\n    this.m_geometry = new THREE.BoxGeometry(1, 1, 1);\r\n    this.m_material = new THREE.MeshBasicMaterial({ color: '#ff1122' });\r\n    this.m_mesh = new THREE.Mesh(this.m_geometry, this.m_material);\r\n    this.m_scene.add(this.m_mesh);\r\n    const {store} = this.props;\r\n    this.m_fileDataType.thresholdIsosurf = store.slider3d_b;\r\n    this.m_fileDataType.Tissue1 = store.slider3d_r;\r\n    this.m_fileDataType.Tissue2 = store.slider3d_g;\r\n    */\r\n    const {store, dispatch} = this.props;\r\n    if (this.m_volumeRenderer3D === null) {\r\n      this.m_volumeRenderer3D = new VolumeRenderer3d({\r\n        curFileDataType: this.m_fileDataType,\r\n        width: w,\r\n        height: h,\r\n        mount: this.m_mount,\r\n        dispatch: dispatch\r\n      });\r\n    }\r\n    this.setVolRenderToStore(this.m_volumeRenderer3D);\r\n    if (this.volume !== null && this.isLoaded === false && this.m_volumeRenderer3D !== null) {\r\n      const volSet = store.visState.volumeSet;\r\n      const volIndex = store.visState.volumeIndex;\r\n      const vol = volSet.getVolume(volIndex);\r\n      const FOUR = 4;\r\n      const isIso = (vol.m_bytesPerVoxel === FOUR) ? true : false;\r\n      //const modeView = store.modeView;\r\n      //let tst = 0;\r\n      //if (this.volume.m_zDim < 4)\r\n      const isMasked = store.visState.mode3d === Modes3d.RAYFAST;\r\n      this.m_volumeRenderer3D.initWithVolume(this.volume, this.volume.m_boxSize, { x: 0, y: 0, z: 0 }, { x: 1, y: 1, z: 1 }, isIso, isMasked, store.doctorView.zoom, store.visState.volumeOpacity);\r\n\r\n      //if (tst) {\r\n      //  return;\r\n      //}\r\n      this.isLoaded = true;\r\n    }\r\n    this.start();\r\n    // setup keyboard\r\n    this.m_mount.focus();\r\n  }\r\n  componentDidUpdate(prevProps) {\r\n      const prevStore = prevProps.store;\r\n      const {store, dispatch} = this.props;\r\n      if (prevStore.visState.volumeIndex !== store.visState.volumeIndex) {\r\n          this.isLoaded = false;\r\n          if (this.m_volumeRenderer3D.volumeReady) {\r\n              dispatch({ type: StoreActionType.SET_LOADER, showLoader: true});\r\n              this.m_volumeRenderer3D.volumeReady = false;\r\n          }\r\n          this.stop();\r\n          let vol = store.visState.volumeSet.getVolume(store.visState.volumeIndex);\r\n          if (vol !== null) {\r\n            this.volume = vol;\r\n          }\r\n          const isMasked = store.visState.mode3d === Modes3d.RAYFAST;\r\n          const isIso = (vol.m_bytesPerVoxel === 4) ? true : false;\r\n          this.m_volumeRenderer3D.initWithVolume(this.volume, this.volume.m_boxSize, { x: 0, y: 0, z: 0 }, { x: 1, y: 1, z: 1 }, isIso, isMasked, true, store.doctorView.zoom, store.visState.volumeOpacity);\r\n          this.m_volumeRenderer3D.setVolumeOpacity(store.visState.volumeOpacity);\r\n          this.isLoaded = true;\r\n          this.start();\r\n      } else if (prevStore.visState.spotColor !== store.visState.spotColor) {\r\n        this.m_volumeRenderer3D.setSpotColor(...store.visState.spotColor)\r\n      } else if (prevStore.visState.volumeOpacity !== store.visState.volumeOpacity) {\r\n        this.m_volumeRenderer3D.setVolumeOpacity(store.visState.volumeOpacity)\r\n      } else if (prevStore.visState.showVenousStructure !== store.visState.showVenousStructure) {\r\n        this.m_volumeRenderer3D.showVenousStructure(store.visState.showVenousStructure)\r\n      }\r\n  }\r\n  componentWillUnmount() {\r\n    this.stop()\r\n    if (this.m_renderer !== null) {\r\n      this.m_mount.removeChild(this.m_renderer.domElement);\r\n    }\r\n    this.m_volumeRenderer3D = null;\r\n  }\r\n  _onMouseMove(e) {\r\n    // console.log(`${e.x}, ${e.y}\\n`);\r\n    if (this.m_volumeRenderer3D !== null) {\r\n      const box = this.m_mount.getBoundingClientRect();\r\n      const containerX = e.clientX - box.left;\r\n      const containerY = e.clientY - box.top;\r\n      this.m_volumeRenderer3D.onMouseMove(containerX, -(this.state.hRender - containerY), this.props.ereaseStart);\r\n    }\r\n  }\r\n  _onMouseDown(e) {\r\n    //console.log(`${e.x}, ${e.y}\\n`);\r\n    if (this.m_volumeRenderer3D !== null) {\r\n      const box = this.m_mount.getBoundingClientRect();\r\n      const containerX = e.clientX - box.left;\r\n      const containerY = e.clientY - box.top;\r\n      this.m_volumeRenderer3D.onMouseDown(containerX, -(this.state.hRender - containerY), this.props.ereaseStart);\r\n    }\r\n  }\r\n  _onMouseUp() { // ommited args: evt\r\n    //console.log(`${e.x}, ${e.y}\\n`);\r\n    if (this.m_volumeRenderer3D !== null) {\r\n      this.m_volumeRenderer3D.onMouseUp();\r\n    }\r\n  }\r\n  _onWheel(e) {\r\n    //console.log(`${e.x}, ${e.y}\\n`);\r\n    if (this.m_volumeRenderer3D !== null) {\r\n      this.m_volumeRenderer3D.onMouseWheel(e);\r\n    }\r\n  }\r\n  onClick(evt) {\r\n    evt.stopPropagation();\r\n  }\r\n  onTouchStart(evt) {\r\n    if ((this.m_mount !== undefined) && (this.m_mount !== null)) {\r\n      // evt.preventDefault();\r\n      const touches = evt.changedTouches;\r\n      const numTouches = touches.length;\r\n      if (numTouches >= 2) {\r\n        console.log(`onTouchStart. numTouches == 2`);\r\n      }\r\n      if (numTouches >= 1) {\r\n        const box = this.m_mount.getBoundingClientRect();\r\n        // const containerX = evt.clientX - box.left;\r\n        // const containerY = evt.clientY - box.top;\r\n        const x = touches[numTouches - 1].pageX - box.left;\r\n        const y = touches[numTouches - 1].pageY - box.top;\r\n        // console.log(`onTouchStart. start at ${x}, ${y}`);\r\n        if (this.m_volumeRenderer3D !== null) {\r\n          this.m_volumeRenderer3D.onMouseDown(x, this.state.hRender - y, this.props.ereaseStart);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  onTouchMove(evt) {\r\n    if ((this.m_mount !== undefined) && (this.m_mount !== null)) {\r\n      // evt.preventDefault();\r\n      const touches = evt.changedTouches;\r\n      const numTouches = touches.length;\r\n      if (numTouches >= 2) {\r\n        console.log(`onTouchStart. numTouches == 2`);\r\n      }\r\n      if (numTouches >= 1) {\r\n        const box = this.m_mount.getBoundingClientRect();\r\n        const x = touches[numTouches - 1].pageX - box.left;\r\n        const y = touches[numTouches - 1].pageY - box.top;\r\n        // console.log(`onTouchMove. move at ${x}, ${y}`);\r\n        if (this.m_volumeRenderer3D !== null) {\r\n          this.m_volumeRenderer3D.onMouseMove(x, this.state.hRender - y, this.props.ereaseStart);\r\n        }\r\n      }\r\n    }\r\n  }\r\n  onTouchEnd() {\r\n    if (this.m_volumeRenderer3D !== null) {\r\n      this.m_volumeRenderer3D.onMouseUp();\r\n    }\r\n  }\r\n  /**\r\n   * Main component render func callback\r\n   */\r\n  render() {\r\n    const {store} = this.props;\r\n    let vol = null;\r\n    //console.log(this.props, store)\r\n    //console.log(store.visState, store.visState.volumeSet)\r\n    const volSet = store.visState.volumeSet;\r\n\r\n    if (volSet && volSet.getNumVolumes() > 0) {\r\n      const volIndex = store.visState.volumeIndex;\r\n      vol = volSet.getVolume(volIndex);\r\n    }\r\n    // const tex3d = this.props.texture3d;\r\n    if (vol !== null) {\r\n      this.volume = vol;\r\n    }\r\n    const ZCUTSHIFT = 0.5;\r\n    const mode3d = store.visState.mode3d;\r\n    const modeView = store.visState.modeView;\r\n    if (this.m_volumeRenderer3D !== null) {\r\n      // console.log(`Graphics3d . mode = ${mode3d}`);\r\n      this.m_volumeRenderer3D.switchToTool23D(store.visState.isTool3D);\r\n      if (modeView !== ModeView.VIEW_3D) {\r\n        if (mode3d === Modes3d.RAYCAST) {\r\n          //if (this.m_prevMode === Modes3d.EREASER) {\r\n          //this.m_volumeRenderer3D.setEraserMode(false);\r\n          //}\r\n          this.m_prevMode = Modes3d.RAYCAST;\r\n          console.log(\"colors: \", store.visState.slider3d_r, store.visState.slider3d_g, store.visState.slider3d_b)\r\n          //this.m_volumeRenderer3D.setTransferFuncVec3([store.visState.slider3d_r, store.visState.slider3d_g, store.visState.slider3d_b], 0);\r\n          this.m_volumeRenderer3D.switchToVolumeRender();\r\n        }\r\n        if (mode3d === Modes3d.ISO) {\r\n          //if (this.m_prevMode === Modes3d.EREASER) {\r\n          //  this.m_volumeRenderer3D.setEraserMode(false);\r\n          //}\r\n          this.m_prevMode = Modes3d.ISO;\r\n          this.m_volumeRenderer3D.switchToIsosurfRender();\r\n          this.m_volumeRenderer3D.setIsoThresholdValue(store.visState.sliderIsosurface);\r\n        }\r\n        if (mode3d === Modes3d.RAYFAST) {\r\n          //if (this.m_prevMode === Modes3d.EREASER) {\r\n          //  this.m_volumeRenderer3D.setEraserMode(false);\r\n          //}\r\n          this.m_prevMode = Modes3d.RAYFAST;\r\n          this.m_volumeRenderer3D.switchToFLATRender();\r\n        }\r\n        if (mode3d === Modes3d.EREASER) {\r\n          //if (this.m_prevMode !== Modes3d.EREASER) {\r\n          //  this.m_volumeRenderer3D.setEraserMode(true);\r\n          //}\r\n          this.m_prevMode = Modes3d.RAYFAST;\r\n          this.m_volumeRenderer3D.switchToIsosurfRender();\r\n          this.m_volumeRenderer3D.setIsoThresholdValue(store.visState.sliderIsosurface);\r\n          this.m_volumeRenderer3D.volumeUpdater.eraser.setEraserRadius(store.visState.sliderErRadius);\r\n          this.m_volumeRenderer3D.volumeUpdater.eraser.setEraserDepth(store.visState.sliderErDepth);\r\n        }\r\n      } else {\r\n        //dispatch({ type: StoreActionType.SET_MODE_3D, mode3d: mode3d })\r\n        this.m_volumeRenderer3D.switchToFullVolumeRender()\r\n      }\r\n      this.m_volumeRenderer3D.setVolumeOpacity(store.visState.volumeOpacity);\r\n      this.m_volumeRenderer3D.setOpacityBarrier(store.visState.sliderOpacity);\r\n      this.m_volumeRenderer3D.updateBrightness(store.visState.sliderBrightness);\r\n      this.m_volumeRenderer3D.updateZCutPlane(store.visState.sliderCut - ZCUTSHIFT);\r\n      this.m_volumeRenderer3D.setStepsize(store.visState.sliderQuality);\r\n      this.m_volumeRenderer3D.updateContrast(store.visState.sliderContrast3D);\r\n    }\r\n    if (this.m_volumeRenderer3D !== null) {\r\n      this.m_volumeRenderer3D.render();\r\n    }\r\n    let opacityVal = this.isLoaded ? '1' : '0';\r\n    const styleObj = {\r\n      width: '100%',\r\n      height: '100%',\r\n      opacity: opacityVal,\r\n    };\r\n\r\n    const jsxCanvasNonSized = <div\r\n      style={styleObj}\r\n      ref={ (mount) => {this.m_mount = mount} }\r\n      onMouseMove={this._onMouseMove.bind(this)}\r\n      onMouseDown={this._onMouseDown.bind(this)}\r\n      onMouseUp={this._onMouseUp.bind(this)}\r\n      onTouchStart={this.onTouchStart.bind(this)}\r\n      onTouchEnd={this.onTouchEnd.bind(this)}\r\n      onTouchMove={this.onTouchMove.bind(this)}\r\n      className=\"graphics-display\"\r\n      onClick={this.onClick.bind(this)}\r\n      onWheel={this._onWheel.bind(this)} />\r\n    const jsxCanvasSized = <div\r\n      width={\"100%\"} height={\"100%\"}\r\n      ref={ (mount) => {this.m_mount = mount} }\r\n      onMouseMove={this._onMouseMove.bind(this)}\r\n      onMouseDown={this._onMouseDown.bind(this)}\r\n      onMouseUp={this._onMouseUp.bind(this)}\r\n      onTouchStart={this.onTouchStart.bind(this)}\r\n      onTouchEnd={this.onTouchEnd.bind(this)}\r\n      onTouchMove={this.onTouchMove.bind(this)}\r\n      onClick={this.onClick.bind(this)}\r\n      tabIndex=\"1\"\r\n      className=\"graphics-display\"\r\n      onWheel={this._onWheel.bind(this)} />\r\n    const jsx = (this.state.wRender > 0) ? jsxCanvasSized : jsxCanvasNonSized;\r\n    //console.log(\"volumeRenderer: \", this.m_volumeRenderer3D)\r\n    return jsx;\r\n  }\r\n}\r\n\r\nexport default Graphics3d;\r\n","/**\r\n * @fileOverview Volume\r\n * @author Epam\r\n * @version 1.0.0\r\n */\r\n\r\n\r\n// ********************************************************\r\n// Imports\r\n// ********************************************************\r\n\r\nimport React from 'react';\r\n\r\n//import LoaderKtx from './loaders/LoaderKtx';\r\n//import LoaderNifti from './loaders/LoaderNifti';\r\n//import LoaderDicom from './loaders/LoaderDicom';\r\n//import LoaderHdr from './loaders/LoaderHdr';\r\n\r\n// ********************************************************\r\n// Const\r\n// ********************************************************\r\n\r\nexport const VOLUME_ICON_SIDE = 64;\r\n\r\n// ********************************************************\r\n// Class\r\n// ********************************************************\r\n\r\n/**\r\n * Class Volume  \r\n * \r\n * Result volume, loaded from Dicom, Ktx, Nifti, ... files\r\n */\r\nclass Volume extends React.Component {\r\n  /**\r\n   * @param {object} props - props from up level object\r\n   */\r\n  constructor(props) {\r\n    super(props);\r\n    this.m_xDim = 0;\r\n    this.m_yDim = 0;\r\n    this.m_zDim = 0;\r\n    this.m_bytesPerVoxel = 0;\r\n    this.m_dataArray = null;\r\n    this.m_dataSize = 0;\r\n    this.m_boxSize = {\r\n      x: 0.0, y: 0.0, z: 0.0\r\n    };\r\n    this.m_phase = 0;\r\n    // icon to show\r\n    this.m_xIcon = 0;\r\n    this.m_yIcon = 0;\r\n    this.m_dataIcon = null;\r\n  }\r\n  createEmptyBytesVolume(xDim, yDim, zDim) {\r\n    this.m_xDim = xDim;\r\n    this.m_yDim = yDim;\r\n    this.m_zDim = zDim;\r\n    const xyzDim = xDim * yDim * zDim;\r\n    this.m_bytesPerVoxel = 1;\r\n    this.m_dataArray = new Uint8Array(xyzDim);\r\n    this.m_dataSize = xyzDim;\r\n    this.m_boxSize = {\r\n      x: xDim, y: yDim, z: zDim\r\n    };\r\n    for (let i = 0; i < xyzDim; i++) {\r\n      this.m_dataArray[i] = 0;\r\n    }\r\n  }\r\n  // Create icon for volume\r\n  createIcon() {\r\n    console.assert(this.m_xDim > 0);\r\n    console.assert(this.m_yDim > 0);\r\n    console.assert(this.m_zDim > 0);\r\n    console.assert(this.m_dataArray !== null);\r\n    const sizeSrcMax = (this.m_xDim > this.m_yDim) ? this.m_xDim : this.m_yDim;\r\n    const scale = sizeSrcMax / VOLUME_ICON_SIDE;\r\n\r\n    // central slice\r\n    const zCenter = Math.floor(this.m_zDim / 2);\r\n    const zOff = zCenter * this.m_xDim * this.m_yDim;\r\n\r\n    this.m_xIcon = VOLUME_ICON_SIDE;\r\n    this.m_yIcon = this.m_xIcon;\r\n    const numPixelsIcon = this.m_xIcon * this.m_yIcon;\r\n    this.m_dataIcon = new Uint8Array(numPixelsIcon);\r\n    for (let i = 0; i < numPixelsIcon; i++){\r\n      this.m_dataIcon[i] = 0;\r\n    }\r\n    // actual size in icon (dest image)\r\n    const wDst = Math.floor(VOLUME_ICON_SIDE * this.m_xDim / sizeSrcMax);\r\n    const hDst = Math.floor(VOLUME_ICON_SIDE * this.m_yDim / sizeSrcMax);\r\n    // top left corner in dst image\r\n    const xDstL = Math.floor(this.m_xIcon / 2 - wDst / 2);\r\n    const yDstT = Math.floor(this.m_yIcon / 2 - hDst / 2);\r\n    for (let yDst = 0; yDst < hDst; yDst++) {\r\n      const ySrc = Math.floor(yDst * scale);\r\n      for (let xDst = 0; xDst < wDst; xDst++) {\r\n        const xSrc = Math.floor(xDst * scale);\r\n        const val = this.m_dataArray[xSrc + ySrc * this.m_xDim + zOff];\r\n        // write result\r\n        const xWrite = xDst + xDstL;\r\n        const yWrite = yDst + yDstT;\r\n        this.m_dataIcon[xWrite + yWrite * this.m_xIcon] = val;\r\n      } // for xDst\r\n    } // for yDst\r\n  } // end createIcon\r\n  //\r\n  // Make each volume texture size equal to 4 * N\r\n  //\r\n  makeDimensions4x() {\r\n    // do nothing if z slices less then 4 (was less 1)\r\n    if (this.m_zDim < 4) {\r\n      return;\r\n    }\r\n    const xDimNew = (this.m_xDim + 3) & (~3);\r\n    const yDimNew = (this.m_yDim + 3) & (~3);\r\n    const zDimNew = (this.m_zDim + 3) & (~3);\r\n    if ((this.m_xDim === xDimNew) && (this.m_yDim === yDimNew) && (this.m_zDim === zDimNew)) {\r\n      return; // do nothing\r\n    } // if new size the same as current\r\n    // perfom convert adding black pixels\r\n    console.log(`Volume. makeDimensions4x. Convert into ${xDimNew}*${yDimNew}*${zDimNew}`);\r\n    const xyzDimNew  = xDimNew * yDimNew * zDimNew;\r\n    const bytesPerVoxel = this.m_bytesPerVoxel;\r\n    const bufSizeBytes = xyzDimNew * bytesPerVoxel;\r\n    const datArrayNew = new Uint8Array(xyzDimNew * bytesPerVoxel);\r\n    let i;\r\n    for (i = 0; i < bufSizeBytes; i++) {\r\n      datArrayNew[i] = 0;\r\n    }\r\n\r\n    const ONE = 1;\r\n    const FOUR = 4;\r\n    const OFF_0 = 0; const OFF_1 = 1;\r\n    const OFF_2 = 2; const OFF_3 = 3;\r\n\r\n    console.log(`Volume info: xyzDim = ${this.m_xDim}*${this.m_yDim}*${this.m_zDim}`);\r\n    console.log(`Volume info: bpp = ${this.m_bytesPerVoxel}`);\r\n    console.log(`Volume info: dataSize = ${this.m_dataSize}`);\r\n\r\n    const xyDim = this.m_xDim * this.m_yDim;\r\n    if (this.m_bytesPerVoxel === ONE) {\r\n      for (let z = 0; z < this.m_zDim; z++) {\r\n        const zOff = z * xyDim;\r\n        const zOffDst = z * xDimNew * yDimNew;\r\n        for (let y = 0; y < this.m_yDim; y++) {\r\n          const yOff = y * this.m_xDim;\r\n          const yOffDst = y * xDimNew;\r\n          for (let x = 0; x < this.m_xDim; x++) {\r\n            const off = x + yOff + zOff;\r\n            const val = this.m_dataArray[off];\r\n            const offDst = x + yOffDst + zOffDst;\r\n            datArrayNew[offDst] = val;\r\n          } // for (x)\r\n        } // for (y)\r\n      } // for (z)\r\n    } else if (this.m_bytesPerVoxel === FOUR) {\r\n      for (let z = 0; z < this.m_zDim; z++) {\r\n        const zOff = z * xyDim;\r\n        const zOffDst = z * xDimNew * yDimNew;\r\n        for (let y = 0; y < this.m_yDim; y++) {\r\n          const yOff = y * this.m_xDim;\r\n          const yOffDst = y * xDimNew;\r\n          for (let x = 0; x < this.m_xDim; x++) {\r\n            const off = (x + yOff + zOff) * FOUR;\r\n            const val0 = this.m_dataArray[off + OFF_0];\r\n            const val1 = this.m_dataArray[off + OFF_1];\r\n            const val2 = this.m_dataArray[off + OFF_2];\r\n            const val3 = this.m_dataArray[off + OFF_3];\r\n            const offDst = (x + yOffDst + zOffDst) * FOUR;\r\n            datArrayNew[offDst + OFF_0] = val0;\r\n            datArrayNew[offDst + OFF_1] = val1;\r\n            datArrayNew[offDst + OFF_2] = val2;\r\n            datArrayNew[offDst + OFF_3] = val3;\r\n          } // for (x)\r\n        } // for (y)\r\n      } // for (z)\r\n    }\r\n\r\n    this.m_xDim = xDimNew;\r\n    this.m_yDim = yDimNew;\r\n    this.m_zDim = zDimNew;\r\n    this.m_dataArray = datArrayNew;\r\n    this.m_dataSize = xyzDimNew;\r\n  } // end\r\n  // do nothing. But we need to implement render() to run Volume tests\r\n  render() {\r\n    return <p>></p>;\r\n  }\r\n\r\n} // end class Volume\r\n\r\nexport default Volume;\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Loading result codes\r\n* @module lib/scripts/loaders/loadresult\r\n*/\r\n\r\n// ******************************************************************\r\n// imports\r\n// ******************************************************************\r\n\r\n/** Class LoadResult to report loading status of binary files  (Ktx, Dicom, Nifti)*/\r\nexport default class LoadResult {\r\n  static getResultString(errorCode) {\r\n    switch (errorCode) {\r\n    case LoadResult.SUCCESS:\r\n      return 'Success';\r\n    case LoadResult.UNKNOWN:\r\n      return 'Unknown';\r\n    case LoadResult.BAD_DICOM:\r\n      return 'Bad Dicom';\r\n    case LoadResult.BAD_HEADER:\r\n      return 'Bad header';\r\n    case LoadResult.UNSUPPORTED_ENDIANNESS:\r\n      return 'Unsupported endianness';\r\n    case LoadResult.UNSUPPORTED_COLOR_FORMAT:\r\n      return 'Unsupported color format';\r\n    case LoadResult.WRONG_HEADER_DATA_SIZE:\r\n      return 'Wrong header data size';\r\n    case LoadResult.WRONG_HEADER_DIMENSIONS:\r\n      return 'Wrong header dimensions';\r\n    case LoadResult.WRONG_HEADER_DATA_TYPE:\r\n      return 'Wrong header data type';\r\n    case LoadResult.WRONG_HEADER_BITS_PER_PIXEL:\r\n      return 'Wrong header bits per pixel';\r\n    case LoadResult.WRONG_HEADER_MAGIC:\r\n      return 'Wrong header magic';\r\n    case LoadResult.ERROR_PROCESS_HISTOGRAM:\r\n      return 'Wrong histogram';\r\n    case LoadResult.WRONG_IMAGE_DIM_X:\r\n      return 'Wrong image dim x';\r\n    case LoadResult.WRONG_IMAGE_DIM_Y:\r\n      return 'Wrong image dim y';\r\n    case LoadResult.WRONG_IMAGE_DIM_Z:\r\n      return 'Wrong image dim z';\r\n    case LoadResult.ERROR_PIXELS_TAG_NOT_FOUND:\r\n      return 'Pixels tag is not found';\r\n    case LoadResult.ERROR_NO_MEMORY:\r\n      return 'No memory during loading';\r\n    case LoadResult.ERROR_CANT_OPEN_URL:\r\n      return 'Cant open file via url';\r\n    case LoadResult.ERROR_WRONG_NUM_SLICES:\r\n      return 'Wrong number of slices';\r\n    case LoadResult.ERROR_HISTOGRAM_DETECT_RIDGES:\r\n      return 'Error detect histogram ridges';\r\n    case LoadResult.ERROR_SCALING:\r\n      return 'Error scaling 16 bit data into 8 bit';\r\n    case LoadResult.ERROR_INVALID_SLICE_INDEX:\r\n      return 'Invalid slice index. Possible reason: incomplete dicom folder';\r\n    case LoadResult.ERROR_TOO_SMALL_DATA_SIZE:\r\n      return 'Too small input data size';\r\n    case LoadResult.ERROR_TOO_LARGE_DATA_SIZE:\r\n      return 'Too large input data size';\r\n    case LoadResult.ERROR_COMPRESSED_IMAGE_NOT_SUPPORTED:\r\n      return 'Compressed image formats read is not supported';\r\n    default:\r\n      return 'Unknown error code';\r\n    } // switch\r\n  }  // getResultString\r\n} // class LoadResult\r\n\r\nLoadResult.SUCCESS = 0;\r\nLoadResult.UNKNOWN = 1;\r\nLoadResult.BAD_DICOM = 2;\r\nLoadResult.BAD_HEADER = 3;\r\nLoadResult.UNSUPPORTED_ENDIANNESS = 4;\r\nLoadResult.UNSUPPORTED_COLOR_FORMAT = 5;\r\nLoadResult.WRONG_HEADER_DATA_SIZE = 6;\r\nLoadResult.WRONG_HEADER_DIMENSIONS = 7;\r\nLoadResult.WRONG_HEADER_DATA_TYPE = 8;\r\nLoadResult.WRONG_HEADER_BITS_PER_PIXEL = 9;\r\nLoadResult.WRONG_HEADER_MAGIC = 10;\r\nLoadResult.ERROR_PROCESS_HISTOGRAM = 11;\r\nLoadResult.WRONG_IMAGE_DIM_X = 12;\r\nLoadResult.WRONG_IMAGE_DIM_Y = 13;\r\nLoadResult.ERROR_PIXELS_TAG_NOT_FOUND = 14;\r\nLoadResult.ERROR_NO_MEMORY = 15;\r\nLoadResult.ERROR_CANT_OPEN_URL = 16;\r\nLoadResult.ERROR_WRONG_NUM_SLICES = 17;\r\nLoadResult.ERROR_HISTOGRAM_DETECT_RIDGES = 18;\r\nLoadResult.ERROR_SCALING = 19;\r\nLoadResult.ERROR_INVALID_SLICE_INDEX = 20;\r\nLoadResult.ERROR_TOO_SMALL_DATA_SIZE = 21;\r\nLoadResult.ERROR_TOO_LARGE_DATA_SIZE = 22;\r\nLoadResult.ERROR_COMPRESSED_IMAGE_NOT_SUPPORTED = 23;\r\n\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Common binary file loader\r\n* @module src/components/visualization/engine/loaders/FileLoader\r\n*/\r\n\r\n// ******************************************************************\r\n// File loader\r\n// ******************************************************************\r\n\r\n/** Instance habdle for loader */\r\nlet GInstanceFileLoader = null;\r\n\r\n/** Class FileLoader for load binary files */\r\nexport default class FileLoader {\r\n  /** Create empty loader\r\n  * @param {string} strUrl - URL for loaded file\r\n  */\r\n  constructor(strUrl) {\r\n    if (!GInstanceFileLoader) {\r\n      GInstanceFileLoader = this;\r\n    }\r\n    /** @property {string} m_url - Urlf ror file being read */\r\n    this.m_url = strUrl;\r\n    /** @property {object} m_request - XMLHttpRequest object, used for acees to resource */\r\n    this.m_request = null;\r\n    this.readFile = this.readFile.bind(this);\r\n  }\r\n  /** Read file\r\n  * @param {object} doneCallback - invoked callback\r\n  */\r\n  readFile(doneCallback, rejectCallback) {\r\n    const METHOD = 'GET';\r\n    this.m_request = new XMLHttpRequest();\r\n    if (!this.m_request) {\r\n      console.log('Cant create object request');\r\n    }\r\n    if ('withCredentials' in this.m_request) {\r\n      // this.m_request.withCredentials = true;\r\n      const NEED_ASYNC = true;\r\n      this.m_request.open(METHOD, this.m_url, NEED_ASYNC);\r\n    // } else if (typeof XDomainRequest !== 'undefined') {\r\n    //   console.log('HttpRequest: XDomainRequest will be used');\r\n    //   this.m_request = new XDomainRequest();\r\n    //   this.m_request.open(METHOD, this.m_url);\r\n    } else {\r\n      this.m_request = null;\r\n      console.log('This browser cant support CORS requests');\r\n      return;\r\n    }\r\n\r\n    this.m_request.responseType = 'arraybuffer';  // \"blob\"\r\n    this.m_request.addEventListener('load', (event) => {\r\n      const arrBuf = event.target.response;\r\n      if (arrBuf === null) {\r\n        console.log('Bad response type. Expect object type in response.');\r\n      } else if (doneCallback) {\r\n        // console.log(`FileFromServer response received. url = ${this.m_url}`);\r\n\r\n        // check wrong buffer content\r\n        const enc = new TextDecoder(\"utf-8\");\r\n        let sz = arrBuf.byteLength;\r\n        if (sz > 4000) {\r\n          sz = 4000;\r\n        }\r\n        const bufHead = arrBuf.slice(0, sz);\r\n        const strBuf = enc.decode(bufHead);\r\n        if (strBuf.substr(0, 9) === \"<!DOCTYPE\") {\r\n          console.log(\"Error load data from URL. Read result is \" + strBuf);\r\n        }\r\n        doneCallback(arrBuf);\r\n      }\r\n    }, false);\r\n\r\n    this.m_request.addEventListener('error', () => {\r\n      // console.log(`Error event happend for XMLHttpRequest: loaded = ${event.loaded}, total = ${event.total}`);\r\n      const errMsg = `Error accessing file ${this.m_url}`;\r\n      rejectCallback(errMsg);\r\n    }, false);\r\n\r\n    this.m_request.send();\r\n    const RES_FAIL_404 = 404;\r\n    if (this.m_request.status === RES_FAIL_404) {\r\n      const errMsg = `Cant access url =  ${this.m_url}`;\r\n      rejectCallback(errMsg);\r\n    }\r\n  }\r\n} // end class FileLoader\r\n","import { IconProp } from \"@fortawesome/fontawesome-svg-core\";\r\nimport VolumeSet from \"../components/visualization/engine/VolumeSet\";\r\n\r\nexport interface State {\r\n  showLoader: boolean,\r\n  fileName: string,\r\n  doctorView: DoctorView,\r\n  nurseView: NurseView,\r\n  visState: VisualizerState,\r\n  socket: SocketIOClient.Socket,\r\n  notification: Notification,\r\n  options: Options\r\n}\r\n\r\nexport interface Options {\r\n  moduleOne: ModuleOneOptions,\r\n  moduleTwo: ModuleTwoOptions,\r\n  moduleThree: ModuleThreeOptions,\r\n  moduleFour: ModuleFourOptions\r\n}\r\n\r\nexport interface NurseView {\r\n  patients: PatientData[],\r\n  status: string,\r\n  isLoaded: boolean,\r\n  rateOfLeakage: number,\r\n  volumeOfLeakage: number,\r\n  timeOfStroke: number,\r\n  title: string,\r\n  date: Date\r\n}\r\n\r\nexport interface DoctorView {\r\n  patients: PatientData[],\r\n  status: string,                  // 'bleeding' or 'bleedingnt'\r\n  isLoaded: boolean,\r\n  rateOfLeakage: number,           // k1\r\n  volumeOfLeakage: number,         // v0 (only for storge purposes not to be displayed)\r\n  timeOfStroke: number,              // v0/k1\r\n  title: string,\r\n  date: Date,\r\n  loadedScan: string,\r\n  phaseTimes: Array<number>,\r\n  zoom: number\r\n}\r\n\r\nexport interface PatientData {\r\n  scanId: string,\r\n  startTime: Date,\r\n  endTime: Date,\r\n  currentModule: number,\r\n  progress: number,\r\n  mlStatus: string,\r\n  failed: boolean,\r\n  initiator: number,\r\n  outputLocation: string,\r\n  phases: number,\r\n  patientName: string,\r\n  patientAge: string,\r\n  patientSex: string,\r\n  scanTime: Date\r\n}\r\n\r\nexport interface VisualizerState {\r\n  spotColor: [number, number, number], // [r, g, b]\r\n  volumeOpacity: number,\r\n  showVenousStructure: boolean,\r\n  volumeSet: VolumeSet,\r\n  volumeIndex: number,\r\n  texture3d: any,\r\n  modeView: number,\r\n  loadingBarRatio: number,\r\n  mode2d: number,\r\n  slider2d: number,\r\n  slider3d_r: number,\r\n  slider3d_g: number,\r\n  slider3d_b: number,\r\n  mode3d: number,\r\n  mode3droi: number,\r\n  sliderOpacity: number,\r\n  sliderIsosurface: number,\r\n  sliderBrightness: number,\r\n  sliderCut: number,\r\n  sliderQuality: number,\r\n  sliderErRadius: number,\r\n  sliderErDepth: number,\r\n  volumeRenderer: any,\r\n  indexTools2d: number,\r\n  render2dZoom: number,\r\n  render2dxPos: number,\r\n  render2dyPos: number,\r\n  graphics2d: any,\r\n  uiApp: any,\r\n  dicomInfo: any,\r\n  isTool3D: boolean,\r\n  sliderContrast3D: any,\r\n  arrErrors: [],\r\n  dicomSeries: [],\r\n  loaderDicom: any,\r\n}\r\n\r\nexport interface Notification {\r\n  body: string,\r\n  header: string,\r\n  isVisible: boolean,\r\n  icon: IconProp | null,\r\n  status: NotificationStatus | null,\r\n  spin: boolean,\r\n  timer: number | null\r\n}\r\n\r\nexport enum NotificationStatus {\r\n  SUCCESS = 'success',\r\n  FAILURE = 'failure'\r\n}\r\n\r\nexport interface ModuleOneOptions {\r\n  processTimingData: boolean,\r\n  build4d: boolean,\r\n  build3d: boolean,\r\n  compute4dSummary: boolean,\r\n  saveAvailableData: boolean,\r\n  reloadTimingIndices: boolean,\r\n  stopIfOptionsChange: boolean,\r\n  autoSelectLargest: boolean,\r\n  autoSelectFirstLargest: boolean,\r\n  autoSelectLastLargest: boolean,\r\n  setTimeSeparationMin: string,\r\n  setTimeSeparationMax: string,\r\n  imageSetIndex: string\r\n}\r\n\r\nexport interface ModuleTwoOptions {\r\n  dataOutput: string\r\n  modality: string,\r\n  vendor: string,\r\n  scanner: string,\r\n  process: string,\r\n  region: string,\r\n  study: string,\r\n  restartEnabled: boolean,\r\n  minimum3d: string,\r\n  includeMinThreshold: boolean,\r\n  includeMaxThreshold: boolean,\r\n  useMorphologicalOperations: boolean,\r\n  strfiDisk: string,\r\n  strfi3d: string,\r\n  imageRegion: string,\r\n  minimumConnected: string,\r\n  coarseRadius: string,\r\n  strfiRadius: string,\r\n  imageIndexRange: string\r\n}\r\n\r\nexport interface ModuleFourOptions {\r\n  enableRestart: boolean,\r\n  vascularMaskDirectory: string,\r\n  outputDataDirectory: string,\r\n}\r\n\r\nexport interface ModuleThreeOptions {\r\n  minimumNumber: string\r\n  numberOfBins: string,\r\n  distributionTail: string,\r\n  feature: string,\r\n  medianMin: string,\r\n  medianMax: string,\r\n  peakRangeMin: string,\r\n  peakRangeMax: string,\r\n  probabilityMin: string,\r\n  probabilityMax: string,\r\n  nonNegativeValues: boolean,\r\n  nonZeroValues: boolean\r\n}","/**\r\n * @fileOverview LoaderKtx\r\n * @author Epam\r\n * @version 1.0.0\r\n */\r\n\r\n\r\n// ********************************************************\r\n// Imports\r\n// ********************************************************\r\n\r\nimport LoadResult from '../LoadResult';\r\nimport FileLoader from './FileLoader';\r\n\r\n// ********************************************************\r\n// Const\r\n// ********************************************************\r\n\r\nexport const KtxHeader = {\r\n  KTX_GL_RED: 0x1903,\r\n  KTX_GL_RGB: 0x1907,\r\n  KTX_GL_RGBA: 0x1908,\r\n  KTX_GL_R8_EXT: 0x8229,\r\n  KTX_GL_RGB8_OES: 0x8051,\r\n  KTX_GL_RGBA8_OES: 0x8058,\r\n};\r\n\r\n// ********************************************************\r\n// Class\r\n// ********************************************************\r\n\r\n/**\r\n * Class LoaderKtx some text later...\r\n */\r\nexport default class LoaderKtx {\r\n  /**\r\n   * @param {object} props - props from up level object\r\n   */\r\n  constructor() {\r\n    this.m_header = {\r\n      m_id: '',\r\n      m_endianness: 0,\r\n      m_glType: 0,\r\n      m_glTypeSize: 0,\r\n      m_glFormat: 0,\r\n      m_glInternalFormat: 0,\r\n      m_glBaseInternalFormat: 0,\r\n      m_pixelWidth: 0,\r\n      m_pixelHeight: 0,\r\n      m_pixelDepth: 0,\r\n      m_numberOfArrayElements: 0,\r\n      m_numberOfFaces: 0,\r\n      m_numberOfMipmapLevels: 0,\r\n      m_bytesOfKeyValueData: 0\r\n    };\r\n    this.m_boxSize = {\r\n      x: 0.0,\r\n      y: 0.0,\r\n      z: 0.0\r\n    };\r\n  } // constructor\r\n  //\r\n  static readInt(bufBytes, bufOff) {\r\n    let iVal = 0;\r\n    const BYTES_IN_INT = 4;\r\n    const BITS_IN_BYTE = 8;\r\n    const LAST_INDEX = 3;\r\n    for (let i = 0; i < BYTES_IN_INT; i++) {\r\n      const iShifted = iVal << BITS_IN_BYTE;\r\n      iVal = iShifted + bufBytes[bufOff + LAST_INDEX - i];\r\n    }\r\n    return iVal;\r\n  }\r\n  //\r\n  static readFloat(buf, off) {\r\n    const BYTES_IN_FLOAT = 4;\r\n    const arBuf = new ArrayBuffer(BYTES_IN_FLOAT);\r\n    const dataArray = new DataView(arBuf);\r\n    const OFF_0 = 0; const OFF_1 = 1;\r\n    const OFF_2 = 2; const OFF_3 = 3;\r\n    dataArray.setUint8(OFF_0, buf[off + OFF_0]);\r\n    dataArray.setUint8(OFF_1, buf[off + OFF_1]);\r\n    dataArray.setUint8(OFF_2, buf[off + OFF_2]);\r\n    dataArray.setUint8(OFF_3, buf[off + OFF_3]);\r\n    const IS_LITTLE_ENDIAN = true;\r\n    const res = dataArray.getFloat32(0, IS_LITTLE_ENDIAN);\r\n    return res;\r\n  } // readFloat\r\n  //\r\n  //\r\n  //\r\n  readFromBuffer(volDst, arrBuf, callbackProgress, callbackComplete) {\r\n    // prepare KTX header\r\n    const bufBytes = new Uint8Array(arrBuf);\r\n    let bufOff = 0;\r\n    if (callbackProgress !== undefined) {\r\n      callbackProgress(0.0);\r\n    }\r\n    if (bufBytes.length === 0) {\r\n      if (callbackComplete !== undefined) {\r\n        callbackComplete(LoadResult.BAD_HEADER);\r\n      }\r\n      return LoadResult.BAD_HEADER;\r\n    }\r\n\r\n    // console.log(`readFromKtx. len = ${bufBytes.length}`);\r\n    // console.log(`readFromKtx. data = ${bufBytes}`);\r\n\r\n    // read header\r\n    const arrayHeaderSign = [0xAB, 0x4B, 0x54, 0x58, 0x20, 0x31, 0x31, 0xBB, 0x0D, 0x0A, 0x1A, 0x0A];\r\n    const lenHeaderSign = arrayHeaderSign.length;\r\n    let isHeaderSignCorrect = true;\r\n    let i;\r\n    // for (i = 0; i < lenHeaderSign; i++) {\r\n    //   console.log(`${bufBytes[i]}`);\r\n    // }\r\n    for (i = 0; i < lenHeaderSign; i++) {\r\n      if (bufBytes[bufOff] !== arrayHeaderSign[i]) {\r\n        isHeaderSignCorrect = false;\r\n        break;\r\n      }\r\n      this.m_header.m_id += String.fromCharCode(bufBytes[bufOff]);\r\n      bufOff += 1;\r\n    }\r\n    if (!isHeaderSignCorrect) {\r\n      console.log('KTX HEADER IS WRONG');\r\n      if (callbackComplete !== undefined) {\r\n        callbackComplete(LoadResult.BAD_HEADER);\r\n      }\r\n      return LoadResult.BAD_HEADER;\r\n    }\r\n    const SIZE_DWORD = 4;\r\n    const ENDIANNESS_16 = 16;\r\n    const ENDIAN_CONST = 0x04030201;\r\n    // read endianess\r\n    this.m_header.m_endianness = LoaderKtx.readInt(bufBytes, bufOff); bufOff += SIZE_DWORD;\r\n    if (this.m_header.m_endianness !== ENDIAN_CONST) {\r\n      const strFoundEndns = this.m_header.m_endianness.toString(ENDIANNESS_16);\r\n      // eslint-disable-next-line\r\n      console.log(`ENDIANNESS IS WRONG. Found = ${strFoundEndns} , but should be = ${ENDIAN_CONST.toString(16)}`);\r\n      if (callbackComplete !== undefined) {\r\n        callbackComplete(LoadResult.UNSUPPORTED_ENDIANNESS);\r\n      }\r\n      return LoadResult.UNSUPPORTED_ENDIANNESS;\r\n    }\r\n\r\n    // read\r\n    this.m_header.m_glType = LoaderKtx.readInt(bufBytes, bufOff); bufOff += SIZE_DWORD;\r\n    this.m_header.m_glTypeSize = LoaderKtx.readInt(bufBytes, bufOff); bufOff += SIZE_DWORD;\r\n    this.m_header.m_glFormat = LoaderKtx.readInt(bufBytes, bufOff); bufOff += SIZE_DWORD;\r\n\r\n    if (\r\n      (this.m_header.m_glFormat !== KtxHeader.KTX_GL_RED) &&\r\n      (this.m_header.m_glFormat !== KtxHeader.KTX_GL_RGB) &&\r\n      (this.m_header.m_glFormat !== KtxHeader.KTX_GL_RGBA)) {\r\n      console.log('KTX header.m_glFormat is WRONG');\r\n      if (callbackComplete !== undefined) {\r\n        callbackComplete(LoadResult.UNSUPPORTED_COLOR_FORMAT);\r\n      }\r\n      return LoadResult.UNSUPPORTED_COLOR_FORMAT;\r\n    }\r\n    this.m_header.m_glInternalFormat = LoaderKtx.readInt(bufBytes, bufOff); bufOff += SIZE_DWORD;\r\n    this.m_header.m_glBaseInternalFormat = LoaderKtx.readInt(bufBytes, bufOff); bufOff += SIZE_DWORD;\r\n    this.m_header.m_pixelWidth = LoaderKtx.readInt(bufBytes, bufOff); bufOff += SIZE_DWORD;\r\n    this.m_header.m_pixelHeight = LoaderKtx.readInt(bufBytes, bufOff); bufOff += SIZE_DWORD;\r\n    this.m_header.m_pixelDepth = LoaderKtx.readInt(bufBytes, bufOff); bufOff += SIZE_DWORD;\r\n\r\n    // save to result volume\r\n    volDst.m_xDim = this.m_header.m_pixelWidth;\r\n    volDst.m_yDim = this.m_header.m_pixelHeight;\r\n    volDst.m_zDim = this.m_header.m_pixelDepth;\r\n\r\n    // check dim\r\n    const head = this.m_header;\r\n    // console.log(`check dim: ${head.m_pixelWidth} * ${head.m_pixelHeight} * ${head.m_pixelDepth}`);\r\n    const MIN_DIM = 4;\r\n    const MAX_DIM = (1024 * 8);\r\n    if ((head.m_pixelWidth < MIN_DIM) || (head.m_pixelHeight < MIN_DIM) \r\n      || (head.m_pixelDepth < MIN_DIM)) {\r\n      console.log(`KTX dims too small: ${head.m_pixelWidth} * ${head.m_pixelHeight} * ${head.m_pixelDepth}`);\r\n      if (callbackComplete !== undefined) {\r\n        callbackComplete(LoadResult.WRONG_IMAGE_DIM_X);\r\n      }\r\n      return LoadResult.WRONG_IMAGE_DIM_X;\r\n    }\r\n    if ((head.m_pixelWidth > MAX_DIM) || (head.m_pixelHeight > MAX_DIM) \r\n      || (head.m_pixelDepth > MAX_DIM)) {\r\n      console.log(`KTX dims too large: ${head.m_pixelWidth} * ${head.m_pixelHeight} * ${head.m_pixelDepth}`);\r\n      if (callbackComplete !== undefined) {\r\n        callbackComplete(LoadResult.WRONG_IMAGE_DIM_X);\r\n      }\r\n      return LoadResult.WRONG_IMAGE_DIM_X;\r\n    }\r\n\r\n    this.m_header.m_numberOfArrayElements = LoaderKtx.readInt(bufBytes, bufOff); bufOff += SIZE_DWORD;\r\n    this.m_header.m_numberOfFaces = LoaderKtx.readInt(bufBytes, bufOff); bufOff += SIZE_DWORD;\r\n    this.m_header.m_numberOfMipmapLevels = LoaderKtx.readInt(bufBytes, bufOff); bufOff += SIZE_DWORD;\r\n    this.m_header.m_bytesOfKeyValueData = LoaderKtx.readInt(bufBytes, bufOff); bufOff += SIZE_DWORD;\r\n\r\n    let bytesPerVoxel = 0;\r\n    const SIZE_BYTE = 1;\r\n    const SIZE_COLOR3 = 3;\r\n    const SIZE_COLOR4 = 4;\r\n    if (this.m_header.m_glFormat === KtxHeader.KTX_GL_RED) {\r\n      bytesPerVoxel = SIZE_BYTE;\r\n    } else if (this.m_header.m_glFormat === KtxHeader.KTX_GL_RGB) {\r\n      bytesPerVoxel = SIZE_COLOR3;\r\n    } else if (this.m_header.m_glFormat === KtxHeader.KTX_GL_RGBA) {\r\n      bytesPerVoxel = SIZE_COLOR4;\r\n    }\r\n\r\n    // read user data\r\n    if (this.m_header.m_bytesOfKeyValueData > 0) {\r\n      let udataOff = bufOff;\r\n      bufOff += this.m_header.m_bytesOfKeyValueData;\r\n\r\n      let xMin, yMin, zMin, xMax, yMax, zMax;\r\n      while (udataOff < bufOff) {\r\n        // read pair len\r\n        // const pairLen = KtxLoader.readInt(bufBytes, udataOff);\r\n        udataOff += SIZE_DWORD;\r\n\r\n        // read string until 0\r\n        let str = '';\r\n        let b;\r\n        for (b = bufBytes[udataOff]; b !== 0; udataOff++) {\r\n          b = bufBytes[udataOff];\r\n          if (b !== 0) {\r\n            str = str.concat(String.fromCharCode(b));\r\n          }\r\n        } // for\r\n        console.log(`UDataString = ${str}`);\r\n        // read vector\r\n        if (str === 'fBoxMin') {\r\n          xMin = LoaderKtx.readFloat(bufBytes, udataOff); udataOff += SIZE_DWORD;\r\n          yMin = LoaderKtx.readFloat(bufBytes, udataOff); udataOff += SIZE_DWORD;\r\n          zMin = LoaderKtx.readFloat(bufBytes, udataOff); udataOff += SIZE_DWORD;\r\n          console.log(`vBoxMix = ${xMin} * ${yMin} * ${zMin}`);\r\n        } else if (str === 'fBoxMax') {\r\n          xMax = LoaderKtx.readFloat(bufBytes, udataOff); udataOff += SIZE_DWORD;\r\n          yMax = LoaderKtx.readFloat(bufBytes, udataOff); udataOff += SIZE_DWORD;\r\n          zMax = LoaderKtx.readFloat(bufBytes, udataOff); udataOff += SIZE_DWORD;\r\n          this.m_boxSize.x = xMax - xMin;\r\n          this.m_boxSize.y = yMax - yMin;\r\n          this.m_boxSize.z = zMax - zMin;\r\n          console.log(`vBox = ${this.m_boxSize.x} * ${this.m_boxSize.y} * ${this.m_boxSize.z}`);\r\n          break;\r\n        } // if fbox max\r\n      } // while udata not ended\r\n    } // if have key data\r\n    // read image data size\r\n    this.m_dataSize = LoaderKtx.readInt(bufBytes, bufOff); bufOff += SIZE_DWORD;\r\n    const dataSizeCalculated =\r\n      this.m_header.m_pixelWidth *\r\n      this.m_header.m_pixelHeight *\r\n      this.m_header.m_pixelDepth * bytesPerVoxel;\r\n    if (this.m_dataSize !== dataSizeCalculated) {\r\n      console.log('!!! not implemented yet');\r\n      if (callbackComplete !== undefined) {\r\n        callbackComplete(LoadResult.WRONG_HEADER_DATA_SIZE);\r\n      }\r\n      return LoadResult.WRONG_HEADER_DATA_SIZE;\r\n    }\r\n    this.m_dataArray = new Uint8Array(this.m_dataSize);\r\n    // get power of 2 for data size\r\n    let pwr2;\r\n    let pwrFinish = false;\r\n    const MAX_POWER = 29;\r\n    for (pwr2 = MAX_POWER; (pwr2 >= 0) && (!pwrFinish); pwr2--) {\r\n      const val = 1 << pwr2;\r\n      if (val < this.m_dataSize) {\r\n        pwrFinish = true;\r\n      }\r\n    }\r\n    pwr2++;\r\n    // build mask for progress update\r\n    const SOME_POWER_MIN = 3;\r\n    pwr2 -= SOME_POWER_MIN;\r\n    if (pwr2 <= 0) {\r\n      pwr2 = 1;\r\n    }\r\n    const progressMask = (1 << pwr2) - 1;\r\n\r\n    for (let i = 0; i < this.m_dataSize; i++) {\r\n      this.m_dataArray[i] = bufBytes[bufOff];\r\n      bufOff += 1;\r\n      // progress update\r\n      if ((callbackProgress !== undefined) && ((i & progressMask) === 0) && (i > 0)) {\r\n        const ratio = i / this.m_dataSize;\r\n        callbackProgress(ratio);\r\n      }\r\n    }\r\n    // update box, if not read\r\n    if (this.m_boxSize.x === 0.0) {\r\n      // Some artificial size: just proportional to pixels dimension\r\n      const MM_PER_PIXEL = 0.3;\r\n      this.m_boxSize.x = MM_PER_PIXEL * this.m_header.m_pixelWidth;\r\n      this.m_boxSize.x = MM_PER_PIXEL * this.m_header.m_pixelWidth;\r\n      this.m_boxSize.y = MM_PER_PIXEL * this.m_header.m_pixelHeight;\r\n      this.m_boxSize.z = MM_PER_PIXEL * this.m_header.m_pixelDepth;\r\n      console.log(`vBox = ${this.m_boxSize.x} * ${this.m_boxSize.y} * ${this.m_boxSize.z}`);\r\n    }\r\n\r\n    volDst.m_bytesPerVoxel = bytesPerVoxel;\r\n    volDst.m_dataArray = this.m_dataArray;\r\n    volDst.m_dataSize = this.m_dataSize;\r\n    volDst.m_boxSize = this.m_boxSize;\r\n    console.log(`KTX Loaded successfully with dim = ${volDst.m_xDim}*${volDst.m_yDim}*${volDst.m_zDim}. bpp=${volDst.m_bytesPerVoxel}`);\r\n\r\n    this.m_isLoadedSuccessfull = true;\r\n    if (callbackProgress !== undefined) {\r\n      callbackProgress(1.0);\r\n    }\r\n    if (callbackComplete !== undefined) {\r\n      callbackComplete(LoadResult.SUCCESS);\r\n    }\r\n    return LoadResult.SUCCESS;\r\n  } // end readFromBuffer\r\n  /**\r\n  *\r\n  * Read Ktx file from URL\r\n  * @param {object} volDst volume to read\r\n  * @param {string} strUrl from where\r\n  * @param {Function} callbackProgress invoke during loading\r\n  * @param {Function} callbackComplete invoke at the end with final success code\r\n  */\r\n  readFromUrl(volDst, strUrl, callbackProgress, callbackComplete) {\r\n    console.log(`LoadedKtx. staring read ${strUrl}`);\r\n    this.m_fileLoader = new FileLoader(strUrl);\r\n    this.m_fileLoader.readFile((arrBuf) => {\r\n      this.readFromBuffer(volDst, arrBuf, callbackProgress, callbackComplete);\r\n      return;\r\n    }, (errMsg) => {\r\n      console.log(`LoaderKtx. Error read file: ${errMsg}`);\r\n      callbackComplete(LoadResult.ERROR_CANT_OPEN_URL, null, 0, null);\r\n      return;\r\n    });\r\n  } // end of readFromUrl\r\n} // end class\r\n","/**\r\n * @fileOverview TransfFunc\r\n * @author Epam\r\n * @version 1.0.0\r\n */\r\n\r\n\r\n// ********************************************************\r\n// Imports\r\n// ********************************************************\r\n\r\nclass TransfFunc {\r\n  constructor() {\r\n    this.m_mouseDown = false;\r\n    this.m_indexMoved = -1;\r\n\r\n    this.m_numHandles = 10;\r\n    this.m_handleColors = [\r\n      { r: 0, g: 0, b: 0 },\r\n      { r: 255, g: 128, b: 64 },\r\n      { r: 255, g: 0, b: 0 },\r\n      { r: 128, g: 64, b: 64 },\r\n      { r: 128, g: 0, b: 0 },\r\n      { r: 64, g: 64, b: 64 },\r\n      { r: 128, g: 128, b: 128 },\r\n      { r: 192, g: 192, b: 192 },\r\n      { r: 255, g: 255, b: 255 },\r\n      { r: 255, g: 255, b: 255 },\r\n    ];\r\n    this.m_handleX = [\r\n      0, 22, 40, 55, 61, 115, 118, 125, 160, 255\r\n    ];\r\n    this.m_handleY = [\r\n      0, 0, 0.3, 0.12, 0, 0, 0.4, 0.8, 0.95, 1.0\r\n    ];\r\n    // screen projections\r\n    this.m_proj = [\r\n      { x: 0, y: 0 },\r\n      { x: 0, y: 0 },\r\n      { x: 0, y: 0 },\r\n      { x: 0, y: 0 },\r\n      { x: 0, y: 0 },\r\n      { x: 0, y: 0 },\r\n      { x: 0, y: 0 },\r\n      { x: 0, y: 0 },\r\n      { x: 0, y: 0 },\r\n      { x: 0, y: 0 }\r\n    ];\r\n    // check correct array size\r\n    if (this.m_handleColors.length !== this.m_numHandles) {\r\n      console.log(`Wrong array this.m_handleColors: ${this.m_handleColors.length} !== ${this.m_numHandles}`);\r\n    }\r\n  } // end constructor\r\n  render(ctx, xMin, yMin, wScreen, hScreen) {\r\n\r\n    this.m_xMin = xMin;\r\n    this.m_yMin = yMin;\r\n    this.m_wScreen = wScreen;\r\n    this.m_hScreen = hScreen;\r\n\r\n    const X_MAX = 255;\r\n    const Y_MAX = 1.0;\r\n    const RAD_CIRCLE = Math.floor(wScreen / 50.0);\r\n    this.m_radCircle = RAD_CIRCLE;\r\n    ctx.lineWidth = 1;\r\n    ctx.strokeStyle = '#000000'\r\n    let xPre, yPre;\r\n\r\n    // draw lines\r\n    xPre = -1; yPre = -1;\r\n    for (let i = 0; i < this.m_numHandles; i++) {\r\n      const xFunc = this.m_handleX[i];\r\n      const yFunc = this.m_handleY[i];\r\n      const x = xMin + Math.floor(wScreen * xFunc / X_MAX);\r\n      const y = yMin + Math.floor(hScreen - 1 - hScreen * yFunc / Y_MAX);\r\n      this.m_proj[i].x = x;\r\n      this.m_proj[i].y = y;\r\n      if (i > 0) {\r\n        ctx.beginPath();\r\n        ctx.moveTo(xPre, yPre);\r\n        ctx.lineTo(x, y);\r\n        ctx.stroke();\r\n      }\r\n      xPre = x;\r\n      yPre = y;\r\n    } // for (i) all handle points\r\n    // draw ellipses\r\n    for (let i = 0; i < this.m_numHandles; i++) {\r\n      const xFunc = this.m_handleX[i];\r\n      const yFunc = this.m_handleY[i];\r\n      const x = xMin + Math.floor(wScreen * xFunc / X_MAX);\r\n      const y = yMin + Math.floor(hScreen - 1 - hScreen * yFunc / Y_MAX);\r\n      let strRCol = this.m_handleColors[i].r.toString(16);\r\n      let strGCol = this.m_handleColors[i].g.toString(16);\r\n      let strBCol = this.m_handleColors[i].b.toString(16);\r\n      strRCol = (strRCol.length === 1) ? ('0' + strRCol) : strRCol;\r\n      strGCol = (strGCol.length === 1) ? ('0' + strGCol) : strGCol;\r\n      strBCol = (strBCol.length === 1) ? ('0' + strBCol) : strBCol;\r\n      const strColor = `#${strRCol}${strGCol}${strBCol}`;\r\n      // console.log(`strColor = ${strColor}`);\r\n      ctx.fillStyle = strColor;\r\n      ctx.beginPath();\r\n      ctx.ellipse(x, y, RAD_CIRCLE, RAD_CIRCLE, 0.0, 0.0, Math.PI * 2.0);\r\n      ctx.fill();\r\n      ctx.stroke();\r\n    } // for (i) all handle points\r\n\r\n  } // end render\r\n  onMouseDown(xScr, yScr) {\r\n    for (let i = 0; i < this.m_numHandles; i++) {\r\n      const dx = xScr - this.m_proj[i].x;\r\n      const dy = yScr - this.m_proj[i].y;\r\n      const dist2 = dx * dx + dy * dy;\r\n      const MIN_DIST_2 = this.m_radCircle * this.m_radCircle;\r\n      if (dist2 <= MIN_DIST_2) {\r\n        console.log(`Picked point ${i}`);\r\n        this.m_mouseDown = true;\r\n        this.m_indexMoved = i;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n  /**\r\n   * on mouse up even t handler\r\n   * \r\n   * @param {number} xScr - mouse x position on screen\r\n   * @param {number} yScr - mouse y position on screen\r\n   */\r\n  onMouseUp() {\r\n    this.m_mouseDown = false;\r\n    return false;\r\n  }\r\n  onMouseMove(xScr, yScr) {\r\n    if (this.m_mouseDown) {\r\n      const isBorderPoint = (this.m_indexMoved === 0) || (this.m_indexMoved === this.m_numHandles - 1);\r\n      let xScrNew;\r\n      let yScrNew;\r\n      if (isBorderPoint) {\r\n        xScrNew = this.m_proj[this.m_indexMoved].x;\r\n      } else {\r\n        xScrNew = xScr;\r\n        xScrNew = (xScrNew < this.m_proj[this.m_indexMoved - 1].x) ? this.m_proj[this.m_indexMoved - 1].x : xScrNew;\r\n        xScrNew = (xScrNew > this.m_proj[this.m_indexMoved + 1].x) ? this.m_proj[this.m_indexMoved + 1].x : xScrNew;\r\n      }\r\n\r\n      yScrNew = yScr;\r\n      if (yScrNew < this.m_yMin) {\r\n        yScrNew = this.m_yMin;\r\n        // console.log('Clip by min y');\r\n      }\r\n      if (yScrNew > this.m_yMin + this.m_hScreen) {\r\n        yScrNew = this.m_yMin + this.m_hScreen;\r\n        // console.log('Clip by max y');\r\n      }\r\n      this.m_proj[this.m_indexMoved].x = xScrNew;\r\n      this.m_proj[this.m_indexMoved].y = yScrNew;\r\n\r\n      const X_MAX = 255;\r\n      const Y_MAX = 1.0;\r\n      const xFunc = (xScrNew - this.m_xMin) * X_MAX / this.m_wScreen;\r\n      const yFunc = (this.m_yMin + this.m_hScreen - 1 - yScrNew) * Y_MAX / this.m_hScreen;\r\n      this.m_handleX[this.m_indexMoved] = xFunc;\r\n      this.m_handleY[this.m_indexMoved] = yFunc;\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n}; //end class TransfFunc\r\n\r\nexport default TransfFunc;\r\n","/**\r\n * @fileOverview UiHistogram\r\n * @author Epam\r\n * @version 1.0.0\r\n */\r\n\r\n\r\n// ********************************************************\r\n// Imports\r\n// ********************************************************\r\n\r\nimport React from 'react';\r\n\r\nimport TransfFunc from '../engine/TransFunc';\r\n\r\n// ********************************************************\r\n// Const\r\n// ********************************************************\r\n\r\nconst DEFAULT_HEIGHT = 220;\r\nconst NEED_TO_DRAW_VERTICAL_MARKS = false;\r\n\r\n// ********************************************************\r\n// Class\r\n// ********************************************************\r\n\r\n/**\r\n * Class UiHistogram some text later...\r\n */\r\nexport default class UiHistogram extends React.Component {\r\n  /**\r\n   * @param {object} props - props from up level object\r\n   */\r\n  constructor(props) {\r\n    super(props);\r\n    this.m_histogram = [];\r\n    this.m_numColors = 0;\r\n\r\n    this.m_transfFunc = new TransfFunc();\r\n    this.m_transfFuncCallback = undefined;\r\n    this.m_transfFuncUpdateCallback = undefined;\r\n\r\n    this.setSize = this.setSize.bind(this);\r\n    this.onMouseDown = this.onMouseDown.bind(this);\r\n    this.onMouseUp = this.onMouseUp.bind(this);\r\n    this.onMouseMove = this.onMouseMove.bind(this);\r\n\r\n    this.state = {\r\n      width: 0,\r\n      height: DEFAULT_HEIGHT,\r\n    };\r\n  }\r\n  componentDidMount() {\r\n    this.updateCanvas();\r\n    window.addEventListener('resize', this.handleResize, false);\r\n    this.setSize();    \r\n  }\r\n  componentDidUpdate() {\r\n    this.updateCanvas();\r\n    window.removeEventListener('resize', this.handleResize, false);\r\n  }\r\n  handleResize() {\r\n    this.setSize();\r\n  }\r\n  setSize() {\r\n    const objOwner = this.m_canvasOwner;\r\n    if (objOwner) {\r\n      const w = objOwner.clientWidth - 2;\r\n      const h = objOwner.clientHeight - 2;\r\n      // console.log(`UiHistogram. setSize. = ${w} * ${h}`);\r\n      this.setState({ width: w });\r\n      this.setState({ height: h });\r\n    }\r\n  }\r\n  getVolumeHistogram(vol) {\r\n    const xDim = vol.m_xDim;\r\n    const yDim = vol.m_yDim;\r\n    const zDim = vol.m_zDim;\r\n    const dataArray = vol.m_dataArray;\r\n    const xyzDim = xDim * yDim * zDim;\r\n    const NUM_COLORS = 256;\r\n    this.m_numColors = NUM_COLORS;\r\n    this.m_histogram = new Array(this.m_numColors);\r\n    let i;\r\n    for (i = 0; i < this.m_numColors; i++) {\r\n      this.m_histogram[i] = 0;\r\n    }\r\n    for (i = 0; i < xyzDim; i++) {\r\n      const ind = dataArray[i];\r\n      this.m_histogram[ind]++;\r\n    }\r\n    // calc max value in histogram\r\n    let valMax = 0;\r\n    for (i = 0; i < this.m_numColors; i++) {\r\n      valMax = (this.m_histogram[i] > valMax) ? this.m_histogram[i] : valMax;\r\n    }\r\n    const SOME_SMALL_ADD = 0.001;\r\n    valMax += SOME_SMALL_ADD;\r\n    // scale values to [0..1]\r\n    const scl = 1.0 / valMax;\r\n    for (i = 0; i < this.m_numColors; i++) {\r\n      this.m_histogram[i] *= scl;\r\n    }\r\n    this.smoothHistogram();\r\n    this.getMaxPeak();\r\n  }\r\n  assignArray(numColors, histogramArray) {\r\n    this.m_numColors = numColors;\r\n    this.m_histogram = histogramArray;\r\n  }\r\n  getLastMaxIndex(valMin = 0.0) {\r\n    const IND_MIN = 4;\r\n    let i;\r\n\r\n    let found = false;\r\n    for (i = this.m_numColors - IND_MIN; i > IND_MIN; i--) {\r\n      if (this.m_histogram[i] > valMin) {\r\n        if ((this.m_histogram[i] > this.m_histogram[i - 2]) && \r\n          (this.m_histogram[i] > this.m_histogram[i + 2])) {\r\n          found = true; break;\r\n        } // if local maximum\r\n      } // if mor min\r\n    } // for (i)\r\n    if (!found) {\r\n      console.log(`getLastMaxIndex. Not found!`);\r\n      return -1;\r\n    }\r\n    return i;\r\n\r\n  } // end get last max index\r\n  //\r\n  //\r\n  getMaxPeak() {\r\n    this.m_peakIndex = -1;\r\n    let i;\r\n    const hist = this.m_histogram;\r\n    const MIN_SCAN = 12;\r\n    const MAX_SCAN = this.m_numColors - 4;\r\n    let maxPeakVal = 0;\r\n    for (i = MAX_SCAN; i > MIN_SCAN; i--) {\r\n      if ((hist[i] > hist[i - 1]) && (hist[i] > hist[i + 1]) && \r\n        (hist[i] > hist[i - 2]) && (hist[i] > hist[i + 2])) {\r\n        const peakVal = hist[i];\r\n        if (peakVal > maxPeakVal) {\r\n          maxPeakVal = peakVal;\r\n          this.m_peakIndex = i;\r\n        }\r\n        // console.log(`Local histogram peak in ${this.m_peakIndex}`);\r\n      } // if (ha slocal peak)\r\n    } // for (all colors to scan) \r\n  }\r\n  smoothHistogram(sigma = 1.2, needNormalize = true) {\r\n    const SIZE_DIV = 60;\r\n    let RAD = Math.floor(this.m_numColors / SIZE_DIV);\r\n    // avoid too large neighbourhood window size\r\n    const SIZE_LARGE = 32;\r\n    if (RAD > SIZE_LARGE) {\r\n      RAD = SIZE_LARGE;\r\n    }\r\n    // console.log(`smoothHistogram. RAD = ${RAD}`);\r\n\r\n    const KOEF = 1.0 / (2 * sigma * sigma);\r\n    const newHist = new Array(this.m_numColors);\r\n    let i;\r\n    let maxVal = 0;\r\n    for (i = 0; i < this.m_numColors; i++) {\r\n      let sum = 0;\r\n      let sumW = 0;\r\n      for (let di = -RAD; di <= RAD; di++) {\r\n        const ii = i + di;\r\n        const t = di / RAD;\r\n        const w = Math.exp(-t * t * KOEF);\r\n        if ((ii >= 0) && (ii < this.m_numColors)) {\r\n          sum += this.m_histogram[ii] * w;\r\n          sumW += w;\r\n        }\r\n      }\r\n      sum /= sumW;\r\n      maxVal = (sum > maxVal) ? sum : maxVal;\r\n\r\n      newHist[i] = sum;\r\n    } // for (i)\r\n    // copy back to hist\r\n    if (needNormalize) {\r\n      for (i = 0; i < this.m_numColors; i++) {\r\n        this.m_histogram[i] = newHist[i] / maxVal;\r\n      } // for (i)\r\n    } else {\r\n      for (i = 0; i < this.m_numColors; i++) {\r\n        this.m_histogram[i] = newHist[i];\r\n      } // for (i)\r\n    }\r\n  } // smoothHistogram\r\n  onMouseDown(evt) {\r\n    if ((this.m_transfFuncCallback === undefined) ||\r\n      (this.m_transfFuncUpdateCallback === undefined)) {\r\n      return;\r\n    }\r\n    const box = this.refs.canvasHistogram.getBoundingClientRect();\r\n    const xScr = evt.clientX - box.left;\r\n    const yScr = evt.clientY - box.top;\r\n    const needRender = this.m_transfFunc.onMouseDown(xScr, yScr);\r\n    if (needRender) {\r\n      this.forceRender();\r\n    }\r\n  }\r\n  onMouseUp(evt) {\r\n    if ((this.m_transfFuncCallback === undefined) ||\r\n      (this.m_transfFuncUpdateCallback === undefined)) {\r\n      return;\r\n    }\r\n    const box = this.refs.canvasHistogram.getBoundingClientRect();\r\n    const xScr = evt.clientX - box.left;\r\n    const yScr = evt.clientY - box.top;\r\n    const needRender = this.m_transfFunc.onMouseUp(xScr, yScr);\r\n    if (needRender) {\r\n      this.forceRender();\r\n    }\r\n  }\r\n  onMouseMove(evt) {\r\n    if ((this.m_transfFuncCallback === undefined) ||\r\n      (this.m_transfFuncUpdateCallback === undefined)) {\r\n      return;\r\n    }\r\n    const box = this.refs.canvasHistogram.getBoundingClientRect();\r\n    const xScr = evt.clientX - box.left;\r\n    const yScr = evt.clientY - box.top;\r\n    const needRender = this.m_transfFunc.onMouseMove(xScr, yScr);\r\n    if (needRender) {\r\n      this.forceRender();\r\n    }\r\n  }\r\n  updateCanvas() {\r\n    if (this.refs.canvasHistogram === undefined) {\r\n      return;\r\n    }\r\n    const ctx = this.refs.canvasHistogram.getContext('2d');\r\n    const w = this.refs.canvasHistogram.clientWidth;\r\n    const h = this.refs.canvasHistogram.clientHeight;\r\n    ctx.fillStyle = 'rgb(220, 220, 220)';\r\n    ctx.fillRect(0,0, w, h);\r\n\r\n    // was 300 * 250\r\n    // console.log(`updateCanvas. canvas dim = ${w} * ${h}`); \r\n\r\n    const vol = this.props.volume;\r\n    if (vol !== null) {\r\n      this.getVolumeHistogram(vol);\r\n    }\r\n\r\n    // rect inside\r\n    // const xMin = Math.floor(0.10 * w);\r\n    // const xMax = Math.floor(0.95 * w);\r\n    const xMin = Math.floor(0.01 * w);\r\n    const xMax = Math.floor(0.99 * w);\r\n    const yMin = Math.floor(0.05 * h);\r\n    const yMax = Math.floor(0.95 * h);\r\n    const wRect = xMax - xMin;\r\n    const hRect = yMax - yMin;\r\n\r\n    ctx.lineWidth = 1;\r\n    ctx.strokeStyle = '#0a0a0a';\r\n\r\n    ctx.moveTo(xMin, yMax);\r\n    ctx.lineTo(xMin, yMin);\r\n    ctx.stroke();\r\n\r\n    ctx.moveTo(xMin, yMax);\r\n    ctx.lineTo(xMax, yMax);\r\n    ctx.stroke();\r\n\r\n    ctx.font = '10px Arial';\r\n    ctx.fillStyle = 'rgb(120, 20, 20)';\r\n    ctx.textBaseline = 'top';\r\n    ctx.textAlign = 'center';\r\n\r\n    // detect max visible value in hist\r\n    let maxHistValue = 1.0;\r\n    if (this.m_peakIndex > 0) {\r\n      maxHistValue = this.m_histogram[this.m_peakIndex] * 2;\r\n      maxHistValue = (maxHistValue > 1.0) ? 1.0 : maxHistValue;\r\n    }\r\n\r\n    // draw marks horizontal\r\n    let i;\r\n    const NUM_X_MARKS = 4;\r\n    for (i = 0; i <= NUM_X_MARKS; i++) {\r\n      const x = xMin + Math.floor(wRect * i / NUM_X_MARKS);\r\n      ctx.moveTo(x, yMax);\r\n      ctx.lineTo(x, yMax + 6);\r\n      ctx.stroke();\r\n      const valMark = Math.floor(0 + this.m_numColors * i / NUM_X_MARKS);\r\n      if (i === 0) {\r\n        ctx.textAlign = 'left';\r\n      } else if (i === NUM_X_MARKS) {\r\n        ctx.textAlign = 'right';\r\n      } else {\r\n        ctx.textAlign = 'center';\r\n      }\r\n      ctx.fillText(valMark.toString(), x, yMax + 4);\r\n    }\r\n    // draw marks vertical\r\n    if (NEED_TO_DRAW_VERTICAL_MARKS) {\r\n      ctx.textBaseline = 'bottom';\r\n      ctx.textAlign = 'left';\r\n      ctx.fillStyle = 'rgb(120, 60, 60)';\r\n      const NUM_Y_MARKS = 4;\r\n      for (i = 0; i <= NUM_Y_MARKS; i++) {\r\n        if (i === NUM_Y_MARKS) {\r\n          ctx.textBaseline = 'top';\r\n        }\r\n        const y = yMax - Math.floor(hRect * i / NUM_Y_MARKS);\r\n        ctx.moveTo(xMin, y);\r\n        ctx.lineTo(xMin - 4, y);\r\n        ctx.stroke();\r\n        const valMark = (0 + maxHistValue * i / NUM_Y_MARKS);\r\n        ctx.fillText(valMark.toFixed(2), xMin + 6, y);\r\n      }\r\n    }\r\n\r\n    ctx.lineWidth = 2;\r\n    ctx.strokeStyle = '#080808';\r\n    ctx.fillStyle = '#707070';\r\n    // draw histogram function line\r\n    ctx.beginPath();\r\n    {\r\n      ctx.moveTo(xMin, yMax);\r\n      let i;\r\n      let x, y;\r\n      for (i = 0; i < this.m_numColors; i++) {\r\n        x = xMin + Math.floor(wRect * i / this.m_numColors);\r\n        let v = this.m_histogram[i] / maxHistValue;\r\n        v = (v >= 1.0) ? 1.0 : v;\r\n        y = yMax - Math.floor(hRect * v);\r\n        ctx.lineTo(x, y);\r\n      } // for (i) all colors\r\n      y = yMax;\r\n      ctx.lineTo(x, y);\r\n    }\r\n    ctx.closePath();\r\n    ctx.fill();\r\n    // draw peak\r\n    if (this.m_peakIndex > 0) {\r\n      ctx.lineWidth = 1;\r\n      ctx.strokeStyle = '#eeeeee';\r\n      const x = xMin + Math.floor(wRect * this.m_peakIndex / this.m_numColors);\r\n      let v = this.m_histogram[this.m_peakIndex] / maxHistValue;\r\n      v = (v >= 1.0) ? 1.0 : v;\r\n      let y = yMax - Math.floor(hRect * v);\r\n      ctx.beginPath();\r\n      ctx.setLineDash([5, 15]);\r\n      ctx.moveTo(x, y);\r\n      y = yMax;\r\n      ctx.lineTo(x, y);\r\n      ctx.stroke();\r\n      ctx.setLineDash([]);\r\n    }\r\n    // render points and lines for modified transfer fucntion\r\n    if ((this.m_transfFuncCallback !== undefined) &&\r\n      (this.m_transfFuncUpdateCallback !== undefined)) {\r\n      this.m_transfFunc.render(ctx, xMin, yMin, wRect, hRect);\r\n    }\r\n  } // end update canvas\r\n  forceRender() {\r\n    this.setState({ state: this.state });\r\n    if (this.m_transfFuncCallback !== undefined) {\r\n      this.m_transfFuncCallback(this.m_transfFunc);\r\n    }\r\n  }\r\n  /**\r\n   * Main component render func callback\r\n   */\r\n  render() {\r\n    const vol = this.props.volume;\r\n    if (vol === undefined) {\r\n      return <p>UiHistogram.props volume is not defined !!!</p>;\r\n    }\r\n    if (vol === null) {\r\n      return <p>vol is null</p>;\r\n    }\r\n    this.m_transfFuncCallback = this.props.transfFunc;\r\n    this.m_transfFuncUpdateCallback = this.props.transfFuncUpdate;\r\n  \r\n    const cw = this.state.width || 200; //;\r\n    const ch = this.state.height || 200; //;\r\n    console.log(cw,ch)\r\n\r\n    const jsxHist = \r\n      <div ref={ (mount) => {this.m_canvasOwner = mount} }>\r\n        <canvas ref=\"canvasHistogram\" width={cw} height={ch} \r\n          onMouseDown={this.onMouseDown} onMouseUp={this.onMouseUp} onMouseMove={this.onMouseMove} />\r\n      </div>;\r\n    return jsxHist;\r\n  }\r\n}\r\n ","/**\r\n * @fileOverview LoaderNifti\r\n * @author Epam\r\n * @version 1.0.0\r\n */\r\n\r\n\r\n// ********************************************************\r\n// Imports\r\n// ********************************************************\r\n\r\nimport LoadResult from '../LoadResult';\r\nimport UiHistogram from '../../ui/UiHistogram';\r\nimport FileLoader from './FileLoader';\r\n\r\n// ********************************************************\r\n// Const\r\n// ********************************************************\r\n\r\n// const NEED_EVEN_TEXTURE_SIZE = false;\r\nconst DEBUG = false;\r\nconst MAX_BYTE = 255;\r\n\r\n// ********************************************************\r\n// Class\r\n// ********************************************************\r\n\r\n/**\r\n * Class LoaderNifti some text later...\r\n */\r\nclass LoaderNifti {\r\n  /**\r\n   * @param {object} props - props from up level object\r\n   */\r\n  constructor() {\r\n    this.m_littleEndian = true;\r\n    this.m_header = {\r\n      m_id: '',\r\n      m_endianness: 0,\r\n      m_glType: 0,\r\n      m_glTypeSize: 0,\r\n      m_glFormat: 0,\r\n      m_glInternalFormat: 0,\r\n      m_glBaseInternalFormat: 0,\r\n      m_pixelWidth: 0,\r\n      m_pixelHeight: 0,\r\n      m_pixelDepth: 0,\r\n      m_numberOfArrayElements: 0,\r\n      m_numberOfFaces: 0,\r\n      m_numberOfMipmapLevels: 0,\r\n      m_bytesOfKeyValueData: 0\r\n    };\r\n    this.m_xDim = 0;\r\n    this.m_yDim = 0;\r\n    this.m_zDim = 0;\r\n    this.phases = 1;\r\n    this.m_boxSize = {\r\n      x: 0.0,\r\n      y: 0.0,\r\n      z: 0.0\r\n    };\r\n  } // constructor\r\n  /**\r\n  * Read 32 bit integer from input buffer\r\n  * @param {object} buf - source buffer\r\n  * @param {number} off - offset in buffer\r\n  * @return 32 bit integer number\r\n  */\r\n  readIntFromBuffer(buf, off) {\r\n    let res = 0;\r\n    if (this.m_littleEndian) {\r\n      res = ((buf[off + 0]) |\r\n        // eslint-disable-next-line\r\n        (buf[off + 1] << 8) |\r\n        // eslint-disable-next-line\r\n        (buf[off + 2] << 16) |\r\n        // eslint-disable-next-line\r\n        (buf[off + 3] << 24));\r\n    } else {\r\n      res = ((buf[off + 3]) |\r\n        // eslint-disable-next-line\r\n        (buf[off + 2] << 8) |\r\n        // eslint-disable-next-line\r\n        (buf[off + 1] << 16) |\r\n        // eslint-disable-next-line\r\n        (buf[off + 0] << 24));\r\n    }\r\n    return res;\r\n  }\r\n  /**\r\n  * Read 16 bit short integer from input buffer\r\n  * @param {object} buf - source buffer\r\n  * @param {number} off - offset in buffer\r\n  * @return 16 bit short integer number\r\n  */\r\n  readShortFromBuffer(buf, off) {\r\n    let res = 0;\r\n    if (this.m_littleEndian) {\r\n      // eslint-disable-next-line\r\n      res = ((buf[off + 0]) | (buf[off + 1] << 8));\r\n    } else {\r\n      // eslint-disable-next-line\r\n      res = ((buf[off + 1]) | (buf[off + 0] << 8));\r\n    }\r\n    return res;\r\n  }\r\n  /**\r\n  * Read 32 bit float from input buffer\r\n  * @param {object} buf - source buffer\r\n  * @param {number} off - offset in buffer\r\n  * @return float number, loaded from buffer\r\n  */\r\n  readFloatFromBuffer(buf, off) {\r\n    const BYTES_IN_FLOAT = 4;\r\n    const arBuf = new ArrayBuffer(BYTES_IN_FLOAT);\r\n    const dataArray = new DataView(arBuf);\r\n    // eslint-disable-next-line\r\n    dataArray.setUint8(0, buf[off + 0]);\r\n    // eslint-disable-next-line\r\n    dataArray.setUint8(1, buf[off + 1]);\r\n    // eslint-disable-next-line\r\n    dataArray.setUint8(2, buf[off + 2]);\r\n    // eslint-disable-next-line\r\n    dataArray.setUint8(3, buf[off + 3]);\r\n    const res = dataArray.getFloat32(0, this.m_littleEndian);\r\n    return res;\r\n  }\r\n  /**\r\n  * Read from local file buffer\r\n  * @param {object} volDst - Destination volume object array to be fiiied\r\n  * @param {object} arrBuf - source byte buffer\r\n  * @param {func} callbackProgress - function invoked during read\r\n  * @param {func} callbackComplete - function invoked after reading\r\n  * @return true, if success\r\n  */\r\n\r\n  /*\r\n    mask is a MASK, all 0, but highlights are 1\r\n    when mask is 0, volDst should be mapped to 0.0 - 250\r\n    when mask is 1, volDst should be 255\r\n  */\r\n  readFromBuffer(volDst, arrBuf, callbackProgress, callbackComplete, mask = null, spotThreshold = 0.75) {\r\n    const bufBytes = new Uint8Array(arrBuf);\r\n    const bufLen = bufBytes.length;\r\n\r\n    if (mask !== null && mask.length !== bufLen) throw new Error(\"check your input arrays\");\r\n    const MIN_BUF_SIZE = 8;\r\n\r\n    const NIFTI_HEADER_SIZE = 348;\r\n    const MAX_PHASES = 19;\r\n    const voxelOffsetLocation = 108;\r\n    const vox_offset = this.readFloatFromBuffer(bufBytes, voxelOffsetLocation);\r\n    console.log(vox_offset);\r\n\r\n    const MAX_BUF_SIZE = (512 * 512 * 320 * MAX_PHASES+vox_offset);\r\n\r\n    if (bufLen < MIN_BUF_SIZE) {\r\n      if (callbackComplete) {\r\n        callbackComplete(LoadResult.ERROR_TOO_SMALL_DATA_SIZE, null, 0, null);\r\n      }\r\n      return false;\r\n    }\r\n    if (bufLen > MAX_BUF_SIZE) {\r\n      if (callbackComplete) {\r\n        callbackComplete(LoadResult.ERROR_TOO_LARGE_DATA_SIZE, null, 0, null);\r\n      }\r\n      return false;\r\n    }\r\n    // Nifti file header size is 348 bytes\r\n    if (bufLen < NIFTI_HEADER_SIZE) {\r\n      console.error('Nifti header too small');\r\n\r\n\r\n      if (callbackComplete) {\r\n        callbackComplete(LoadResult.BAD_HEADER, null, 0, null);\r\n      }\r\n      return false;\r\n    }\r\n    if (DEBUG) console.log(`Nifti loader. Start parse ${bufLen} bytes...`);\r\n\r\n    const SIZE_DWORD = 4;\r\n    const SIZE_SHORT = 2;\r\n\r\n    let bufOff = 0;\r\n    let headSize = this.readIntFromBuffer(bufBytes, bufOff);\r\n    if (headSize > (2 << 24)) {\r\n      this.m_littleEndian = false;\r\n      headSize = this.readIntFromBuffer(bufBytes, bufOff);\r\n    }\r\n\r\n    bufOff += SIZE_DWORD;\r\n    if (headSize !== NIFTI_HEADER_SIZE) {\r\n      console.error(`Nifti first int wrong: ${headSize}, but should be ${NIFTI_HEADER_SIZE}`);\r\n      if (callbackComplete) {\r\n        callbackComplete(LoadResult.BAD_HEADER, null, 0, null);\r\n      }\r\n      return false;\r\n    }\r\n\r\n    // data type\r\n    // eslint-disable-next-line\r\n    bufOff += 10;\r\n    // db name\r\n    // eslint-disable-next-line\r\n    bufOff += 18;\r\n    // extents\r\n    bufOff += SIZE_DWORD;\r\n    // session error\r\n    bufOff += SIZE_SHORT;\r\n    // regular\r\n    bufOff += 1;\r\n    // dim info\r\n    bufOff += 1;\r\n\r\n    // read number of dimensions\r\n    const numDimensions = this.readShortFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_SHORT;\r\n    const MIN_NUM_DIMS = 3;\r\n    if (numDimensions < MIN_NUM_DIMS) {\r\n      console.error(`Nifti header wrong num dimensions: ${numDimensions}, but should be at least 3`);\r\n      if (callbackComplete) {\r\n        callbackComplete(LoadResult.WRONG_HEADER_DIMENSIONS, null, 0, null);\r\n      }\r\n      return false;\r\n    }\r\n    this.m_xDim = this.readShortFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_SHORT;\r\n    this.m_yDim = this.readShortFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_SHORT;\r\n    // says zDim is 3, should be 320 for 4 dimensions\r\n    // if (numDimensions === 4) {\r\n    //     this.phases = this.readShortFromBuffer(bufBytes, bufOff);\r\n    //     bufOff += SIZE_SHORT;\r\n    // }\r\n    this.m_zDim = this.readShortFromBuffer(bufBytes, bufOff);\r\n\r\n    bufOff += SIZE_SHORT;\r\n    if (numDimensions === 4) {\r\n      this.phases = this.readShortFromBuffer(bufBytes, bufOff);\r\n      bufOff += SIZE_SHORT;\r\n      const valuesPerTimePoint = this.readShortFromBuffer(bufBytes, bufOff);\r\n      bufOff += 6;\r\n      if (DEBUG) console.log(\"values per time point: \", valuesPerTimePoint);\r\n    }\r\n    else {\r\n      bufOff += 8;\r\n    }\r\n\r\n    // intent_p1\r\n    bufOff += SIZE_DWORD;\r\n    // intent_p2\r\n    bufOff += SIZE_DWORD;\r\n    // intent_p3\r\n    bufOff += SIZE_DWORD;\r\n    // intent_code\r\n    bufOff += SIZE_SHORT;\r\n    const dataType = this.readShortFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_SHORT;\r\n    const bitPix = this.readShortFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_SHORT;\r\n    const sliceStart = this.readShortFromBuffer(bufBytes, bufOff);\r\n    if (DEBUG) {\r\n      console.log(\"bits / voxel: \", bitPix);\r\n      console.log(\"slice start: \", sliceStart);\r\n      console.log(\"datatype: \", dataType);\r\n    }\r\n\r\n    const NIFTI_DATA_TYPE_UINT8 = 2;\r\n    const NIFTI_DATA_TYPE_INT16 = 4;\r\n    const NIFTI_DATA_TYPE_FLOAT32 = 16;\r\n    const NIFTI_DATA_TYPE_INT8 = 256;\r\n    const NIFTI_DATA_TYPE_UINT16 = 512;\r\n\r\n    let isDataTypeCorrect = 0;\r\n    isDataTypeCorrect |= (dataType === NIFTI_DATA_TYPE_UINT8);\r\n    isDataTypeCorrect |= (dataType === NIFTI_DATA_TYPE_INT16);\r\n    isDataTypeCorrect |= (dataType === NIFTI_DATA_TYPE_FLOAT32);\r\n    isDataTypeCorrect |= (dataType === NIFTI_DATA_TYPE_INT8);\r\n    isDataTypeCorrect |= (dataType === NIFTI_DATA_TYPE_UINT16);\r\n\r\n\r\n    if (!isDataTypeCorrect) {\r\n      console.error(`Nifti header read. This data type (${dataType}) is not supported`);\r\n      if (callbackComplete) {\r\n        callbackComplete(LoadResult.WRONG_HEADER_DATA_TYPE, null, 0, null);\r\n      }\r\n      return false;\r\n    }\r\n    const BIT_PIXELS_8 = 8;\r\n    const BIT_PIXELS_16 = 16;\r\n    const BIT_PIXELS_32 = 32;\r\n    const isSupported = (bitPix === BIT_PIXELS_8) |\r\n      (bitPix === BIT_PIXELS_16) | (bitPix === BIT_PIXELS_32);\r\n    if (!isSupported) {\r\n      console.error(`Nifti wrong bitPix: ${bitPix}, but should be 8,16 or 32`);\r\n      if (callbackComplete) {\r\n        callbackComplete(LoadResult.WRONG_HEADER_BITS_PER_PIXEL, null, 0, null);\r\n      }\r\n      return false;\r\n    }\r\n    // slice start\r\n    bufOff += SIZE_SHORT;\r\n\r\n    // grid spacing\r\n    // const pixdim0 = this.readFloatFromBuffer(bufBytes, bufOff);\r\n    //bufOff += SIZE_DWORD;\r\n    if (DEBUG) console.log(\"buff offset: \", bufOff)\r\n    const pixdim1 = this.readFloatFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_DWORD;\r\n    const pixdim2 = this.readFloatFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_DWORD;\r\n    const pixdim3 = this.readFloatFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_DWORD;\r\n    const pixdim4 = this.readFloatFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_DWORD;\r\n    const pixdim5 = this.readFloatFromBuffer(bufBytes, bufOff);\r\n    if (DEBUG) {\r\n      console.log(`Nifti pixdim1: ${pixdim1}`);\r\n      console.log(`Nifti pixdim2: ${pixdim2}`);\r\n      console.log(`Nifti pixdim3: ${pixdim3}`);\r\n      console.log(`Nifti pixdim4: ${pixdim4}`);\r\n      console.log(`Nifti pixdim5: ${pixdim5}`);\r\n    }\r\n\r\n    //bufOffset is at 92 here, grapped voxOffset at the beginning\r\n    bufOff += 31;\r\n\r\n    const xyzt_units = bufBytes[bufOff];\r\n    if (DEBUG) console.log(\"xyzt_units: \", xyzt_units);\r\n    this.m_boxSize.x = this.m_xDim * pixdim1;\r\n    this.m_boxSize.y = this.m_yDim * pixdim2;\r\n    this.m_boxSize.z = this.m_zDim * pixdim3;\r\n    const TOO_SMALL_SIZE = 1.0e-5;\r\n    if (this.m_boxSize.x < TOO_SMALL_SIZE) {\r\n      const SOME_MAGIC_BOX_DIM = 312.0;\r\n      this.m_boxSize.x = SOME_MAGIC_BOX_DIM;\r\n      this.m_boxSize.y = SOME_MAGIC_BOX_DIM;\r\n      this.m_boxSize.z = SOME_MAGIC_BOX_DIM;\r\n    }\r\n    if (DEBUG) console.log(`Nifti physic volume size: ${this.m_boxSize.x} * ${this.m_boxSize.y} * ${this.m_boxSize.z}`);\r\n\r\n    // 4 last bytes are magic\r\n    bufOff = NIFTI_HEADER_SIZE - SIZE_DWORD;\r\n    // 'n' == 110, '+' == 43, '1' == 49\r\n    const MAG_0 = 110;\r\n    const MAG_1 = 43;\r\n    const MAG_2 = 49;\r\n    const isCorrectMagic = (bufBytes[bufOff + 0] === MAG_0) &&\r\n      // eslint-disable-next-line\r\n      (bufBytes[bufOff + 1] === MAG_1) &&\r\n      // eslint-disable-next-line\r\n      (bufBytes[bufOff + 2] === MAG_2);\r\n    if (!isCorrectMagic) {\r\n      // eslint-disable-next-line\r\n      console.error(`Nifti hdr bad magic: ${bufBytes[bufOff + 0]}, ${bufBytes[bufOff + 1]}, ${bufBytes[bufOff + 2]}`);\r\n      if (callbackComplete) {\r\n        callbackComplete(LoadResult.WRONG_HEADER_MAGIC, null, 0, null);\r\n      }\r\n      return false;\r\n    }\r\n    bufOff += SIZE_DWORD; // last magic bytes in header\r\n\r\n    //note that below variable assumes that each phase contains the same amount of data\r\n    const numVoxelsPerPhase = this.m_xDim * this.m_yDim * this.m_zDim;\r\n    const numVoxels = numVoxelsPerPhase * this.phases;\r\n    const dataOff = vox_offset; //when using nii, the first byte of data is stored at this offset\r\n    const PHASE_OFFSET = (bufLen - dataOff) / this.phases;\r\n    // get power of 2 for data size\r\n    const scale = new Array(this.phases);\r\n    const ACC_DEGREE = 9;\r\n\r\n\r\n        let i, j;\r\n    // scan min max in array\r\n        const valMax = Array(this.phases).fill(0);\r\n        j = 0;\r\n        if ((dataType === NIFTI_DATA_TYPE_INT16) || (dataType === NIFTI_DATA_TYPE_UINT16)) {\r\n            for (let p = 0; p < this.phases; p++) {\r\n                j = p*PHASE_OFFSET;\r\n                for (i = 0; i < numVoxels; i++) {\r\n                    const val = this.readShortFromBuffer(bufBytes, dataOff + j);\r\n                    // eslint-disable-next-line\r\n                    j += 2;\r\n                    if (val > valMax[p]) {\r\n                    valMax[p] = val;\r\n                    }\r\n                    // progress update\r\n                    if (callbackProgress && numVoxels % (j*4) === 0) {\r\n                        const ratio = (j / numVoxels) / 4;\r\n                        if (DEBUG) console.log(\"finding max progress, cap at 25%: \", ratio);\r\n                        callbackProgress(ratio);\r\n                    }\r\n                } // for (i) al voxels\r\n            }\r\n        }\r\n        if (dataType === NIFTI_DATA_TYPE_FLOAT32) {\r\n            for (let p = 0; p < this.phases; p++) {\r\n                j = p*PHASE_OFFSET;\r\n                for (i = 0; i < numVoxels; i++) {\r\n                    const fval = this.readFloatFromBuffer(bufBytes, dataOff + j);\r\n                    const val = Math.floor(fval) + 1;\r\n                    // eslint-disable-next-line\r\n                    j += 4;\r\n                    if (val > valMax[p]) {\r\n                    valMax[p] = val;\r\n                    }\r\n                    // progress update\r\n                    if (callbackProgress && numVoxels % (j*4) === 0) {\r\n                        const ratio = (j / numVoxels) / 4;\r\n                        if (DEBUG) console.log(\"finding max progress, cap at 25%: \", ratio);\r\n                        callbackProgress(ratio);\r\n                    }\r\n                } // for (i) al voxels\r\n            }\r\n        }\r\n\r\n        // console.log(`Nifti 16 data max val: ${valMax}`);\r\n\r\n        // create histogram\r\n        // const histArray = new Int32Array(valMax);\r\n        let histArray = [];\r\n        for (let p = 0; p < this.phases; p++) {\r\n            histArray[p] = new Float32Array(valMax[p] + 1);\r\n            for (i = 0; i < valMax[p] + 1; i++) {\r\n              histArray[p][i] = 0.0;\r\n            }\r\n        }\r\n        j = 0;\r\n        if ((dataType === NIFTI_DATA_TYPE_INT16) || (dataType === NIFTI_DATA_TYPE_UINT16)) {\r\n            for (let p = 0; p < this.phases; p++) {\r\n                j = p*PHASE_OFFSET;\r\n                for (i = 0; i < numVoxelsPerPhase; i++) {\r\n                    const val = this.readShortFromBuffer(bufBytes, dataOff + j);\r\n                    // eslint-disable-next-line\r\n                    j += 2;\r\n                    histArray[p][val] ++;\r\n                }\r\n            }\r\n        } // if\r\n        if (dataType === NIFTI_DATA_TYPE_FLOAT32) {\r\n            for (let p = 0; p < this.phases; p++) {\r\n                j = p*PHASE_OFFSET;\r\n                for (i = 0; i < numVoxelsPerPhase; i++) {\r\n                    const val = Math.floor(this.readFloatFromBuffer(bufBytes, dataOff + j));\r\n                    // eslint-disable-next-line\r\n                    j += 4;\r\n                    histArray[p][val] ++;\r\n                }\r\n            }\r\n        } // if\r\n    const TOO_MIN_SCALE = 4;\r\n    const histogram = new Array(this.phases);\r\n    if ((dataType === NIFTI_DATA_TYPE_INT16) || (dataType === NIFTI_DATA_TYPE_UINT16)) {\r\n        for (let p = 0; p < this.phases; p++) {\r\n            histogram[p] = new UiHistogram();\r\n            histogram[p].assignArray(valMax[p], histArray[p]);\r\n            const HIST_SMOOTH_SIGMA = 0.8;\r\n            const NORMALIZATION_APPLY = false;\r\n            histogram[p].smoothHistogram(HIST_SMOOTH_SIGMA, NORMALIZATION_APPLY);\r\n\r\n            const VAL_MIN = 4.0;\r\n            // fix max index if maximum not found\r\n            let indMax = histogram[p].getLastMaxIndex(VAL_MIN);\r\n            if (indMax < 4) {\r\n                indMax = valMax[p];\r\n            }\r\n            if (DEBUG) console.log(`LoaderNifti. get Last max peak: ${indMax} / ${histogram[p].m_numColors}`);\r\n            scale[p] = (MAX_BYTE << ACC_DEGREE) / indMax;\r\n            if (scale[p] <= TOO_MIN_SCALE) {\r\n                console.error('Bad scaling: image will be 0');\r\n                if (callbackComplete) {\r\n                callbackComplete(LoadResult.ERROR_PROCESS_HISTOGRAM, null, 0, null);\r\n                }\r\n                return false;\r\n            }\r\n        }\r\n    }\r\n\r\n    // convert 16 bit data to 8 bit array\r\n    const BITS_IN_BYTE = 8;\r\n    const dataSize = numVoxels * (bitPix / BITS_IN_BYTE);\r\n    let dataArray = [];\r\n    for (let p = 0; p < this.phases; p++) {\r\n      dataArray[p] = new Uint8Array(numVoxelsPerPhase);\r\n    }\r\n\r\n    i=0\r\n    j=0;\r\n    if ((dataType === NIFTI_DATA_TYPE_INT16) || (dataType === NIFTI_DATA_TYPE_UINT16)) {\r\n        for (let p = 0; p < this.phases; p++) {\r\n            j = p*PHASE_OFFSET;\r\n            for (i = 0; i < numVoxels; i++) {\r\n                let val = this.readShortFromBuffer(bufBytes, dataOff + j);\r\n                // eslint-disable-next-line\r\n                j += 2;\r\n                // scale down to [0..255]\r\n                val = (val * scale[p]) >> ACC_DEGREE;\r\n                // check [0..255] range for some voxels out from histogram peak\r\n                val = (val <= MAX_BYTE) ? val : MAX_BYTE;\r\n                dataArray[p][i] = val;\r\n                // progress update\r\n                if (callbackProgress && numVoxels % (j*4) === 0) {\r\n                    const ratio = 0.5 + (j / numVoxels) / 2;\r\n                    if (DEBUG) console.log(\"filling data, 50%-100%: \", ratio);\r\n                    callbackProgress(ratio);\r\n                }\r\n            } // for (i) all voxels\r\n        }\r\n    } // if 16 bit\r\n    else if ((dataType === NIFTI_DATA_TYPE_INT8) || (dataType === NIFTI_DATA_TYPE_UINT8)) { // if 8 bit\r\n        for (let p = 0; p < this.phases; p++) {\r\n            j = p*PHASE_OFFSET;\r\n            for (i = 0; i < numVoxelsPerPhase; i++, j++) {\r\n                let val = bufBytes[dataOff + j];\r\n\r\n                //support second file with spot data\r\n                // let msk = mask ? mask[dataOff + j] : 0;\r\n\r\n                //this is only module 4 data, so it will look like this [0, 1, 2, 3]\r\n                // we map 3 to 255\r\n\r\n                val *= 255/3 ; // 255 is divisible by 3? CRAZY.\r\n\r\n                // if there is only one file, but it is 8 bit,\r\n                // then this is a combined vasc/spot file, with vasc = 1 and spot > 1\r\n                // if (val > 1) {\r\n                //   msk = 1;\r\n                //   val = 1;\r\n                // }\r\n\r\n                // js is beautiful and super readable so I wont even explain this next part\r\n                //val = (msk && MAX_BYTE) || (val && Math.floor(MAX_BYTE*spotThreshold)); // ensures no part of the spot is cut out\r\n                //val = val && ( msk ? MAX_BYTE : Math.floor(MAX_BYTE*0.99)); // functionally different but gives same result because the mask should be an exact overlay\r\n\r\n                dataArray[p][i] = val;\r\n                // progress update\r\n                if (callbackProgress && numVoxels % (j*4) === 0) {\r\n                    const ratio = 0.5 + (j / numVoxels) / 2;\r\n                    if (DEBUG) console.log(\"filling data, 50%-100%: \", ratio);\r\n                    callbackProgress(ratio);\r\n                }\r\n              } // for (i) all voxels\r\n        } // end phase loop\r\n\r\n    } else throw new Error(\"BAD input dataType\")\r\n\r\n\r\n\r\n   let xyDim = this.m_xDim * this.m_yDim;\r\n   let x; let y;\r\n   let z;\r\n   const zOffMin = 0 * xyDim;\r\n   const zOffMax = (this.m_zDim - 1) * xyDim;\r\n   const xOffMin = 0;\r\n   const xOffMax = this.m_xDim - 1;\r\n   const yOffMin = 0;\r\n   const yOffMax = (this.m_yDim - 1) * this.m_xDim;\r\n   for (let p = 0; p < this.phases; p++) {\r\n        // clear borders\r\n        for (y = 0; y < this.m_yDim; y++) {\r\n        const yOff = y * this.m_xDim;\r\n        for (x = 0; x < this.m_xDim; x++) {\r\n          let off;\r\n          off = zOffMin + yOff + x;\r\n          dataArray[p][off] = 0;\r\n          off = zOffMax + yOff + x;\r\n          dataArray[p][off] = 0;\r\n        } // for (x)\r\n      }   // for (y)\r\n\r\n      for (z = 0; z < this.m_zDim; z++) {\r\n        const zOff = z * xyDim;\r\n        for (y = 0; y < this.m_yDim; y++) {\r\n          let off;\r\n          off = zOff + (y * this.m_xDim) + xOffMin;\r\n          dataArray[p][off] = 0;\r\n          off = zOff + (y * this.m_xDim) + xOffMax;\r\n          dataArray[p][off] = 0;\r\n        }\r\n      }\r\n      for (z = 0; z < this.m_zDim; z++) {\r\n        const zOff = z * xyDim;\r\n        for (x = 0; x < this.m_xDim; x++) {\r\n          let off;\r\n          off = zOff + yOffMin + x;\r\n          dataArray[p][off] = 0;\r\n          off = zOff + yOffMax + x;\r\n          dataArray[p][off] = 0;\r\n        }\r\n      }\r\n    }\r\n\r\n    //since we are now passing array in, just get first index for now\r\n    // save to result volumes\r\n    for (let p = 0; p < this.phases; p++) {\r\n      volDst[p].m_xDim = this.m_xDim;\r\n      volDst[p].m_yDim = this.m_yDim;\r\n      volDst[p].m_zDim = this.m_zDim;\r\n\r\n      const ONE = 1;\r\n      volDst[p].m_bytesPerVoxel = ONE;\r\n      volDst[p].m_dataArray = dataArray[p];\r\n      volDst[p].m_dataSize = numVoxelsPerPhase;\r\n      volDst[p].m_boxSize = this.m_boxSize;\r\n      volDst[p].m_phase = p;\r\n    }\r\n\r\n    if (DEBUG) console.log(`Nifti header read OK. Volume pixels = ${this.m_xDim} * ${this.m_yDim} * ${this.m_zDim} `);\r\n\r\n    // Finally invoke user callback after file was read\r\n    const KTX_GL_RED = 0x1903;\r\n    const KTX_UNSIGNED_BYTE = 0x1401;\r\n    const header = {\r\n      m_pixelWidth: this.m_xDim,\r\n      m_pixelHeight: this.m_yDim,\r\n      m_pixelDepth: this.m_zDim,\r\n      m_glType: KTX_UNSIGNED_BYTE,\r\n      m_glTypeSize: 1,\r\n      m_glFormat: KTX_GL_RED,\r\n      m_glInternalFormat: KTX_GL_RED,\r\n      m_glBaseInternalFormat: KTX_GL_RED,\r\n    };\r\n    if (callbackProgress) {\r\n      callbackProgress(1.0);\r\n    }\r\n    if (callbackComplete) {\r\n      callbackComplete(LoadResult.SUCCESS, header, dataSize, dataArray);\r\n    } // if callbackComplete ready\r\n\r\n    return true;\r\n  } // end of readFromBuffer\r\n  /**\r\n  *\r\n  * Read Nifti file from URL\r\n  * @param {object} volDst volume to read\r\n  * @param {string} strUrl from where\r\n  * @param {Function} callbackProgress invoke during loading\r\n  * @param {Function} callbackComplete invoke at the end with final success code\r\n  */\r\n  readFromUrl(volDst, strUrl, callbackProgress, callbackComplete) {\r\n    if (DEBUG) console.log(`LoadedNifti.staring read ${strUrl} `);\r\n    this.m_fileLoader = new FileLoader(strUrl);\r\n    this.m_fileLoader.readFile((arrBuf) => {\r\n      const okRead = this.readFromBuffer(volDst, arrBuf, callbackProgress, callbackComplete);\r\n      return okRead;\r\n    }, (errMsg) => {\r\n      if (DEBUG) console.log(`LoadedNifti.Error read file: ${errMsg} `);\r\n      callbackComplete(LoadResult.ERROR_CANT_OPEN_URL, null, 0, null);\r\n    });\r\n    return true;\r\n  } // end of readFromUrl\r\n\r\n} // end class LoaderNifti\r\n\r\nexport default LoaderNifti;","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Dicom tags description\r\n* @module lib/scripts/loaders/dicomdict\r\n*/\r\n\r\n\r\nexport default class DicomDictionary {\r\n\r\n  constructor() {\r\n    this.TAGS = [\r\n      /* eslint-disable */\r\n      [0x0002, 0x0000, 'OB', 'FileMetaInfoGroupLength'],\r\n      [0x0002, 0x0001, 'OB', 'FileMetaInformationVersion'],\r\n      [0x0002, 0x0002, 'UI', 'MediaStoredSOPClassUID'],\r\n\r\n      [0x0002, 0x0003, 'UI', 'MediaStoredSOPInstanceUID'],\r\n      [0x0002, 0x0010, 'UI', 'TransferSyntaxUID'],\r\n      [0x0002, 0x0012, 'UI', 'ImplementationClassUID'],\r\n      [0x0002, 0x0013, 'UI', 'ImplementationVersionName'],\r\n      [0x0002, 0x0016, 'UI', 'SourceApplicationEntityTitle'],\r\n      [0x0002, 0x0100, 'UI', 'PrivateInformationCreatorUID'],\r\n      [0x0002, 0x0102, 'UI', 'PrivateInformation'],\r\n\r\n      [0x0008, 0x0000, 'UL', 'IdentifyingGroupLength'],\r\n      [0x0008, 0x0001, 'UI', 'LengthToEnd'],\r\n      [0x0008, 0x0005, 'CS', 'SpecificCharacterSet'],\r\n      [0x0008, 0x0006, 'SQ', 'LanguageCodeSequence'],\r\n      [0x0008, 0x0008, 'CS', 'ImageType'],\r\n      [0x0008, 0x0010, 'SH', 'RecognitionCode'],\r\n      [0x0008, 0x0012, 'DA', 'InstanceCreationDate'],\r\n      [0x0008, 0x0013, 'TM', 'InstanceCreationTime'],\r\n      [0x0008, 0x0014, 'UI', 'InstanceCreatorUID'],\r\n      [0x0008, 0x0016, 'UI', 'SOPClassUID'],\r\n      [0x0008, 0x0018, 'UI', 'SOPInstanceUID'],\r\n      [0x0008, 0x001A, 'UI', 'RelatedGeneralSOPClassUID'],\r\n      [0x0008, 0x001B, 'UI', 'OriginalSpecializedSOPClassUID'],\r\n      [0x0008, 0x0020, 'DA', 'StudyDate'],\r\n      [0x0008, 0x0021, 'DA', 'SeriesDate'],\r\n      [0x0008, 0x0022, 'DA', 'AcquisitionDate'],\r\n      [0x0008, 0x0023, 'DA', 'ContentDate'],\r\n      [0x0008, 0x0024, 'DA', 'OverlayDate'],\r\n      [0x0008, 0x0025, 'DA', 'CurveDate'],\r\n      [0x0008, 0x002A, 'DT', 'AcquisitionDateTime'],\r\n      [0x0008, 0x0030, 'TM', 'StudyTime'],\r\n      [0x0008, 0x0031, 'TM', 'SeriesTime'],\r\n      [0x0008, 0x0032, 'TM', 'AcquisitionTime'],\r\n      [0x0008, 0x0033, 'TM', 'ContentTime'],\r\n      [0x0008, 0x0034, 'TM', 'OverlayTime'],\r\n      [0x0008, 0x0035, 'TM', 'CurveTime'],\r\n      [0x0008, 0x0040, 'US', 'DataSetType'],\r\n      [0x0008, 0x0041, 'LO', 'DataSetSubtype'],\r\n      [0x0008, 0x0042, 'CS', 'NuclearMedicineSeriesType'],\r\n      [0x0008, 0x0050, 'SH', 'AccessionNumber'],\r\n      [0x0008, 0x0051, 'SQ', 'IssuerOfAccessionNumberSequence'],\r\n      [0x0008, 0x0052, 'CS', 'QueryRetrieveLevel'],\r\n      [0x0008, 0x0054, 'AE', 'RetrieveAETitle'],\r\n      [0x0008, 0x0056, 'CS', 'InstanceAvailability'],\r\n      [0x0008, 0x0058, 'UI', 'FailedSOPInstanceUIDList'],\r\n      [0x0008, 0x0060, 'CS', 'Modality'],\r\n      [0x0008, 0x0070, 'XX', 'Manufacturer'],\r\n      [0x0008, 0x0080, 'XX', 'InstitutionName'],\r\n      [0x0008, 0x0081, 'XX', 'InstitutionAddress'],\r\n      [0x0008, 0x0090, 'XX', 'ReferringPhysicansName'],\r\n      [0x0008, 0x1010, 'XX', 'StationName'],\r\n      [0x0008, 0x1030, 'XX', 'StudyDescription'],\r\n      [0x0008, 0x103E, 'LO', 'SeriesDescription'],\r\n      [0x0008, 0x1040, 'XX', 'InstitutionDepartmentName'],\r\n      [0x0008, 0x1050, 'XX', 'PerformingPhysicansName'],\r\n      [0x0008, 0x1060, '\"XX', '\"Unkown'],\r\n      [0x0008, 0x1080, 'XX', 'AdmittingDiagnosesDescription'],\r\n      [0x0008, 0x1090, 'XX', 'ManufacturterModelName'],\r\n      [0x0008, 0x1111, 'XX', 'ReferencedPerformedProcStepSeq'],\r\n      [0x0008, 0x1140, 'XX', 'ReferencedImageSequence'],\r\n      [0x0008, 0x1150, 'UI', 'ReferencedSOP​ClassUID'],\r\n      [0x0008, 0x1155, 'UI', 'ReferencedSOP​InstanceUID'],\r\n\r\n      [0x0008, 0x2111, '\"XX', '\"DerivationDescription'],\r\n      [0x0008, 0x2112, '\"XX', '\"SourceImageSequence'],\r\n    \r\n      [0x0009, 0x0010, 'LO', 'PrivateCreator'],\r\n      [0x0009, 0x0011, '??', '\"Unknown'],\r\n      [0x0009, 0x0012, '??', '\"Unknown'],\r\n    \r\n      [0x0009, 0x1001, 'XX', 'PrivateTag'],\r\n      [0x0009, 0x1002, 'XX', 'PrivateTag'],\r\n      [0x0009, 0x1004, 'XX', 'PrivateTag'],\r\n      [0x0009, 0x1027, 'XX', 'PrivateTag'],\r\n      [0x0009, 0x1030, 'XX', 'PrivateTag'],\r\n      [0x0009, 0x1031, 'XX', 'PrivateTag'],\r\n      [0x0009, 0x10E3, 'XX', 'PrivateTag'],\r\n      [0x0009, 0x10E9, 'XX', 'PrivateTag'],\r\n\r\n      [0x0010, 0x0000, 'UL', 'PatientGroupLength'],\r\n      [0x0010, 0x0010, 'PN', 'PatientName'],\r\n      [0x0010, 0x0020, 'LO', 'PatientID'],\r\n      [0x0010, 0x0021, 'LO', 'IssuerOfPatientID'],\r\n      [0x0010, 0x0022, 'CS', 'TypeOfPatientID'],\r\n      [0x0010, 0x0024, 'SQ', 'IssuerOfPatientIDQualifiersSequence'],\r\n      [0x0010, 0x0030, 'DA', 'PatientBirthDate'],\r\n      [0x0010, 0x0032, 'TM', 'PatientBirthTime'],\r\n      [0x0010, 0x0040, 'CS', 'PatientGender'],\r\n      [0x0010, 0x0050, 'SQ', 'PatientInsurancePlanCodeSequence'],\r\n      [0x0010, 0x0101, 'SQ', 'PatientPrimaryLanguageCodeSequence'],\r\n      [0x0010, 0x0102, 'SQ', 'PatientPrimaryLanguageModifierCodeSequence'],\r\n      [0x0010, 0x1000, 'LO', 'OtherPatientIDs'],\r\n      [0x0010, 0x1001, 'PN', 'OtherPatientNames'],\r\n      [0x0010, 0x1002, 'SQ', 'OtherPatientIDsSequence'],\r\n      [0x0010, 0x1005, 'PN', 'PatientBirthName'],\r\n      [0x0010, 0x1010, 'AS', 'PatientAge'],\r\n      [0x0010, 0x1020, 'DS', 'PatientSize'],\r\n      [0x0010, 0x1021, 'SQ', 'PatientSizeCodeSequence'],\r\n      [0x0010, 0x1030, 'DS', 'PatientWeight'],\r\n      [0x0010, 0x1040, 'LO', 'PatientAddress'],\r\n      [0x0010, 0x1050, 'LO', 'InsurancePlanIdentification'],\r\n      [0x0010, 0x1060, 'PN', 'PatientMotherBirthName'],\r\n      [0x0010, 0x1080, 'LO', 'MilitaryRank'],\r\n      [0x0010, 0x1081, 'LO', 'BranchOfService'],\r\n      [0x0010, 0x1090, 'LO', 'MedicalRecordLocator'],\r\n      [0x0010, 0x2000, 'LO', 'MedicalAlerts'],\r\n      [0x0010, 0x2110, 'LO', 'Allergies'],\r\n      [0x0010, 0x2150, 'LO', 'CountryOfResidence'],\r\n      [0x0010, 0x2152, 'LO', 'RegionOfResidence'],\r\n      [0x0010, 0x2154, 'SH', 'PatientTelephoneNumbers'],\r\n      [0x0010, 0x2160, 'SH', 'EthnicGroup'],\r\n      [0x0010, 0x2180, 'SH', 'Occupation'],\r\n      [0x0010, 0x21A0, 'CS', 'SmokingStatus'],\r\n      [0x0010, 0x21B0, 'LT', 'AdditionalPatientHistory'],\r\n      [0x0010, 0x21C0, 'US', 'PregnancyStatus'],\r\n      [0x0010, 0x21D0, 'DA', 'LastMenstrualDate'],\r\n      [0x0010, 0x21F0, 'LO', 'PatientReligiousPreference'],\r\n      [0x0010, 0x2201, 'LO', 'PatientSpeciesDescription'],\r\n      [0x0010, 0x2202, 'SQ', 'PatientSpeciesCodeSequence'],\r\n      [0x0010, 0x2203, 'CS', 'PatientSexNeutered'],\r\n      [0x0010, 0x2210, 'CS', 'AnatomicalOrientationType'],\r\n      [0x0010, 0x2292, 'LO', 'PatientBreedDescription'],\r\n      [0x0010, 0x2293, 'SQ', 'PatientBreedCodeSequence'],\r\n      [0x0010, 0x2294, 'SQ', 'BreedRegistrationSequence'],\r\n      [0x0010, 0x2295, 'LO', 'BreedRegistrationNumber'],\r\n      [0x0010, 0x2296, 'SQ', 'BreedRegistryCodeSequence'],\r\n      [0x0010, 0x2297, 'PN', 'ResponsiblePerson'],\r\n      [0x0010, 0x2298, 'CS', 'ResponsiblePersonRole'],\r\n      [0x0010, 0x2299, 'LO', 'ResponsibleOrganization'],\r\n      [0x0010, 0x4000, 'LT', 'PatientComments'],\r\n      [0x0010, 0x9431, 'FL', 'ExaminedBodyThickness'],\r\n\r\n      [0x0018, 0x0000, 'UL', 'AcquisitionGroupLength'],\r\n      [0x0018, 0x0020, 'XX', 'ScanningSequence'],\r\n      [0x0018, 0x0021, 'XX', 'SequenceVariant'],\r\n      [0x0018, 0x0022, 'XX', 'ScanOptions'],\r\n      [0x0018, 0x0023, 'XX', 'MrAcquisionType'],\r\n      // Add new tag from 2019-01-23\r\n      [0x0018, 0x0024, '??', '\"SequenceName'],\r\n      [0x0018, 0x0025, 'XX', 'AngioFlag'],\r\n      [0x0018, 0x0050, 'XX', 'SliceThickness'],\r\n      [0x0018, 0x0060, 'DS', 'KVP'],\r\n      [0x0018, 0x0080, 'XX', 'RepetitionTime'],\r\n      [0x0018, 0x0081, 'XX', 'EchoTime'],\r\n      [0x0018, 0x0082, 'XX', 'InversionTime'],\r\n      [0x0018, 0x0083, 'XX', 'NumberOfAverages'],\r\n      [0x0018, 0x0084, 'XX', 'ImagingFrequency'],\r\n      [0x0018, 0x0085, 'XX', 'ImagedNucleus'],\r\n      [0x0018, 0x0086, 'XX', 'EchoNumber'],\r\n      [0x0018, 0x0087, 'XX', 'MagneticFieldStrength'],\r\n      [0x0018, 0x0088, 'XX', 'SpacingBetweenSlices'],\r\n      [0x0018, 0x0089, 'XX', 'NumberOfPhaseEncodingSteps'],\r\n      [0x0018, 0x0090, 'XX', 'DataCollectionDiameter'],\r\n      [0x0018, 0x0091, 'XX', 'EchoTrainLength'],\r\n      [0x0018, 0x0093, 'XX', 'ProcentSampling'],\r\n      [0x0018, 0x0094, 'XX', 'ProcentPhaseFieldOfView'],\r\n      [0x0018, 0x0095, 'XX', 'PixelBandwidth'],\r\n      [0x0018, 0x1000, 'XX', 'DeviceSerialNumber'],\r\n      [0x0018, 0x1002, \"??\", 'DeviceUID'],\r\n      [0x0018, 0x1003, \"??\", 'DeviceID'],\r\n      [0x0018, 0x1004, \"??\", 'PlateID'],\r\n      [0x0018, 0x1005, \"??\", 'GeneratorID'],\r\n      [0x0018, 0x1006, \"??\", 'GridID'],\r\n      [0x0018, 0x1007, \"??\", '\"CassetteID'],\r\n      [0x0018, 0x1008, \"??\", 'GantryID'],\r\n      [0x0018, 0x1010, \"??\", 'SecondaryCaptureDeviceID'],\r\n      [0x0018, 0x1011, \"??\", 'HardcopyCreationDeviceID'],\r\n      [0x0018, 0x1012, \"??\", 'DateOfSecondaryCapture'],\r\n      [0x0018, 0x1014, \"??\", 'TimeOfSecondaryCapture'],\r\n      [0x0018, 0x1016, \"??\", 'SecondaryCaptureDeviceManufacturer'],\r\n      [0x0018, 0x1017, \"??\", 'HardcopyDeviceManufacturer'],\r\n      [0x0018, 0x1018, \"??\", 'SecondaryCaptureDeviceModelName'],\r\n      [0x0018, 0x1019, \"??\", 'SecondaryCaptureDeviceSoftwareVers'],\r\n      [0x0018, 0x101A, \"??\", 'HardcopyDeviceSoftwareVersion'],\r\n      [0x0018, 0x101B, \"??\", 'HardcopyDeviceModelName'],\r\n    \r\n      [0x0018, 0x1020, 'XX', 'SoftwareVersions'],\r\n      [0x0018, 0x1030, 'XX', 'ProtocolName'],\r\n      [0x0018, 0x1081, 'XX', '\"LowR-RValue'],\r\n      [0x0018, 0x1082, 'XX', '\"HiR-RValue'],\r\n      [0x0018, 0x1083, 'XX', '\"IntervalsAcquired'],\r\n      [0x0018, 0x1084, 'XX', '\"IntervalsRejected'],\r\n    \r\n      [0x0018, 0x1088, 'XX', 'HeartRate'],\r\n      [0x0018, 0x1090, 'XX', 'CardiacNumberOfImages'],\r\n      [0x0018, 0x1094, 'XX', 'TriggerWindow'],\r\n      [0x0018, 0x1100, 'XX', 'ReconstructionDiameter'],\r\n      [0x0018, 0x1110, 'XX', 'DistanceSourceToDetector'],\r\n      [0x0018, 0x1111, 'XX', 'DistanceSourceToPatient'],\r\n      [0x0018, 0x1115, 'XX', 'Unknown'],\r\n      [0x0018, 0x1120, 'XX', 'GantryDetectorTilt'],\r\n      [0x0018, 0x1130, 'XX', 'TableHeight'],\r\n      [0x0018, 0x1140, 'XX', 'RotationDirection'],\r\n      [0x0018, 0x1150, 'XX', 'ExposureTime'],\r\n      [0x0018, 0x1151, 'XX', 'XRayTubeCurrent'],\r\n      [0x0018, 0x1152, 'XX', 'Exposure'],\r\n      [0x0018, 0x115e, 'XX', '\"Unknown'],\r\n\r\n      [0x0018, 0x1160, 'XX', 'FilterType'],\r\n      [0x0018, 0x1164, 'XX', '\"unknown'],\r\n      [0x0018, 0x1166, 'XX', '\"unknown'],\r\n      [0x0018, 0x1168, 'XX', '\"unknown'],\r\n    \r\n      [0x0018, 0x1170, 'XX', 'GeneratorPower'],\r\n      [0x0018, 0x1180, 'XX', '\"Unknown'],\r\n      [0x0018, 0x1190, 'XX', 'FocalSpot'],\r\n      [0x0018, 0x1210, 'XX', 'ConvolutionKernel'],\r\n      [0x0018, 0x1250, 'XX', 'ReceiveCoilName'],\r\n      [0x0018, 0x1310, 'XX', 'AcquisionMatrix'],\r\n      [0x0018, 0x1312, 'XX', 'InPlanePhaseEncodingDirection'],\r\n      [0x0018, 0x1314, 'XX', 'FlipAngle'],\r\n      [0x0018, 0x1315, 'XX', 'VariableFlipAngleFlag'],\r\n      [0x0018, 0x1316, 'XX', 'SAR'],\r\n      [0x0018, 0x1400, 'XX', 'unknown'],\r\n\r\n      [0x0018, 0x1600, 'XX', '\"ShutterShape'],\r\n      [0x0018, 0x1602, 'XX', 'ShutterLeftVerticalEdge'],\r\n      [0x0018, 0x1604, 'XX', '\"ShutterRightVerticalEdge'],\r\n      [0x0018, 0x1606, 'XX', '\"ShutterUpperHorizontalEdge'],\r\n      [0x0018, 0x1608, 'XX', '\"ShutterLowerHorizontalEdge'],\r\n      [0x0018, 0x1610, 'XX', '\"CenterOfCircularShutter'],\r\n      [0x0018, 0x1612, 'XX', '\"RadiusOfCircularShutter'],\r\n      [0x0018, 0x1620, 'XX', '\"VerticesOfPolygonalShutter'],\r\n      [0x0018, 0x1622, 'XX', '\"ShutterPresentationValue'],\r\n      [0x0018, 0x1623, 'XX', '\"ShutterOverlayGroup'],\r\n      [0x0018, 0x1624, 'XX', '\"ShutterPresentationColorCIELabVal'],\r\n    \r\n      [0x0018, 0x1700, 'XX', 'Unknown'],\r\n      [0x0018, 0x1702, 'XX', 'Unknown'],\r\n      [0x0018, 0x1704, 'XX', 'Unknown'],\r\n      [0x0018, 0x1706, 'XX', 'Unknown'],\r\n      [0x0018, 0x1708, 'XX', 'Unknown'],\r\n\r\n      [0x0018, 0x4000, 'XX', '\"AcquisitionComments'],\r\n      [0x0018, 0x5000, 'XX', 'OutputPower'],\r\n      [0x0018, 0x5020, 'XX', 'Unknown'],\r\n      [0x0018, 0x5021, 'XX', '\"Unknown'],\r\n\r\n      [0x0018, 0x5100, 'XX', 'PatientPosition'],\r\n      [0x0018, 0x5101, 'XX', 'ViewPosition'],\r\n      [0x0018, 0x6000, 'XX', 'Unknown'],\r\n    \r\n      [0x0018, 0x9301, 'XX', 'CTAcquisitionTypeSequence'],\r\n      [0x0018, 0x9302, 'XX', 'AcquisitionType'],\r\n      [0x0018, 0x9303, 'XX', 'TubeAngle'],\r\n      [0x0018, 0x9304, 'XX', 'CTAcquisitionDetailsSequence'],\r\n      [0x0018, 0x9305, 'XX', 'RevolutionTime'],\r\n      [0x0018, 0x9306, 'XX', 'SingleCollimationWidth'],\r\n      [0x0018, 0x9307, 'XX', 'TotalCollimationWidth'],\r\n      [0x0018, 0x9308, 'XX', 'CTTableDynamicsSequence'],\r\n      [0x0018, 0x9309, 'XX', 'TableSpeed'],\r\n      [0x0018, 0x9310, 'XX', 'TableFeedPerRotation'],\r\n    \r\n      [0x0018, 0x9311, 'XX', 'SpiralPitchFactor'],\r\n      [0x0018, 0x9312, 'XX', 'CTGeometrySequence'],\r\n      [0x0018, 0x9313, 'XX', 'DataCollectionCenterPatient'],\r\n      [0x0018, 0x9314, 'XX', 'CTReconstructionSequence'],\r\n      [0x0018, 0x9315, 'XX', 'ReconstructionAlgorithm'],\r\n      [0x0018, 0x9316, 'XX', 'ConvolutionKernelGroup'],\r\n      [0x0018, 0x9317, 'XX', 'ReconstructionFieldOfView'],\r\n      [0x0018, 0x9318, 'XX', 'ReconstructionTargetCenterPatient'],\r\n      [0x0018, 0x9319, 'XX', 'ReconstructionAngle'],\r\n      [0x0018, 0x9320, 'XX', 'ImageFilter'],\r\n      [0x0018, 0x9321, 'XX', 'CTExposureSequenc'],\r\n      [0x0018, 0x9322, 'XX', 'ReconstructionPixelSpacing'],\r\n      [0x0018, 0x9323, 'XX', 'ExposureModulationType'],\r\n      [0x0018, 0x9324, 'XX', 'EstimatedDoseSaving'],\r\n      [0x0018, 0x9325, 'XX', 'CTXRayDetailsSequence'],\r\n      [0x0018, 0x9326, 'XX', 'CTPositionSequence'],\r\n      [0x0018, 0x9327, 'XX', 'TablePosition'],\r\n      [0x0018, 0x9328, 'XX', 'ExposureTimeInMilliSec'],\r\n      [0x0018, 0x9329, 'XX', 'CTImageFrameTypeSequence'],\r\n      [0x0018, 0x9330, 'XX', 'XRayTubeCurrentInMilliAmps'],\r\n    \r\n      [0x0019, 0x0010, 'LO', 'PrivateCreator'],\r\n      [0x0019, 0x1002, 'XX', 'NumberOfCellsInDetector'],\r\n      [0x0019, 0x1003, 'XX', 'CellsNumberAtTheta'],\r\n      [0x0019, 0x1004, 'XX', 'CellsSpacing'],\r\n      [0x0019, 0x100F, 'XX', 'HorizFrameOfRef'],\r\n      [0x0019, 0x1011, 'XX', 'SeriesContrast'],\r\n      [0x0019, 0x1012, 'XX', 'LastPSeq'],\r\n      [0x0019, 0x1013, 'XX', 'StartNumberOfBaseLine'],\r\n      [0x0019, 0x1014, 'XX', 'EndNumberOfBaseLine'],\r\n      [0x0019, 0x1015, 'XX', 'StartNumberForEnchancedScans'],\r\n      [0x0019, 0x1016, 'XX', 'EndNumberForEnchancedScans'],\r\n      [0x0019, 0x1017, 'XX', 'SeriesPlane'],\r\n      [0x0019, 0x1018, 'XX', 'FirstScanRas'],\r\n      [0x0019, 0x1019, 'XX', 'FirstScanLocation'],\r\n      [0x0019, 0x101A, 'XX', 'LastScanRas'],\r\n      [0x0019, 0x101B, 'XX', 'LastScanLoc'],\r\n      [0x0019, 0x101E, 'XX', 'DisplayFieldOfView'],\r\n      [0x0019, 0x1023, 'XX', 'TableSpeed'],\r\n      [0x0019, 0x1024, 'XX', 'MidScanTime'],\r\n      [0x0019, 0x1025, 'XX', 'MidScanFlag'],\r\n      [0x0019, 0x1026, 'XX', 'DegreesOfAzimuth'],\r\n      [0x0019, 0x1027, 'XX', 'GantryPeriod'],\r\n      [0x0019, 0x102A, 'XX', 'XRayOnPosition'],\r\n      [0x0019, 0x102B, 'XX', 'XRayOffPosition'],\r\n      [0x0019, 0x102C, 'XX', 'NumberOfTriggers'],\r\n      [0x0019, 0x102E, 'XX', 'AngleOfFirstView'],\r\n      [0x0019, 0x102F, 'XX', 'TriggerFrequency'],\r\n      [0x0019, 0x1039, 'XX', 'ScanFovType'],\r\n      [0x0019, 0x1040, 'XX', 'StatReconFlag'],\r\n      [0x0019, 0x1041, 'XX', 'ComputeType'],\r\n      [0x0019, 0x1042, 'XX', 'SegmentNumber'],\r\n      [0x0019, 0x1043, 'XX', 'TotalSegmentsRequested'],\r\n      [0x0019, 0x1044, 'XX', 'InterscanDelay'],\r\n      [0x0019, 0x1047, 'XX', 'ViewCompressionFactor'],\r\n      [0x0019, 0x104A, 'XX', 'TotalNoOfRefChannels'],\r\n      [0x0019, 0x104B, 'XX', 'DataSizeForScanData'],\r\n      [0x0019, 0x1052, 'XX', 'ReconPostProcflag'],\r\n      [0x0019, 0x1057, 'XX', 'CTWaterNumber'],\r\n      [0x0019, 0x1058, 'XX', 'CTBoneNumber'],\r\n      [0x0019, 0x105A, 'XX', 'AcquisitionDuration'],\r\n      [0x0019, 0x105E, 'XX', 'NumberOfChannels'],\r\n      [0x0019, 0x105F, 'XX', 'IncrementBetweenChannels'],\r\n      [0x0019, 0x1060, 'XX', 'StartingView'],\r\n      [0x0019, 0x1061, 'XX', 'NumberOfViews'],\r\n      [0x0019, 0x1062, 'XX', 'IncrementBetweenViews'],\r\n      [0x0019, 0x106A, 'XX', 'DependantOnNoViewsProcessed'],\r\n      [0x0019, 0x107D, 'DS', 'SecondEcho'],\r\n      [0x0019, 0x107E, 'SS', 'NumberOfEchoes'],\r\n      [0x0019, 0x107F, 'DS', 'TableDelta'],\r\n      [0x0019, 0x1081, 'SS', 'Contiguous'],\r\n      [0x0019, 0x1084, 'DS', 'PeakSAR'],\r\n      [0x0019, 0x1087, 'DS', 'CardiacRepetitionTime'],\r\n      [0x0019, 0x1088, 'SS', 'ImagesPerCardiacCycle'],\r\n      [0x0019, 0x108A, 'SS', 'ActualReceiveGainAnalog'],\r\n      [0x0019, 0x108B, 'SS', 'ActualReceiveGainDigital'],\r\n      [0x0019, 0x108D, 'DS', 'DelayAfterTrigger'],\r\n      [0x0019, 0x108F, 'SS', 'Swappf'],\r\n      [0x0019, 0x1090, 'SS', 'PauseInterval'],\r\n      [0x0019, 0x1091, 'DS', 'PulseTime'],\r\n      [0x0019, 0x1092, 'SL', 'SliceOffsetOnFreqAxis'],\r\n      [0x0019, 0x1093, 'DS', 'CenterFrequency'],\r\n      [0x0019, 0x1094, 'SS', 'TransmitGain'],\r\n      [0x0019, 0x1095, 'SS', 'AnalogReceiverGain'],\r\n      [0x0019, 0x1096, 'SS', 'DigitalReceiverGain'],\r\n      [0x0019, 0x1097, 'SL', 'BitmapDefiningCVs'],\r\n      [0x0019, 0x109B, 'SS', 'PulseSeqMode'],\r\n      [0x0019, 0x109C, 'LO', 'PulseSeqName'],\r\n      [0x0019, 0x109D, 'DT', 'PulseSeqDate'],\r\n      [0x0019, 0x109E, 'LO', 'InternalPulseSeqName'],\r\n      [0x0019, 0x109F, 'SS', 'TransmittingCoil'],\r\n      [0x0019, 0x10A0, 'SS', 'SurfaceCoilType'],\r\n      [0x0019, 0x10A1, 'SS', 'ExtremityCoilFlag'],\r\n      [0x0019, 0x10A2, 'SL', 'RawDataRunNumber'],\r\n      [0x0019, 0x10A3, 'UL', 'CalibratedFieldStrength'],\r\n      [0x0019, 0x10A4, 'SS', 'SATFatWaterBone'],\r\n      [0x0019, 0x10A7, 'DS', 'UserData01'],\r\n      [0x0019, 0x10A8, 'DS', 'UserData02'],\r\n      [0x0019, 0x10A9, 'DS', 'UserData03'],\r\n      [0x0019, 0x10AA, 'DS', 'UserData04'],\r\n      [0x0019, 0x10AB, 'DS', 'UserData05'],\r\n      [0x0019, 0x10AC, 'DS', 'UserData06'],\r\n      [0x0019, 0x10AD, 'DS', 'UserData07'],\r\n      [0x0019, 0x10AE, 'DS', 'UserData08'],\r\n      [0x0019, 0x10AF, 'DS', 'UserData09'],\r\n      [0x0019, 0x10B0, 'DS', 'UserData10'],\r\n      [0x0019, 0x10B1, 'DS', 'UserData11'],\r\n      [0x0019, 0x10B2, 'DS', 'UserData12'],\r\n      [0x0019, 0x10B3, 'DS', 'UserData13'],\r\n      [0x0019, 0x10B4, 'DS', 'UserData14'],\r\n      [0x0019, 0x10B5, 'DS', 'UserData15'],\r\n      [0x0019, 0x10B6, 'DS', 'UserData16'],\r\n      [0x0019, 0x10B7, 'DS', 'UserData17'],\r\n      [0x0019, 0x10B8, 'DS', 'UserData18'],\r\n      [0x0019, 0x10B9, 'DS', 'UserData19'],\r\n      [0x0019, 0x10BA, 'DS', 'UserData20'],\r\n      [0x0019, 0x10BB, 'DS', 'UserData21'],\r\n      [0x0019, 0x10BC, 'DS', 'UserData22'],\r\n      [0x0019, 0x10BD, 'DS', 'UserData23'],\r\n      [0x0019, 0x10BE, 'DS', 'ProjectionAngle'],\r\n      [0x0019, 0x10C0, 'SS', 'SaturationPlanes'],\r\n      [0x0019, 0x10C2, 'SS', 'SATLocationR'],\r\n      [0x0019, 0x10C3, 'SS', 'SATLocationL'],\r\n      [0x0019, 0x10C4, 'SS', 'SATLocationA'],\r\n      [0x0019, 0x10C5, 'SS', 'SATLocationP'],\r\n      [0x0019, 0x10C6, 'SS', 'SATLocationH'],\r\n      [0x0019, 0x10C7, 'SS', 'SATLocationF'],\r\n      [0x0019, 0x10C8, 'SS', 'SATThicknessR-L'],\r\n      [0x0019, 0x10C9, 'SS', 'SATThicknessA-P'],\r\n      [0x0019, 0x10CA, 'SS', 'SATThicknessH-F'],\r\n      [0x0019, 0x10CB, 'SS', 'PrescribedFlowAxis'],\r\n      [0x0019, 0x10CC, 'SS', 'VelocityEncoding'],\r\n      [0x0019, 0x10CD, 'SS', 'ThicknessDisclaimer'],\r\n      [0x0019, 0x10CE, 'SS', 'PrescanType'],\r\n      [0x0019, 0x10CF, 'SS', 'PrescanStatus'],\r\n      [0x0019, 0x10D2, 'SS', 'ProjectionAlgorithm'],\r\n      [0x0019, 0x10D3, 'SH', 'ProjectionAlgorithm'],\r\n      [0x0019, 0x10D5, 'SS', 'FractionalEcho'],\r\n      [0x0019, 0x10D7, 'SS', 'CardiacPhases'],\r\n      [0x0019, 0x10D8, 'SS', 'VariableEchoflag'],\r\n      [0x0019, 0x10D9, 'DS', 'ConcatenatedSAT'],\r\n      [0x0019, 0x10DF, 'DS', 'UserData'],\r\n      [0x0019, 0x10E0, 'DS', 'UserData'],\r\n      [0x0019, 0x10E2, 'DS', 'VelocityEncodeScale'],\r\n      [0x0019, 0x10F2, 'SS', 'FastPhases'],\r\n      [0x0019, 0x10F9, 'DS', 'TransmissionGain'],\r\n\r\n      [0x0020, 0x0000, 'UL', 'RelationshipGroupLength'],\r\n      [0x0020, 0x000D, 'UI', 'StudyInstanceID'],\r\n      [0x0020, 0x000E, 'UI', 'SeriesInstanceID'],\r\n      [0x0020, 0x0010, 'IS', 'StudyID'],\r\n      [0x0020, 0x0011, 'IS', 'SeriesNumber'],\r\n      [0x0020, 0x0012, 'IS', 'AcquisionNumber'],\r\n      [0x0020, 0x0013, 'IS', 'ImageNumber'],\r\n      [0x0020, 0x0020, 'IS', 'PatientOrientation'],\r\n      [0x0020, 0x0032, 'DS', 'ImagePosition'],\r\n      [0x0020, 0x0037, 'DS', 'ImageOrientation'],\r\n      [0x0020, 0x0040, 'XX', 'PositionReferenceIndicator'],\r\n      [0x0020, 0x0041, 'XX', 'SliceLocation'],\r\n      [0x0020, 0x0052, 'UI', 'FrameOfRefefernceID'],\r\n      [0x0020, 0x0060, 'XX', 'Laterality'],\r\n      [0x0020, 0x1002, 'XX', 'ImagesInAcquision'],\r\n      [0x0020, 0x1040, 'LO', 'PositionReferenceIndicator'],\r\n      [0x0020, 0x1041, 'DS', 'SliceLocation'],\r\n      [0x0020, 0x9056, 'XX', 'StackId'],\r\n      [0x0020, 0x9057, 'XX', 'InStackPositionNumber'],\r\n\r\n      [0x0021, 0x0010, 'LO', 'PrivateCreator'],\r\n      [0x0021, 0x1003, 'XX', 'SeriesFromWhichPrescribed'],\r\n      [0x0021, 0x1005, 'XX', 'GenesisVersionNow'],\r\n      [0x0021, 0x1007, 'XX', 'SeriesRecordChecksum'],\r\n      [0x0021, 0x1018, 'XX', 'GenesisVersionNow'],\r\n      [0x0021, 0x1019, 'XX', 'AcqreconRecordChecksum'],\r\n      [0x0021, 0x1020, 'XX', 'TableStartLocation'],\r\n      [0x0021, 0x1035, 'XX', 'SeriesFromWhichPrescribed'],\r\n      [0x0021, 0x1036, 'XX', 'ImageFromWhichPrescribed'],\r\n      [0x0021, 0x1037, 'XX', 'ScreenFormat'],\r\n      [0x0021, 0x104A, 'XX', 'AnatomicalReferenceForScout'],\r\n      [0x0021, 0x104F, 'XX', 'LocationsInAcquisition'],\r\n      [0x0021, 0x1050, 'XX', 'GraphicallyPrescribed'],\r\n      [0x0021, 0x1051, 'XX', 'RotationFromSourceXRot'],\r\n      [0x0021, 0x1052, 'XX', 'RotationFromSourceYRot'],\r\n      [0x0021, 0x1053, 'XX', 'RotationFromSourceZRot'],\r\n      [0x0021, 0x1054, 'XX', 'ImagePosition'],\r\n      [0x0021, 0x1055, 'XX', 'ImageOrientation'],\r\n      [0x0021, 0x1056, 'XX', 'IntegerSlop'],\r\n      [0x0021, 0x1057, 'XX', 'IntegerSlop'],\r\n      [0x0021, 0x1058, 'XX', 'IntegerSlop'],\r\n      [0x0021, 0x1059, 'XX', 'IntegerSlop'],\r\n      [0x0021, 0x105A, 'XX', 'IntegerSlop'],\r\n      [0x0021, 0x105B, 'XX', 'FloatSlop'],\r\n      [0x0021, 0x105C, 'XX', 'FloatSlop'],\r\n      [0x0021, 0x105D, 'XX', 'FloatSlop'],\r\n      [0x0021, 0x105E, 'XX', 'FloatSlop'],\r\n      [0x0021, 0x105F, 'XX', 'FloatSlop'],\r\n      [0x0021, 0x1081, 'XX', 'AutoWindowLevelAlpha'],\r\n      [0x0021, 0x1082, 'XX', 'AutoWindowLevelBeta'],\r\n      [0x0021, 0x1083, 'XX', 'AutoWindowLevelWindow'],\r\n      [0x0021, 0x1084, 'XX', 'ToWindowLevelLevel'],\r\n      [0x0021, 0x1090, 'XX', 'TubeFocalSpotPosition'],\r\n      [0x0021, 0x1091, 'XX', 'BiopsyPosition'],\r\n      [0x0021, 0x1092, 'XX', 'BiopsyTLocation'],\r\n      [0x0021, 0x1093, 'XX', 'BiopsyRefLocation'],\r\n\r\n      [0x0023, 0x0010, 'LO', 'PrivateCreator'],\r\n      [0x0023, 0x1001, 'XX', 'NumberOfSeriesInStudy'],\r\n      [0x0023, 0x1002, 'XX', 'NumberOfUnarchivedSeries'],\r\n      [0x0023, 0x1010, 'XX', 'ReferenceImageField'],\r\n      [0x0023, 0x1050, 'XX', 'SummaryImage'],\r\n      [0x0023, 0x1070, 'XX', 'StartTimeSecsInFirstAxial'],\r\n      [0x0023, 0x1074, 'SL', 'NoofUpdatesToHeader'],\r\n      [0x0023, 0x107d, 'SS', 'IndicatesIfTheStudyHasCompleteInfo'],\r\n      [0x0023, 0x1080, 'LO', 'CRFilmFormat'],\r\n\r\n      [0x0025, 0x0010, 'LO', 'PrivateCreator'],\r\n      [0x0025, 0x1006, 'SS', 'LastPulseSequenceUsed'],\r\n      [0x0025, 0x1007, 'SL', 'ImagesInSeries'],\r\n      [0x0025, 0x1010, 'SL', 'LandmarkCounter'],\r\n      [0x0025, 0x1011, 'SS', 'NumberOfAcquisitions'],\r\n      [0x0025, 0x1014, 'SL', 'IndicatesNoofUpdatesToHeader'],\r\n      [0x0025, 0x1017, 'SL', 'SeriesCompleteFlag'],\r\n      [0x0025, 0x1018, 'SL', 'NumberOfImagesArchived'],\r\n      [0x0025, 0x1019, 'SL', 'LastImageNumberUsed'],\r\n      [0x0025, 0x101A, 'SH', 'PrimaryReceiverSuiteAndHost'],\r\n      [0x0025, 0x101B, 'OB', 'ProtocolDataBlock'],\r\n\r\n      [0x0027, 0x0010, 'LO', 'PrivateCreator'],\r\n      [0x0027, 0x1006, 'XX', 'ImageArchiveFlag'],\r\n      [0x0027, 0x1010, 'XX', 'ScoutType'],\r\n      [0x0027, 0x101C, 'XX', 'VmaMamp'],\r\n      [0x0027, 0x101D, 'XX', 'VmaPhase'],\r\n      [0x0027, 0x101E, 'XX', 'VmaMod'],\r\n      [0x0027, 0x101F, 'XX', 'VmaClip'],\r\n      [0x0027, 0x1020, 'XX', 'SmartScanOnOffFlag'],\r\n      [0x0027, 0x1030, 'XX', 'ForeignImageRevision'],\r\n      [0x0027, 0x1031, 'XX', 'ImagingMode'],\r\n      [0x0027, 0x1032, 'XX', 'PulseSequence'],\r\n      [0x0027, 0x1033, 'XX', 'ImagingOptions'],\r\n      [0x0027, 0x1035, 'XX', 'PlaneType'],\r\n      [0x0027, 0x1036, 'XX', 'ObliquePlane'],\r\n      [0x0027, 0x1040, 'XX', 'RASLetterOfImageLocation'],\r\n      [0x0027, 0x1041, 'XX', 'ImageLocation'],\r\n      [0x0027, 0x1042, 'XX', 'CenterRCoordOfPlaneImage'],\r\n      [0x0027, 0x1043, 'XX', 'CenterACoordOfPlaneImage'],\r\n      [0x0027, 0x1044, 'XX', 'CenterSCoordOfPlaneImage'],\r\n      [0x0027, 0x1045, 'XX', 'NormalRCoord'],\r\n      [0x0027, 0x1046, 'XX', 'NormalACoord'],\r\n      [0x0027, 0x1047, 'XX', 'NormalSCoord'],\r\n      [0x0027, 0x1048, 'XX', 'RCoordOfTopRightCorner'],\r\n      [0x0027, 0x1049, 'XX', 'ACoordOfTopRightCorner'],\r\n      [0x0027, 0x104A, 'XX', 'SCoordOfTopRightCorner'],\r\n      [0x0027, 0x104B, 'XX', 'RCoordOfBottomRightCorner'],\r\n      [0x0027, 0x104C, 'XX', 'ACoordOfBottomRightCorner'],\r\n      [0x0027, 0x104D, 'XX', 'SCoordOfBottomRightCorner'],\r\n      [0x0027, 0x1050, 'XX', 'TableStartLocation'],\r\n      [0x0027, 0x1051, 'XX', 'TableEndLocation'],\r\n      [0x0027, 0x1060, 'FL', 'ImageDimensionX'],\r\n      [0x0027, 0x1061, 'FL', 'ImageDimensionY'],\r\n      [0x0027, 0x1062, 'FL', 'NumberOfExcitations'],\r\n\r\n      [0x0028, 0x0000, 'UL', 'ImagePresentationGroupLength'],\r\n      [0x0028, 0x0002, 'US', 'SamplesPerPixel'],\r\n      [0x0028, 0x0004, 'CS', 'PhotometricInterpretation'],\r\n      [0x0028, 0x0006, 'US', 'Planar​Configuration'],\r\n      [0x0028, 0x0008, 'XX', 'NumberOfFrames'],\r\n      [0x0028, 0x0010, 'US', 'Rows'],\r\n      [0x0028, 0x0011, 'US', 'Columns'],\r\n      [0x0028, 0x0030, 'DS', 'PixelSpacing'],\r\n      [0x0028, 0x0100, 'US', 'BitsAllocated'],\r\n      [0x0028, 0x0101, 'US', 'BitsStored'],\r\n      [0x0028, 0x0102, 'US', 'HighBit'],\r\n      [0x0028, 0x0103, 'US', 'PixelRepresentation'],\r\n      [0x0028, 0x0106, 'XX', 'SmallestImagePixelValue'],\r\n      [0x0028, 0x0107, 'XX', 'LargestImagePixelValue'],\r\n      [0x0028, 0x0120, 'US', 'PixelAddingValue'],\r\n      [0x0028, 0x0301, 'CS', 'BurnderInAnnotation'],\r\n      [0x0028, 0x0303, 'CS', 'Longitudinal​Temporal​Information​Modified'],\r\n      [0x0028, 0x1050, 'DS', 'WindowCenter'],\r\n      [0x0028, 0x1051, 'DS', 'WindowWidth'],\r\n      [0x0028, 0x1052, 'DS', 'RescaleIntercept'],\r\n      [0x0028, 0x1053, 'DS', 'RescaleSlope'],\r\n      [0x0028, 0x1054, 'LO', 'RescaleType'],\r\n      [0x0028, 0x1055, 'LO', 'Window​Center​Width​Explanation'],\r\n\r\n      [0x0029, 0x0010, 'LO', 'PrivateCreator'],\r\n      [0x0029, 0x1015, 'SL', 'LowerRangeOfPixels1h'],\r\n      [0x0029, 0x1016, 'SL', 'LowerRangeOfPixels1i'],\r\n      [0x0029, 0x1017, 'SL', 'LowerRangeOfPixels2'],\r\n      [0x0029, 0x1018, 'SL', 'UpperRangeOfPixels2'],\r\n      [0x0029, 0x1026, 'SS', 'VersionOfTheHdrStruct'],\r\n      [0x0029, 0x1031, 'LO', 'PrivateTag'],\r\n      [0x0029, 0x1032, 'UL', 'PrivateTag'],\r\n      [0x0029, 0x1033, 'UL', 'PrivateTag'],\r\n      [0x0029, 0x1034, 'SL', 'AdvantageCompOverflow'],\r\n      [0x0029, 0x1035, 'SL', 'AdvantageCompUnderflow'],\r\n\r\n      [0x0032, 0x0000, 'UL', 'StudyGroupLength'],\r\n      [0x0032, 0x000c, 'XX', 'StrudyPriorityId'],\r\n      [0x0032, 0x1020, 'XX', 'ScheduledStudyLocation'],\r\n      [0x0032, 0x1030, 'XX', 'ReasonForStudy'],\r\n      [0x0032, 0x1060, 'XX', 'RequestedProcedureDescription'],\r\n\r\n      [0x0038, 0x0010, 'XX', 'AdmissionId'],\r\n      [0x0038, 0x0050, 'XX', 'SpecialNeeds'],\r\n      [0x0038, 0x0500, 'XX', 'PatientState'],\r\n    \r\n      [0x0040, 0x0000, 'UL', 'TextGroupLength'],\r\n      [0x0040, 0x0242, 'XX', 'PerformedStationName'],\r\n      [0x0040, 0x0243, 'XX', 'PerformedLocation'],\r\n      [0x0040, 0x0244, 'XX', 'PerformedProcedureStepStartDate'],\r\n      [0x0040, 0x0245, 'XX', 'PerformedProcedureStepStartTime'],\r\n      [0x0040, 0x0253, 'XX', 'PerformedProcedureStepId'],\r\n      [0x0040, 0x0254, 'XX', 'PerformedProcedureStepDescription'],\r\n      [0x0040, 0x0255, 'LO', 'PerformedProcedureTypeDescription'],\r\n      [0x0040, 0x0280, 'XX', '\"CommentsOnPerformedProcedureStep'],\r\n      [0x0040, 0x0321, 'XX', 'FilmConsumptionSequence'],\r\n    \r\n      [0x0040, 0x1001, 'XX', 'RequestedProcedureId'],\r\n      [0x0040, 0x1002, 'XX', 'Unknown'],\r\n      [0x0040, 0x1003, 'XX', 'Unknown'],\r\n      [0x0040, 0x1004, 'XX', 'PatientTransportArrangments'],\r\n      [0x0040, 0x1005, 'XX', 'RequestedProcedureLocation'],\r\n      [0x0040, 0x1010, 'XX', 'NamesOfIntendentRecipientsOfResults'],\r\n      [0x0040, 0x1400, 'XX', 'RequestedProcedureComments'],\r\n\r\n      [0x0040, 0x2400, 'XX', 'ImagingServiceRequestComments'],\r\n      [0x0040, 0x3001, 'XX', 'Unknown'],\r\n    \r\n      [0x0043, 0x0010, 'LO', 'PrivateCreator'],\r\n      [0x0043, 0x1001, 'XX', 'BitmapOfPrescanOptions'],\r\n      [0x0043, 0x1002, 'XX', 'GradientOffsetInX'],\r\n      [0x0043, 0x1003, 'XX', 'GradientOffsetInY'],\r\n      [0x0043, 0x1004, 'XX', 'GradientOffsetInZ'],\r\n      [0x0043, 0x1005, 'XX', 'ImgIsOriginalOrUnoriginal'],\r\n      [0x0043, 0x1006, 'XX', 'NumberOfEPIShots'],\r\n      [0x0043, 0x1007, 'XX', 'ViewsPerSegment'],\r\n      [0x0043, 0x1008, 'XX', 'RespiratoryRateBpm'],\r\n      [0x0043, 0x1009, 'XX', 'RespiratoryTriggerPoint'],\r\n      [0x0043, 0x100A, 'XX', 'TypeOfReceiverUsed'],\r\n      [0x0043, 0x100B, 'XX', 'PeakRateOfChangeOfGradientField'],\r\n      [0x0043, 0x100C, 'XX', 'LimitsInUnitsOfPercent'],\r\n      [0x0043, 0x100D, 'XX', 'PSDEstimatedLimit'],\r\n      [0x0043, 0x100E, 'XX', 'PSDEstimatedLimitInTeslaPerSecond'],\r\n      [0x0043, 0x100F, 'XX', 'Saravghead'],\r\n      [0x0043, 0x1010, 'XX', 'WindowValue'],\r\n      [0x0043, 0x1011, 'XX', 'TotalInputViews'],\r\n      [0x0043, 0x1012, 'XX', 'XRayChain'],\r\n      [0x0043, 0x1013, 'XX', 'DeconKernelParameters'],\r\n      [0x0043, 0x1014, 'XX', 'CalibrationParameters'],\r\n      [0x0043, 0x1015, 'XX', 'TotalOutputViews'],\r\n      [0x0043, 0x1016, 'XX', 'NumberOfOverranges'],\r\n      [0x0043, 0x1017, 'XX', 'IBHImageScaleFactors'],\r\n      [0x0043, 0x1018, 'XX', 'BBHCoefficients'],\r\n      [0x0043, 0x1019, 'XX', 'NumberOfBBHChainsToBlend'],\r\n      [0x0043, 0x101A, 'XX', 'StartingChannelNumber'],\r\n      [0x0043, 0x101B, 'XX', 'PpscanParameters'],\r\n      [0x0043, 0x101C, 'XX', 'GEImageIntegrity'],\r\n      [0x0043, 0x101D, 'XX', 'LevelValue'],\r\n      [0x0043, 0x101E, 'XX', 'DeltaStartTime'],\r\n      [0x0043, 0x101F, 'XX', 'MaxOverrangesInAView'],\r\n      [0x0043, 0x1020, 'XX', 'AvgOverrangesAllViews'],\r\n      [0x0043, 0x1021, 'XX', 'CorrectedAfterGlowTerms'],\r\n      [0x0043, 0x1025, 'XX', 'ReferenceChannels'],\r\n      [0x0043, 0x1026, 'XX', 'NoViewsRefChansBlocked'],\r\n      [0x0043, 0x1027, 'XX', 'ScanPitchRatio'],\r\n      [0x0043, 0x1028, 'XX', 'UniqueImageIden'],\r\n      [0x0043, 0x1029, 'XX', 'HistogramTables'],\r\n      [0x0043, 0x102A, 'XX', 'UserDefinedData'],\r\n      [0x0043, 0x102B, 'XX', 'PrivateScanOptions'],\r\n      [0x0043, 0x102C, 'XX', 'EffectiveEchoSpacing'],\r\n      [0x0043, 0x102D, 'XX', 'StringSlopField1'],\r\n      [0x0043, 0x102E, 'XX', 'StringSlopField2'],\r\n      [0x0043, 0x102F, 'XX', 'RawDataType'],\r\n      [0x0043, 0x1030, 'XX', 'RawDataType'],\r\n      [0x0043, 0x1031, 'XX', 'RACordOfTargetReconCenter'],\r\n      [0x0043, 0x1032, 'XX', 'RawDataType'],\r\n      [0x0043, 0x1033, 'XX', 'NegScanspacing'],\r\n      [0x0043, 0x1034, 'XX', 'OffsetFrequency'],\r\n      [0x0043, 0x1035, 'XX', 'UserUsageTag'],\r\n      [0x0043, 0x1036, 'XX', 'UserFillMapMSW'],\r\n      [0x0043, 0x1037, 'XX', 'UserFillMapLSW'],\r\n      [0x0043, 0x1038, 'XX', 'User25_48'],\r\n      [0x0043, 0x1039, 'XX', 'SlopInt6_9'],\r\n      [0x0043, 0x1040, 'XX', 'TriggerOnPosition'],\r\n      [0x0043, 0x1041, 'XX', 'DegreeOfRotation'],\r\n      [0x0043, 0x1042, 'XX', 'DASTriggerSource'],\r\n      [0x0043, 0x1043, 'XX', 'DASFpaGain'],\r\n      [0x0043, 0x1044, 'XX', 'DASOutputSource'],\r\n      [0x0043, 0x1045, 'XX', 'DASAdInput'],\r\n      [0x0043, 0x1046, 'XX', 'DASCalMode'],\r\n      [0x0043, 0x1047, 'XX', 'DASCalFrequency'],\r\n      [0x0043, 0x1048, 'XX', 'DASRegXm'],\r\n      [0x0043, 0x1049, 'XX', 'DASAutoZero'],\r\n      [0x0043, 0x104A, 'XX', 'StartingChannelOfView'],\r\n      [0x0043, 0x104B, 'XX', 'DASXmPattern'],\r\n      [0x0043, 0x104C, 'XX', 'TGGCTriggerMode'],\r\n      [0x0043, 0x104D, 'XX', 'StartScanToXrayOnDelay'],\r\n      [0x0043, 0x104E, 'XX', 'DurationOfXrayOn'],\r\n      [0x0043, 0x1060, 'XX', 'SlopInt10_17'],\r\n      [0x0043, 0x1061, 'XX', 'ScannerStudyEntityUID'],\r\n      [0x0043, 0x1062, 'XX', 'ScannerStudyID'],\r\n      [0x0043, 0x106F, 'XX', 'ScannerTableEntry'],\r\n      [0x0043, 0x107D, 'US', 'ReconModeFlagWord '],\r\n      [0x0043, 0x1080, 'LO', 'CoilIDData'],\r\n      [0x0043, 0x1081, 'LO', 'GECoilName'],\r\n      [0x0043, 0x1082, 'LO', 'SystemConfigurationInformation'],\r\n      [0x0043, 0x1083, 'DS', 'AssetRFactors'],\r\n      [0x0043, 0x1084, 'LO', 'AdditionalAssetData'],\r\n      [0x0043, 0x1089, 'LO', 'GoverningBodyAndSARDefinition'],\r\n      [0x0043, 0x108A, 'CS', 'PrivateInPlanePhaseEncodingDirection'],\r\n      [0x0043, 0x1090, 'LO', 'SARDefinition'],\r\n      [0x0043, 0x1091, 'DS', 'SARValue'],\r\n      [0x0043, 0x1095, 'LO', 'PrescanReuseString'],\r\n      [0x0043, 0x1096, 'CS', 'ContentQualification'],\r\n      [0x0043, 0x1097, 'LO', 'ImageFilteringParameters'],\r\n      [0x0043, 0x109A, 'IS', 'RxStackIdentification'],\r\n      [0x0043, 0x10AA, 'LO', 'AdditionalFilteringParameters'],\r\n      [0x0043, 0x10B1, 'SS', 'ExcitationMode'],\r\n\r\n      [0x0045, 0x0010, 'LO', 'PrivateCreator'],\r\n      [0x0045, 0x1001, 'XX', 'NumberOfMacroRowsInDetector'],\r\n      [0x0045, 0x1002, 'XX', 'MacroWidthAtISOCenter'],\r\n      [0x0045, 0x1003, 'XX', 'DASType'],\r\n      [0x0045, 0x1004, 'XX', 'DASGain'],\r\n      [0x0045, 0x1006, 'XX', 'TableDirectionInOrOut'],\r\n      [0x0045, 0x1007, 'XX', 'ZSmoothingFactor'],\r\n      [0x0045, 0x1008, 'XX', 'ViewWeightingMode'],\r\n      [0x0045, 0x1009, 'XX', 'SigmaRowNumberWhichRowsWereUsed'],\r\n      [0x0045, 0x100A, 'XX', 'MinimumDasValueFoundInTheScanData'],\r\n      [0x0045, 0x100B, 'XX', 'MaximumOffsetShiftValueUsed'],\r\n      [0x0045, 0x100C, 'XX', 'NumberOfViewsShifted'],\r\n      [0x0045, 0x100D, 'XX', 'ZTrackingFlag'],\r\n      [0x0045, 0x100E, 'XX', 'MeanZError'],\r\n      [0x0045, 0x100F, 'XX', 'ZTrackingMaximumError'],\r\n      [0x0045, 0x1010, 'XX', 'StartingViewForRow2a'],\r\n      [0x0045, 0x1011, 'XX', 'NumberOfViewsInRow2a'],\r\n      [0x0045, 0x1012, 'XX', 'StartingViewForRow1a'],\r\n      [0x0045, 0x1013, 'XX', 'SigmaMode'],\r\n      [0x0045, 0x1014, 'XX', 'NumberOfViewsInRow1a'],\r\n      [0x0045, 0x1015, 'XX', 'StartingViewForRow2b'],\r\n      [0x0045, 0x1016, 'XX', 'NumberOfViewsInRow2b'],\r\n      [0x0045, 0x1017, 'XX', 'StartingViewForRow1b'],\r\n      [0x0045, 0x1018, 'XX', 'NumberOfViewsInRow1b'],\r\n      [0x0045, 0x1021, 'XX', 'PrivateTag'],\r\n      [0x0045, 0x1022, 'XX', 'PrivateTag'],\r\n      [0x0045, 0x1032, 'XX', 'PrivateTag'],\r\n\r\n\r\n      [0x0053, 0x0010, 'LO', 'PrivateCreator'],\r\n      [0x0053, 0x1020, 'XX', 'PrivateTag'],\r\n      [0x0053, 0x1040, 'XX', 'PrivateTag'],\r\n      [0x0053, 0x1041, 'XX', 'PrivateTag'],\r\n      [0x0053, 0x1042, 'XX', 'PrivateTag'],\r\n      [0x0053, 0x1043, 'XX', 'PrivateTag'],\r\n      [0x0053, 0x1062, 'XX', 'PrivateTag'],\r\n\r\n      [0x0088, 0x0140, 'XX', 'StorageMediaFileSetUid'],\r\n      [0x0088, 0x0200, 'XX', 'IconImageSequence'],\r\n\r\n      [0x2001, 0x1003, 'XX', 'Unknown'],\r\n      [0x2001, 0x100a, 'XX', 'Unknown'],\r\n      [0x2001, 0x106e, 'XX', 'Unknown'],\r\n      [0x2005, 0x0012, 'XX', 'Unknown'],\r\n      [0x2005, 0x0013, 'XX', 'Unknown'],\r\n      [0x2005, 0x0014, 'XX', 'Unknown'],\r\n      [0x2005, 0x1213, 'XX', 'Unknown'],\r\n      [0x2005, 0x1406, 'XX', 'Unknown'],\r\n\r\n      [0x5533, 0x1203, 'XX', '\"Unknown'],\r\n      [0x5533, 0x5511, 'XX', '\"Unknown'],\r\n\r\n      [0x7fe0, 0x0000, 'IM', 'PixelDataGroupLength'],\r\n      [0x7fe0, 0x0010, 'IM', 'PixelData'],\r\n      /* eslint-enable */\r\n    ];\r\n  } // constructor\r\n  /**\r\n  * Get vr string code from group + element codes\r\n  * @param {number} group - group of the tag\r\n  * @param {number} element - element of the tag\r\n  * return {string} vr\r\n  */\r\n  getVr(group, element) {\r\n    let vr = '';\r\n    const numTags = this.TAGS.length;\r\n    for (let i = 0; i < numTags; i++) {\r\n      if ((this.TAGS[i][0] === group) && (this.TAGS[i][1] === element)) {\r\n        vr = this.TAGS[i][2];\r\n      }\r\n    } // for (i) all\r\n    if (element === 0) {\r\n      vr = 'UL';\r\n    }\r\n    return vr;\r\n  } // get VR\r\n  /**\r\n  * Get descripotion string  from group + element codes\r\n  * @param {number} group - group of the tag\r\n  * @param {number} element - element of the tag\r\n  * return {string} description\r\n  */\r\n  getTextDesc(group, element) {\r\n    let tagDesc = '?';\r\n    const numTags = this.TAGS.length;\r\n    for (let i = 0; i < numTags; i++) {\r\n      if ((this.TAGS[i][0] === group) && (this.TAGS[i][1] === element)) {\r\n        tagDesc = this.TAGS[i][3];\r\n      }\r\n    } // for (i) all\r\n    return tagDesc;\r\n  } // get tag text description\r\n}\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Dicom info\r\n* @module lib/scripts/loaders/dicominfo\r\n*/\r\n\r\n/**\r\n* Class @class DicomInfo for volume some important text data render\r\n*/\r\nclass DicomInfo {\r\n  constructor() {\r\n    this.m_patientName = '';\r\n    this.m_patientDateOfBirth = '';\r\n    this.m_studyDescr = '';\r\n    this.m_studyDate = '';\r\n    this.m_seriesTime = '';\r\n    this.m_seriesDescr = '';\r\n    this.m_bodyPartExamined = '';\r\n    this.m_institutionName = '';\r\n    this.m_operatorsName = '';\r\n    this.m_physicansName = '';\r\n\r\n    this.m_patientId = '';\r\n    this.m_patientGender = '';\r\n    this.m_acquisionTime = '';\r\n    this.m_manufacturerName = '';\r\n    // tags info for each slice. Each entry is DicomSliceInfo\r\n    this.m_sliceInfo = [];\r\n  }\r\n}\r\n\r\nexport default DicomInfo;\r\n","\r\n\r\n// *****************************************************************\r\n// Const \r\n// *****************************************************************\r\n\r\nconst TAG_TRANSFER_SYNTAX = [0x0002, 0x0010];\r\nconst TAG_META_LENGTH = [0x0002, 0x0000];\r\nconst TAG_PIXEL_DATA = [0x7FE0, 0x0010];\r\n\r\n/**\r\n* class DicomTag is used for parse tags inside dicom file structure\r\n*/\r\nclass DicomTag {\r\n  /**\r\n   * @param {number} group - group in pair group:element\r\n   * @param {number} element - element in pair group:element\r\n   * @param {string} vr - special string for tag\r\n   * @param {object} value - tag value: data array\r\n   * @param {number} offsetStart - start of tag\r\n   * @param {number} offsetValue - offset value\r\n   * @param {number} offsetEnd - offset in stream\r\n   * @param {number} littleEndian - is in little endian mode numbers encoding\r\n   */\r\n  constructor(group,\r\n    element,\r\n    vr,\r\n    value,\r\n    offsetStart,\r\n    offsetValue,\r\n    offsetEnd,\r\n    littleEndian) {\r\n    /** @property {number} m_group - group for group:element pair */\r\n    this.m_group = group;\r\n    /** @property {number} m_element - element for group:element pair */\r\n    this.m_element = element;\r\n    /** @property {string} m_vr - special VR text for tag */\r\n    this.m_vr = vr;\r\n    /** @property {object} m_value - array with content */\r\n    this.m_value = value;\r\n    /** @property {number} m_offsetStart - start of tag */\r\n    this.m_offsetStart = offsetStart;\r\n    /** @property {number} m_offsetValue - value of tag */\r\n    this.m_offsetValue = offsetValue;\r\n    /** @property {number} m_offsetEnd - end of tag */\r\n    this.m_offsetEnd = offsetEnd;\r\n    /** @property {number} m_littleEndian - is in big/little endian */\r\n    this.m_littleEndian = littleEndian;\r\n  }\r\n  /**\r\n  * get value\r\n  * @return {object} data content of this tag\r\n  */\r\n  value() {\r\n    return this.m_value;\r\n  }\r\n  /**\r\n  * check has transform syntax or not\r\n  * @return {boolean} is transform\r\n  */\r\n  isTransformSyntax() {\r\n    if ((this.m_group === TAG_TRANSFER_SYNTAX[0]) && (this.m_element === TAG_TRANSFER_SYNTAX[1])) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n  /**\r\n  * check is this tag meta\r\n  * @return {boolean} true, if this tag is meta tag\r\n  */\r\n  isMetaLength() {\r\n    if ((this.m_group === TAG_META_LENGTH[0]) && (this.m_element === TAG_META_LENGTH[1])) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n  /**\r\n  * check has image bits in this tag data\r\n  * @return {boolean} true, if image bits is inside tag data\r\n  */\r\n  isPixelData() {\r\n    if ((this.m_group === TAG_PIXEL_DATA[0]) && (this.m_element === TAG_PIXEL_DATA[1])) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n}\r\nexport default DicomTag;","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n/**\r\n* Get string hash\r\n* @module components/visualization/engine/utils/hash\r\n*/\r\n// absolute imports\r\n/**\r\n* Class Hash to calc string hash\r\n* @class Hash\r\n*/\r\nclass Hash {\r\n\r\n  static getHash(strInp) {\r\n    const ROT = 27;\r\n    const len = strInp.length;\r\n    let hash = len * 53;\r\n    for (let i = 0; i < len; i++) {\r\n      const val = strInp.charCodeAt(i);\r\n      hash = hash * (val ^ 137211941);\r\n      // bit rotate\r\n      hash = (hash << ROT) | (hash >> (32 - ROT));\r\n      // mask\r\n      hash &= 0x3fffffff;\r\n    }\r\n    return hash;\r\n  }\r\n}\r\n\r\nexport default Hash;\r\n","\r\n// ********************************************************\r\n// Imports\r\n// ********************************************************\r\n\r\nimport Hash from '../utils/Hash';\r\n\r\n\r\n// ********************************************************\r\n// Class\r\n// ********************************************************\r\n\r\n/**\r\n* Class DicomSlice Single slice with info, used to detect series\r\n*/\r\n\r\nclass DicomSlice {\r\n  constructor() {\r\n    this.m_image = null;\r\n    this.m_sliceNumber = 0;\r\n    this.m_sliceLocation = 0.0;\r\n    // 10, 10\r\n    this.m_patientName = '';\r\n    // 8, 1030\r\n    this.m_studyDescr = '';\r\n    // 8, 20\r\n    this.m_studyDate = '';\r\n    // 8, 31\r\n    this.m_seriesTime = '';\r\n    // 8, 103E\r\n    this.m_seriesDescr = '';\r\n    // 18, 15\r\n    this.m_bodyPartExamined = '';\r\n    //\r\n    this.m_hash = 0;\r\n    this.m_xDim = 0;\r\n    this.m_yDim = 0;\r\n  }\r\n  buildHash() {\r\n    const strMix = this.m_patientName + this.m_studyDescr +\r\n    this.m_studyDate + this.m_seriesTime + \r\n    this.m_seriesDescr + this.m_bodyPartExamined;\r\n    this.m_hash = Hash.getHash(strMix);\r\n  } // end build hash\r\n} // end class DicomSlice\r\n\r\nexport default DicomSlice;\r\n","//\r\n//\r\n//\r\n\r\nimport DicomSlice from \"./dicomslice\";\r\n\r\nconst FLOAT_TOO_LARGE_VALUE = 555555555555.5;\r\n\r\n\r\nclass DicomSerie {\r\n  constructor(hash) {\r\n    console.assert(hash !== undefined);\r\n    console.assert(typeof hash === \"number\", \"hash shold be number\");\r\n\r\n    this.m_hash = hash;\r\n    this.m_slices = [];\r\n    this.m_minSlice = +FLOAT_TOO_LARGE_VALUE;\r\n    this.m_maxSlice = -FLOAT_TOO_LARGE_VALUE;\r\n  }\r\n  addSlice(slice) {\r\n    console.assert(slice !== undefined);\r\n    console.assert(slice instanceof DicomSlice, \"added slice should be DicomSlice object\");\r\n    this.m_slices.push(slice);\r\n    this.m_minSlice = (slice.m_sliceNumber < this.m_minSlice) ? slice.m_sliceNumber : this.m_minSlice;\r\n    this.m_maxSlice = (slice.m_sliceNumber > this.m_maxSlice) ? slice.m_sliceNumber : this.m_maxSlice;\r\n  }\r\n\r\n} // end DicomSerie\r\n\r\nexport default DicomSerie;","// ********************************************************\r\n// Imports\r\n// ********************************************************\r\n\r\nimport DicomSlice from './dicomslice';\r\nimport DicomSerie from './dicomserie';\r\n\r\n// ********************************************************\r\n// Const\r\n// ********************************************************\r\n\r\n// ********************************************************\r\n// Class\r\n// ********************************************************\r\n\r\n/**\r\n* Class DicomSlicesVolume Collected volume (from slices)\r\n*/\r\nclass DicomSlicesVolume {\r\n  constructor() {\r\n    //\r\n    // series[i]:\r\n    //  m_minSlice\r\n    //  m_maxSlice\r\n    //  m_slices[]\r\n    //\r\n    this.m_series = [];\r\n  }\r\n  destroy() {\r\n    this.m_series = [];\r\n  }\r\n  getSeries() {\r\n    return this.m_series;\r\n  }\r\n  //\r\n  // slice: DicomSlice\r\n  addSlice(slice) {\r\n    console.assert(slice !== undefined);\r\n    console.assert(slice instanceof DicomSlice, \"should be DicomSlice object\");\r\n    console.assert(slice.m_hash !== undefined);\r\n    console.assert(slice.m_hash !== 0);\r\n    let indSerie = this.getSerieIndex(slice);\r\n    if (indSerie < 0) {\r\n      // create new serie\r\n      const serieNew = new DicomSerie(slice.m_hash);\r\n      this.m_series.push(serieNew);\r\n      indSerie = this.m_series.length - 1;\r\n    }\r\n    // add slice to serie\r\n    const ser = this.m_series[indSerie];\r\n    ser.addSlice(slice);\r\n  } // end add slice\r\n  getSerieIndex(slice) {\r\n    const numSeries = this.m_series.length;\r\n    for (let i = 0; i < numSeries; i++) {\r\n      const serie = this.m_series[i];\r\n      if (serie.m_hash === slice.m_hash) {\r\n        return i;\r\n      }\r\n    } // end for\r\n    return -1;\r\n  } // end get serie index\r\n\r\n} // end class DicomSlicesVolume\r\n\r\nexport default DicomSlicesVolume;\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Dicom slice info\r\n* @module lib/scripts/loaders/dicomsliceinfo\r\n*/\r\n\r\n/**\r\n* Class @class DicomSliceInfo slice information\r\n*/\r\nclass DicomSliceInfo {\r\n  constructor() {\r\n    this.m_sliceName = '';\r\n    this.m_fileName = '';\r\n    // tags info for each slice. Each entry is DicomTagInfo\r\n    this.m_tags = [];\r\n  }\r\n}\r\n\r\nexport default DicomSliceInfo;\r\n","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n\"License\"); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n\"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n* Dicom tag info\r\n* @module lib/scripts/loaders/dicomtaginfo\r\n*/\r\n\r\n/**\r\n* Class @class DicomTagInfo tag descr\r\n*/\r\nclass DicomTagInfo {\r\n  constructor() {\r\n    this.m_tag = '';\r\n    this.m_attrName = '';\r\n    this.m_attrValue = '';\r\n  }\r\n}\r\n\r\nexport default DicomTagInfo;\r\n","\r\n// **********************************************\r\n// Imports\r\n// **********************************************\r\n\r\n// **********************************************\r\n// Class\r\n// **********************************************\r\n\r\nclass FileTools {\r\n  isValidUrl(strUrl) {\r\n    const regA = /^((ftp|http|https):\\/\\/)?(([\\S]+)\\.)?([\\S]+)\\.([A-z]{2,})(:\\d{1,6})?\\/[\\S]+/;\r\n    const regB = /(ftp|http|https):\\/\\/([\\d]+)\\.([\\d]+)\\.([\\d]+)\\.([\\d]+)(:([\\d]+))?\\/([\\S]+)/;\r\n    const isValidA = strUrl.match(regA);\r\n    const isValidB = strUrl.match(regB);\r\n    if ((isValidA === null) && (isValidB === null)) {\r\n      return false;\r\n    }\r\n    return true;\r\n  } // end isValidUrl\r\n  getFileNameFromUrl(strUrl) {\r\n    let idx = strUrl.lastIndexOf('/');\r\n    if (idx < 0) {\r\n      idx = strUrl.lastIndexOf('\\\\');\r\n    }\r\n    if (idx < 0) {\r\n      console.log('getFileNameFromUrl: wrong URL!');\r\n      return '';\r\n    }\r\n    let strFileName = strUrl.substring(idx + 1);\r\n    const MAX_LEN = 40;\r\n    strFileName = (strFileName.length <= MAX_LEN) ? strFileName : strFileName.substring(0, MAX_LEN);\r\n    return strFileName;\r\n  }\r\n  getFolderNameFromUrl(strUrl) {\r\n    let idx = strUrl.lastIndexOf('/');\r\n    if (idx < 0) {\r\n      idx = strUrl.lastIndexOf('\\\\');\r\n    }\r\n    if (idx < 0) {\r\n      console.log('getFolderNameFromUrl: wrong URL!');\r\n      return '';\r\n    }\r\n    const strFolder = strUrl.substring(0, idx);\r\n    return strFolder;\r\n  }\r\n  isUrlExists(strUrl) {\r\n    let request = null;\r\n    if (window.XMLHttpRequest) {\r\n      request = new XMLHttpRequest();\r\n    } else {\r\n      // request = new ActiveXObject(\"Microsoft.XMLHTTP\");\r\n    }\r\n    // request.open('HEAD', strUrl, false);\r\n    const NEED_ASYNC = true;\r\n    request.open('GET', strUrl, NEED_ASYNC);\r\n    request.send();\r\n    const RES_FAIL_404 = 404;\r\n    const isValid = (request.status !== RES_FAIL_404);\r\n    return isValid;\r\n  } // isUrlkExist\r\n  encodeUrl(strIn) {\r\n    let strOut = '';\r\n    let dotFound = false;\r\n    const len = strIn.length;\r\n    for (let i = 0; i < len; i++) {\r\n      const sym = strIn[i];\r\n      const isDelim = (sym === '/') || (sym === '.') || (sym === '-')  || (sym === '_');\r\n      if (dotFound && (!isDelim)) {\r\n        const c = strIn.charCodeAt(i);\r\n        const symModi = String.fromCharCode(c + 1);\r\n        strOut += symModi;\r\n      } else {\r\n        strOut += sym;\r\n      }\r\n      dotFound = (sym === '.') ? true : dotFound;\r\n    } // for (i)\r\n    return strOut;\r\n  } // encodeUrl\r\n  decodeUrl(strIn) {\r\n    let strOut = '';\r\n    let dotFound = false;\r\n    const len = strIn.length;\r\n    for (let i = 0; i < len; i++) {\r\n      const sym = strIn[i];\r\n      const isDelim = (sym === '/') || (sym === '.') || (sym === '-')  || (sym === '_');\r\n      if (dotFound && (!isDelim)) {\r\n        const c = strIn.charCodeAt(i);\r\n        const symModi = String.fromCharCode(c - 1);\r\n        strOut += symModi;\r\n      } else {\r\n        strOut += sym;\r\n      }\r\n      dotFound = (sym === '.') ? true : dotFound;\r\n    } // for (i)\r\n    console.log(`${strOut}`);\r\n    return strOut;\r\n  } // encodeUrl\r\n\r\n} // class FileTools\r\nexport default FileTools;  \r\n","/**\r\n * @fileOverview LoaderDicom\r\n * @author Epam\r\n * @version 1.0.0\r\n */\r\n\r\n\r\n// ********************************************************\r\n// Imports\r\n// ********************************************************\r\n\r\n// import gdcm from 'gdcm-js';\r\n\r\n// import jpeg from 'jpeg-lossless-decoder-js';\r\n\r\nimport LoadResult from '../LoadResult';\r\n\r\nimport DicomDictionary from './dicomdict';\r\nimport DicomInfo from './dicominfo';\r\nimport DicomTag from './dicomtag';\r\nimport DicomSlice from './dicomslice';\r\nimport DicomSlicesVolume from './dicomslicesvolume';\r\nimport DicomSliceInfo from './dicomsliceinfo';\r\nimport DicomTagInfo from './dicomtaginfo';\r\nimport FileTools from './FileTools';\r\nimport FileLoader from './FileLoader';\r\n\r\n// import Volume from '../Volume';\r\nimport VolumeSet from '../VolumeSet';\r\nimport Volume from '../Volume';\r\n\r\n// ********************************************************\r\n// Const\r\n// ********************************************************\r\n\r\nconst DEBUG_PRINT_TAGS_INFO = false;\r\nconst DEBUG_PRINT_INDI_SLICE_INFO = false;\r\nconst NEED_SCAN_EMPTY_BORDER = false;\r\nconst NEED_APPLY_GAUSS_SMOOTHING = false;\r\n\r\n/** deep artificially fix volume texture size to even numbers */\r\nconst NEED_EVEN_TEXTURE_SIZE = false;\r\n\r\n/* eslint-disable */\r\nconst MAGIC_DICM = [68, 73, 67, 77];\r\n\r\nconst DICOM_ERROR_OK = 0;\r\nconst DICOM_ERROR_WRONG_HEADER = -1;\r\nconst DICOM_ERROR_TOO_SMALL_FILE = -2;\r\n\r\nconst UNDEFINED_LENGTH = 0xFFFFFFFF;\r\n\r\nconst LARGE_NUMBER = 0x3FFFFFFF;\r\n\r\nconst TAG_IMAGE_INSTANCE_NUMBER = [0x0020, 0x0013];\r\nconst TAG_PIXEL_DATA = [0x7FE0, 0x0010];\r\n\r\nconst TAG_BITS_ALLOCATED = [0x0028, 0x0100];\r\nconst TAG_IMAGE_ROWS = [0x0028, 0x0010];\r\nconst TAG_IMAGE_COLS = [0x0028, 0x0011];\r\nconst TAG_IMAGE_HIGH_BIT = [0x0028, 0x0102];\r\nconst TAG_IMAGE_SMALL_PIX_VAL = [0x0028, 0x0106];\r\nconst TAG_IMAGE_LARGE_PIX_VAL = [0x0028, 0x0107];\r\nconst TAG_PIXEL_PADDING_VALUE = [0x0028, 0x0120];\r\nconst TAG_PIXEL_SPACING = [0x0028, 0x0030];\r\nconst TAG_WINDOW_CENTER = [0x0028, 0x1050];\r\nconst TAG_WINDOW_WIDTH = [0x0028, 0x1051];\r\nconst TAG_RESCALE_INTERCEPT = [0x0028, 0x1052];\r\nconst TAG_RESCALE_SLOPE = [0x0028, 0x1053];\r\nconst TAG_RESCALE_TYPE = [0x0028, 0x1054];\r\nconst TAG_PIXEL_REPRESENTATION = [0x0028, 0x0103];\r\n\r\nconst TAG_IMAGE_POSITION = [0x0020, 0x0032];\r\nconst TAG_SLICE_LOCATION = [0x0020, 0x1041];\r\nconst TAG_SAMPLES_PER_PIXEL = [0x0028, 0x0002];\r\nconst TAG_SERIES_DESCRIPTION = [0x0008, 0x103E];\r\nconst TAG_SERIES_TIME = [0x0008, 0x31];\r\nconst TAG_END_OF_ITEMS = [0xFFFE, 0xE00D];\r\nconst TAG_END_OF_SEQUENCE = [0xFFFE, 0xE0DD];\r\nconst TAG_SERIES_NUMBER = [0x0020, 0x0011];\r\nconst TAG_SLICE_THICKNESS = [0x0018, 0x0050];\r\nconst TAG_BODY_PART_EXAMINED = [0x0018, 0x0015];\r\n\r\nconst TRANSFER_SYNTAX_IMPLICIT_LITTLE = '1.2.840.10008.1.2';\r\nconst TRANSFER_SYNTAX_EXPLICIT_LITTLE = '1.2.840.10008.1.2.1';\r\nconst TRANSFER_SYNTAX_EXPLICIT_BIG = '1.2.840.10008.1.2.2';\r\nconst TRANSFER_SYNTAX_COMPRESSION_JPEG = '1.2.840.10008.1.2.4';\r\nconst TRANSFER_SYNTAX_COMPRESSION_JPEG_LOSSLESS = '1.2.840.10008.1.2.4.57';\r\nconst TRANSFER_SYNTAX_COMPRESSION_JPEG_LOSSLESS_SEL1 = '1.2.840.10008.1.2.4.70';\r\nconst TRANSFER_SYNTAX_COMPRESSION_JPEG_BASELINE_8BIT = '1.2.840.10008.1.2.4.50';\r\nconst TRANSFER_SYNTAX_COMPRESSION_JPEG_BASELINE_12BIT = '\"1.2.840.10008.1.2.4.51';\r\nconst TRANSFER_SYNTAX_COMPRESSION_JPEG_2000_LOSSLESS = '1.2.840.10008.1.2.4.90';\r\nconst TRANSFER_SYNTAX_COMPRESSION_JPEG_2000 = '1.2.840.10008.1.2.4.91';\r\nconst TRANSFER_SYNTAX_COMPRESSION_RLE = '1.2.840.10008.1.2.5';\r\nconst TRANSFER_SYNTAX_COMPRESSION_DEFLATE = '1.2.840.10008.1.2.1.99';\r\n\r\n// Information from dicom tags, displayed in 2d screen\r\nconst TAG_PATIENT_NAME = [0x0010, 0x0010];\r\nconst TAG_PATIENT_ID = [0x0010, 0x0020];\r\nconst TAG_PATIENT_BIRTH_DATE = [0x0010, 0x0030];\r\nconst TAG_PATIENT_GENDER = [0x0010, 0x0040];\r\nconst TAG_STUDY_DATE = [0x0008, 0x0020];\r\nconst TAG_STUDY_DESCR = [0x0008, 0x1030];\r\nconst TAG_ACQUISION_TIME = [0x0008, 0x0032];\r\nconst TAG_INSTITUTION_NAME = [0x0008, 0x0080];\r\nconst TAG_PHYSICANS_NAME = [0x0008, 0x0090];\r\nconst TAG_MANUFACTURER_NAME = [0x0008, 0x0070];\r\nconst TAG_OPERATORS_NAME = [0x0008, 0x1070];\r\n\r\n// const NEED_EVEN_TEXTURE_SIZE = false;\r\n\r\n// ********************************************************\r\n// Class\r\n// ********************************************************\r\n\r\n/**\r\n * Class LoaderDicom some text later...\r\n */\r\nclass LoaderDicom{\r\n  /**\r\n   * @param {object} props - props from up level object\r\n   */\r\n  constructor(numFiles, needScaleDownTexture = false) {\r\n    this.m_xDim = -1;\r\n    this.m_yDim = -1;\r\n    this.m_zDim = numFiles;\r\n    this.m_needScaleDownTexture = needScaleDownTexture;\r\n    /** @property {object} m_fileLoader - low level file loader */\r\n    this.m_folder = null;\r\n    /** @property {boolean} m_isLoadedSuccessfull - Loaded flag: success o not */\r\n    this.m_isLoadedSuccessfull = false;\r\n    /** @property {number} m_dataSize - Volume data size in bytes */\r\n    this.m_dataSize = 0;\r\n    /** @property {array} m_dataArray - byte array for volume data */\r\n    this.m_dataArray = null;\r\n    /** dictionary */\r\n    this.m_dictionary = new DicomDictionary();\r\n    /** index of the image in slices set */\r\n    this.m_imageNumber = -1;\r\n    /** @property {array} m_errors - array  with error after file read, used internally */\r\n    this.m_errors = [];\r\n    /**  @property {string} m_transformSyntax - string with pixel data transform syntax */\r\n    this.m_transformSyntax = \"\";\r\n    /** @property {array} m_loaders - array with objects for individual file loading */\r\n    this.m_loaders = [];\r\n    /** @property {number} m_xDim - volume dimension on x (width) */\r\n    this.m_xDim = -1;\r\n    /** @property {number} m_yDim - volume dimension on y (height) */\r\n    this.m_yDim = -1;\r\n    /** @property {number} m_bitsPerPixel - bits per pixe;. Can be 8, 16, 32 */\r\n    this.m_bitsPerPixel = -1;\r\n    /** @property {number} m_padValue - background pixel value, not used in histogram */\r\n    this.m_padValue = -LARGE_NUMBER;\r\n    this.m_windowCenter = LARGE_NUMBER; // TAG_WINDOW_CENTER\r\n    this.m_windowWidth = LARGE_NUMBER; // TAG_WINDOW_WIDTH\r\n    this.m_rescaleIntercept = 0; // TAG_RESCALE_INTERCEPT, used as v` = v * rescaleSlope + rescaleIntercept\r\n    this.m_rescaleSlope = 1; // TAG_RESCALE_SLOPE\r\n    this.m_rescaleHounsfield = false;\r\n    this.m_pixelRepresentaionSigned = false;\r\n\r\n    /** @property {number} m_littleEndian - little ednian encoding of pixel data */\r\n    this.m_littleEndian = true;\r\n    /** @property {number} m_samplesPerPixel - number of samples per pixel. Can be 1 or 3. Used as average */\r\n    this.m_samplesPerPixel = 1;\r\n    /** @property {number} m_seriesNumber - Index of series to check the same image set in slices */\r\n    this.m_seriesNumber = -1;\r\n    /** @property {string} m_seriesDescr - Description of series */\r\n    this.m_seriesDescr = '';\r\n    /** @property {object} m_boxSize - vertex3f with physic volume dimension */\r\n    this.m_boxSize = {\r\n      x: 1.0,\r\n      y: 1.0,\r\n      z: 1.0,\r\n    };\r\n    /** @property {object} m_boxSize - vertex3f with physic volume dimension */\r\n    this.m_nonEmptyBoxMin = {\r\n      x: 0.0,\r\n      y: 0.0,\r\n      z: 0.0,\r\n    };\r\n    /** @property {object} m_boxSize - vertex3f with physic volume dimension */\r\n    this.m_nonEmptyBoxMax = {\r\n      x: 1.0,\r\n      y: 1.0,\r\n      z: 1.0,\r\n    };\r\n\r\n    /** @property {object} m_slicesVolume - Volume, where slices are collected */\r\n    this.m_slicesVolume = new DicomSlicesVolume();\r\n    /** @property {object} m_newTagEvent - custom event, that is send on new tag reading */\r\n    this.m_newTagEvent = new CustomEvent('newTag', {\r\n      detail: {\r\n        group: null,\r\n        element: null,\r\n        desc: null,\r\n        value: null,\r\n        imageNumber: null,\r\n        fileName: null,\r\n      },\r\n    });\r\n    /** @property {Object} m_info - Patient name, patient gender, ... */\r\n    this.m_dicomInfo = new DicomInfo();\r\n\r\n    // physical dimension\r\n    this.m_pixelSpacing = {\r\n      x: 0.0,\r\n      y: 0.0,\r\n      z: 0.0\r\n    };\r\n    this.m_filesLoadedCounter = 0;\r\n    this.m_numLoadedFiles = numFiles;\r\n\r\n    this.m_imagePosMin = {\r\n      // eslint-disable-next-line\r\n      x: +1.0e12,\r\n      // eslint-disable-next-line\r\n      y: +1.0e12,\r\n      // eslint-disable-next-line\r\n      z: +1.0e12\r\n    };\r\n    this.m_imagePosMax = {\r\n      // eslint-disable-next-line\r\n      x: -1.0e12,\r\n      // eslint-disable-next-line\r\n      y: -1.0e12,\r\n      // eslint-disable-next-line\r\n      z: -1.0e12\r\n    };\r\n\r\n    // eslint-disable-next-line\r\n    this.m_sliceLocMin = +1.0e12;\r\n    // eslint-disable-next-line\r\n    this.m_sliceLocMax = -1.0e12;\r\n\r\n    this.runLoader = this.runLoader.bind(this);\r\n  }\r\n  getBoxSize() {\r\n    return this.m_boxSize;\r\n  }\r\n  getNonEmptyBoxMin() {\r\n    return this.m_nonEmptyBoxMin;\r\n  }\r\n  getNonEmptyBoxMax() {\r\n    return this.m_nonEmptyBoxMax;\r\n  }\r\n\r\n  getDicomInfo() {\r\n    return this.m_dicomInfo;\r\n  }\r\n  /**\r\n   * Create volume from slices set (m_slicesVolume)\r\n   * It can be several set of slices (for multiple series) and hash will\r\n   * select required slices\r\n   * \r\n   * Create volume data array from individual slices, loaded from different files\r\n   * @param {VolumeSet} volSet - destination volume set, will be created\r\n   * @param {number} indexSelected  - desired volume (serie) index\r\n   * @param {number} hashSelected - use only slices with this hash\r\n   * @return {LoadResult} LoadResult.SUCCESS if success\r\n   */\r\n createVolumeFromSlices(volSet, indexSelected, hashSelected) {\r\n  // check arguments\r\n  console.assert(volSet != null, \"Null volume\");\r\n  console.assert(volSet instanceof VolumeSet, \"Should be volume set\");\r\n  console.assert(typeof(indexSelected) === \"number\", \"index should be number\");\r\n  console.assert(typeof(hashSelected) === \"number\", \"index should be number\");\r\n\r\n  let volDst = null;\r\n  if (indexSelected < volSet.getNumVolumes()) {\r\n    volDst = volSet.getVolume(indexSelected);\r\n  } else {\r\n    volDst = new Volume();\r\n    volSet.addVolume(volDst);\r\n    volDst = volSet.getVolume(indexSelected);\r\n    console.assert(volDst !== null);\r\n  }\r\n\r\n  const numSeries = this.m_slicesVolume.m_series.length;\r\n  // get serie with given hash\r\n  let indSerie = -1;\r\n  for (let s = 0; s < numSeries; s++) {\r\n    if (this.m_slicesVolume.m_series[s].m_hash === hashSelected) {\r\n      indSerie = s; break;\r\n    }\r\n  }\r\n  console.assert(indSerie >= 0);\r\n  const serie = this.m_slicesVolume.m_series[indSerie];\r\n  const slice0 = serie.m_slices[0];\r\n  const numSlices = serie.m_slices.length;\r\n  this.m_xDim = slice0.m_xDim;\r\n  this.m_yDim = slice0.m_yDim;\r\n  this.m_zDim = serie.m_slices.length;\r\n  let xyDim = this.m_xDim * this.m_yDim;\r\n  \r\n  const imagePosBox = {\r\n    x: this.m_imagePosMax.x - this.m_imagePosMin.x,\r\n    y: this.m_imagePosMax.y - this.m_imagePosMin.y,\r\n    z: this.m_imagePosMax.z - this.m_imagePosMin.z\r\n  };\r\n  const TOO_MIN = 0.00001;\r\n  let zBox;\r\n  if (Math.abs(this.m_pixelSpacing.z) > TOO_MIN) {\r\n    zBox = this.m_pixelSpacing.z * this.m_zDim;\r\n  } else {\r\n    zBox = imagePosBox.z;\r\n    if (Math.abs(zBox) < TOO_MIN) {\r\n      zBox = imagePosBox.x;\r\n      if (Math.abs(zBox) < TOO_MIN) {\r\n        zBox = imagePosBox.y;\r\n      }\r\n    }\r\n  } // if pixel spacing 0\r\n  if (zBox < TOO_MIN) {\r\n    zBox = 1.0;\r\n  }\r\n  // check empty pixel spacing\r\n  if (this.m_pixelSpacing.x * this.m_pixelSpacing.y < TOO_MIN) {\r\n    this.m_pixelSpacing.x = 1.0;\r\n    this.m_pixelSpacing.y = 1.0;\r\n  }\r\n  this.m_pixelSpacing.z = zBox / this.m_zDim;\r\n  this.m_boxSize.z = this.m_zDim * this.m_pixelSpacing.z;\r\n  this.m_boxSize.x = this.m_xDim * this.m_pixelSpacing.x;\r\n  this.m_boxSize.y = this.m_yDim * this.m_pixelSpacing.y;\r\n  console.log(`createVolumeFromSlices. Volume local phys dim: ${this.m_boxSize.x} * ${this.m_boxSize.y} * ${this.m_boxSize.z}`);\r\n\r\n  let i;\r\n  let dataSize = 0;\r\n  let dataArray = null;\r\n\r\n  // convert big endian in slices\r\n  if (!this.m_littleEndian) {\r\n    for (let ser = 0; ser < numSeries; ser++){\r\n      const serie = this.m_slicesVolume.m_series[ser];\r\n      if (serie.m_hash !== hashSelected) {\r\n        continue;\r\n      }\r\n      for (let sl = 0; sl < numSlices; sl++) {\r\n        const slice = serie.m_slices[sl];\r\n        const sliceData16 = slice.m_image;\r\n        const xDim = slice.m_xDim;\r\n        const yDim = slice.m_yDim;\r\n        xyDim = xDim * yDim;\r\n        for (i = 0; i < xyDim; i++) {\r\n          const val16 = sliceData16[i];\r\n          sliceData16[i] = (val16 >> 8) | ((val16 << 8) & 0xffff);\r\n        } // for (i) all slice pixels\r\n      } // for sl\r\n    } // for ser\r\n  } // if big endian\r\n\r\n  // remove pad values or too much values\r\n  for (let ser = 0; ser < numSeries; ser++) {\r\n    const serie = this.m_slicesVolume.m_series[ser];\r\n    if (serie.m_hash !== hashSelected) {\r\n      continue;\r\n    }\r\n    for (let sl = 0; sl < numSlices; sl++) {\r\n      const slicePad = serie.m_slices[sl];\r\n      const xDim = slicePad.m_xDim;\r\n      const yDim = slicePad.m_yDim;\r\n      xyDim = xDim * yDim;\r\n      for (i = 0; i < xyDim; i++) {\r\n        const val16 = slicePad.m_image[i];\r\n        // if ((val16 === this.m_padValue) || ((val16 & 0x8000) !== 0)) {\r\n        if (val16 === this.m_padValue) {\r\n          val16 = 0;\r\n        }\r\n        slicePad.m_image[i] = val16;\r\n      } // for (i) all slice pixels\r\n    } // for sl\r\n  } // for ser\r\n\r\n  // dont apply rescale formula here, due to unsigned numbder can became signed, but store\r\n  // image in the unsigmed form\r\n\r\n  // get maximum value from slices (but only for given serie : hash)\r\n  let maxVal = -LARGE_NUMBER;\r\n  let minVal = +LARGE_NUMBER;\r\n  for (let ser = 0; ser < numSeries; ser++) {\r\n    const serie = this.m_slicesVolume.m_series[ser];\r\n    if (serie.m_hash !== hashSelected) {\r\n      continue;\r\n    }\r\n    for (let sl = 0; sl < numSlices; sl++) {\r\n      const slice = serie.m_slices[sl];\r\n      const sliceData16 = slice.m_image;\r\n      const xDim = slice.m_xDim;\r\n      const yDim = slice.m_yDim;\r\n      xyDim = xDim * yDim;\r\n      for (i = 0; i < xyDim; i++) {\r\n        const valData = sliceData16[i] * this.m_rescaleSlope + this.m_rescaleIntercept;\r\n        minVal = (valData < minVal) ? valData : minVal;\r\n        maxVal = (valData > maxVal) ? valData : maxVal;\r\n      } // for (i) all slice pixels\r\n    } // for sl\r\n  } // for ser\r\n\r\n  console.log(`Build Volume. min/max value=${minVal}/${maxVal}. Volume dim = ${this.m_xDim}*${this.m_yDim}*${this.m_zDim}`);\r\n  console.log(`Min slice number = ${serie.m_minSlice}`);\r\n  console.log(`Max slice number = ${serie.m_maxSlice}`);\r\n  maxVal = (maxVal - minVal > 0) ? maxVal : (maxVal + 1); \r\n\r\n  const BITS_ACCUR = 11;\r\n  const BITS_IN_BYTE = 8;\r\n  const scale = Math.floor((1 << (BITS_IN_BYTE + BITS_ACCUR)) / (maxVal - minVal));\r\n  const TOO_MIN_SCALE = 4;\r\n  if (scale <= TOO_MIN_SCALE) {\r\n    console.log('Bad scaling: image will be 0');\r\n    return LoadResult.ERROR_SCALING;\r\n  }\r\n\r\n  // get slices for selected serie\r\n  const srcSlices = serie.m_slices;\r\n\r\n  const numSlicesByTags = serie.m_maxSlice - serie.m_minSlice + 1;\r\n  if (numSlicesByTags !== numSlices) {\r\n    console.log(`Sort by location! N slices by tags = ${numSlicesByTags}, but N readed slices = ${numSlices}`);\r\n  }\r\n  // sort slices via slice location OR slice number\r\n  let minSliceNum = srcSlices[0].m_sliceNumber;\r\n  let maxSliceNum = srcSlices[0].m_sliceNumber;\r\n  for (let s = 0; s < numSlices; s++) {\r\n    const num = srcSlices[s].m_sliceNumber;\r\n    minSliceNum = (num < minSliceNum) ? num : minSliceNum;\r\n    maxSliceNum = (num > maxSliceNum) ? num : maxSliceNum;\r\n  }\r\n  const difSlceNum = maxSliceNum - minSliceNum;\r\n  if (difSlceNum > 0) {\r\n    // sort slices by slice number (read from dicom tag)\r\n    srcSlices.sort((a, b) => {\r\n      const zDif = a.m_sliceNumber - b.m_sliceNumber;\r\n      return zDif;\r\n    });\r\n  } else {\r\n    // sort slices by slice location (read from diocom tag)\r\n    srcSlices.sort((a, b) => {\r\n      const zDif = a.m_sliceLocation - b.m_sliceLocation;\r\n      return zDif;\r\n    });\r\n  }\r\n  // assign new slice numbers according accending location\r\n  let ind = 0;\r\n  for (let s = 0; s < numSlices; s++) {\r\n    srcSlices[s].m_sliceNumber = ind;\r\n    ind++;\r\n  }\r\n  this.m_zDim = numSlices;\r\n\r\n  // create out volume data array\r\n  // normal copy volume with transform 16 -> 8 bit\r\n\r\n  dataSize = this.m_xDim * this.m_yDim * this.m_zDim;\r\n  dataArray = new Uint8Array(dataSize);\r\n  if (dataArray === null) {\r\n    console.log('no memory');\r\n    return LoadResult.ERROR_NO_MEMORY;\r\n  }\r\n  for (i = 0; i < dataSize; i++) {\r\n    dataArray[i] = 0;\r\n  }\r\n\r\n  // convert slices data into volume set data (16 bpp -> 8 bpp, etc)\r\n  const MAX_BYTE = 255;\r\n  for (let s = 0; s < numSlices; s++) {\r\n    const sliceSrc = srcSlices[s];\r\n    xyDim = sliceSrc.m_xDim * sliceSrc.m_yDim;\r\n    const dataSrc16 = sliceSrc.m_image;\r\n    // console.log(`Slice[${s}] sliceNumber = ${slice.m_sliceNumber} sliceLocation = ${slice.m_sliceLocation}`);\r\n\r\n    // const z = slice.m_sliceNumber - this.m_slicesVolume.m_minSlice;\r\n    let z = sliceSrc.m_sliceNumber;\r\n    if (z >= serie.m_slices.length) {\r\n      z = sliceSrc.m_sliceNumber - serie.m_minSlice;\r\n      if ((z < 0) || (z >= this.m_zDim)) {\r\n        console.log('Invalid z slice reference');\r\n        return LoadResult.ERROR_INVALID_SLICE_INDEX;\r\n      } // if z invalid\r\n    } // if z more num slices\r\n\r\n    if (dataSrc16 !== null) {\r\n      const offZ = z * xyDim;\r\n\r\n      if ((this.m_windowCenter !== LARGE_NUMBER) && (this.m_windowWidth !== LARGE_NUMBER)) {\r\n        const winMin = this.m_windowCenter - this.m_windowWidth * 0.5;\r\n        for (i = 0; i < xyDim; i++) {\r\n          const valScaled = dataSrc16[i] * this.m_rescaleSlope + this.m_rescaleIntercept;\r\n\r\n          let val = 0;\r\n          if (this.m_rescaleHounsfield) {\r\n            // rescale for hounsfield units\r\n            val = Math.floor((valScaled - winMin) * 255 / this.m_windowWidth);\r\n          } else {\r\n            // usual (default) rescale\r\n            val = Math.floor(127 + (valScaled - this.m_windowCenter) * 128 / (this.m_windowWidth / 2));\r\n          }\r\n          val = (val >= 0) ? val : 0;\r\n          val = (val < 255) ? val : 255;\r\n          dataArray[offZ + i] = val;\r\n        } // for i\r\n      } else {\r\n        // window center, width not specified\r\n        for (i = 0; i < xyDim; i++) {\r\n          const val16 = dataSrc16[i] * this.m_rescaleSlope + this.m_rescaleIntercept;\r\n          let val = ((val16 - minVal) * scale) >> BITS_ACCUR;\r\n          // let val = Math.floor(255 * val16 / maxVal);\r\n          val = (val <= MAX_BYTE) ? val : MAX_BYTE;\r\n          dataArray[offZ + i] = val;\r\n        } // for i\r\n      } // no defined window center, width\r\n\r\n    } // if has slice data\r\n  } // for(s) all slices\r\n\r\n  // destroy for what?\r\n  // this.m_slicesVolume.destroy();\r\n\r\n  // Scale down volume by slices\r\n  const numPixelsInVolume = this.m_xDim * this.m_yDim * this.m_zDim;\r\n  // eslint-disable-next-line\r\n  const MAX_VOLUME_PIXELS = 512 * 512 * 256;\r\n  if (this.m_needScaleDownTexture && (numPixelsInVolume > MAX_VOLUME_PIXELS)) {\r\n    const XY_MAX_DIM = 512;\r\n    const Z_LOW_DIM = 120;\r\n    const xDimDst = (this.m_xDim <= XY_MAX_DIM) ? this.m_xDim : XY_MAX_DIM;\r\n    const yDimDst = (this.m_yDim <= XY_MAX_DIM) ? this.m_yDim : XY_MAX_DIM;\r\n    const zDimDst = Z_LOW_DIM;\r\n    const dataNew = VolumeTools.scaleTextureDown(this, dataArray, xDimDst, yDimDst, zDimDst);\r\n    dataArray = dataNew;\r\n    xyDim = this.m_xDim * this.m_yDim;\r\n    console.log(`Volume scaled down to: ${xDimDst} * ${yDimDst} * ${zDimDst}.`);\r\n  }\r\n\r\n  // Scan for empty voxels on border sides\r\n  if (NEED_SCAN_EMPTY_BORDER) {\r\n    const xDim = this.m_xDim;\r\n    const yDim = this.m_yDim;\r\n    const zDim = this.m_zDim;\r\n\r\n    const minValBarrier = 16;\r\n    let x;\r\n    let y;\r\n    let z;\r\n    let isEmpty;\r\n    isEmpty = true;\r\n    for (x = 0; (x < xDim / TWICE) && (isEmpty); x++) {\r\n      // check is empty plane\r\n      for (y = 0; (y < yDim) && (isEmpty); y++) {\r\n        for (z = 0; (z < zDim) && (isEmpty); z++) {\r\n          const off = (z * xyDim) + (y * xDim) + x;\r\n          if (dataArray[off] > minValBarrier) {\r\n            isEmpty = false;\r\n          }\r\n        } // for (z)\r\n      } // for (y()\r\n    } // for (x)\r\n    const xBorderMin = x;\r\n\r\n    isEmpty = true;\r\n    for (x = xDim - 1; (x > xDim / TWICE) && (isEmpty); x--) {\r\n      // check is empty plane\r\n      for (y = 0; (y < yDim) && (isEmpty); y++) {\r\n        for (z = 0; (z < zDim) && (isEmpty); z++) {\r\n          const off = (z * xyDim) + (y * xDim) + x;\r\n          if (dataArray[off] > minValBarrier) {\r\n            isEmpty = false;\r\n          }\r\n        } // for (z)\r\n      } // for (y()\r\n    } // for (x)\r\n    const xBorderMax = x;\r\n\r\n    isEmpty = true;\r\n    for (y = 0; (y < yDim / TWICE) && (isEmpty); y++) {\r\n      // check is empty plane\r\n      for (x = 0; (x < xDim) && (isEmpty); x++) {\r\n        for (z = 0; (z < zDim) && (isEmpty); z++) {\r\n          const off = (z * xyDim) + (y * xDim) + x;\r\n          if (dataArray[off] > minValBarrier) {\r\n            isEmpty = false;\r\n          }\r\n        } // for (z)\r\n      } // for (y()\r\n    } // for (x)\r\n    const yBorderMin = y;\r\n\r\n    isEmpty = true;\r\n    for (y = yDim - 1; (y > yDim / TWICE) && (isEmpty); y--) {\r\n      // check is empty plane\r\n      for (x = 0; (x < xDim) && (isEmpty); x++) {\r\n        for (z = 0; (z < zDim) && (isEmpty); z++) {\r\n          const off = (z * xyDim) + (y * xDim) + x;\r\n          if (dataArray[off] > minValBarrier) {\r\n            isEmpty = false;\r\n          }\r\n        } // for (z)\r\n      } // for (y()\r\n    } // for (x)\r\n    const yBorderMax = y;\r\n\r\n    isEmpty = true;\r\n    for (z = 0; (z < zDim / TWICE) && (isEmpty); z++) {\r\n      // check is empty plane\r\n      for (x = 0; (x < xDim) && (isEmpty); x++) {\r\n        for (y = 0; (y < yDim) && (isEmpty); y++) {\r\n          const off = (z * xyDim) + (y * xDim) + x;\r\n          if (dataArray[off] > minValBarrier) {\r\n            isEmpty = false;\r\n          }\r\n        } // for (z)\r\n      } // for (y()\r\n    } // for (x)\r\n    const zBorderMin = z;\r\n\r\n    isEmpty = true;\r\n    for (z = zDim - 1; (z > zDim / TWICE) && (isEmpty); z--) {\r\n      // check is empty plane\r\n      for (x = 0; (x < xDim) && (isEmpty); x++) {\r\n        for (y = 0; (y < yDim) && (isEmpty); y++) {\r\n          const off = (z * xyDim) + (y * xDim) + x;\r\n          if (dataArray[off] > minValBarrier) {\r\n            isEmpty = false;\r\n          }\r\n        } // for (z)\r\n      } // for (y()\r\n    } // for (x)\r\n    const zBorderMax = z;\r\n\r\n    // console.log(`Border scan: xBorderMin = ${xBorderMin}, xBorderMax = ${xBorderMax}. xDim = ${xDim}`);\r\n    // console.log(`Border scan: yBorderMin = ${yBorderMin}, yBorderMax = ${yBorderMax}. yDim = ${yDim}`);\r\n    // console.log(`Border scan: zBorderMin = ${zBorderMin}, zBorderMax = ${zBorderMax}. zDim = ${zDim}`);\r\n    this.m_nonEmptyBoxMin.x = xBorderMin / xDim;\r\n    this.m_nonEmptyBoxMin.y = yBorderMin / yDim;\r\n    this.m_nonEmptyBoxMin.z = zBorderMin / zDim;\r\n    this.m_nonEmptyBoxMax.x = xBorderMax / xDim;\r\n    this.m_nonEmptyBoxMax.y = yBorderMax / yDim;\r\n    this.m_nonEmptyBoxMax.z = zBorderMax / zDim;\r\n\r\n    this.m_boxSize.z = (zBorderMax - zBorderMin) * this.m_pixelSpacing.z;\r\n    this.m_boxSize.x = (xBorderMax - xBorderMin) * this.m_pixelSpacing.x;\r\n    this.m_boxSize.y = (yBorderMax - yBorderMin) * this.m_pixelSpacing.y;\r\n\r\n    const neMin = this.m_nonEmptyBoxMin;\r\n    const neMax = this.m_nonEmptyBoxMax;\r\n    console.log(`Border scan min: ${neMin.x}, ${neMin.y}, ${neMin.z}`);\r\n    console.log(`Border scan max: ${neMax.x}, ${neMax.y}, ${neMax.z}`);\r\n  } // if need scan empty borders\r\n\r\n  // Special volume texture size fix (z dim should be even)\r\n  if (NEED_EVEN_TEXTURE_SIZE) {\r\n    const xDim = this.m_xDim;\r\n    const yDim = this.m_yDim;\r\n    const zDim = this.m_zDim;\r\n    if ((zDim & 1) !== 0) {\r\n      const volDataAlignedSize = VolumeTools.makeTextureSizeEven(dataArray, xDim, yDim, zDim);\r\n      // Align all dims to 4*x\r\n      const NUM3 = 3;\r\n      this.m_xDim = (xDim + NUM3) & (~NUM3);\r\n      this.m_yDim = (yDim + NUM3) & (~NUM3);\r\n      this.m_zDim = (zDim + NUM3) & (~NUM3);\r\n      dataArray = volDataAlignedSize;\r\n    }\r\n  }\r\n\r\n  // Apply Gauss smooth filter\r\n  if (NEED_APPLY_GAUSS_SMOOTHING) {\r\n    const volTools = new VolumeTools();\r\n    const GAUSS_RADIUS = 2;\r\n    const GAUSS_SIGMA = 1.4;\r\n    volTools.gaussSmooth(dataArray, this.m_xDim, this.m_yDim, this.m_zDim, GAUSS_RADIUS, GAUSS_SIGMA);\r\n  }\r\n\r\n  // Apply 0 to the edges of volume\r\n  const MIN_NUM_SLICES_FOR_VOL = 4;\r\n  if (this.m_zDim > MIN_NUM_SLICES_FOR_VOL) {\r\n    let x;\r\n    let y;\r\n    let z;\r\n    let yOff;\r\n    let zOff;\r\n    // z planes\r\n    z = 0;\r\n    const zOffMin = z * this.m_xDim * this.m_yDim;\r\n    z = this.m_zDim - 1;\r\n    const zOffMax = z * this.m_xDim * this.m_yDim;\r\n    for (y = 0; y < this.m_yDim; y++) {\r\n      yOff = y * this.m_xDim;\r\n      for (x = 0; x < this.m_xDim; x++) {\r\n        dataArray[zOffMin + yOff + x] = 0;\r\n        dataArray[zOffMax + yOff + x] = 0;\r\n      } // for x\r\n    }  // for y\r\n\r\n    // x planes\r\n    x = 0;\r\n    const xOffMin = x;\r\n    x = this.m_xDim - 1;\r\n    const xOffMax = x;\r\n    for (z = 0; z < this.m_zDim; z++) {\r\n      zOff = z * this.m_xDim * this.m_yDim;\r\n      for (y = 0; y < this.m_yDim; y++) {\r\n        yOff = y * this.m_xDim;\r\n        dataArray[zOff + yOff + xOffMin] = 0;\r\n        dataArray[zOff + yOff + xOffMax] = 0;\r\n      }\r\n    }\r\n    // y planes\r\n    y = 0;\r\n    const yOffMin = y * this.m_xDim;\r\n    y = this.m_yDim - 1;\r\n    const yOffMax = y * this.m_xDim;\r\n    for (z = 0; z < this.m_zDim; z++) {\r\n      zOff = z * this.m_xDim * this.m_yDim;\r\n      for (x = 0; x < this.m_xDim; x++) {\r\n        dataArray[zOff + x + yOffMin] = 0;\r\n        dataArray[zOff + x + yOffMax] = 0;\r\n      } // for x\r\n    } // for z\r\n  } // if zDim more min possible for volume\r\n\r\n  const KTX_GL_RED = 0x1903;\r\n  const KTX_UNSIGNED_BYTE = 0x1401;\r\n  const header = {\r\n    m_pixelWidth: this.m_xDim,\r\n    m_pixelHeight: this.m_yDim,\r\n    m_pixelDepth: this.m_zDim,\r\n    m_glType: KTX_UNSIGNED_BYTE,\r\n    m_glTypeSize: 1,\r\n    m_glFormat: KTX_GL_RED,\r\n    m_glInternalFormat: KTX_GL_RED,\r\n    m_glBaseInternalFormat: KTX_GL_RED,\r\n  };\r\n  const callbackComplete = this.m_callbackComplete;\r\n  if (callbackComplete) {\r\n    callbackComplete(LoadResult.SUCCESS, header, dataSize, dataArray);\r\n  } // if callback ready\r\n  const ONE = 1;\r\n\r\n  volDst.m_xDim = this.m_xDim;\r\n  volDst.m_yDim = this.m_yDim;\r\n  volDst.m_zDim = this.m_zDim;\r\n  volDst.m_dataArray = dataArray;\r\n  volDst.m_dataSize = dataSize;\r\n  volDst.m_bytesPerVoxel = ONE;\r\n  volDst.m_boxSize.x = this.m_boxSize.x;\r\n  volDst.m_boxSize.y = this.m_boxSize.y;\r\n  volDst.m_boxSize.z = this.m_boxSize.z;\r\n\r\n  volDst.m_patientName = this.m_dicomInfo.m_patientName;\r\n  volDst.m_patientBirth = this.m_dicomInfo.m_patientDateOfBirth;\r\n  volDst.m_seriesDescr = this.m_dicomInfo.m_seriesDescr;\r\n\r\n\r\n  volDst.m_studyDescr = this.m_dicomInfo.m_studyDescr;\r\n  volDst.m_studyDate = this.m_dicomInfo.m_studyDate;\r\n  volDst.m_seriesTime = this.m_dicomInfo.m_seriesTime;\r\n  volDst.m_bodyPartExamined = this.m_dicomInfo.m_bodyPartExamined;\r\n  volDst.m_institutionName = this.m_dicomInfo.m_institutionName;\r\n  volDst.m_operatorsName = this.m_dicomInfo.m_operatorsName;\r\n  volDst.m_physicansName = this.m_dicomInfo.m_physicansName;\r\n\r\n  volDst.createIcon();\r\n\r\n\r\n  return LoadResult.SUCCESS;\r\n} // end createVolumeFromSlices\r\n\r\n  static getVrsStringIndex(vr) {\r\n    const VRS = [\r\n      'AE', 'AS', 'AT', 'CS', 'DA', 'DS', 'DT', 'FL',\r\n      'FD', 'IS', 'LO', 'LT', 'OB', 'OD', 'OF', 'OW',\r\n      'PN', 'SH', 'SL', 'SS', 'ST', 'TM', 'UI', 'UL',\r\n      'UN', 'US', 'UT',\r\n    ];\r\n    const numElems = VRS.length;\r\n    for (let i = 0; i < numElems; i++) {\r\n      if (VRS[i] === vr) {\r\n        return i;\r\n      }\r\n    }\r\n    return -1;\r\n  }\r\n  static getDataVrsStringIndex(vr) {\r\n    const DATA_VRS = [\r\n      'OB', 'OW', 'OF', 'SQ', 'UT', 'UN',\r\n    ];\r\n    const numElems = DATA_VRS.length;\r\n    for (let i = 0; i < numElems; i++) {\r\n      if (DATA_VRS[i] === vr) {\r\n        return i;\r\n      }\r\n    }\r\n    return -1;\r\n  }\r\n  /**\r\n  * Convert DataView object into string\r\n  * @param {object} dataView - DataView object (created from ArrayBuffer)\r\n  * @param {number} offset - current offset in buffer, when string started\r\n  * @param {number} lengthBuf - number of bytes to convert to string\r\n  * @return {string} string presentation of DataView\r\n  */\r\n  static getStringAt(dataView, offset, lengthBuf) {\r\n    let str = '';\r\n    for (let i = 0; i < lengthBuf; i++) {\r\n      const ch = dataView.getUint8(offset + i);\r\n      if (ch !== 0) {\r\n        str += String.fromCharCode(ch);\r\n      }\r\n    }\r\n    return str;\r\n  }\r\n  static getUtf8StringAt(dataView, offset, lengthBuf) {\r\n    let str = '';\r\n    let i = 0;\r\n    while (i < lengthBuf) {\r\n      let c = dataView.getUint8(offset + i); i++;\r\n      if (c == 0x5e) {\r\n        c = 32;\r\n      }\r\n      switch (c >> 4) {\r\n        case 0: case 1:\r\n        case 2: case 3:\r\n        case 4: case 5:\r\n        case 6: case 7:\r\n          str += String.fromCharCode(c);\r\n          break;\r\n        case 12: case 13:\r\n          const char2 = dataView.getUint8(offset + i); i++;\r\n          str += String.fromCharCode(((c & 0x1F) << 6) | (char2 & 0x3F));\r\n          break;\r\n        case 14:\r\n          const ch2 = dataView.getUint8(offset + i); i++;\r\n          const ch3 = dataView.getUint8(offset + i); i++;\r\n          str += String.fromCharCode(((c & 0x0F) << 12) |\r\n                                     ((ch2 & 0x3F) << 6) |\r\n                                     ((ch3 & 0x3F) << 0));\r\n          break;          \r\n      } // switch\r\n \r\n    } // while not end string\r\n    return str;\r\n  }\r\n  static getAttrValueAsString(tag) {\r\n    if (tag.m_value === null) {\r\n      if (tag.m_vr === 'SQ') { // sequence of items\r\n        return '(Sequence Data)';\r\n      }\r\n      return null;\r\n    }\r\n    const SIZE_SHORT = 2;\r\n    const SIZE_DWORD = 4;\r\n    const dvTag = new DataView(tag.m_value);\r\n    let tmp = null;\r\n    let res = null;\r\n    let date = null;\r\n    let readBytes = 0;\r\n    // to do: add AT, OB?, OD?, OF?, OW?, Unknown?\r\n    switch (tag.m_vr) {\r\n      case 'AE': // application entity\r\n        return LoaderDicom.getStringAt(dvTag, 0, tag.m_value.byteLength);\r\n      case 'AS': // age string\r\n        tmp = LoaderDicom.getStringAt(dvTag, 0, tag.m_value.byteLength);\r\n        // eslint-disable-next-line\r\n        res = Number(tmp.slice(0, 3)).toString();\r\n        switch (tmp[3]) {\r\n          case 'D':\r\n            return `${res} days`;\r\n          case 'W':\r\n            return `${res} weeks`;\r\n          case 'M':\r\n            return `${res} months`;\r\n          case 'Y':\r\n            return `${res} years`;\r\n          default:\r\n            return null;\r\n        }\r\n      case 'CS': // code string\r\n        return LoaderDicom.getStringAt(dvTag, 0, tag.m_value.byteLength);\r\n      case 'DA': // date\r\n        tmp = LoaderDicom.getStringAt(dvTag, 0, tag.m_value.byteLength);\r\n        // eslint-disable-next-line\r\n        date = new Date(`${tmp.slice(0, 4)}-${tmp.slice(4, 6)}-${tmp.slice(6, 8)}`);\r\n        return date.toLocaleDateString();\r\n      case 'DS': // decimal string\r\n        return LoaderDicom.getStringAt(dvTag, 0, tag.m_value.byteLength);\r\n      case 'DT': // date time\r\n        // to do: parse date-time as YYYYMMDDHHMMSS.FFFFFF&ZZXX\r\n        return LoaderDicom.getStringAt(dvTag, 0, tag.m_value.byteLength);\r\n      case 'FL': // floating point single\r\n        res = dvTag.getFloat32(0, tag.m_littleEndian).toString();\r\n        readBytes = SIZE_DWORD;\r\n        while (readBytes + SIZE_DWORD <= dvTag.byteLength) {\r\n          res = `${res} \\\\ ${dvTag.getFloat32(readBytes, tag.m_littleEndian).toString()}`;\r\n          readBytes += SIZE_DWORD;\r\n        }\r\n        return res;\r\n      case 'FD': // floating point double\r\n        res = dvTag.getFloat64(0, tag.m_littleEndian).toString();\r\n        readBytes = (SIZE_DWORD + SIZE_DWORD);\r\n        while (readBytes + SIZE_DWORD + SIZE_DWORD <= dvTag.byteLength) {\r\n          res = `${res} \\\\ ${dvTag.getFloat64(readBytes, tag.m_littleEndian).toString()}`;\r\n          readBytes += (SIZE_DWORD + SIZE_DWORD);\r\n        }\r\n        return res;\r\n      case 'IS': // integer string\r\n        return LoaderDicom.getStringAt(dvTag, 0, tag.m_value.byteLength);\r\n      case 'LO': // long string\r\n        return LoaderDicom.getStringAt(dvTag, 0, tag.m_value.byteLength);\r\n      case 'LT': // long text\r\n        // to do: check if it works for several paragraphs\r\n        return LoaderDicom.getStringAt(dvTag, 0, tag.m_value.byteLength);\r\n      case 'PN': // person name\r\n        return LoaderDicom.getStringAt(dvTag, 0, tag.m_value.byteLength);\r\n      case 'SH': // short string\r\n        return LoaderDicom.getStringAt(dvTag, 0, tag.m_value.byteLength);\r\n      case 'SL': // signed long\r\n        res = dvTag.getInt32(0, tag.m_littleEndian).toString();\r\n        readBytes = SIZE_DWORD;\r\n        while (readBytes + SIZE_SHORT <= dvTag.byteLength) {\r\n          res = `${res} \\\\ ${dvTag.getInt16(readBytes, tag.m_littleEndian).toString()}`;\r\n          readBytes += SIZE_DWORD;\r\n        }\r\n        return res;\r\n      case 'SS': // signed short\r\n        res = dvTag.getInt16(0, tag.m_littleEndian).toString();\r\n        readBytes = SIZE_SHORT;\r\n        while (readBytes + SIZE_SHORT <= dvTag.byteLength) {\r\n          res = `${res} \\\\ ${dvTag.getInt16(readBytes, tag.m_littleEndian).toString()}`;\r\n          readBytes += SIZE_SHORT;\r\n        }\r\n        return res;\r\n      case 'ST': // short text\r\n        return LoaderDicom.getStringAt(dvTag, 0, tag.m_value.byteLength);\r\n      case 'TM': // time\r\n        tmp = LoaderDicom.getStringAt(dvTag, 0, tag.m_value.byteLength);\r\n        if (tag.m_value.byteLength >= SIZE_SHORT) {\r\n          // eslint-disable-next-line\r\n          res = `${Number(tmp.slice(0, 2))}h`;\r\n        }\r\n        if (tag.m_value.byteLength >= SIZE_DWORD) {\r\n          // eslint-disable-next-line\r\n          res = `${res} ${Number(tmp.slice(2, 4))}m`;\r\n        }\r\n        if (tag.m_value.byteLength > SIZE_DWORD) {\r\n          // eslint-disable-next-line\r\n          res = `${res} ${parseFloat(tmp.slice(4, tag.m_value.byteLength))}s`;\r\n        }\r\n        return res;\r\n      case 'UI': // unique identifier\r\n        return LoaderDicom.getStringAt(dvTag, 0, tag.m_value.byteLength);\r\n      case 'UL': // unsigned long\r\n        res = dvTag.getUint32(0, tag.m_littleEndian).toString();\r\n        readBytes = SIZE_DWORD;\r\n        while (readBytes + SIZE_DWORD <= dvTag.byteLength) {\r\n          res = `${res} \\\\ ${dvTag.getUint32(readBytes, tag.m_littleEndian).toString()}`;\r\n          readBytes += SIZE_DWORD;\r\n        }\r\n        return res;\r\n      case 'US': // unsigned short\r\n        res = dvTag.getUint16(0, tag.m_littleEndian).toString();\r\n        readBytes = SIZE_SHORT;\r\n        while (readBytes + SIZE_SHORT <= dvTag.byteLength) {\r\n          res = `${res} \\\\ ${dvTag.getUint16(readBytes, tag.m_littleEndian).toString()}`;\r\n          readBytes += SIZE_SHORT;\r\n        }\r\n        return res;\r\n      case 'UT': // unlimited text\r\n        // to do: check if it works for several paragraphs\r\n        return LoaderDicom.getStringAt(dvTag, 0, tag.m_value.byteLength);\r\n      default:\r\n        return null;\r\n    }\r\n  }\r\n  /**\r\n  * Get next tag from stream\r\n  * @param {object} dataView - array\r\n  * @param {number} offset - current offset in buffer\r\n  * @return {object} if success or null, when fail. Fail reasons: invalid tag length read.\r\n  */\r\n getNextTag(dataView, offset) {\r\n  // check end of buffer\r\n  if (offset >= dataView.byteLengh) {\r\n    return null;\r\n  }\r\n  const SIZE_SHORT = 2;\r\n  const SIZE_DWORD = 4;\r\n\r\n  let little = true;\r\n  let group = 0;\r\n  let element = 0;\r\n  let lenData = 0;\r\n  const offsetStart = offset;\r\n  let vr = '';\r\n\r\n  const MAGIC_GROUP = 0x0002;\r\n\r\n  if (this.m_metaFinished) {\r\n    little = this.m_littleEndian;\r\n    group = dataView.getUint16(offset, little);\r\n  } else {\r\n    group = dataView.getUint16(offset, 1);\r\n    if (((this.m_metaFinishedOffset !== -1) && (offset >= this.m_metaFinishedOffset)) || (group !== MAGIC_GROUP)) {\r\n      this.m_metaFinished = 1;\r\n      little = this.m_littleEndian;\r\n      group = dataView.getUint16(offset, little);\r\n    } else {\r\n      little = true;\r\n    }\r\n  }\r\n  if (!this.m_metaFound && (group === MAGIC_GROUP)) {\r\n    this.m_metaFound = true;\r\n  }\r\n  offset += SIZE_SHORT; // skip group number\r\n\r\n  element = dataView.getUint16(offset, little);\r\n  offset += SIZE_SHORT; // skip element number\r\n\r\n  if (this.m_explicit || !this.m_metaFinished) {\r\n    vr = LoaderDicom.getStringAt(dataView, offset, SIZE_SHORT);\r\n    if (!this.m_metaFound && this.m_metaFinished && (LoaderDicom.getVrsStringIndex(vr) === -1)) {\r\n      vr = DicomDictionary.getVr(group, element);\r\n      lenData = dataView.getUint32(offset, little);\r\n      // assert for lenData < 1024 * 1024 * 32\r\n      offset += SIZE_DWORD;\r\n      this.m_explicit = false;\r\n    } else {\r\n      offset += SIZE_SHORT;\r\n      if (LoaderDicom.getDataVrsStringIndex(vr) !== -1) {\r\n        offset += SIZE_SHORT;\r\n        lenData = dataView.getUint32(offset, little);\r\n        // assert for lenData < 1024 * 1024 * 32\r\n        offset += SIZE_DWORD;\r\n      } else {\r\n        lenData = dataView.getUint16(offset, little);\r\n        // assert for lenData < 1024 * 1024 * 32\r\n        offset += SIZE_SHORT;\r\n      }\r\n    }\r\n  } else {\r\n    vr = this.m_dictionary.getVr(group, element);\r\n    lenData = dataView.getUint32(offset, little);\r\n    // assert for lenData < 1024 * 1024 * 32\r\n    if (lenData === UNDEFINED_LENGTH) {\r\n      vr = 'SQ';\r\n    }\r\n    offset += SIZE_DWORD;\r\n  }\r\n  const offsetValue = offset;\r\n  let dataValue = null;\r\n  if (vr === 'SQ') {\r\n    // see nema dicom Table 7.5-3\r\n    // for now just skip sequence items\r\n    if (lenData === UNDEFINED_LENGTH) {\r\n      let sqGroup = 0;\r\n      let sqElement = 0;\r\n      while (!((sqGroup === TAG_END_OF_SEQUENCE[0]) && (sqElement === TAG_END_OF_SEQUENCE[1]))) {\r\n        sqGroup = dataView.getUint16(offset, little);\r\n        offset += SIZE_SHORT;\r\n        sqElement = dataView.getUint16(offset, little);\r\n        offset += SIZE_SHORT;\r\n        const sqLength = dataView.getUint32(offset, little);\r\n        offset += SIZE_DWORD;\r\n        if (sqLength === UNDEFINED_LENGTH) {\r\n          // item delim. tag (fffe, e00d)\r\n          while (!(((sqGroup === TAG_END_OF_ITEMS[0]) && (sqElement === TAG_END_OF_ITEMS[1])) ||\r\n            ((sqGroup === TAG_END_OF_SEQUENCE[0]) && (sqElement === TAG_END_OF_SEQUENCE[1])))) {\r\n            const tagNew = this.getNextTag(dataView, offset);\r\n            offset = tagNew.m_offsetEnd;\r\n            sqGroup = dataView.getUint16(offset, little);\r\n            sqElement = dataView.getUint16(offset + SIZE_SHORT, little);\r\n          }\r\n          offset += (SIZE_DWORD + SIZE_DWORD); // 4 for group and element + 4 for length field\r\n        } else { // if sqLength is ffffffff\r\n          offset += sqLength;\r\n        }\r\n      } // while not end tag sequence\r\n      lenData = 0;\r\n    } // if length equal to ffffffff\r\n  } else if (lenData > 0) {\r\n    if (lenData === UNDEFINED_LENGTH) {\r\n      if ((group === TAG_PIXEL_DATA[0]) && (element === TAG_PIXEL_DATA[1])) {\r\n        lenData = (dataView.byteLength - offset);\r\n      }\r\n    }\r\n    // Get data from buffer, starting from offset\r\n    dataValue = dataView.buffer.slice(offset, offset + lenData);\r\n  }\r\n  const VAL_16 = 16;\r\n  if (DEBUG_PRINT_TAGS_INFO) {\r\n    const strDesc = this.m_dictionary.getTextDesc(group, element);\r\n    const strGr = group.toString(VAL_16);\r\n    const strEl = element.toString(VAL_16);\r\n    console.log(`Tag {${strGr},${strEl}}, VR='${vr}', Length=${lenData}, Desc=${strDesc}`);\r\n  }\r\n  const VAL_MIN_ONE = 0xffffffff;\r\n  if (lenData === VAL_MIN_ONE) {\r\n    return null;\r\n  }\r\n\r\n  offset += lenData;\r\n  const tag = new DicomTag(group, element, vr, dataValue, offsetStart, offsetValue, offset, this.m_littleEndian);\r\n\r\n  if (tag) {\r\n    this.m_newTagEvent.detail.group = group.toString(VAL_16);\r\n    this.m_newTagEvent.detail.element = element.toString(VAL_16);\r\n    this.m_newTagEvent.detail.desc = this.m_dictionary.getTextDesc(group, element);\r\n    this.m_newTagEvent.detail.value = LoaderDicom.getAttrValueAsString(tag);\r\n    if ((group === TAG_IMAGE_INSTANCE_NUMBER[0]) && (element === TAG_IMAGE_INSTANCE_NUMBER[1])) {\r\n      this.m_newTagEvent.detail.imageNumber = parseInt(this.m_newTagEvent.detail.value, 10);\r\n    } else {\r\n      this.m_newTagEvent.detail.imageNumber = -1;\r\n    }\r\n    dispatchEvent(this.m_newTagEvent);\r\n  }\r\n\r\n  if (tag.isTransformSyntax()) {\r\n    const tagDataLen = tag.m_value.byteLength;\r\n    const dvTag = new DataView(tag.m_value);\r\n    const strTagVal = LoaderDicom.getStringAt(dvTag, 0, tagDataLen);\r\n    if (strTagVal === TRANSFER_SYNTAX_IMPLICIT_LITTLE) {\r\n      this.m_explicit = false;\r\n      this.m_littleEndian = true;\r\n    } else if (strTagVal === TRANSFER_SYNTAX_EXPLICIT_BIG) {\r\n      this.m_explicit = true;\r\n      this.m_littleEndian = false;\r\n    } else if (strTagVal === TRANSFER_SYNTAX_COMPRESSION_DEFLATE) {\r\n      this.m_needsDeflate = true;\r\n      this.m_explicit = true;\r\n      this.m_littleEndian = true;\r\n    } else if (strTagVal == TRANSFER_SYNTAX_COMPRESSION_JPEG) {\r\n      this.m_transformSyntax = TRANSFER_SYNTAX_COMPRESSION_JPEG;\r\n    } else if (strTagVal == TRANSFER_SYNTAX_COMPRESSION_JPEG_LOSSLESS_SEL1) {\r\n      this.m_transformSyntax = TRANSFER_SYNTAX_COMPRESSION_JPEG_LOSSLESS_SEL1;\r\n    } else if (strTagVal == TRANSFER_SYNTAX_COMPRESSION_JPEG_LOSSLESS) {\r\n      this.m_transformSyntax = TRANSFER_SYNTAX_COMPRESSION_JPEG_LOSSLESS;\r\n    } else if (strTagVal == TRANSFER_SYNTAX_COMPRESSION_JPEG_BASELINE_8BIT) {\r\n      this.m_transformSyntax = TRANSFER_SYNTAX_COMPRESSION_JPEG_BASELINE_8BIT;\r\n    } else if (strTagVal == TRANSFER_SYNTAX_COMPRESSION_JPEG_BASELINE_12BIT) {\r\n      this.m_transformSyntax = TRANSFER_SYNTAX_COMPRESSION_JPEG_BASELINE_12BIT;\r\n    } else if (strTagVal == TRANSFER_SYNTAX_COMPRESSION_JPEG_2000_LOSSLESS) {\r\n      this.m_transformSyntax = TRANSFER_SYNTAX_COMPRESSION_JPEG_2000_LOSSLESS;\r\n    } else if (strTagVal == TRANSFER_SYNTAX_COMPRESSION_JPEG_2000) {\r\n      this.m_transformSyntax = TRANSFER_SYNTAX_COMPRESSION_JPEG_2000;\r\n    } else if (strTagVal == TRANSFER_SYNTAX_COMPRESSION_RLE) {\r\n      this.m_transformSyntax = TRANSFER_SYNTAX_COMPRESSION_RLE;\r\n\r\n    } else {\r\n      this.m_explicit = true;\r\n      this.m_littleEndian = true;\r\n    }\r\n  } else if (tag.isMetaLength()) {\r\n    this.m_metaFinishedOffset = tag.m_value[0] + offset;\r\n  }\r\n  return tag;\r\n  } // getNextTag\r\n  static numberToHexString(val) {\r\n    const str = val.toString(16);\r\n    const len = str.length;\r\n    const numLeadZeros = 4 - len;\r\n    let strZeros = '';\r\n    for (let i = 0; i < numLeadZeros; i++) {\r\n      strZeros += '0';\r\n    }\r\n    const strRes = '0x' + strZeros + str;\r\n    return strRes;\r\n  }\r\n  readFromGoogleBuffer(i, fileName, ratioLoaded, arrBuf, callbackProgress, callbackComplete)\r\n  {\r\n    const dataView = new DataView(arrBuf);\r\n    let fileSize = dataView.byteLength;\r\n    // fileSize = (fileSize) & (~1);\r\n    // console.log(`readFromGoogleBuffer. fileSize = ${fileSize}`);\r\n    // fileSize = (fileSize <= 512) ? fileSize : 512;\r\n\r\n    // const strHeader = LoaderDicom.getStringAt(dataView, 0, 512);\r\n    // console.log(`readFromGoogleBuffer. header = ${strHeader}`);\r\n\r\n    const OFF_CONTENT_TYPE = 64;\r\n    const LEN_CONTENT_TYPE = 32;\r\n    const strCtx = LoaderDicom.getStringAt(dataView, OFF_CONTENT_TYPE, LEN_CONTENT_TYPE);\r\n    const STR_CTX_MATCH = 'Content-Type: application/dicom;';\r\n    const isEqCtxStr = (strCtx === STR_CTX_MATCH);\r\n    if (isEqCtxStr) {\r\n      const SIZE_GOOGLE_HEADER = 136;\r\n      const arrBufWoHead = arrBuf.slice(SIZE_GOOGLE_HEADER);\r\n      const dataViewWoGoogle = new DataView(arrBufWoHead);\r\n      const okRet = this.readFromBuffer(i, fileName, ratioLoaded, arrBufWoHead, callbackProgress, callbackComplete)\r\n      return okRet;\r\n    } else {\r\n      console.log(`readFromGoogleBuffer. bad content type = ${strCtx}`);\r\n      return LoadResult.BAD_HEADER;\r\n    }\r\n  }\r\n  /**\r\n  * Read from local file buffer\r\n  * @param {number} indexFile - index of slice loaded\r\n  * @param {string} fileName - Loaded file\r\n  * @param {number} ratioLoaded - ratio from 0 to 1.0.\r\n  * @param {object} arrBuf - source byte buffer, ArrayBuffer type\r\n  * @return LoadResult.XXX\r\n  */\r\n  readFromBuffer(indexFile, fileName, ratioLoaded, arrBuf, callbackProgress, callbackComplete) {\r\n    if (typeof indexFile !== 'number') {\r\n      console.log('LoaderDicom.readFromBuffer: bad indexFile argument');\r\n    }\r\n    if (typeof fileName !== 'string') {\r\n      console.log('LoaderDicom.readFromBuffer: bad fileName argument');\r\n    }\r\n    if (typeof arrBuf !== 'object') {\r\n      console.log('LoaderDicom.readFromBuffer: bad arrBuf argument');\r\n    }\r\n    // const bufBytes = new Uint8Array(arrBuf);\r\n    // const isUint8Arr = bufBytes instanceof Uint8Array;\r\n    // if (!isUint8Arr) {\r\n    //   console.log('LoaderDicom. readFromBuffer. Error read buffer');\r\n    //   return false;\r\n    // }\r\n\r\n    // console.log(`LoaderDicom. readFromBuffer. file = ${fileName}, ratio = ${ratioLoaded}`);\r\n\r\n    // add info\r\n    const dicomInfo = this.m_dicomInfo;\r\n    const sliceInfo = new DicomSliceInfo();\r\n    const strSlice = 'Slice ' + indexFile.toString();\r\n    sliceInfo.m_sliceName = strSlice;\r\n    sliceInfo.m_fileName = fileName;\r\n    sliceInfo.m_tags = [];\r\n    dicomInfo.m_sliceInfo.push(sliceInfo);\r\n\r\n    const dataView = new DataView(arrBuf);\r\n    if (dataView === null) {\r\n      console.log('No memory');\r\n      return LoadResult.ERROR_NO_MEMORY;\r\n    }\r\n    const fileSize = dataView.byteLength;\r\n    // check dicom header\r\n    const SIZE_HEAD = 144;\r\n    if (fileSize < SIZE_HEAD) {\r\n      // this.m_errors[indexFile] = DICOM_ERROR_TOO_SMALL_FILE;\r\n      this.m_error = LoadResult.ERROR_TOO_SMALL_DATA_SIZE;\r\n      if (callbackComplete !== undefined) {\r\n        callbackComplete(LoadResult.ERROR_TOO_SMALL_DATA_SIZE);\r\n      }\r\n      return LoadResult.ERROR_TOO_SMALL_DATA_SIZE;\r\n    }\r\n    const OFF_MAGIC = 128;\r\n    const SIZE_DWORD = 4;\r\n    const SIZE_SHORT = 2;\r\n    for (let i = 0; i < SIZE_DWORD; i++) {\r\n      const v = dataView.getUint8(OFF_MAGIC + i);\r\n      if (v !== MAGIC_DICM[i]) {\r\n        this.m_errors[indexFile] = DICOM_ERROR_WRONG_HEADER;\r\n        console.log(`Dicom readFromBuffer. Wrong header in file: ${fileName}`);\r\n        if (callbackComplete !== undefined) {\r\n          callbackComplete(LoadResult.WRONG_HEADER_MAGIC);\r\n        }\r\n        return LoadResult.WRONG_HEADER_MAGIC;\r\n      }\r\n    }\r\n    let offset = OFF_MAGIC;\r\n    offset += SIZE_DWORD;\r\n\r\n    //\r\n    this.m_littleEndian = true;\r\n    this.m_explicit = true;\r\n    this.m_metaFound = false;\r\n    this.m_metaFinished = false;\r\n    this.m_metaFinishedOffset = -1;\r\n    this.m_needsDeflate = false;\r\n\r\n    this.m_imageNumber = -1;\r\n    this.m_xDim = -1;\r\n    this.m_yDim = -1;\r\n    this.m_bitsPerPixel = -1;\r\n    this.m_windowCenter = -1;\r\n    this.m_windowWidth = -1;\r\n    let pixelBitMask = 0;\r\n    let pixelPaddingValue = 0;\r\n    let pixelsTagReaded = false;\r\n    let pixelMinValue = -1;\r\n    let pixelMaxValue = -1;\r\n\r\n    // read tag by tag, until image tag\r\n    let tag;\r\n    for (tag = this.getNextTag(dataView, offset); tag !== null;) {\r\n      if (tag.isPixelData()) {\r\n        pixelsTagReaded = true;\r\n        break;\r\n      }\r\n      offset = tag.m_offsetEnd;\r\n      tag = this.getNextTag(dataView, offset);\r\n      if (tag === null) {\r\n        break;\r\n      }\r\n\r\n      // add to tag info\r\n      const dicomInfo = this.m_dicomInfo;\r\n      const numlices = dicomInfo.m_sliceInfo.length;\r\n      const sliceInfo = dicomInfo.m_sliceInfo[numlices - 1];\r\n      const tagInfo = new DicomTagInfo();\r\n      tagInfo.m_tag = '(' + \r\n        LoaderDicom.numberToHexString(tag.m_group) + ',' + \r\n        LoaderDicom.numberToHexString(tag.m_element) + ')';\r\n      const strTagName = this.m_dictionary.getTextDesc(tag.m_group, tag.m_element);\r\n      tagInfo.m_attrName = (strTagName.length > 1) ? strTagName : '';\r\n\r\n      let strVal = LoaderDicom.getAttrValueAsString(tag);\r\n      strVal = (strVal !== null) ? strVal : '';\r\n\r\n      tagInfo.m_attrValue = strVal;\r\n      sliceInfo.m_tags.push(tagInfo);\r\n\r\n      // console.log(`Add tag info. tag = ${tagInfo.m_tag} atNa = ${tagInfo.m_attrName} atVal = ${tagInfo.m_attrValue} `);\r\n\r\n      // get important info from tag: image number\r\n      if ((tag.m_group === TAG_IMAGE_INSTANCE_NUMBER[0]) && (tag.m_element === TAG_IMAGE_INSTANCE_NUMBER[1])) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        const strNum = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n        this.m_imageNumber = parseInt(strNum, 10) - 1;\r\n        if (DEBUG_PRINT_TAGS_INFO) {\r\n          console.log(`Str = ${strNum}, ImageNumber = ${this.m_imageNumber}`);\r\n        }\r\n      }\r\n      // get important tag: image rows\r\n      if ((tag.m_group === TAG_IMAGE_ROWS[0]) && (tag.m_element === TAG_IMAGE_ROWS[1])) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        const yDim = (dataLen === SIZE_SHORT) ?\r\n          dv.getUint16(0, this.m_littleEndian) : dv.getUint32(0, this.m_littleEndian);\r\n        if (DEBUG_PRINT_TAGS_INFO) {\r\n          console.log(`yDim = ${yDim}`);\r\n        }\r\n        if (this.m_yDim < 0) {\r\n          this.m_yDim = yDim;\r\n        } else if (this.m_yDim !== yDim) {\r\n          console.log('Bad image size y');\r\n          if (callbackComplete !== undefined) {\r\n            callbackComplete(LoadResult.WRONG_IMAGE_DIM_Y);\r\n          }\r\n          return LoadResult.WRONG_IMAGE_DIM_Y;\r\n        }\r\n      }\r\n      // get important tag: image cols\r\n      if ((tag.m_group === TAG_IMAGE_COLS[0]) && (tag.m_element === TAG_IMAGE_COLS[1])) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        const xDim = (dataLen === SIZE_SHORT) ?\r\n          dv.getUint16(0, this.m_littleEndian) : dv.getUint32(0, this.m_littleEndian);\r\n        if (DEBUG_PRINT_TAGS_INFO) {\r\n          console.log(`xDim = ${xDim}`);\r\n        }\r\n        if (this.m_xDim < 0) {\r\n          this.m_xDim = xDim;\r\n        } else if (this.m_xDim !== xDim) {\r\n          console.log('Bad image size x');\r\n          if (callbackComplete !== undefined) {\r\n            callbackComplete(LoadResult.WRONG_IMAGE_DIM_X);\r\n          }\r\n          return LoadResult.WRONG_IMAGE_DIM_X;\r\n        }\r\n      }\r\n      // get important tag: bits allocated\r\n      if ((tag.m_group === TAG_BITS_ALLOCATED[0]) && (tag.m_element === TAG_BITS_ALLOCATED[1])) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        this.m_bitsPerPixel = (dataLen === SIZE_SHORT) ?\r\n          dv.getUint16(0, this.m_littleEndian) : dv.getUint32(0, this.m_littleEndian);\r\n        if (DEBUG_PRINT_TAGS_INFO) {\r\n          console.log(`bitsPerPixel = ${this.m_bitsPerPixel}`);\r\n        }\r\n      }\r\n\r\n      // window center\r\n      if ((tag.m_group === TAG_WINDOW_CENTER[0]) && (tag.m_element === TAG_WINDOW_CENTER[1])) {\r\n        if ((tag.m_value != null) && (tag.m_value.byteLength > 0)) {\r\n          const dataLen = tag.m_value.byteLength;\r\n          const dv = new DataView(tag.m_value);\r\n          const strNum = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n          this.m_windowCenter = parseInt(strNum, 10);\r\n          if (DEBUG_PRINT_TAGS_INFO) {\r\n            console.log(`Str = ${strNum}, WindowCenter = ${this.m_windowCenter}`);\r\n          }\r\n        } // if non zero data\r\n      } // window center\r\n      \r\n      // window width\r\n      if ((tag.m_group === TAG_WINDOW_WIDTH[0]) && (tag.m_element === TAG_WINDOW_WIDTH[1])) {\r\n        if ((tag.m_value != null) && (tag.m_value.byteLength > 0)) {\r\n          const dataLen = tag.m_value.byteLength;\r\n          const dv = new DataView(tag.m_value);\r\n          const strNum = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n          this.m_windowWidth = parseInt(strNum, 10);\r\n          if (DEBUG_PRINT_TAGS_INFO) {\r\n            console.log(`Str = ${strNum}, WindowWidth = ${this.m_windowWidth}`);\r\n          }\r\n        } // if non zero data\r\n      } // window width\r\n\r\n      // rescale intercept\r\n      if ((tag.m_group === TAG_RESCALE_INTERCEPT[0]) && (tag.m_element === TAG_RESCALE_INTERCEPT[1])) {\r\n        if ((tag.m_value != null) && (tag.m_value.byteLength > 0)) {\r\n          const dataLen = tag.m_value.byteLength;\r\n          const dv = new DataView(tag.m_value);\r\n          const strNum = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n          this.m_rescaleIntercept = parseInt(strNum, 10);\r\n          if (DEBUG_PRINT_TAGS_INFO) {\r\n            console.log(`Str = ${strNum}, RescaleIntercept = ${this.m_rescaleIntercept}`);\r\n          }\r\n        } // if non zero data\r\n      } // rescale intercept\r\n\r\n      // rescale slope\r\n      if ((tag.m_group === TAG_RESCALE_SLOPE[0]) && (tag.m_element === TAG_RESCALE_SLOPE[1])) {\r\n        if ((tag.m_value != null) && (tag.m_value.byteLength > 0)) {\r\n          const dataLen = tag.m_value.byteLength;\r\n          const dv = new DataView(tag.m_value);\r\n          const strNum = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n          this.m_rescaleSlope = parseInt(strNum, 10);\r\n          if (DEBUG_PRINT_TAGS_INFO) {\r\n            console.log(`Str = ${strNum}, RescaleSlope = ${this.m_rescaleSlope}`);\r\n          }\r\n        } // if non zero data\r\n      } // rescale slope\r\n\r\n      // rescale type\r\n      if ((tag.m_group === TAG_RESCALE_TYPE[0]) && (tag.m_element === TAG_RESCALE_TYPE[1])) {\r\n        if ((tag.m_value != null) && (tag.m_value.byteLength > 0)) {\r\n          const dataLen = tag.m_value.byteLength;\r\n          const dv = new DataView(tag.m_value);\r\n          const strVal = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n          if (strVal === 'HU') {\r\n            this.m_rescaleHounsfield = true;  \r\n          }\r\n          if (DEBUG_PRINT_TAGS_INFO) {\r\n            console.log(`Str = ${strNum}, RescaleType = ${this.m_rescaleHounsfield}`);\r\n          }\r\n        } // if non zero data\r\n      } // rescale type\r\n\r\n      // pixel representation\r\n      if ((tag.m_group === TAG_PIXEL_REPRESENTATION[0]) && (tag.m_element === TAG_PIXEL_REPRESENTATION[1])) {\r\n        if ((tag.m_value != null) && (tag.m_value.byteLength > 0)) {\r\n          const dataLenPixRep = tag.m_value.byteLength;\r\n          const dvPixRep = new DataView(tag.m_value);\r\n          const pixRep = (dataLenPixRep === SIZE_SHORT) ?\r\n            dvPixRep.getUint16(0, this.m_littleEndian) : dvPixRep.getUint32(0, this.m_littleEndian);\r\n          if (pixRep === 1) {\r\n            this.m_pixelRepresentaionSigned = true;\r\n          }\r\n          if (DEBUG_PRINT_TAGS_INFO) {\r\n            console.log(`Str = ${strNum}, Pixel representation is signed = ${this.m_pixelRepresentaionSigned}`);\r\n          }\r\n        } // if non zero data\r\n      } // rescale slope\r\n\r\n      // get series number\r\n      if ((tag.m_group === TAG_SERIES_NUMBER[0]) && (tag.m_element === TAG_SERIES_NUMBER[1])) {\r\n        if ((tag.m_value != null) && (tag.m_value.byteLength > 0)) {\r\n          const dataLen = tag.m_value.byteLength;\r\n          const dv = new DataView(tag.m_value);\r\n          const strNum = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n          this.m_seriesNumber = parseInt(strNum, 10);\r\n          if (DEBUG_PRINT_TAGS_INFO) {\r\n            console.log(`Str = ${strNum}, SeriesNumber = ${this.m_seriesNumber}`);\r\n          }\r\n        } // if non zero data\r\n      } // series number\r\n\r\n      // get important tag: series description\r\n      if ((tag.m_group === TAG_SERIES_DESCRIPTION[0]) && (tag.m_element === TAG_SERIES_DESCRIPTION[1]) &&\r\n        (tag.m_value !== null)) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        this.m_seriesDescr = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n        if (DEBUG_PRINT_TAGS_INFO) {\r\n          console.log(`Series description = ${this.m_seriesDescr}`);\r\n        }\r\n      }\r\n      // get important tag: hight bit\r\n      if ((tag.m_group === TAG_IMAGE_HIGH_BIT[0]) && (tag.m_element === TAG_IMAGE_HIGH_BIT[1])) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        const highBit = (dataLen === SIZE_SHORT) ?\r\n          dv.getUint16(0, this.m_littleEndian) : dv.getUint32(0, this.m_littleEndian);\r\n        pixelBitMask = (1 << (highBit + 1)) - 1;\r\n        if (DEBUG_PRINT_TAGS_INFO) {\r\n          console.log(`highBit = ${highBit}`);\r\n        }\r\n      }\r\n\r\n      // get important tag: min pixel value\r\n      if ((tag.m_group === TAG_IMAGE_SMALL_PIX_VAL[0]) && (tag.m_element === TAG_IMAGE_SMALL_PIX_VAL[1])) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        pixelMinValue = (dataLen === SIZE_SHORT) ?\r\n          dv.getInt16(0, this.m_littleEndian) : dv.getInt32(0, this.m_littleEndian);\r\n        if (DEBUG_PRINT_TAGS_INFO) {\r\n          console.log(`pixelMinValue = ${pixelMinValue}`);\r\n        }\r\n      }\r\n\r\n      // get important tag: max pixel value\r\n      if ((tag.m_group === TAG_IMAGE_LARGE_PIX_VAL[0]) && (tag.m_element === TAG_IMAGE_LARGE_PIX_VAL[1])) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        pixelMaxValue = (dataLen === SIZE_SHORT) ?\r\n          dv.getInt16(0, this.m_littleEndian) : dv.getInt32(0, this.m_littleEndian);\r\n        if (DEBUG_PRINT_TAGS_INFO) {\r\n          console.log(`pixelMaxValue = ${pixelMaxValue}`);\r\n        }\r\n      }\r\n\r\n      // get important tag: pixel padding value\r\n      if ((tag.m_group === TAG_PIXEL_PADDING_VALUE[0]) && (tag.m_element === TAG_PIXEL_PADDING_VALUE[1])) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        pixelPaddingValue = (dataLen === SIZE_SHORT) ?\r\n          dv.getUint16(0, this.m_littleEndian) : dv.getUint32(0, this.m_littleEndian);\r\n        this.m_padValue = pixelPaddingValue;\r\n        if (DEBUG_PRINT_TAGS_INFO) {\r\n          console.log(`pixelPaddingValue = ${pixelPaddingValue}`);\r\n        }\r\n      }\r\n      // get important tag: pixel spacing in 2d (xy)\r\n      if ((tag.m_group === TAG_PIXEL_SPACING[0]) && (tag.m_element === TAG_PIXEL_SPACING[1])) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        const strPixelSpacing = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n        const strArr = strPixelSpacing.split('\\\\');\r\n        if (strArr.length === SIZE_SHORT) {\r\n          this.m_pixelSpacing.x = parseFloat(strArr[0]);\r\n          this.m_pixelSpacing.y = parseFloat(strArr[1]);\r\n          if (DEBUG_PRINT_TAGS_INFO) {\r\n            console.log(`TAG. pixel spacing xy = ${this.m_pixelSpacing.x} * ${this.m_pixelSpacing.y}`);\r\n          }\r\n        }\r\n      }\r\n      // get important tag: image position (x,y,z)\r\n      if ((tag.m_group === TAG_IMAGE_POSITION[0]) && (tag.m_element === TAG_IMAGE_POSITION[1])) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        const strImagePosition = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n        const strArr = strImagePosition.split('\\\\');\r\n        const NUM_COMPONENTS_3 = 3;\r\n        if (strArr.length === NUM_COMPONENTS_3) {\r\n          // eslint-disable-next-line\r\n          const xPos = parseFloat(strArr[0]);\r\n          // eslint-disable-next-line\r\n          const yPos = parseFloat(strArr[1]);\r\n          // eslint-disable-next-line\r\n          const zPos = parseFloat(strArr[2]);\r\n          this.m_imagePosMin.x = (xPos < this.m_imagePosMin.x) ? xPos : this.m_imagePosMin.x;\r\n          this.m_imagePosMin.y = (yPos < this.m_imagePosMin.y) ? yPos : this.m_imagePosMin.y;\r\n          this.m_imagePosMin.z = (zPos < this.m_imagePosMin.z) ? zPos : this.m_imagePosMin.z;\r\n          this.m_imagePosMax.x = (xPos > this.m_imagePosMax.x) ? xPos : this.m_imagePosMax.x;\r\n          this.m_imagePosMax.y = (yPos > this.m_imagePosMax.y) ? yPos : this.m_imagePosMax.y;\r\n          this.m_imagePosMax.z = (zPos > this.m_imagePosMax.z) ? zPos : this.m_imagePosMax.z;\r\n          if (DEBUG_PRINT_TAGS_INFO) {\r\n            console.log(`TAG. image position x,y,z = ${xPos}, ${yPos}, ${zPos}`);\r\n          }\r\n        }\r\n      }\r\n\r\n      // slice thickness\r\n      if ((tag.m_group === TAG_SLICE_THICKNESS[0]) && (tag.m_element === TAG_SLICE_THICKNESS[1])) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        const strSliceThickness = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n        this.m_pixelSpacing.z = parseFloat(strSliceThickness);\r\n        if (DEBUG_PRINT_TAGS_INFO) {\r\n          console.log(`TAG. slice thickness = ${this.m_pixelSpacing.z}`);\r\n        }\r\n      }\r\n\r\n      // get important tag: slice location (x,y,z)\r\n      if ((tag.m_group === TAG_SLICE_LOCATION[0]) && (tag.m_element === TAG_SLICE_LOCATION[1])) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        const strSliceLocation = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n        const sliceLoc = parseFloat(strSliceLocation);\r\n        this.m_sliceLocation = sliceLoc;\r\n        this.m_sliceLocMin = (sliceLoc < this.m_sliceLocMin) ? sliceLoc : this.m_sliceLocMin;\r\n        this.m_sliceLocMax = (sliceLoc > this.m_sliceLocMax) ? sliceLoc : this.m_sliceLocMax;\r\n        if (DEBUG_PRINT_TAGS_INFO) {\r\n          console.log(`TAG. Slice location = ${this.m_sliceLocation}`);\r\n        }\r\n      }\r\n\r\n      // get important tag: samples per pixel\r\n      if ((tag.m_group === TAG_SAMPLES_PER_PIXEL[0]) && (tag.m_element === TAG_SAMPLES_PER_PIXEL[1])) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        this.m_samplesPerPixel = (dataLen === SIZE_SHORT) ?\r\n          dv.getUint16(0, this.m_littleEndian) : dv.getUint32(0, this.m_littleEndian);\r\n        if (DEBUG_PRINT_TAGS_INFO) {\r\n          console.log(`samplesPerPixel = ${this.m_samplesPerPixel}`);\r\n        }\r\n      }\r\n\r\n      // dicom info\r\n      if ((tag.m_group === TAG_SERIES_DESCRIPTION[0]) && (tag.m_element === TAG_SERIES_DESCRIPTION[1]) &&\r\n        (tag.m_value !== null)) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        const strDescr = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n        // console.log(`DicomLoader. Series descr read = ${strDescr}`);\r\n        this.m_dicomInfo.m_seriesDescr = strDescr;\r\n      }\r\n      if ((tag.m_group === TAG_SERIES_TIME[0]) && (tag.m_element === TAG_SERIES_TIME[1]) &&\r\n        (tag.m_value !== null)) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        const strTimeMerged = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n        // eslint-disable-next-line\r\n        const strHour = strTimeMerged.substring(0, 2);\r\n        // eslint-disable-next-line\r\n        const strMinute = strTimeMerged.substring(2, 4);\r\n        // eslint-disable-next-line\r\n        const strSec = strTimeMerged.substring(4, strTimeMerged.length);\r\n        const strTimeBuild = `${strHour}:${strMinute}:${strSec}`;\r\n        // console.log(`Series time read = ${strTimeBuild}`);\r\n        this.m_dicomInfo.m_seriesTime = strTimeBuild;\r\n        if (DEBUG_PRINT_TAGS_INFO) {\r\n          console.log(`Series time = ${this.m_dicomInfo.m_seriesTime}`);\r\n        }\r\n      }\r\n      if ((tag.m_group === TAG_PATIENT_NAME[0]) && (tag.m_element === TAG_PATIENT_NAME[1]) &&\r\n        (tag.m_value !== null)) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        this.m_dicomInfo.m_patientName = LoaderDicom.getUtf8StringAt(dv, 0, dataLen);\r\n        this.m_dicomInfo.m_patientName = this.m_dicomInfo.m_patientName.trim();\r\n        //console.log(`m_patientName = ${this.m_dicomInfo.m_patientName}`);\r\n      }\r\n      if ((tag.m_group === TAG_PATIENT_ID[0]) && (tag.m_element === TAG_PATIENT_ID[1]) &&\r\n        (tag.m_value !== null)) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        this.m_dicomInfo.m_patientId = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n        // console.log(`m_patientId = ${this.m_dicomInfo.m_patientId}`);\r\n      }\r\n      if ((tag.m_group === TAG_PATIENT_GENDER[0]) && (tag.m_element === TAG_PATIENT_GENDER[1]) &&\r\n        (tag.m_value !== null)) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        this.m_dicomInfo.m_patientGender = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n        // console.log(`m_patientGender = ${this.m_dicomInfo.m_patientGender}`);\r\n      }\r\n      if ((tag.m_group === TAG_PATIENT_BIRTH_DATE[0]) && (tag.m_element === TAG_PATIENT_BIRTH_DATE[1]) &&\r\n        (tag.m_value !== null)) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        const strDateMerged = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n        // eslint-disable-next-line\r\n        const strY = strDateMerged.substring(0, 4);\r\n        // eslint-disable-next-line\r\n        const strM = strDateMerged.substring(4, 6);\r\n        // eslint-disable-next-line\r\n        const strD = strDateMerged.substring(6);\r\n        this.m_dicomInfo.m_patientDateOfBirth = `${strD}/${strM}/${strY}`;\r\n        // console.log(`m_patientDateOfBirth = ${this.m_dicomInfo.m_patientDateOfBirth}`);\r\n      }\r\n      if ((tag.m_group === TAG_STUDY_DATE[0]) && (tag.m_element === TAG_STUDY_DATE[1]) &&\r\n        (tag.m_value !== null)) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        const strDateMerged = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n        // eslint-disable-next-line\r\n        const strY = strDateMerged.substring(0, 4);\r\n        // eslint-disable-next-line\r\n        const strM = strDateMerged.substring(4, 6);\r\n        // eslint-disable-next-line\r\n        const strD = strDateMerged.substring(6);\r\n        this.m_dicomInfo.m_studyDate = `${strD}/${strM}/${strY}`;\r\n        // console.log(`m_studyDate = ${this.m_dicomInfo.m_studyDate}`);\r\n      }\r\n      if ((tag.m_group === TAG_STUDY_DESCR[0]) && (tag.m_element === TAG_STUDY_DESCR[1]) &&\r\n        (tag.m_value !== null)) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        const strDescr = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n        this.m_dicomInfo.m_studyDescr = strDescr;\r\n        this.m_dicomInfo.m_studyDescr = this.m_dicomInfo.m_studyDescr.trim();\r\n        // console.log(`m_studyDescr = ${this.m_dicomInfo.m_studyDescr}`);\r\n      }\r\n      if ((tag.m_group === TAG_BODY_PART_EXAMINED[0]) && (tag.m_element === TAG_BODY_PART_EXAMINED[1]) &&\r\n        (tag.m_value !== null)) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        this.m_dicomInfo.m_bodyPartExamined = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n        // console.log(`m_patientName = ${this.m_dicomInfo.m_patientName}`);\r\n      }\r\n\r\n\r\n      if ((tag.m_group === TAG_ACQUISION_TIME[0]) && (tag.m_element === TAG_ACQUISION_TIME[1]) &&\r\n        (tag.m_value !== null)) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        this.m_dicomInfo.m_acquisionTime = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n        // console.log(`m_acquisionTime = ${this.m_dicomInfo.m_acquisionTime}`);\r\n      }\r\n      if ((tag.m_group === TAG_INSTITUTION_NAME[0]) && (tag.m_element === TAG_INSTITUTION_NAME[1]) &&\r\n        (tag.m_value !== null)) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        this.m_dicomInfo.m_institutionName = LoaderDicom.getUtf8StringAt(dv, 0, dataLen);\r\n        this.m_dicomInfo.m_institutionName = this.m_dicomInfo.m_institutionName.trim();\r\n        // console.log(`m_institutionName = ${this.m_dicomInfo.m_institutionName}`);\r\n      }\r\n\r\n      if ((tag.m_group === TAG_OPERATORS_NAME[0]) && (tag.m_element === TAG_OPERATORS_NAME[1]) &&\r\n      (tag.m_value !== null)) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        this.m_dicomInfo.m_operatorsName = LoaderDicom.getUtf8StringAt(dv, 0, dataLen);\r\n        this.m_dicomInfo.m_operatorsName = this.m_dicomInfo.m_operatorsName.trim();\r\n        // console.log(`m_operatorsName = ${this.m_dicomInfo.m_operatorsName}`);\r\n      }\r\n      if ((tag.m_group === TAG_PHYSICANS_NAME[0]) && (tag.m_element === TAG_PHYSICANS_NAME[1]) &&\r\n        (tag.m_value !== null)) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        this.m_dicomInfo.m_physicansName = LoaderDicom.getUtf8StringAt(dv, 0, dataLen);\r\n        this.m_dicomInfo.m_physicansName = this.m_dicomInfo.m_physicansName.trim();\r\n        // console.log(`m_physicansName = ${this.m_dicomInfo.m_physicansName}`);\r\n      }\r\n      if ((tag.m_group === TAG_MANUFACTURER_NAME[0]) && (tag.m_element === TAG_MANUFACTURER_NAME[1]) &&\r\n        (tag.m_value !== null)) {\r\n        const dataLen = tag.m_value.byteLength;\r\n        const dv = new DataView(tag.m_value);\r\n        this.m_dicomInfo.m_manufacturerName = LoaderDicom.getStringAt(dv, 0, dataLen);\r\n        this.m_dicomInfo.m_manufacturerName = this.m_dicomInfo.m_manufacturerName.trim();\r\n        // console.log(`m_manufacturerName = ${this.m_dicomInfo.m_manufacturerName}`);\r\n      }\r\n    } // for all tags readed\r\n    if (!pixelsTagReaded) {\r\n      if (callbackComplete !== undefined) {\r\n        callbackComplete(LoadResult.ERROR_PIXELS_TAG_NOT_FOUND);\r\n      }\r\n      return LoadResult.ERROR_PIXELS_TAG_NOT_FOUND;\r\n    }\r\n    // check transform syntax\r\n    if (this.m_transformSyntax.length > 1) {\r\n      // const decoder = new jpeg.lossless.Decoder();\r\n      // const outBuffer = decoder.decompress(tag.m_value);\r\n      if (callbackComplete !== undefined) {\r\n        callbackComplete(LoadResult.ERROR_COMPRESSED_IMAGE_NOT_SUPPORTED);\r\n      }\r\n      return LoadResult.ERROR_COMPRESSED_IMAGE_NOT_SUPPORTED;\r\n    }\r\n\r\n    // check correct data from tags\r\n    const BITS_IN_BYTE = 8;\r\n    const imageSizeBytes = Math.floor(this.m_xDim * this.m_yDim * (this.m_bitsPerPixel / BITS_IN_BYTE) * this.m_samplesPerPixel);\r\n    if ((imageSizeBytes !== tag.m_value.byteLength) || (pixelBitMask === 0)) {\r\n      console.log(`Wrong image pixels size. Readed ${tag.m_value.byteLength}, but expected ${imageSizeBytes}`);\r\n      if (callbackComplete !== undefined) {\r\n        callbackComplete(LoadResult.ERROR_COMPRESSED_IMAGE_NOT_SUPPORTED);\r\n      }\r\n      return LoadResult.WRONG_HEADER_DATA_SIZE;\r\n    }\r\n\r\n    const numPixels = this.m_xDim * this.m_yDim;\r\n    // const volSlice = this.m_slicesVolume.getNewSlice();\r\n    const volSlice = new DicomSlice();\r\n    if (volSlice === null) {\r\n      console.log('No memory');\r\n      return LoadResult.ERROR_NO_MEMORY;\r\n    }\r\n\r\n    if (this.m_pixelRepresentaionSigned) {\r\n      volSlice.m_image = new Int16Array(numPixels);\r\n    } else {\r\n      volSlice.m_image = new Uint16Array(numPixels);\r\n    }\r\n    if (volSlice.m_image === null) {\r\n      console.log('No memory');\r\n      return LoadResult.ERROR_NO_MEMORY;\r\n    }\r\n    volSlice.m_sliceNumber = this.m_imageNumber;\r\n    volSlice.m_sliceLocation = this.m_sliceLocation;\r\n    volSlice.m_patientName = this.m_dicomInfo.m_patientName;\r\n    volSlice.m_studyDescr = this.m_dicomInfo.m_studyDescr;\r\n    volSlice.m_studyDate = this.m_dicomInfo.m_studyDate;\r\n    volSlice.m_seriesTime = this.m_dicomInfo.m_seriesTime;\r\n    volSlice.m_seriesDescr = this.m_dicomInfo.m_seriesDescr;\r\n    volSlice.m_bodyPartExamined = this.m_dicomInfo.m_bodyPartExamined;\r\n    volSlice.m_institutionName = this.m_dicomInfo.m_institutionName;\r\n    volSlice.m_operatorsName = this.m_dicomInfo.m_operatorsName;\r\n    volSlice.m_physicansName = this.m_dicomInfo.m_physicansName;\r\n    volSlice.buildHash();\r\n\r\n    volSlice.m_xDim = this.m_xDim;\r\n    volSlice.m_yDim = this.m_yDim;\r\n\r\n    // console.log(`patName = ${volSlice.m_patientName}`);\r\n    // console.log(`studyDescr = ${volSlice.m_studyDescr}`);\r\n    // console.log(`studyDate = ${volSlice.m_studyDate}`);\r\n    // console.log(`seriesTime = ${volSlice.m_seriesTime}`);\r\n    // console.log(`seriesDescr = ${volSlice.m_seriesDescr}`);\r\n    // console.log(`bodyPartExamined = ${volSlice.m_bodyPartExamined}`);\r\n\r\n    \r\n\r\n    // Fill slice image\r\n    // const imageDst = this.m_slices[this.m_imageNumber];\r\n    const imageDst = volSlice.m_image;\r\n    const imageSrc = new DataView(tag.m_value);\r\n    if (imageSrc === null) {\r\n      console.log('No memory');\r\n      return LoadResult.ERROR_NO_MEMORY;\r\n    }\r\n\r\n    const BITS_8 = 8;\r\n    const BITS_16 = 16;\r\n    const NUM_1 = 1;\r\n    const NUM_3 = 3;\r\n\r\n    let i;\r\n    if (this.m_bitsPerPixel === BITS_8) {\r\n      if (this.m_samplesPerPixel === NUM_1) {\r\n        for (i = 0; i < numPixels; i++) {\r\n          const val = imageSrc.getUint8(i);\r\n          imageDst[i] = val;\r\n        }\r\n          // if 1 sample per pixel\r\n      } else if (this.m_samplesPerPixel === NUM_3) {\r\n        // if 3 samples per pixel\r\n        let j = 0;\r\n        for (i = 0; i < numPixels; i++, j += 3) {\r\n          const b0 = imageSrc.getUint8(j + 0);\r\n          const b1 = imageSrc.getUint8(j + 1);\r\n          const b2 = imageSrc.getUint8(j + 2);\r\n          // assert(b0 < 256);\r\n          // assert(b1 < 256);\r\n          // assert(b2 < 256);\r\n          imageDst[i] = Math.floor((b0 + b1 + b2) / 3);\r\n        }\r\n      }\r\n    } else if (this.m_bitsPerPixel === BITS_16) {\r\n      let i2 = 0;\r\n      for (i = 0; i < numPixels; i++) {\r\n        let val = imageSrc.getUint16(i2, this.m_littleEndian);\r\n        i2 += SIZE_SHORT;\r\n        imageDst[i] = val;\r\n      } // end for i pixels\r\n    } else { // if 16 bpp\r\n      console.log('TODO: need to implement reading non-8 and non-16 bit dicom images');\r\n    }\r\n    this.m_error = DICOM_ERROR_OK;\r\n\r\n    // add volume slice to slices volume (and manage series)\r\n    this.m_slicesVolume.addSlice(volSlice);\r\n\r\n    // console.log(`Dicom read OK. Volume pixels = ${this.m_xDim} * ${this.m_yDim} * ${this.m_zDim}`);\r\n    if (callbackComplete !== undefined) {\r\n      callbackComplete(LoadResult.SUCCESS);\r\n    }\r\n    return LoadResult.SUCCESS;\r\n  } // end readFromBuffer\r\n\r\n  readFromUrl(volSet, strUrl, callbackProgress, callbackComplete) {\r\n    // check arguments\r\n    console.assert(volSet != null, \"Null volume\");\r\n    console.assert(volSet instanceof VolumeSet, \"Should be volume set\");\r\n    console.assert(strUrl != null, \"Null string url\");\r\n    \r\n    // console.log(`typeof(strUrl) - ${typeof(strUrl)}`);\r\n    console.assert(typeof(strUrl) === 'string', \"Should be string in url\");\r\n    \r\n    // replace file name to 'file_list.txt'\r\n    const ft = new FileTools();\r\n    const isValidUrl = ft.isValidUrl(strUrl);\r\n    if (!isValidUrl) {\r\n      console.log(`readFromUrl: not vaild URL = = ${strUrl} `);\r\n      return false;\r\n    }\r\n    this.m_folder = ft.getFolderNameFromUrl(strUrl);\r\n    const urlFileList = this.m_folder + '/file_list.txt';\r\n    console.log(`readFromUrl: load file = ${urlFileList} `);\r\n\r\n    const fileLoader = new FileLoader(urlFileList);\r\n    this.m_callbackComplete = callbackComplete;\r\n    this.m_callbackProgress = callbackProgress;\r\n    this.m_fileListCounter = 0;\r\n    fileLoader.readFile((arrBuf) => {\r\n      this.m_fileListCounter += 1;\r\n      if (this.m_fileListCounter === 1) {\r\n        const okRead = this.readReadyFileList(volSet, arrBuf, callbackProgress, callbackComplete);\r\n        return okRead;\r\n      }\r\n      return true;\r\n    }, (errMsg) => {\r\n      console.log(`Error read file: ${errMsg}`);\r\n      callbackComplete(LoadResult.ERROR_CANT_OPEN_URL, null, 0, null);\r\n      return false;\r\n    }); // get file from server\r\n    return true;\r\n  }\r\n  readReadyFileList(volSet, arrBuf, callbackProgress, callbackComplete) {\r\n    // check arguments\r\n    console.assert(volSet != null, \"Null volume\");\r\n    console.assert(volSet instanceof VolumeSet, \"Should be volume set\");\r\n    console.assert(arrBuf != null, \"Null array\");\r\n    console.assert(arrBuf.constructor.name === \"ArrayBuffer\", \"Should be ArrayBuf in arrBuf\");\r\n\r\n    const uint8Arr = new Uint8Array(arrBuf);\r\n    // const strFileContent = new TextDecoder('utf-8').decode(uint8Arr);\r\n    const strFileContent = String.fromCharCode.apply(null, uint8Arr);\r\n\r\n    const LEN_LOG = 64;\r\n    const strLog = strFileContent.substr(0, LEN_LOG);\r\n    console.log(`Loaded file list. Started with:  ${strLog} ...`);\r\n\r\n    const arrFileNames = strFileContent.split('\\n');\r\n\r\n    let numFiles = arrFileNames.length;\r\n    // check last empty elements\r\n    const MIN_FILE_NAME_SIZE = 4;\r\n    for (let i = numFiles - 1; i >= 0; i--) {\r\n      if (arrFileNames[i].endsWith('\\r')) {\r\n        arrFileNames[i] = arrFileNames[i].substring(0, arrFileNames[i].length - 1);\r\n      }\r\n      if (arrFileNames[i].length < MIN_FILE_NAME_SIZE) {\r\n        arrFileNames.pop();\r\n      }\r\n    }\r\n    numFiles = arrFileNames.length;\r\n\r\n    this.m_zDim = numFiles;\r\n    console.log(`Loaded file list. ${numFiles} files will be loaded. 1st file in list is = ${arrFileNames[0]}`);\r\n    console.log(`Loaded file list. Last file in list is = ${arrFileNames[numFiles - 1]}`);\r\n\r\n    // declare slices array\r\n    for (let i = 0; i < numFiles; i++) {\r\n      // this.m_slices[i] = null;\r\n      this.m_errors[i] = -1;\r\n      this.m_loaders[i] = null;\r\n    }\r\n\r\n    // physical dimension\r\n    this.m_pixelSpacing = {\r\n      x: 0.0,\r\n      y: 0.0,\r\n      z: 0.0,\r\n    };\r\n    this.m_filesLoadedCounter = 0;\r\n    this.m_numFailsLoad = 0;\r\n    this.m_numLoadedFiles = numFiles;\r\n\r\n    this.m_imagePosMin = {\r\n      // eslint-disable-next-line\r\n      x: +1.0e12,\r\n      // eslint-disable-next-line\r\n      y: +1.0e12,\r\n      // eslint-disable-next-line\r\n      z: +1.0e12\r\n    };\r\n    this.m_imagePosMax = {\r\n      // eslint-disable-next-line\r\n      x: -1.0e12,\r\n      // eslint-disable-next-line\r\n      y: -1.0e12,\r\n      // eslint-disable-next-line\r\n      z: -1.0e12\r\n    };\r\n\r\n    // eslint-disable-next-line\r\n    this.m_sliceLocMin = +1.0e12;\r\n    // eslint-disable-next-line\r\n    this.m_sliceLocMax = -1.0e12;\r\n\r\n    for (let i = 0; (i < this.m_numLoadedFiles) && (this.m_numFailsLoad < 1); i++) {\r\n      const urlFile = `${this.m_folder}/${arrFileNames[i]}`;\r\n      // console.log(`Loading (${i})-th url: ${urlFile}`);\r\n      this.m_loaders[i] = new FileLoader(urlFile);\r\n      const loader = this.m_loaders[i];\r\n      const NOT_FROM_GOOGLE = false;\r\n      // let volDst = volSet.getVolume(0);\r\n      //if (volDst === null) {\r\n      //  volDst = new Volume();\r\n      //  volSet.addVolume(volDst);\r\n      // } \r\n      const okLoader = this.runLoader(volSet, arrFileNames[i], loader, i, callbackProgress, callbackComplete, NOT_FROM_GOOGLE);\r\n      if (!okLoader) {\r\n        return false;\r\n      }\r\n    }  // for i all files-slices in folder\r\n    return true;\r\n  } // end readReadyFileList(arrBuf)\r\n  /**\r\n  * Run loader to read dicom file\r\n  * @param {object} volSet - destination volum set\r\n  * @param {string} fileName - File to read\r\n  * @param {object} loader - loader object with file inside\r\n  * @param {number} i - index of file in files array\r\n  * @param {func} callbackProgress - callback for continiuos load reporting\r\n  * @param {func} callbackComplete - callback after load finish\r\n  * @param {bool} fromGoogle - true, if from google store\r\n  *\r\n  */\r\n  runLoader(volSet, fileName, loader, i, callbackProgress, callbackComplete, fromGoogle) {\r\n    this.m_fromGoogle = fromGoogle;\r\n    // console.log(`Loading url: ${fileName}`);\r\n    loader.readFile((fileArrBu) => {\r\n      const ratioLoaded = this.m_filesLoadedCounter / this.m_numLoadedFiles;\r\n      const VAL_MASK = 7;\r\n      if ((callbackProgress !== undefined) && ((this.m_filesLoadedCounter & VAL_MASK) === 0)) {\r\n        callbackProgress(ratioLoaded);\r\n      }\r\n      if ((callbackProgress !== undefined) &&\r\n        (this.m_filesLoadedCounter + 1 === this.m_numLoadedFiles)) {\r\n        callbackProgress(1.0);\r\n      }\r\n      this.m_newTagEvent.detail.fileName = fileName;\r\n\r\n      let status;\r\n      if (this.m_fromGoogle) {\r\n        status = this.readFromGoogleBuffer(i, fileName, ratioLoaded, fileArrBu, callbackProgress, callbackComplete);\r\n      } else {\r\n        status = this.readFromBuffer(i, fileName, ratioLoaded, fileArrBu, callbackProgress, callbackComplete);\r\n      }\r\n\r\n      if ((status !== LoadResult.SUCCESS) && (this.m_numFailsLoad === 0)) {\r\n        this.m_numFailsLoad += 1;\r\n        if (callbackComplete !== null) {\r\n          callbackComplete(status, null, 0, null, fileName);\r\n          return false;\r\n        }\r\n      }\r\n      // update total files counter\r\n      this.m_filesLoadedCounter += 1;\r\n      if (DEBUG_PRINT_INDI_SLICE_INFO) {\r\n        console.log(`Loaded local indi slice: ${fileName}. Total loaded slices: ${this.m_filesLoadedCounter}`);\r\n      }\r\n      // console.log(`!!!!!!!!! m_filesLoadedCounter = ${this.m_filesLoadedCounter} / ${this.m_numLoadedFiles}`);\r\n\r\n      if (this.m_filesLoadedCounter === this.m_numLoadedFiles) {\r\n        // Finalize physic dimension\r\n        if (DEBUG_PRINT_TAGS_INFO) {\r\n          console.log(`slice location (min, max) = ${this.m_sliceLocMin}, ${this.m_sliceLocMax}`);\r\n        }\r\n        const imagePosBox = {\r\n          x: this.m_imagePosMax.x - this.m_imagePosMin.x,\r\n          y: this.m_imagePosMax.y - this.m_imagePosMin.y,\r\n          z: this.m_imagePosMax.z - this.m_imagePosMin.z\r\n        };\r\n        const TOO_MIN = 0.00001;\r\n        let zBox;\r\n        if (Math.abs(this.m_pixelSpacing.z) > TOO_MIN) {\r\n          zBox = this.m_pixelSpacing.z * this.m_zDim;\r\n        } else {\r\n          zBox = imagePosBox.z;\r\n          if (Math.abs(zBox) < TOO_MIN) {\r\n            zBox = imagePosBox.x;\r\n            if (Math.abs(zBox) < TOO_MIN) {\r\n              zBox = imagePosBox.y;\r\n            }\r\n          }\r\n        } // if pixel spacing 0\r\n        if (zBox < TOO_MIN) {\r\n          zBox = 1.0;\r\n        }\r\n\r\n        this.m_pixelSpacing.z = zBox / this.m_zDim;\r\n        this.m_boxSize.z = this.m_zDim * this.m_pixelSpacing.z;\r\n        this.m_boxSize.x = this.m_xDim * this.m_pixelSpacing.x;\r\n        this.m_boxSize.y = this.m_yDim * this.m_pixelSpacing.y;\r\n        console.log(`Volume local phys dim: ${this.m_boxSize.x} * ${this.m_boxSize.y} * ${this.m_boxSize.z}`);\r\n        // TODO: add hash\r\n        let series = this.m_slicesVolume.getSeries();\r\n        if (series.length === 0) {\r\n          this.m_slicesVolume.buildSeriesInfo();\r\n          series = this.m_slicesVolume.getSeries();\r\n        }\r\n        const indexSerie = 0;\r\n        const hash = series[indexSerie].m_hash;\r\n        const errStatus = this.createVolumeFromSlices(volSet, indexSerie,  hash);\r\n        if (callbackComplete !== null) {\r\n          callbackComplete(errStatus);\r\n          return true;\r\n        }\r\n      } // if last file was loaded\r\n      return true;\r\n    }, (errMsg) => {\r\n      console.log(`Error read file: ${errMsg}`);\r\n      return false;\r\n    }); // end of readfile\r\n    return true;\r\n  } // end runLoader\r\n\r\n\r\n\r\n} // end class LoaderDicom\r\n\r\nexport default LoaderDicom;\r\n\r\n ","/*\r\nLicensed to the Apache Software Foundation (ASF) under one\r\nor more contributor license agreements.  See the NOTICE file\r\ndistributed with this work for additional information\r\nregarding copyright ownership.  The ASF licenses this file\r\nto you under the Apache License, Version 2.0 (the\r\n'License'); you may not use this file except in compliance\r\nwith the License.  You may obtain a copy of the License at\r\n\r\n  http://www.apache.org/licenses/LICENSE-2.0\r\n\r\nUnless required by applicable law or agreed to in writing,\r\nsoftware distributed under the License is distributed on an\r\n'AS IS' BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\nKIND, either express or implied.  See the License for the\r\nspecific language governing permissions and limitations\r\nunder the License.\r\n*/\r\n\r\n/**\r\n/**\r\n* File load from local disk or URL with promise to complete\r\n* @module components/visualization/engine.loaders/loadpromise\r\n*/\r\n\r\n// ******************************************************************\r\n// class LoadFilePromise\r\n// ******************************************************************\r\n\r\n/** Class LoadFilePromise implements local and remote (via URL) file reading functionality via Promises */\r\nexport default class LoadFilePromise {\r\n  constructor() {\r\n    this.m_file = null;\r\n    this.m_reader = null;\r\n    this.m_request = null;\r\n  }\r\n  /**\r\n  * Read local file. If success, invoke resolve callback for created promise\r\n  *\r\n  * @param {object} file - file to read\r\n  * @return {object} Promise, working after file will be read\r\n  */\r\n  readLocal(file) {\r\n    return new Promise((resolve) => {\r\n      this.m_file = file;\r\n      this.m_reader = new FileReader();\r\n      this.m_reader.addEventListener('load', (evt) => {\r\n        const arrBuf = evt.target.result;\r\n        if (resolve) {\r\n          resolve(arrBuf);\r\n        }\r\n      });\r\n      this.m_reader.readAsArrayBuffer(this.m_file);\r\n    });\r\n  }\r\n  /**\r\n  * Read remote file (via promise). If success, invoke resolve callback for created promise\r\n  *\r\n  * @param {string} url - file to read\r\n  * @return {object} Promise, working after file will be read\r\n  */\r\n  readFromUrl(url) {\r\n    return new Promise((resolve, reject) => {\r\n      this.m_url = url;\r\n      this.m_request = null;\r\n      const METHOD = 'GET';\r\n      this.m_request = new XMLHttpRequest();\r\n      if ('withCredentials' in this.m_request) {\r\n        // this.m_request.withCredentials = true;\r\n        const NEED_ASYNC = true;\r\n        this.m_request.open(METHOD, this.m_url, NEED_ASYNC);\r\n        // } else if (typeof XDomainRequest !== 'undefined') {\r\n        // console.log('HttpRequest: XDomainRequest will be used');\r\n        // this.m_request = new XDomainRequest();\r\n        // this.m_request.open(METHOD, this.m_url);\r\n      } else {\r\n        this.m_request = null;\r\n        console.log('This browser cant support CORS requests');\r\n        return;\r\n      }\r\n      this.m_request.responseType = 'arraybuffer';  // \"blob\"\r\n      this.m_request.addEventListener('load', (event) => {\r\n        const arrBuf = event.target.response;\r\n        if (arrBuf === null) {\r\n          console.log('Bad response type. Expect object type in response.');\r\n        } else {\r\n          resolve(arrBuf);\r\n        }\r\n      }, false);\r\n\r\n      this.m_request.addEventListener('error', (event) => {\r\n        const strError = `Error event happend for XMLHttpRequest: loaded = ${event.loaded}, total = ${event.total}`;\r\n        console.log(strError);\r\n        reject(strError);\r\n      }, false);\r\n      this.m_request.send();\r\n    });\r\n  }\r\n}\r\n","/**\r\n * @fileOverview LoaderHdr\r\n * @author Epam\r\n * @version 1.0.0\r\n */\r\n\r\n// ********************************************************\r\n// Imports\r\n// ********************************************************\r\n\r\nimport LoadResult from '../LoadResult';\r\nimport FileTools from './FileTools';\r\nimport LoadFilePromise from './LoadPromise';\r\nimport Volume from '../Volume';\r\nimport VolumeSet from '../VolumeSet';\r\n\r\n\r\n// ********************************************************\r\n// Const\r\n// ********************************************************\r\n\r\n// const NEED_EVEN_TEXTURE_SIZE = false;\r\n\r\nconst HDR_DT_NONE = 0;\r\nconst HDR_DT_UNSIGNED_CHAR = 2;\r\nconst HDR_DT_SIGNED_SHORT = 4;\r\n\r\n// ********************************************************\r\n// Class\r\n// ********************************************************\r\n\r\n/**\r\n * Class LoaderHdr some text later...\r\n */\r\nclass LoaderHdr {\r\n  static readByteFromBuffer(buf, off) {\r\n    return buf[off];\r\n  }\r\n  /**\r\n  * Read 32 bit integer from input buffer\r\n  * @param {object} buf - source buffer\r\n  * @param {number} off - offset in buffer\r\n  * @return 32 bit integer number\r\n  */\r\n  static readIntFromBuffer(buf, off) {\r\n    const res = ((buf[off + 0]) |\r\n      // eslint-disable-next-line\r\n      (buf[off + 1] << 8) |\r\n      // eslint-disable-next-line\r\n      (buf[off + 2] << 16) |\r\n      // eslint-disable-next-line\r\n      (buf[off + 3] << 24)\r\n    );\r\n    return res;\r\n  }\r\n  /**\r\n  * Read 16 bit short integer from input buffer\r\n  * @param {object} buf - source buffer\r\n  * @param {number} off - offset in buffer\r\n  * @return 16 bit short integer number\r\n  */\r\n  static readShortFromBuffer(buf, off) {\r\n    // eslint-disable-next-line\r\n    const res = ((buf[off + 0]) | (buf[off + 1] << 8));\r\n    return res;\r\n  }\r\n  /**\r\n  * Read 32 bit float from input buffer\r\n  * @param {object} buf - source buffer\r\n  * @param {number} off - offset in buffer\r\n  * @return 32 bit float number\r\n  */\r\n  static readFloatFromBuffer(buf, off) {\r\n    const BYTES_IN_FLOAT = 4;\r\n    const arBuf = new ArrayBuffer(BYTES_IN_FLOAT);\r\n    const dataArray = new DataView(arBuf);\r\n    // eslint-disable-next-line\r\n    dataArray.setUint8(0, buf[off + 0]);\r\n    // eslint-disable-next-line\r\n    dataArray.setUint8(1, buf[off + 1]);\r\n    // eslint-disable-next-line\r\n    dataArray.setUint8(2, buf[off + 2]);\r\n    // eslint-disable-next-line\r\n    dataArray.setUint8(3, buf[off + 3]);\r\n    const IS_LITTLE_ENDIAN = true;\r\n    const res = dataArray.getFloat32(0, IS_LITTLE_ENDIAN);\r\n    return res;\r\n  }\r\n  /**\r\n  * Convert DataView object into string\r\n  * @param {object} buf - buffer\r\n  * @param {number} off - current offset in buffer, when string started\r\n  * @param {number} lengthBuf - number of bytes to convert to string\r\n  * @return {string} string presentation of DataView\r\n  */\r\n  static getStringAt(buf, off, lengthBuf) {\r\n    let str = '';\r\n    for (let i = 0; i < lengthBuf; i++) {\r\n      const ch = buf[off + i];\r\n      if (ch === 0) {\r\n        break;\r\n      }\r\n      str += String.fromCharCode(ch);\r\n    }\r\n    return str;\r\n  }\r\n  //\r\n  // read header file\r\n  //\r\n  readFromBufferHeader(volumeDst, arrBuf, callbackProgress, callbackComplete) {\r\n    // check arguments\r\n    console.assert(volumeDst != null, \"Null volume\");\r\n    console.assert(volumeDst instanceof Volume, \"Should be volume\");\r\n    console.assert(arrBuf != null, \"Null array\");\r\n    console.assert(arrBuf.constructor.name === \"ArrayBuffer\", \"Should be ArrayBuf in arrBuf\");\r\n\r\n    const bufBytes = new Uint8Array(arrBuf);\r\n    const bufLen = bufBytes.length;\r\n    const HDR_HEADER_SIZE = 348;\r\n    // console.log(`Header buf size === ${bufLen}`);\r\n    if (bufLen !== HDR_HEADER_SIZE) {\r\n      if (callbackComplete) {\r\n        callbackComplete(LoadResult.WRONG_HEADER_DATA_SIZE, null, 0, null);\r\n      }\r\n      return false;\r\n    }\r\n\r\n    const SIZE_DWORD = 4;\r\n    const SIZE_SHORT = 2;\r\n    const SIZE_BYTE = 1;\r\n\r\n    let bufOff = 0;\r\n    // read sizeof header\r\n    const sizeofHdr = LoaderHdr.readIntFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_DWORD;\r\n    if (sizeofHdr !== HDR_HEADER_SIZE) {\r\n      console.log(`Hdr first int wrong: ${sizeofHdr}, but should be ${HDR_HEADER_SIZE}`);\r\n      if (callbackComplete) {\r\n        callbackComplete(LoadResult.BAD_HEADER, null, 0, null);\r\n      }\r\n      return false;\r\n    }\r\n    const ONE = 1;\r\n    const TWO = 2;\r\n\r\n    // read dataType char[10]\r\n    const DATA_TYPE_LEN = 10;\r\n    const strDataType = LoaderHdr.getStringAt(bufBytes, bufOff, DATA_TYPE_LEN);\r\n    bufOff += DATA_TYPE_LEN;\r\n    volumeDst.m_dataType = HDR_DT_NONE;\r\n    if (strDataType === 'CHAR') {\r\n      volumeDst.m_dataType = HDR_DT_UNSIGNED_CHAR;\r\n      volumeDst.m_bytesPerVoxel = ONE;\r\n    }\r\n    if (strDataType === 'SHORT') {\r\n      volumeDst.m_dataType = HDR_DT_SIGNED_SHORT;\r\n      volumeDst.m_bytesPerVoxel = TWO;\r\n    }\r\n    if (volumeDst.m_dataType === HDR_DT_NONE) {\r\n      console.log(`Hdr wrong data type. Should be CHAR or SHORT, but found: ${strDataType}`);\r\n      if (callbackComplete) {\r\n        callbackComplete(LoadResult.BAD_HEADER, null, 0, null);\r\n      }\r\n      return false;\r\n    }\r\n    console.log(`Hdr read data type = ${strDataType}`);\r\n\r\n    // read dbName char[18]\r\n    const DB_NAME_LEN = 18;\r\n    bufOff += DB_NAME_LEN;\r\n\r\n    // reads extents int\r\n    const iExtents = LoaderHdr.readIntFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_DWORD;\r\n    const MAGIC_EXTENTS = 16384;\r\n    if (iExtents !== MAGIC_EXTENTS) {\r\n      console.log(`Hdr wrong extents in header. Should be ${MAGIC_EXTENTS}, but found: ${iExtents}`);\r\n      if (callbackComplete) {\r\n        callbackComplete(LoadResult.BAD_HEADER, null, 0, null);\r\n      }\r\n      return false;\r\n    }\r\n    // read session error\r\n    // const iSessionError = HdrVolume.readShortFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_SHORT;\r\n\r\n    // read regular\r\n    const iRegular = LoaderHdr.readByteFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_BYTE;\r\n\r\n    const  MAGIC_REGULAR = 114;\r\n    if (iRegular !== MAGIC_REGULAR) {\r\n      console.log(`Hdr wrong regular in header. Should be ${MAGIC_REGULAR}, but found: ${iRegular}`);\r\n      if (callbackComplete) {\r\n        callbackComplete(LoadResult.BAD_HEADER, null, 0, null);\r\n      }\r\n      return false;\r\n    }\r\n\r\n    // read hKeyUn\r\n    // const hKeyUn = HdrVolume.readByteFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_BYTE;\r\n\r\n    // read ushort dim[8]\r\n    // const dim0 = HdrVolume.readShortFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_SHORT;\r\n    const dim1 = LoaderHdr.readShortFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_SHORT;\r\n    const dim2 = LoaderHdr.readShortFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_SHORT;\r\n    const dim3 = LoaderHdr.readShortFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_SHORT;\r\n\r\n    volumeDst.m_xDim = dim1;\r\n    volumeDst.m_yDim = dim2;\r\n    volumeDst.m_zDim = dim3;\r\n    console.log(`HDR: volume dim = ${volumeDst.m_xDim} * ${volumeDst.m_yDim} * ${volumeDst.m_zDim} `);\r\n\r\n    // read unused dim [4,5,6,7]\r\n    const NUM_DIM_UNUSED = 4;\r\n    bufOff += SIZE_SHORT * NUM_DIM_UNUSED;\r\n\r\n    // read voxUnits\r\n    const VOX_UNITS_SIZE = 4;\r\n    bufOff += VOX_UNITS_SIZE;\r\n\r\n    // read calUnits char[8]\r\n    const CAL_UNITS_SIZE = 8;\r\n    bufOff += CAL_UNITS_SIZE;\r\n\r\n    // read unused\r\n    // const unusedH = HdrVolume.readShortFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_SHORT;\r\n\r\n    // read dataType\r\n    const dataTypeH = LoaderHdr.readShortFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_SHORT;\r\n    if (volumeDst.m_dataType === HDR_DT_UNSIGNED_CHAR) {\r\n      if (dataTypeH !== HDR_DT_UNSIGNED_CHAR) {\r\n        console.log('Wrong data tye for char typed header');\r\n        return false;\r\n      }\r\n    }\r\n    if (volumeDst.m_dataType === HDR_DT_SIGNED_SHORT) {\r\n      if (dataTypeH !== HDR_DT_SIGNED_SHORT) {\r\n        console.log('Wrong data tye for signed short typed header');\r\n        return false;\r\n      }\r\n    }\r\n\r\n    // read bitPix\r\n    const BITS_IN_CHAR = 8;\r\n    const BITS_IN_WORD = 16;\r\n\r\n    const bitPixH = LoaderHdr.readShortFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_SHORT;\r\n    if (volumeDst.m_dataType === HDR_DT_UNSIGNED_CHAR) {\r\n      if (bitPixH !== BITS_IN_CHAR) {\r\n        console.log('Wrong bits pix for char typed header');\r\n        return false;\r\n      }\r\n    }\r\n    if (volumeDst.m_dataType === HDR_DT_SIGNED_SHORT) {\r\n      if (bitPixH !== BITS_IN_WORD) {\r\n        console.log('Wrong bits pix for word typed header');\r\n        return false;\r\n      }\r\n    }\r\n\r\n    // read dimUn\r\n    // const dimUn = HdrVolume.readShortFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_SHORT;\r\n\r\n    // read pixDim : voxelDim\r\n    // const pixDim0 = HdrVolume.readFloatFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_DWORD;\r\n    const pixDim1 = LoaderHdr.readFloatFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_DWORD;\r\n    const pixDim2 = LoaderHdr.readFloatFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_DWORD;\r\n    const pixDim3 = LoaderHdr.readFloatFromBuffer(bufBytes, bufOff);\r\n    bufOff += SIZE_DWORD;\r\n\r\n    // read rest of pixDim\r\n    const NUM_REST_PIX_DIM = 4;\r\n    bufOff += SIZE_DWORD * NUM_REST_PIX_DIM;\r\n\r\n    volumeDst.m_boxSize.x = volumeDst.m_xDim * pixDim1;\r\n    volumeDst.m_boxSize.y = volumeDst.m_yDim * pixDim2;\r\n    volumeDst.m_boxSize.z = volumeDst.m_zDim * pixDim3;\r\n    console.log(`HDR: physic size = ${volumeDst.m_boxSize.x} * ${volumeDst.m_boxSize.y} * ${volumeDst.m_boxSize.z} `);\r\n\r\n    return true;\r\n  }\r\n  //\r\n  // read image file\r\n  //\r\n  readFromBufferImage(volumeDst, arrBuf, callbackProgress, callbackComplete) {\r\n    // check arguments\r\n    console.assert(volumeDst != null, \"Null volume\");\r\n    console.assert(volumeDst instanceof Volume, \"Should be volume\");\r\n    console.assert(arrBuf != null, \"Null array\");\r\n    console.assert(arrBuf.constructor.name === \"ArrayBuffer\", \"Should be ArrayBuf in arrBuf\");\r\n\r\n    const bufBytes = new Uint8Array(arrBuf);\r\n    const bufLen = bufBytes.length;\r\n    const MIN_BUF_SIZE = 8;\r\n    const MAX_BUF_SIZE = (1024 * 1024 * 230);\r\n    if (bufLen < MIN_BUF_SIZE) {\r\n      if (callbackComplete) {\r\n        callbackComplete(LoadResult.ERROR_TOO_SMALL_DATA_SIZE , null, 0, null);\r\n      }\r\n      return false;\r\n    }\r\n    if (bufLen >= MAX_BUF_SIZE) {\r\n      if (callbackComplete) {\r\n        callbackComplete(LoadResult.ERROR_TOO_LARGE_DATA_SIZE , null, 0, null);\r\n      }\r\n      return false;\r\n    }\r\n    volumeDst.m_imageBufferSize = bufLen;\r\n    volumeDst.m_arrBuf = arrBuf;\r\n    console.log(`readFromBufferImage complete with ${bufLen} bytes in image `);\r\n    return true;\r\n  } // end readFromBufferImage\r\n  //\r\n  // create volume from 2 components\r\n  //\r\n  createVolumeFromHeaderAndImage(volDst) {\r\n    // check arguments\r\n    console.assert(volDst != null, \"Null volume\");\r\n    console.assert(volDst instanceof Volume, \"Should be volume\");\r\n  \r\n    const NUM_BYTES_CHAR = 1;\r\n    const NUM_BYTES_WORD = 2;\r\n\r\n    let bytesPerPixel = 0;\r\n    if (volDst.m_dataType === HDR_DT_UNSIGNED_CHAR) {\r\n      bytesPerPixel = NUM_BYTES_CHAR;\r\n    }\r\n    if (volDst.m_dataType === HDR_DT_SIGNED_SHORT) {\r\n      bytesPerPixel = NUM_BYTES_WORD;\r\n    }\r\n    const numPixels = volDst.m_xDim * volDst.m_yDim * volDst.m_zDim;\r\n    const estimatedVolSize = numPixels * bytesPerPixel;\r\n    if (estimatedVolSize !== volDst.m_imageBufferSize) {\r\n      console.log(`HDR: wrong IMG data size. Read: ${volDst.m_imageBufferSize}, but expected ${estimatedVolSize} `);\r\n      return false;\r\n    }\r\n    const arrBuf = volDst.m_arrBuf;\r\n    if (volDst.m_dataType === HDR_DT_SIGNED_SHORT) {\r\n      const dataArray16 = new Uint16Array(arrBuf);\r\n      volDst.m_dataArray = new Uint8Array(numPixels);\r\n      // convert 16 bpp -> 8 bpp\r\n      let i;\r\n      let valMax = 0;\r\n      for (i = 0; i < numPixels; i++) {\r\n        valMax = (dataArray16[i] > valMax) ? dataArray16[i] : valMax;\r\n      }\r\n      // console.log(`IMG: maximum input color is ${valMax}`);\r\n      valMax++;\r\n\r\n      // scale down to 256 colors\r\n      const MAX_COLOR_BYTE = 255;\r\n      for (i = 0; i < numPixels; i++) {\r\n        volDst.m_dataArray[i] = Math.floor(MAX_COLOR_BYTE * dataArray16[i] / valMax);\r\n      }\r\n    } else if (volDst.m_dataType === HDR_DT_UNSIGNED_CHAR) {\r\n      // Read color indices info: usually this is 1 bpp data\r\n      const bufBytes = new Uint8Array(arrBuf);\r\n      volDst.m_dataArray = bufBytes;\r\n    }\r\n\r\n    // save to result volume\r\n    const ONE = 1;\r\n    volDst.m_bytesPerVoxel = ONE;\r\n    volDst.m_dataSize = volDst.m_imageBufferSize;\r\n    return true;\r\n  }\r\n  //\r\n  // create vol from 2 volumes: intensity and hdr\r\n  //\r\n  createRoiVolumeFromHeaderAndImage(volDst, volRoi) {\r\n    // check arguments\r\n    console.assert(volDst != null, \"Null volume\");\r\n    console.assert(volDst instanceof Volume, \"Should be volume\");\r\n    console.assert(volRoi != null, \"Null volume\");\r\n    console.assert(volRoi instanceof Volume, \"Should be volume\");\r\n\r\n    // both volumes are in 1 byte format\r\n    const ONE = 1;\r\n    if (volDst.m_bytesPerVoxel !== ONE) {\r\n      console.log('createRoiVolumeFromHeaderAndImage: bad volDst. m_bytesPerVoxel should be 1');\r\n      return false;\r\n    }\r\n    if (volRoi.m_bytesPerVoxel !== ONE) {\r\n      console.log('createRoiVolumeFromHeaderAndImage: bad volRoi');\r\n      return false;\r\n    }\r\n    // compare size\r\n    if ((volDst.m_xDim !== volRoi.m_xDim) || (volDst.m_yDim !== volRoi.m_yDim) || (volDst.m_zDim !== volRoi.m_zDim)) {\r\n      console.log('createRoiVolumeFromHeaderAndImage: different volumes sizes');\r\n      return false;\r\n    }\r\n    const numPixels = volDst.m_xDim * volDst.m_yDim * volDst.m_zDim;\r\n    const BYTES_IN_RGBA = 4;\r\n    const dataNew = new Uint8Array(numPixels * BYTES_IN_RGBA);\r\n\r\n    const arrBuf = volRoi.m_arrBuf;\r\n    const dataArrayRoi8 = new Uint8Array(arrBuf);\r\n\r\n    const OFF0 = 0; const OFF1 = 1;\r\n    const OFF2 = 2; const OFF3 = 3;\r\n    let j = 0;\r\n    for (let i = 0; i < numPixels; i++, j += BYTES_IN_RGBA) {\r\n      dataNew[j + OFF0] = volDst.m_dataArray[i];\r\n      dataNew[j + OFF1] = 0;\r\n      dataNew[j + OFF2] = 0;\r\n      dataNew[j + OFF3] = dataArrayRoi8[i];\r\n    }\r\n    volDst.m_dataArray = dataNew;\r\n    const FOUR = 4;\r\n    volDst.m_bytesPerVoxel = FOUR;\r\n    console.log('createRoiVolumeFromHeaderAndImage: success');\r\n    return true;\r\n  } //\r\n  /**\r\n   * Read hdr (h + img) files from URL\r\n   * \r\n   * @param {object} volSet - volume set\r\n   * @param {string} strUrl - url string\r\n   * @param {func} callbackProgress - callback during read progress\r\n   * @param {func} callbackComplete - callback after complete (good or bad)\r\n   * @return true, if success\r\n   */\r\n  readFromUrl(volSet, strUrl, callbackProgress, callbackComplete) {\r\n    console.log(`readFromUrl. going to read from ${strUrl} ...`);\r\n\r\n    const ft = new FileTools();\r\n    const isValidUrl = ft.isValidUrl(strUrl);\r\n    if (!isValidUrl) {\r\n      console.log(`readFromUrl: not vaild URL = = ${strUrl} `);\r\n      return false;\r\n    }\r\n    this.m_folder = ft.getFolderNameFromUrl(strUrl);\r\n    const fileName = ft.getFileNameFromUrl(strUrl);\r\n    // console.log(`readFromUrl: folder =  ${this.m_folder} filename = ${fileName}`);\r\n\r\n    const regExp = /(\\w+)_intn.(h|hdr)/;\r\n    const arrGrp = regExp.exec(fileName);\r\n    if (arrGrp.length !== 3) {\r\n      console.log(`LoaderHdr.readFromUrl: bad URL name = ${strUrl}. Should be in template NNN_intn.h `);\r\n      return false;\r\n    }\r\n    const namePrefix = arrGrp[1];\r\n    //console.log(`readFromUrl: name prefix = ${namePrefix}, grpLen = ${arrGrp.length}`);\r\n\r\n    const fileNameIntensityHeader = this.m_folder + '/' + namePrefix + '_intn.h';\r\n    const fileNameIntensityImage = this.m_folder + '/' + namePrefix + '_intn.img';\r\n    const fileNameMaskHeader = this.m_folder + '/' + namePrefix + '_mask.h';\r\n    const fileNameMaskImage = this.m_folder + '/' + namePrefix + '_mask.img';\r\n\r\n\r\n    const arrUrls = [];\r\n    arrUrls.push(fileNameIntensityHeader);\r\n    arrUrls.push(fileNameIntensityImage);\r\n    arrUrls.push(fileNameMaskHeader);\r\n    arrUrls.push(fileNameMaskImage);\r\n    const ok = this.readFromUrls(arrUrls, volSet, callbackProgress, callbackComplete);\r\n\r\n    return ok;\r\n  } // end of readFromUrl\r\n  /**\r\n   * \r\n   * @param {object} arrUrls  - array of strings urls\r\n   * @param {*} volSet  - dest volume set\r\n   * @param {*} callbackProgress - callback during read\r\n   * @param {*} callbackComplete - callback after end fo read\r\n   */\r\n  readFromUrls(arrUrls, volSet, callbackProgress, callbackComplete) {\r\n\r\n    // check arguments\r\n    console.assert(volSet != null, \"Null volume set\");\r\n    console.assert(volSet instanceof VolumeSet, \"Should be volume set\");\r\n    \r\n\r\n    const numUrls = arrUrls.length;\r\n    const NUM_URLS_IN_SET = 2;\r\n    const NUM_FILES_VOL_INT_ROI = 4;\r\n    if (numUrls === NUM_URLS_IN_SET) {\r\n      let urlHdr = arrUrls[0];\r\n      let urlImg = arrUrls[1];\r\n      const loaderHdr = new LoadFilePromise();\r\n      const loaderImg = new LoadFilePromise();\r\n      let indPointH = urlHdr.indexOf('.h');\r\n      if (indPointH === -1) {\r\n        indPointH = urlHdr.indexOf('.hdr');\r\n      }\r\n      if (indPointH === -1) {\r\n        const strCopy = urlHdr;\r\n        urlHdr = urlImg;\r\n        urlImg = strCopy;\r\n      }\r\n\r\n      // this.m_volIntensity = new HdrVolume(this.m_needScaleDownTexture);\r\n\r\n      const volDst = volSet.getVolume(0);\r\n      loaderHdr.readFromUrl(urlHdr).then((arrBufHdr) => {\r\n        this.readFromBufferHeader(volDst, arrBufHdr, callbackComplete, callbackProgress);\r\n        console.log(`Load success HDR file: ${urlHdr}`);\r\n        loaderImg.readFromUrl(urlImg).then((arrBufImg) => {\r\n          this.readFromBufferImage(volDst, arrBufImg, callbackComplete, callbackProgress);\r\n          console.log(`Load success IMG file: ${urlImg}`);\r\n\r\n          // complete 2 images\r\n          this.createVolumeFromHeaderAndImage(volDst);\r\n\r\n          // invoke callback for good loading end\r\n          callbackComplete(LoadResult.SUCCESS);\r\n\r\n        });\r\n      }, (error) => {\r\n        console.log('HDR File read error', error);\r\n        callbackComplete(LoadResult.ERROR_CANT_OPEN_URL, null, 0, null);\r\n        return false;\r\n      });\r\n    } else if (numUrls === NUM_FILES_VOL_INT_ROI) {\r\n      // read 4 files\r\n      const urlHdrInt = arrUrls[0];\r\n      const urlImgInt = arrUrls[1];\r\n      const urlHdrRoi = arrUrls[2];\r\n      const urlImgRoi = arrUrls[3];\r\n\r\n      const loaderHdrInt = new LoadFilePromise();\r\n      const loaderImgInt = new LoadFilePromise();\r\n      const loaderHdrRoi = new LoadFilePromise();\r\n      const loaderImgRoi = new LoadFilePromise();\r\n\r\n      // this.m_volIntensity = new HdrVolume(this.m_needScaleDownTexture);\r\n      // this.m_volRoi = new HdrVolume(this.m_needScaleDownTexture);\r\n\r\n      const volRoi = new Volume();\r\n      const volDst = volSet.getVolume(0);\r\n\r\n      loaderHdrInt.readFromUrl(urlHdrInt).then((arrBufHdr) => {\r\n        // this.m_volIntensity.readBufferHead(arrBufHdr, callbackComplete, callbackProgress);\r\n        // this.readBufferHead(arrBufHdr, callbackComplete, callbackProgress);\r\n        this.readFromBufferHeader(volDst, arrBufHdr, callbackComplete, callbackProgress);\r\n\r\n        console.log(`Load success HDR file: ${urlHdrInt}`);\r\n        loaderImgInt.readFromUrl(urlImgInt).then((arrBufImg) => {\r\n          // this.m_volIntensity.readBufferImg(arrBufImg, callbackComplete, callbackProgress);\r\n          // this.readBufferImg(arrBufImg, callbackComplete, callbackProgress);\r\n          this.readFromBufferImage(volDst, arrBufImg, callbackComplete, callbackProgress);\r\n          console.log(`Load success IMG file: ${urlImgInt}`);\r\n\r\n          loaderHdrRoi.readFromUrl(urlHdrRoi).then((arrBufferHdr) => {\r\n            //this.m_volRoi.readBufferHead(arrBufferHdr, callbackComplete, callbackProgress);\r\n            this.readFromBufferHeader(volRoi, arrBufferHdr, callbackComplete, callbackProgress);\r\n\r\n            loaderImgRoi.readFromUrl(urlImgRoi).then((arrBufferImg) => {\r\n\r\n              // this.m_volRoi.readBufferImg(arrBufferImg, callbackComplete, callbackProgress);\r\n              this.readFromBufferImage(volRoi, arrBufferImg, callbackComplete, callbackProgress);\r\n\r\n              // transform intensity data from 16 bpp -> 8 bpp\r\n              this.createVolumeFromHeaderAndImage(volDst);\r\n\r\n              // mix intensity + roi\r\n              this.createRoiVolumeFromHeaderAndImage(volDst, volRoi);\r\n\r\n              // invoke callback for good loading end\r\n              callbackComplete(LoadResult.SUCCESS);\r\n\r\n            }); // loaderImgRoi\r\n          }); // loaderHdrRoi\r\n\r\n        }); // loaderImgInt\r\n      }, (error) => {\r\n        console.log('HDR File read error', error);\r\n        return false;\r\n      }); // loaderHdrInt\r\n\r\n    } else {\r\n      console.log(`Error read hdr files. Should be ${NUM_URLS_IN_SET} files`);\r\n      return false;\r\n    }// if number of files equal to 2\r\n    return true;\r\n  } // end of readFromUrls\r\n} // end class LoaderHdr\r\n\r\nexport default LoaderHdr;\r\n","/**\r\n * @fileOverview VolumeSet\r\n * @author Epam\r\n * @version 1.0.0\r\n */\r\n\r\n\r\n// ********************************************************\r\n// Imports\r\n// ********************************************************\r\n\r\nimport React from 'react';\r\n\r\nimport Volume from './Volume';\r\n\r\nimport LoaderKtx from './loaders/LoaderKtx';\r\nimport LoaderNifti from './loaders/LoaderNifti';\r\nimport LoaderDicom from './loaders/LoaderDicom';\r\nimport LoaderHdr from './loaders/LoaderHdr';\r\n\r\n// ********************************************************\r\n// Const\r\n// ********************************************************\r\nconst PIXDIM_BYTE_OFFSET = 40;\r\n/** \r\n * Class representing a volume set \r\n * Typically set contains only 1 volume, but for some Dicom folders it can be more then 1 \r\n * See Volume class as an element of volume set\r\n */\r\nclass VolumeSet extends React.Component {\r\n  /**\r\n   * @param {object} props - props from up level object\r\n   */\r\n  constructor(props) {\r\n    super(props);\r\n    /** nuber of volumes in set */\r\n    this.m_numVolumes = 0;\r\n    /** volumes array. see more details in class Volume */\r\n    this.m_volumes = [];\r\n    /** patient name (etracted from dicom tags or empty for non-dicom files) */\r\n    this.m_patientName = '';\r\n    /** date of patient birth */\r\n    this.m_patientBirth = '';\r\n    /** text description of serie */\r\n    this.m_seriesDescr = '';\r\n    /** text description of study */\r\n    this.m_studyDescr = '';\r\n    /** text with date of study */\r\n    this.m_studyDate = '';\r\n    /** text with time series taken */\r\n    this.m_seriesTime = '';\r\n    /** text with body part */\r\n    this.m_bodyPartExamined = '';\r\n    /** text institution like clinic, university, etc. */\r\n    this.m_institutionName = '';\r\n    /** text with operator name */\r\n    this.m_operatorsName = '';\r\n    /** text with physican name */\r\n    this.m_physicansName = '';\r\n  }\r\n  /**\r\n   * Add volume to set\r\n   * \r\n   * @param {Volume} vol - added volume\r\n   */\r\n  addVolume(vol) {\r\n    console.assert(vol instanceof Volume, \"VolumeSet.addVolume: arg must be Volume\");\r\n    // this.m_volumes[this.m_numVolumes] = vol;\r\n    this.m_volumes.push(vol);\r\n    this.m_numVolumes++;\r\n  }\r\n  /**\r\n   * Get number of volumes in st\r\n   * \r\n   * @return {number} Amount of volumes on set\r\n   */\r\n  getNumVolumes() {\r\n    return this.m_numVolumes;\r\n  }\r\n  /**\r\n   * Get volume by its index\r\n   * @param {number} idx - index of volume in set\r\n   * @return {Volume} volume is set or null\r\n   */\r\n  getVolume(idx) {\r\n    console.assert(Number.isInteger(idx), \"VolumeSet.getVolume: arg must be number\");\r\n    console.assert(idx < this.m_numVolumes, \"index of volume should be in range\");\r\n    console.assert(idx >= 0, \"index of volume should be non negative\");\r\n    if ((idx < 0) || (idx >= this.m_numVolumes)) {\r\n      return null;\r\n    }\r\n    return this.m_volumes[idx];\r\n  }\r\n  checkVolume() {\r\n      const phases = this.m_numVolumes;\r\n      if (phases <= 1) {\r\n          console.log(\"volumes is less than or equal to one: \", phases);\r\n          return true;\r\n      }\r\n      let volumeSizes = new Array(phases);\r\n      for (let p = 0; p < phases; p++) {\r\n        let currentVol = this.getVolume(p);\r\n        if (currentVol === null) {\r\n            return false;\r\n        }\r\n        volumeSizes[p] = currentVol.m_dataArray.length;\r\n      }\r\n        //check sizes first\r\n      for (let i = 1; i < phases; i++) {\r\n          console.assert(volumeSizes[i-1] === volumeSizes[i], \"volume size mismatch. Phase \",i-1,\" size is \", volumeSizes[i-1],\" and phase \", i, \" size is \", volumeSizes[i]);\r\n          if (volumeSizes[i-1] !== volumeSizes[i]) {\r\n              return false;\r\n          }\r\n      }\r\n      //now check contents\r\n      for (let p = 1; p < phases; p++) {\r\n          let prevVol = this.getVolume(p-1);\r\n          let currVol = this.getVolume(p);\r\n          console.log(prevVol,currVol);\r\n        for (let pixel = 0; pixel < volumeSizes[p]; pixel++) {\r\n            if (prevVol.m_dataArray[pixel] !== currVol.m_dataArray[pixel]) {\r\n                console.log(\"volumes for phases \", p-1, \" and \", p, \" are different at pixel: \", pixel, \" with values: \",prevVol.m_dataArray[pixel], \" and \", currVol.m_dataArray[pixel]);\r\n                return false;\r\n            }\r\n        }\r\n      }\r\n      console.log(\"volumes are the same\");\r\n      return true;\r\n  }\r\n  // do nothing. But we need to implement render() to run Volume tests\r\n  render() {\r\n    return null;\r\n  }\r\n  // ********************************************\r\n  // Read metyhods. From Ktx, Dicom, ..\r\n  // ********************************************\r\n  /**\r\n   * Read KTX from local file buffer\r\n   * \r\n   * @param {char array} arrBuf \r\n   * @param {func} callbackProgress \r\n   * @param {func} callbackComplete \r\n   */\r\n  readFromKtx(arrBuf, callbackProgress, callbackComplete) {\r\n    console.assert(arrBuf != null);\r\n    console.assert(arrBuf.constructor.name === \"ArrayBuffer\", \"Should be ArrayBuf in arrBuf\");\r\n    const loader = new LoaderKtx();\r\n    const vol = this.getVolume(0);\r\n    const ret = loader.readFromBuffer(vol, arrBuf, callbackProgress, callbackComplete);\r\n    return ret;\r\n  }  \r\n  readFromKtxUrl(strUrl, callbackProgress, callbackComplete) {\r\n    const loader = new LoaderKtx();\r\n    const vol = this.getVolume(0);\r\n    loader.readFromUrl(vol, strUrl, callbackProgress, callbackComplete);\r\n  }\r\n  readFromNiiUrl(strUrl, callbackProgress, callbackComplete) {\r\n    const loader = new LoaderNifti();\r\n    const vol = this.getVolume(0);\r\n    const ret = loader.readFromUrl(vol, strUrl, callbackProgress, callbackComplete);\r\n    return ret;\r\n  }\r\n  readFromDicomUrl(strUrl, callbackProgress, callbackComplete) {\r\n    const NUM_FILES = 0; // will be filled later\r\n    const loader = new LoaderDicom(NUM_FILES);\r\n    const ret = loader.readFromUrl(this, strUrl, callbackProgress, callbackComplete);\r\n    return ret;\r\n  }\r\n  readFromHdrUrl(strUrl, callbackProgress, callbackComplete) {\r\n    const loader = new LoaderHdr();\r\n    const ret = loader.readFromUrl(this, strUrl, callbackProgress, callbackComplete);\r\n    return ret;\r\n  }\r\n  //this one\r\n  readFromNifti(arrBuf, callbackProgress, callbackComplete, maskBuff = null) {\r\n    const loader = new LoaderNifti();\r\n    // const vol = this.getVolume(0);\r\n    const numDimensions = loader.readShortFromBuffer(arrBuf, PIXDIM_BYTE_OFFSET);\r\n    console.log(this.getNumVolumes(), numDimensions);\r\n    if (numDimensions === 4) {\r\n        const phases = loader.readShortFromBuffer(arrBuf, PIXDIM_BYTE_OFFSET + 8);\r\n        console.log(phases)\r\n        while (this.getNumVolumes() < phases) {\r\n            this.addVolume(new Volume());\r\n        }\r\n    }\r\n    if (maskBuff !== null) {\r\n        return loader.readFromBuffer(this.m_volumes, arrBuf, callbackProgress, callbackComplete, maskBuff);\r\n    }\r\n    else {\r\n        return loader.readFromBuffer(this.m_volumes, arrBuf, callbackProgress, callbackComplete);\r\n    }\r\n  }\r\n  readFromDicom(loader, arrBuf, callbackProgress, callbackComplete) {\r\n    const indexFile = 0;\r\n    const fileName = 'file???';\r\n    const ratio = 0.0;\r\n\r\n    const ret = loader.readFromBuffer(indexFile, fileName, ratio, arrBuf, callbackProgress, callbackComplete);\r\n    return ret;\r\n  }\r\n  readSingleSliceFromDicom(loader, indexFile, fileName, ratioLoaded, arrBuf, callbackProgress, callbackComplete) {\r\n    const ret = loader.readFromBuffer(indexFile, fileName, ratioLoaded, arrBuf, callbackProgress, callbackComplete);\r\n    return ret;\r\n  }\r\n\r\n} // end VolumeSet\r\n\r\nexport default VolumeSet;\r\n","import { Options, State } from \"./types\";\r\nimport { socket } from './socket';\r\nimport {\r\n  ModeView,\r\n  Modes2d,\r\n  Modes3d,\r\n  Modes3droi,\r\n} from './constants';\r\nimport VolumeSet from \"../components/visualization/engine/VolumeSet\";\r\nimport * as THREE from 'three';\r\n\r\nconst defaultOptions: Options = {\r\n  moduleOne: {\r\n    processTimingData: true,\r\n    build4d: true,\r\n    build3d: true,\r\n    compute4dSummary: true,\r\n    saveAvailableData: true,\r\n    reloadTimingIndices: true,\r\n    stopIfOptionsChange: false,\r\n    autoSelectLargest: true,\r\n    autoSelectFirstLargest: false,\r\n    autoSelectLastLargest: true,\r\n    setTimeSeparationMin: '0',\r\n    setTimeSeparationMax: '60',\r\n    imageSetIndex: '0'\r\n  },\r\n  moduleTwo: {\r\n    dataOutput: \"C:\\\\Workspaces\\\\carl\",\r\n    modality: \"CT\",\r\n    vendor: \"Toshiba\",\r\n    scanner: \"320\",\r\n    process: \"DCE\",\r\n    region: \"Brain\",\r\n    study: \"ICH\",\r\n    restartEnabled: true,\r\n    minimum3d: \"0.125\",\r\n    includeMinThreshold: true,\r\n    includeMaxThreshold: false,\r\n    useMorphologicalOperations: true,\r\n    strfiDisk: '5',\r\n    strfi3d: '2',\r\n    imageRegion: 'Minimum',\r\n    minimumConnected: '0.2',\r\n    coarseRadius: '20',\r\n    strfiRadius: \"1.5\",\r\n    imageIndexRange: \"All\"\r\n  },\r\n  moduleThree: {\r\n    minimumNumber: '50',\r\n    numberOfBins: '400',\r\n    distributionTail: '0.01',\r\n    feature: 'Median Value',\r\n    medianMin: '0.3',\r\n    medianMax: '0.4',\r\n    peakRangeMin: '0.3',\r\n    peakRangeMax: '0.4',\r\n    probabilityMin: '0',\r\n    probabilityMax: '0.97',\r\n    nonNegativeValues: true,\r\n    nonZeroValues: true\r\n\r\n  },\r\n  moduleFour: {\r\n    enableRestart: true,\r\n    vascularMaskDirectory: '',\r\n    outputDataDirectory: '',\r\n  }\r\n}\r\n\r\nconst state: State = {\r\n  socket,\r\n  showLoader: false,\r\n  fileName: 'brain.ktx',\r\n  notification: {\r\n    body: '',\r\n    header: '',\r\n    isVisible: false,\r\n    status: null,\r\n    icon: null,\r\n    spin: false,\r\n    timer: null\r\n  },\r\n  doctorView: {\r\n    isLoaded: false,\r\n    loadedScan: '',\r\n    patients: [],\r\n    status: \"Bleeding\",\r\n    rateOfLeakage: 0.31,\r\n    volumeOfLeakage: -1,\r\n    timeOfStroke: 7320,\r\n    title: \"CT Head or Brain W/O&W\",\r\n    date: new Date(2006, 9, 6),\r\n    phaseTimes: [4,6,8,10,12,14,16,18,20,22,24,26,28,33,38,43,48,53],\r\n    zoom: 0.9\r\n  },\r\n  nurseView: {\r\n    isLoaded: false,\r\n    patients: [],\r\n    status: \"Not Bleeding\",\r\n    rateOfLeakage: -1,\r\n    volumeOfLeakage: -1,\r\n    timeOfStroke: 0,\r\n    title: \"CT Head or Brain W/O&W\",\r\n    date: new Date(2006, 9, 6)\r\n  },\r\n  visState: {\r\n    volumeSet: new VolumeSet({}),\r\n    spotColor: new THREE.Vector3(1,1,1),\r\n    showVenousStructure: true,\r\n    loadingBarRatio: 50,\r\n    volumeIndex: 0,\r\n    texture3d: null,\r\n    modeView: ModeView.VIEW_3D_LIGHT,\r\n    mode2d: Modes2d.TRANSVERSE,\r\n    slider2d: 0.5,\r\n    slider3d_r: 0.09,\r\n    slider3d_g: 0.3,\r\n    slider3d_b: 0.46,\r\n    mode3d: Modes3d.RAYCAST,\r\n    mode3droi: Modes3droi.RAYCAST,\r\n    sliderOpacity: 0.53,\r\n    sliderIsosurface: 0.46,\r\n    sliderBrightness: 0.56,\r\n    sliderCut: 1.0,\r\n    sliderQuality: 0.35,\r\n    sliderErRadius: 50.0,\r\n    sliderErDepth: 50.0,\r\n    volumeRenderer: null,\r\n    indexTools2d: 0,\r\n    render2dZoom: 1.0,\r\n    render2dxPos: 0.0,\r\n    render2dyPos: 0.0,\r\n    graphics2d: null,\r\n    uiApp: null,\r\n    dicomInfo: null,\r\n    isTool3D: false,\r\n    volumeOpacity: 1.0,\r\n    sliderContrast3D: 0.0,\r\n    arrErrors: [],\r\n    dicomSeries: [],\r\n    loaderDicom: null,\r\n  },\r\n  options: defaultOptions\r\n}\r\n\r\nexport const initialState: State = state\r\n","\r\nexport const formatPatientData = (records: any) => {\r\n  return records.map((record: any) => ({\r\n    scanId: record[0],\r\n    startTime: record[1] ? new Date(record[1]) : new Date(),\r\n    endTime: record[2] ? new Date(record[2]) : new Date(),\r\n    currentModule: record[3],\r\n    progress: record[4],\r\n    mlStatus: record[5],\r\n    failed: record[6],\r\n    initiator: records[7],\r\n    outputLocation: record[8],\r\n    phases: record[9],\r\n    patientName: record[10],\r\n    patientAge: record[11],\r\n    patientSex: record[12],\r\n    scanTime: record[13] ? new Date(record[13]) : new Date(),\r\n  })\r\n  )\r\n}\r\n\r\nexport const formatBiomarkerData = (records: any) => {\r\n  return records.map((record: any) => ({\r\n    scanId: record[0],\r\n    marker: record[1],\r\n    value: record[2],\r\n    postTime: record[3] ? new Date(record[3]) : new Date(),\r\n  })\r\n  )\r\n}\r\n\r\nexport const formatDateString = (date: Date) => {\r\n  const dateString = date.toLocaleDateString();\r\n  const timeString = `${date.getHours().toString().padStart(2, '0')}:${date.getMinutes().toString().padStart(2, '0')}`\r\n  return `${dateString} ${timeString}`;\r\n}","import { ModuleFourOptions as mo4, ModuleOneOptions as mo1, ModuleThreeOptions as mo3, ModuleTwoOptions as mo2, Options, PatientData, State } from \"./types\";\r\nimport { initialState } from \"./state\";\r\nimport { StoreActionType } from './constants';\r\nimport { formatPatientData, formatBiomarkerData } from \"../utils/format\";\r\n\r\nconst massagePatientData = (state: State, patientData: PatientData[]) => {\r\n  const row: PatientData = patientData[0];\r\n  const res = state.nurseView.patients.findIndex(o => o.scanId === row.scanId)\r\n  const docRes = state.doctorView.patients.findIndex(o => o.scanId === row.scanId)\r\n  let newNurseData = [...state.nurseView.patients]\r\n  let newDocData = [...state.doctorView.patients]\r\n\r\n  if (row.currentModule === 5) {\r\n    if (res >= 0) {\r\n      newNurseData.splice(res, 1);\r\n      newDocData.push(row);\r\n    }\r\n    else if (docRes >= 0) {\r\n      newDocData[docRes] = row\r\n    }\r\n    else {\r\n      newDocData.push(row)\r\n    }\r\n  }\r\n  else {\r\n    if (res >= 0) {\r\n      newNurseData[res] = row;\r\n    }\r\n    else if (docRes >= 0) {\r\n      newDocData.splice(docRes, 1);\r\n      newNurseData.push(row);\r\n    }\r\n    else {\r\n      newNurseData.push(row)\r\n    }\r\n  }\r\n  return [newNurseData, newDocData]\r\n}\r\n\r\n\r\nexport const reducer = (state = initialState, action: any): State => {\r\n  switch (action.type) {\r\n    case StoreActionType.SET_IS_LOADED:\r\n      return { ...state, doctorView: { ...state.doctorView, isLoaded: action.isLoaded } }\r\n    case StoreActionType.SET_LOADER:\r\n        return { ...state, showLoader: action.showLoader }\r\n    case StoreActionType.SET_SPOT_COLOR:\r\n      return { ...state, visState: { ...state.visState, spotColor: [action.r, action.g, action.b] } }\r\n    case StoreActionType.SET_VOLUME_OPACITY:\r\n      return { ...state, visState: { ...state.visState, volumeOpacity: action.volumeOpacity} }\r\n    case StoreActionType.SET_SHOW_VENOUS_STRUCTURE:\r\n      return { ...state, visState: { ...state.visState, showVenousStructure: action.showVenousStructure} }\r\n    case StoreActionType.SET_SCANID:\r\n      return { ...state, doctorView: { ...state.doctorView, loadedScan: action.loadedScan } }\r\n    case StoreActionType.SET_VOLUME_SET:\r\n      return { ...state, visState: { ...state.visState, volumeSet: action.volumeSet } }\r\n    case StoreActionType.SET_TEXTURE3D:\r\n      return { ...state, visState: { ...state.visState, texture3d: action.texture3d } };\r\n    case StoreActionType.SET_VOLUME_INDEX:\r\n      return { ...state, visState: { ...state.visState, volumeIndex: action.volumeIndex } };\r\n    case StoreActionType.SET_MODE_VIEW:\r\n      return { ...state, visState: { ...state.visState, modeView: action.modeView } }\r\n    case StoreActionType.SET_MODE_2D:\r\n      return { ...state, visState: { ...state.visState, mode2d: action.mode2d } };\r\n    case StoreActionType.SET_SLIDER_2D:\r\n      return { ...state, visState: { ...state.visState, slider2d: action.slider2d } };\r\n    case StoreActionType.SET_MODE_3D:\r\n      return { ...state, visState: { ...state.visState, mode3d: action.mode3d } };\r\n    case StoreActionType.SET_MODE_3Droi:\r\n      return { ...state, visState: { ...state.visState, mode3droi: action.mode3droi } };\r\n    case StoreActionType.SET_SLIDER_3DR:\r\n      return { ...state, visState: { ...state.visState, slider3d_r: action.slider3d_r } };\r\n    case StoreActionType.SET_SLIDER_3DB:\r\n      return { ...state, visState: { ...state.visState, slider3d_b: action.slider3d_b } };\r\n    case StoreActionType.SET_SLIDER_3DG:\r\n      return { ...state, visState: { ...state.visState, slider3d_g: action.slider3d_g } };\r\n    case StoreActionType.SET_SLIDER_Opacity:\r\n      return { ...state, visState: { ...state.visState, sliderOpacity: action.sliderOpacity } };\r\n    case StoreActionType.SET_SLIDER_Isosurface:\r\n      return { ...state, visState: { ...state.visState, sliderIsosurface: action.sliderIsosurface } };\r\n    case StoreActionType.SET_SLIDER_ErRadius:\r\n      return { ...state, visState: { ...state.visState, sliderErRadius: action.sliderErRadius } };\r\n    case StoreActionType.SET_SLIDER_ErDepth:\r\n      return { ...state, visState: { ...state.visState, sliderErDepth: action.sliderErDepth } };\r\n    case StoreActionType.SET_VOLUME_Renderer:\r\n      return { ...state, visState: { ...state.visState, volumeRenderer: action.volumeRenderer } };\r\n    case StoreActionType.SET_SLIDER_Brightness:\r\n      return { ...state, visState: { ...state.visState, sliderBrightness: action.sliderBrightness } };\r\n    case StoreActionType.SET_SLIDER_Cut:\r\n      return { ...state, visState: { ...state.visState, sliderCut: action.sliderCut } };\r\n    case StoreActionType.SET_SLIDER_Quality:\r\n      return { ...state, visState: { ...state.visState, sliderQuality: action.sliderQuality } };\r\n    case StoreActionType.SET_2D_TOOLS_INDEX:\r\n      return { ...state, visState: { ...state.visState, indexTools2d: action.indexTools2d } };\r\n    case StoreActionType.SET_2D_X_POS:\r\n      return { ...state, visState: { ...state.visState, render2dxPos: action.render2dxPos } };\r\n    case StoreActionType.SET_2D_ZOOM:\r\n      return { ...state, visState: { ...state.visState, render2dZoom: action.render2dZoom } };\r\n    case StoreActionType.SET_2D_Y_POS:\r\n      return { ...state, visState: { ...state.visState, render2dyPos: action.render2dyPos } };\r\n    case StoreActionType.SET_UI_APP:\r\n      return { ...state, visState: { ...state.visState, uiApp: action.uiApp } };\r\n    case StoreActionType.SET_DICOM_INFO:\r\n      return { ...state, visState: { ...state.visState, dicomInfo: action.dicomInfo } };\r\n    case StoreActionType.SET_IS_TOOL3D:\r\n      return { ...state, visState: { ...state.visState, isTool3D: action.isTool3D } };\r\n    case StoreActionType.SET_GRAPHICS_2D:\r\n      return { ...state, visState: { ...state.visState, graphics2d: action.graphics2d } };\r\n    case StoreActionType.SET_SLIDER_Contrast3D:\r\n      return { ...state, visState: { ...state.visState, sliderContrast3D: action.sliderContrast3D } };\r\n    case StoreActionType.SET_ERR_ARRAY:\r\n      return { ...state, visState: { ...state.visState, arrErrors: action.arrErrors } };\r\n    case StoreActionType.SET_DICOM_SERIES:\r\n      return { ...state, visState: { ...state.visState, dicomSeries: action.dicomSeries } };\r\n    case StoreActionType.SET_LOADER_DICOM:\r\n      return { ...state, visState: { ...state.visState, loaderDicom: action.loaderDicom } };\r\n      case StoreActionType.SET_3D_ZOOM:\r\n      return { ...state, doctorView: { ...state.doctorView, zoom: action.zoom } };\r\n    case StoreActionType.SET_PATIENT_DATA: {\r\n      const patientData: PatientData[] = formatPatientData(action.payload)\r\n      return {\r\n        ...state,\r\n        doctorView: { ...state.doctorView, patients: patientData.filter(patient => patient.currentModule === 5) },\r\n        nurseView: { ...state.nurseView, patients: patientData.filter(patient => patient.currentModule !== 5) }\r\n      };\r\n    };\r\n    case StoreActionType.UPDATE_PATIENT_DATA: {\r\n      const patientData = formatPatientData([action.payload])\r\n      const [newNurseData, newDocData] = massagePatientData(state, patientData);\r\n      return {\r\n        ...state,\r\n        doctorView: { ...state.doctorView, patients: newDocData },\r\n        nurseView: { ...state.nurseView, patients: newNurseData }\r\n      };\r\n    };\r\n    case StoreActionType.UPDATE_BIOMARKER_DATA: {\r\n      const biomarkerData = formatBiomarkerData([action.payload])[0]\r\n      console.log(biomarkerData); // TODO actually do something with this\r\n      if (biomarkerData.marker === \"V0\") {\r\n        state.doctorView.volumeOfLeakage = biomarkerData.value;\r\n      }\r\n      else if (biomarkerData.marker === \"K1\") {\r\n        state.doctorView.rateOfLeakage = biomarkerData.value;\r\n      }\r\n\r\n      if (state.doctorView.rateOfLeakage !== -1 && state.doctorView.volumeOfLeakage !== -1) {\r\n        state.doctorView.timeOfStroke = Math.round(state.doctorView.volumeOfLeakage / state.doctorView.rateOfLeakage * 100) / 100;\r\n        state.doctorView.status = \"Bleeding\";\r\n      }\r\n      return {\r\n        ...state,\r\n      };\r\n    };\r\n    case StoreActionType.SET_NOTIFICATION: {\r\n      return {\r\n        ...state,\r\n        notification: action.payload,\r\n      };\r\n    }\r\n    case StoreActionType.SET_PHASETIMES:\r\n      return {\r\n        ...state,\r\n        doctorView: {\r\n          ...state.doctorView,\r\n          phaseTimes: action.payload\r\n        }\r\n      }\r\n    case StoreActionType.SET_INPUT:\r\n      const {\r\n        module, name, value\r\n      } = action.payload\r\n      const newState = {\r\n        ...state,\r\n        options: {\r\n          ...state.options\r\n        }\r\n      };\r\n      newState.options.moduleOne = { ...state.options.moduleOne }\r\n      newState.options.moduleTwo = { ...state.options.moduleTwo }\r\n      newState.options.moduleThree = { ...state.options.moduleThree }\r\n      newState.options.moduleFour = { ...state.options.moduleFour }\r\n      // heck you typescript for being annoying\r\n      // @ts-ignore\r\n      newState.options[module as keyof Options][name] = value as any;\r\n      return newState;\r\n    default: return { ...state }\r\n  }\r\n}","import { createContext, Dispatch, useReducer } from 'react';\r\nimport {reducer} from './reducer';\r\nimport {initialState} from './state';\r\nimport {State} from './types';\r\n\r\nexport const AppContext = createContext({} as [State, Dispatch<Record<string, any>>]);\r\n\r\nexport const AppContextProvider = (props: Record<string, any>) => {\r\n  const [state, dispatch] = useReducer(reducer, initialState);\r\n\r\n  return (\r\n    <AppContext.Provider\r\n      value={[state, dispatch]}>\r\n      {props.children}\r\n    </AppContext.Provider>\r\n  );\r\n};\r\n\r\n","/**\r\n * @fileOverview Texture3D\r\n * @author Epam\r\n * @version 1.0.0\r\n */\r\n\r\n// ********************************************************\r\n// Imports\r\n// ********************************************************\r\n\r\nimport * as THREE from 'three';\r\n\r\n\r\n// ********************************************************\r\n// Const\r\n// ********************************************************\r\n\r\n// ********************************************************\r\n// Class\r\n// ********************************************************\r\n\r\n/**\r\n * Class Texture3D  some text later...\r\n */\r\nexport default class Texture3D {\r\n  constructor() {\r\n    this.m_texture = -1;\r\n  }\r\n  createFromRawVolume(vol) {\r\n    this.m_texture = new THREE.DataTexture3D(vol.m_dataArray, vol.m_xDim, vol.m_yDim, vol.m_zDim);\r\n  }\r\n}\r\n","export default __webpack_public_path__ + \"static/media/module4demoSubset.nii.3164307a.gz\";","import axios from 'axios';\r\n\r\n// eslint-disable-next-line\r\nimport file from '../assets/module4demoSubset.nii.gz';\r\nexport default class httpClient {\r\n\r\n  async getFileName(scanId: string) {\r\n    try {\r\n      return await axios.get(file, {\r\n        responseType: 'blob',\r\n        params: {\r\n          scan_id: scanId,\r\n          tc: (new Date()).getTime()\r\n        }\r\n      })\r\n    }\r\n    catch (e) {\r\n      return e\r\n    }\r\n  }\r\n\r\n  async getTiming(scanId: string) {\r\n    return JSON.parse(`[\r\n      5e-05,\r\n      2.1e-05,\r\n      2e-05,\r\n      3e-05,\r\n      2e-05,\r\n      2e-05,\r\n      2e-05,\r\n      3e-05,\r\n      2e-05,\r\n      2.1e-05,\r\n      3e-05,\r\n      2e-05,\r\n      2e-05,\r\n      6e-05,\r\n      6.1e-05,\r\n      5e-05,\r\n      6e-05,\r\n      6.1e-05\r\n    ]`);\r\n    /*\r\n    axios.get('http://localhost:5000/file_retriever/timing', {\r\n      responseType: 'json',\r\n      params: {\r\n        scan_id: scanId,\r\n        tc: (new Date()).getTime()\r\n      }\r\n    })\r\n    */\r\n  }\r\n}","export default function Worker_fn() {\n  return new Worker(__webpack_public_path__ + \"static/js/file-worker.633e076d.worker.js\");\n}\n","/* eslint-disable no-fallthrough */\r\nimport { faSpinner, faTimesCircle, faCheckCircle } from \"@fortawesome/free-solid-svg-icons\";\r\nimport { Dispatch } from \"react\";\r\nimport Texture3D from \"../components/visualization/engine/Texture3D\";\r\nimport Volume from \"../components/visualization/engine/Volume\";\r\nimport VolumeSet from \"../components/visualization/engine/VolumeSet\";\r\nimport { StoreActionType, ModeView, Modes3d } from \"../context/constants\";\r\nimport { NotificationStatus } from \"../context/types\";\r\nimport HttpClient from './httpClient';\r\n// eslint-disable-next-line import/no-webpack-loader-syntax\r\nimport FileWorker from \"worker-loader!./file-worker\"\r\n\r\nexport const runFileWorker = async (dispatch: Dispatch<any>, scanId: string) => {\r\n  const api = new HttpClient();\r\n\r\n  dispatch({\r\n    type: StoreActionType.SET_NOTIFICATION,\r\n    payload: {\r\n      body: '',\r\n      header: 'Loading 4D Image',\r\n      isVisible: true,\r\n      icon: faSpinner,\r\n      spin: true,\r\n      timer: null\r\n    }\r\n  });\r\n\r\n\r\n  const res = await api.getFileName(scanId);\r\n\r\n  if (res instanceof Error) {\r\n    dispatch({\r\n      type: StoreActionType.SET_NOTIFICATION,\r\n      payload: {\r\n        body: 'Couldn\\'t find an image',\r\n        header: 'Loading failed',\r\n        isVisible: false,\r\n        status: NotificationStatus.FAILURE,\r\n        icon: faTimesCircle,\r\n        timer: 4000\r\n      }\r\n    });\r\n    return\r\n  }\r\n  console.log(res);\r\n\r\n  const worker = new FileWorker()\r\n  worker.postMessage({ data: res.data, scanId });\r\n  worker.onerror = (err) => {\r\n    worker.terminate()\r\n    dispatch({\r\n      type: StoreActionType.SET_NOTIFICATION,\r\n      payload: {\r\n        body: 'An error occurred while loading the image.',\r\n        header: 'Loading failed',\r\n        isVisible: false,\r\n        status: NotificationStatus.FAILURE,\r\n        icon: faTimesCircle,\r\n        timer: 4000\r\n      }\r\n    });\r\n\r\n    console.log(err)\r\n  };\r\n\r\n  let hydratedTex3d: Texture3D;\r\n  let volumeSetWithData: VolumeSet;\r\n  let m_volumes: Volume[] = [];\r\n\r\n    // api.getTiming(scanId).then(function(response) {\r\n    //     //expecting array of timing differences in seconds, elements should be one less than phases\r\n    //     if (response.status === 200 && response.data.length > 0) {\r\n    //         console.log(\"dispatching phase\");\r\n    //         dispatch({ type: StoreActionType.SET_PHASETIMES, payload: response.data });\r\n    //     }\r\n    // })\r\n\r\n  worker.onmessage = (e) => {\r\n    // ctx.postMessage({status: 'start', text3d: JSON.stringify(tex3d)})\r\n    // ctx.postMessage({status: 'vol', volume: JSON.stringify(v), data})\r\n    // ctx.postMessage({status: 'end', volumeSet: JSON.stringify(volumeSet)});\r\n    // ctx.postMessage({status: 'fail'});\r\n\r\n    // All these objects are JSON stringified version of themselves\r\n    const { status, volume, volumeSet, tex3d, data } = e.data;\r\n\r\n    switch(status) {\r\n      case 'start':\r\n        hydratedTex3d = Object.assign(new Texture3D(), JSON.parse(tex3d));\r\n        console.log(`Volume loaded, transferring from worker...`);\r\n        break;\r\n      case 'vol':\r\n        const hydratedVolume = Object.assign(new Texture3D(), JSON.parse(volume));\r\n        hydratedVolume.m_dataArray = data;\r\n        m_volumes.push(hydratedVolume);\r\n        console.log(`   Got volume ${m_volumes.length}`)\r\n        break;\r\n      case 'end':\r\n        volumeSetWithData= Object.assign(new VolumeSet({}), JSON.parse(volumeSet));\r\n        volumeSetWithData.m_volumes = m_volumes;\r\n\r\n        const fullyRehydratedVolumeSet = Object.assign(new VolumeSet({}), volumeSetWithData);\r\n\r\n        dispatch({ type: StoreActionType.SET_LOADER, showLoader: true});\r\n        dispatch({ type: StoreActionType.SET_VOLUME_SET, volumeSet: fullyRehydratedVolumeSet });\r\n        dispatch({ type: StoreActionType.SET_VOLUME_INDEX, volumeIndex: m_volumes.length - 1 });\r\n        dispatch({ type: StoreActionType.SET_IS_LOADED, isLoaded: true });\r\n        dispatch({ type: StoreActionType.SET_SCANID, loadedScan: scanId});\r\n        dispatch({ type: StoreActionType.SET_ERR_ARRAY, arrErrors: [] });\r\n        dispatch({ type: StoreActionType.SET_TEXTURE3D, texture3d: hydratedTex3d });\r\n        dispatch({ type: StoreActionType.SET_MODE_VIEW, modeView: ModeView.VIEW_2D });\r\n        dispatch({ type: StoreActionType.SET_MODE_3D, mode3d: Modes3d.RAYCAST });\r\n        dispatch({\r\n          type: StoreActionType.SET_NOTIFICATION,\r\n          payload: {\r\n            body: '',\r\n            header: 'Success',\r\n            isVisible: false,\r\n            status: NotificationStatus.SUCCESS,\r\n            icon: faCheckCircle,\r\n            timer: 4\r\n          }\r\n        });\r\n        console.log(`Volume transferring finished.`);\r\n        worker.terminate();\r\n        break;\r\n      case 'fail':\r\n      default:\r\n        worker.terminate();\r\n    }\r\n  };\r\n\r\n}\r\n","import React from 'react';\r\n\r\ninterface LoadingCircleProps {\r\n  progress: number,\r\n  radius: number,\r\n  stroke: number\r\n}\r\n\r\nexport default function LoadingCircle({ progress, radius, stroke }: LoadingCircleProps) {\r\n\r\n  const normalizedRadius = radius - stroke * 2;\r\n  const circumference = normalizedRadius * 2 * Math.PI;\r\n  const strokeDashoffset = circumference - progress / 100 * circumference;\r\n\r\n  return (\r\n    <svg\r\n      height={radius * 2}\r\n      width={radius * 2}\r\n      >\r\n      <circle\r\n        stroke=\"lightgreen\"\r\n        fill=\"transparent\"\r\n        strokeWidth={ stroke }\r\n        strokeDasharray={ circumference + ' ' + circumference }\r\n        style={ { strokeDashoffset } }\r\n        r={ normalizedRadius }\r\n        cx={ radius }\r\n        cy={ radius }\r\n        />\r\n    </svg>\r\n  );\r\n}","import React, { useContext } from 'react';\r\nimport StoreActionType from '../../context/constants/ActionTypes';\r\nimport { AppContext } from '../../context/context';\r\nimport { PatientData } from '../../context/types';\r\nimport { runFileWorker } from '../../utils/fileWorkerUtil';\r\nimport { formatDateString } from '../../utils/format';\r\nimport LoadingCircle from './LoadingCircle';\r\nimport './Shared.css';\r\n\r\ninterface PatienListProps {\r\n  isNurse: boolean;\r\n}\r\n\r\nexport default function PatientList({ isNurse }: PatienListProps) {\r\n  const [state, dispatch] = useContext(AppContext)\r\n  const patients = isNurse ? state.nurseView.patients : state.doctorView.patients\r\n\r\n  const getModuleName = (module: number) => {\r\n    switch (module) {\r\n      case 0:\r\n        return \"Initializing\"\r\n      case 1:\r\n        return \"Preprocessing\"\r\n      case 2:\r\n        return \"Extract Brain Region\"\r\n      case 3:\r\n        return \"Vascular Segmentation\"\r\n      case 4:\r\n        return \"Dynamic Spot Selection\"\r\n      case 5:\r\n        return \"Completed\"\r\n    }\r\n  }\r\n\r\n  const runFileWorkerClick = async (scanId: string) => {\r\n    if (state.doctorView.loadedScan !== scanId)\r\n      return await runFileWorker(dispatch, scanId);\r\n    else\r\n      return dispatch({ type: StoreActionType.SET_IS_LOADED, isLoaded: true });\r\n  }\r\n\r\n  return (\r\n    <div className=\"file-list fill\">\r\n      <div className=\"col-12 px-0 py-4 flex center top\">\r\n        <div className=\"col-8 p-0 flex center top \">\r\n          <h3 className=\"header\">Patient Files</h3>\r\n          {!patients.length &&\r\n            <div className=\"col-12 flex space-around\">\r\n              <div className=\"col-12\" style={{'color': 'grey'}}>\r\n                No {isNurse ? 'in-progress' : 'completed'} scans.\r\n              </div>\r\n            </div>\r\n          }\r\n          {!!patients.length && patients.map((patient: PatientData) => (\r\n            <div key={patient.scanId}\r\n              className=\"col-12 flex space-between file-item\"\r\n              onClick={async () => await runFileWorkerClick(patient.scanId) }>\r\n              <div className=\"col-5 flex left\" >\r\n                {patient.patientName || patient.scanId}\r\n              </div>\r\n              <div className=\"col-3 flex left\">\r\n                {formatDateString(patient.startTime)}\r\n              </div>\r\n              <div className=\"col-4 p-0 flex right\">\r\n                <div className=\"pr-1\">\r\n                  ({getModuleName(patient.currentModule)})\r\n                </div>\r\n                {patient.progress}%\r\n                <LoadingCircle radius={10} stroke={2} progress={patient.progress} />\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  )\r\n}","import React, { useContext, useEffect, useState } from 'react';\r\nimport { Col, ProgressBar, Dropdown } from 'react-bootstrap';\r\nimport Nouislider from 'react-nouislider';\r\nimport Graphics3d from '../../components/visualization/engine/Graphics3d';\r\nimport { Modes3d, StoreActionType } from '../../context/constants';\r\nimport { AppContext } from '../../context/context';\r\nimport PatientList from '../shared/PatientList';\r\nimport wNumb from 'wnumb';\r\nimport Loader from \"react-loader-spinner\";\r\n//styles\r\nimport \"./DoctorView.scss\";\r\nimport \"react-loader-spinner/dist/loader/css/react-spinner-loader.css\";\r\n\r\n\r\nfunction DoctorView() {\r\n  const [state, dispatch] = useContext(AppContext)\r\n  const [showProgressBar, setShowProgressBar] = useState(false)\r\n  const [strProgressMessage, setMessage] = useState(\"Loading...\");\r\n  const [progressBarRatio, setRatio] = useState(0);\r\n  const [spinning, toggleSpin] = useState(false);\r\n  const options = ['Anterior Axial', 'Coronal'];\r\n  const [currentOption, setOption] = useState(0);\r\n\r\n  const graphics3d = React.useRef<Graphics3d>(null);\r\n  const slider = React.useRef<Nouislider>(null);\r\n  const opacitySlider = React.useRef<Nouislider>(null);\r\n  const zoomSlider = React.useRef<Nouislider>(null);\r\n\r\n  const volSet = state.visState.volumeSet;\r\n  const volumeIndex = [state.visState.volumeIndex];\r\n\r\n  const sliderOpacity = [state.visState.volumeOpacity];\r\n  const isNormalView = state.visState.mode3d === Modes3d.RAYCAST;\r\n  const showVenousStructure = state.visState.showVenousStructure;\r\n\r\n  const MIN_ZOOM = 0.5;\r\n  const MAX_ZOOM = 2;\r\n\r\n  let numVolumes = 0;\r\n  if (volSet !== null && volSet !== undefined) {\r\n    numVolumes = volSet.getNumVolumes();\r\n  }\r\n\r\n  const closeVis = () => {\r\n    dispatch({ type: StoreActionType.SET_LOADER, showLoader: false});\r\n    // dispatch({ type: StoreActionType.SET_VOLUME_SET, volumeSet: null });\r\n    // dispatch({ type: StoreActionType.SET_VOLUME_INDEX, volumeIndex: 0 });\r\n    dispatch({ type: StoreActionType.SET_IS_LOADED, isLoaded: false });\r\n    // dispatch({ type: StoreActionType.SET_FILENAME, fileName: \"\" });\r\n    // dispatch({ type: StoreActionType.SET_ERR_ARRAY, arrErrors: [] });\r\n    // dispatch({ type: StoreActionType.SET_TEXTURE3D, texture3d: null });\r\n  }\r\n\r\n  const timeConversion = (time: number) => {\r\n\r\n    const milliseconds = (time * 1000)\r\n\r\n    const microseconds = (milliseconds * 1000)\r\n\r\n    const nanoseconds = (microseconds * 1000000000)\r\n\r\n    if (milliseconds > 1) {\r\n      return milliseconds.toFixed(0);\r\n    } else if (microseconds > 1) {\r\n      return microseconds.toFixed(0);\r\n    } else if (nanoseconds > 1) {\r\n      return nanoseconds.toFixed(0);\r\n    } else {\r\n      return time.toFixed(2);\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    class appUI {\r\n      doHideProgressBar() {\r\n        setShowProgressBar(false)\r\n      }\r\n      doShowProgressBar(str: string) {\r\n        setMessage(str)\r\n        setShowProgressBar(true)\r\n      }\r\n      doSetProgressBarRatio(ratio: number) {\r\n        if ((ratio >= 0) && (ratio <= 99)) {\r\n          if (!showProgressBar) {\r\n            setShowProgressBar(true)\r\n          }\r\n          setRatio(ratio)\r\n        }\r\n      }\r\n    }\r\n    const app = new appUI()\r\n    dispatch({\r\n      type: StoreActionType.SET_UI_APP,\r\n      uiApp: app\r\n    });\r\n\r\n    dispatch({\r\n      type: StoreActionType.SET_VOLUME_INDEX,\r\n      volumeIndex: numVolumes - 1\r\n    })\r\n  }, [])\r\n\r\n  const objPrgBarVis = (\r\n    <div className=\"col-12 flex center\" style={{ marginTop: 'auto' }}>\r\n      <Col xs xl sm md lg=\"12\" style={{ width: '100%', color: 'whitesmoke' }}>\r\n        {strProgressMessage}\r\n        <ProgressBar animated variant=\"success\"\r\n          now={progressBarRatio} label={`${progressBarRatio}%`} />\r\n      </Col>\r\n    </div>)\r\n\r\n  const onChangePhase = (target: string[]) => {\r\n    if (graphics3d.current && graphics3d.current.isLoaded) // we dont want to load new phases until the last one is finished\r\n      dispatch({ type: StoreActionType.SET_VOLUME_INDEX, volumeIndex: Number.parseInt(target[0]) });\r\n    else if (slider.current)\r\n      slider.current.set(state.visState.volumeIndex)\r\n\r\n  }\r\n\r\n  const onChangeZoom = (zoom: number, increment?: number) => {\r\n    zoom = zoom / 10;\r\n    zoom = Number.parseFloat(zoom.toFixed(1));\r\n    if (increment !== undefined) {\r\n      if (increment === 1) {\r\n        zoom += 0.1;\r\n        zoom = zoom > MAX_ZOOM ? MAX_ZOOM : zoom;\r\n      }\r\n      else {\r\n        zoom -= 0.1;\r\n        zoom = zoom < MIN_ZOOM ? MIN_ZOOM : zoom;\r\n      }\r\n    }\r\n    dispatch({ type: StoreActionType.SET_3D_ZOOM, zoom: zoom });\r\n    state.visState.volumeRenderer.orbitControl.setZoom(zoom);\r\n  }\r\n\r\n  const dateFormatting = (date: Date) => {\r\n    const time = date.toDateString()\r\n    return time;\r\n  };\r\n\r\n  const toggleSpot = () => {\r\n    if (isNormalView) {\r\n      dispatch({ type: StoreActionType.SET_MODE_3D, mode3d: Modes3d.RAYFAST });\r\n    }\r\n    else {\r\n      dispatch({ type: StoreActionType.SET_MODE_3D, mode3d: Modes3d.RAYCAST });\r\n    }\r\n  }\r\n\r\n  const toggleVenousStructure = () => {\r\n    dispatch({ type: StoreActionType.SET_SHOW_VENOUS_STRUCTURE, showVenousStructure: !showVenousStructure });\r\n  }\r\n\r\n  const timeUnit = (time: number) => {\r\n\r\n    const milliseconds = (time * 1000)\r\n\r\n    const microseconds = (milliseconds * 1000)\r\n\r\n    const nanoseconds = (microseconds * 1000000000)\r\n\r\n    if (milliseconds > 1) {\r\n      return 'ms'\r\n    } else if (microseconds > 1) {\r\n      return 'us'\r\n    } else if (nanoseconds > 1) {\r\n      return 'ns'\r\n    } else {\r\n      return 's'\r\n    }\r\n  }\r\n\r\n  const handleSliderChange = (opacity: number) => {\r\n    dispatch({ type: StoreActionType.SET_VOLUME_OPACITY, volumeOpacity: opacity / 100 });\r\n  }\r\n\r\n  const setView = (key: any, e: any) => {\r\n      const newViewMode = Number.parseInt(e.target.id);\r\n      if (state.visState.volumeRenderer) {\r\n          state.visState.volumeRenderer.setPresetView(newViewMode);\r\n          setOption(newViewMode);\r\n      }\r\n  }\r\n\r\n  return (\r\n    <div className=\"col-12 p-0 flex fill\">\r\n      {!state.doctorView.isLoaded && <PatientList isNurse={false} />}\r\n      {state.doctorView.isLoaded && (<div className=\"overlay flex\">\r\n        <div className=\"col-3 p-3 flex left\">\r\n          <div className=\"col-12 p-0 flex left data-header\">\r\n            Status\r\n          </div>\r\n          <h3 className=\"data-large\">\r\n            {state.doctorView.status}\r\n          </h3>\r\n          <div className=\"col-12 p-0 flex left data-header\">\r\n            Est. Rate of Leakage\r\n          </div>\r\n          <h3 className=\"data-large\">\r\n            {state.doctorView.rateOfLeakage} ml/min\r\n          </h3>\r\n          <div className=\"col-12 p-0 flex left data-header\">\r\n            Est. Time of Stroke\r\n          </div>\r\n          <h3 className=\"data-large\">\r\n            {state.doctorView.timeOfStroke / 60} min\r\n          </h3>\r\n          {/* note: should only allow button to be selected if a spot is identified */}\r\n          <div className=\"col-12 p-0 flex left\">\r\n            <button className=\"button-main\" style={{ 'background': isNormalView ? '' : 'dimgrey' }} onClick={() => toggleSpot()}>Reveal SPOT</button>\r\n          </div>\r\n          {\r\n            state.visState.volumeRenderer &&\r\n          <div className=\"col-12 p-0 flex left\">\r\n            <button className=\"button-main\" style={{ 'background': !spinning ? '' : 'dimgrey' }} onClick={() => toggleSpin(state.visState.volumeRenderer.setAutoSpin(!spinning))}>Auto rotate</button>\r\n          </div>\r\n          }\r\n          <div className=\"col-12 p-0 flex left\">\r\n            <button className=\"button-main\" style={{ 'background': !showVenousStructure ? '' : 'dimgrey' }} onClick={() => toggleVenousStructure()}>Show Venous Structure</button>\r\n          </div>\r\n          <div className=\"col-12 p-0 flex left\">\r\n            <div className=\"data-header\">\r\n                Orientation\r\n            </div>\r\n            <Dropdown className=\"dropdown\" id=\"dropdown-basic-button\" onSelect={setView}>\r\n                <Dropdown.Toggle id={JSON.stringify(Math.random())}>{options[currentOption]}</Dropdown.Toggle>\r\n                <Dropdown.Menu >\r\n                    {options.map((option, index) => (\r\n                        <Dropdown.Item id={index}>{option}</Dropdown.Item>)\r\n                    )}\r\n                </Dropdown.Menu>\r\n            </Dropdown>\r\n        </div>\r\n          <div className=\"col-auto p-0 flex column small-slider vertical\">\r\n            <i className=\"fas fa-search-plus mb-3\" style={{ color: 'white', cursor: 'pointer' }} onClick={() => onChangeZoom(zoomSlider.current.slider.get(), 0)}></i>\r\n            <Nouislider onSlide={(data: any) => onChangeZoom(data)}\r\n              range={{ min: MIN_ZOOM * 10, max: MAX_ZOOM * 10 }}\r\n              animate={false}\r\n              ref={zoomSlider}\r\n              orientation=\"vertical\"\r\n              // style={{ height: 100 }}\r\n              width={10}\r\n              start={[state.doctorView.zoom * 10]} connect={[false, true]} step={1} tooltips={false}\r\n              format={wNumb({ decimals: 1 })} />\r\n            <i className=\"fas fa-search-minus  mt-3\" style={{ color: 'white', cursor: 'pointer' }} onClick={() => onChangeZoom(zoomSlider.current.slider.get(), 1)}></i>\r\n          </div>\r\n        </div>\r\n        <div className=\"col-6 p-0\">\r\n        </div>\r\n        <div className=\"col-3 p-4 flex right top\">\r\n          <div className=\"col-12 p-0 data-header flex right\">\r\n            John Doe\r\n          </div>\r\n          <div className=\"col-12 p-0 data-header flex right\">\r\n            {state.doctorView.title}\r\n          </div>\r\n          <div className=\"col-12 p-0 data-header flex right\">\r\n            {dateFormatting(state.doctorView.date)}\r\n          </div>\r\n          <div className=\"col-12 p-0 data-header flex right\">\r\n            Age: 72\r\n          </div>\r\n          <div className=\"col-12 p-0 data-header flex right\">\r\n            Sex: M\r\n          </div>\r\n          <div className=\"col-12 p-0\">\r\n            <button className=\"button-main\" onClick={() => closeVis()}>Close</button>\r\n          </div>\r\n          <div className=\"col-12 pt-2 px-0 flex data-header right\">\r\n            <b>\r\n              Volume Opacity: {(state.visState.volumeOpacity * 100).toFixed(0)}%\r\n            </b>\r\n          </div>\r\n          <div className=\"col-auto p-0 flex small-slider vertical\">\r\n            <Nouislider onSlide={(data: any) => handleSliderChange(data)}\r\n              range={{ min: 0, max: 100 }}\r\n              ref={opacitySlider}\r\n              direction=\"rtl\"\r\n              start={[state.visState.volumeOpacity * 100]}\r\n              connect={[true, false]}\r\n              orientation=\"vertical\"\r\n              step={1} />\r\n          </div>\r\n        </div>\r\n        <div className=\"col-12 p-0 flex center slider-container\">\r\n          <div className=\"col-8 p-4 slider\">\r\n            {\r\n              numVolumes > 1 &&\r\n              <Nouislider onSet={(data: any) => onChangePhase(data)}\r\n                range={{ min: 0, max: numVolumes - 1 }}\r\n                // range={{ min: 0, max: 10 }}\r\n                ref={slider}\r\n                style={{ height: 100, cursor: 'pointer' }}\r\n                start={volumeIndex} connect={[true, false]} step={1} tooltips={true} format={wNumb({ decimals: 0 })} />\r\n            }\r\n            {state.doctorView.phaseTimes.length > 0 && numVolumes > 1 &&\r\n              <div className=\"col-12 p-0 flex space-between\">\r\n                <div className=\"data-header flex center column tick\">\r\n                  <div className=\"tick-line\" />\r\n                  <h5>0s</h5>\r\n                </div>\r\n                {state.doctorView.phaseTimes.map(num => (\r\n                  <div className=\"data-header flex center column tick\">\r\n                    <div className=\"tick-line\" />\r\n                    <h5>{num}s</h5>\r\n                  </div>\r\n                ))}\r\n              </div>}\r\n          </div>\r\n        </div>\r\n      </div>\r\n      )}\r\n\r\n        <div className=\"loader-container\">\r\n            <Loader\r\n                type=\"ThreeDots\"\r\n                color=\"#95afcd\"\r\n                height={250}\r\n                width={250}\r\n                visible={state.showLoader}\r\n            />\r\n        </div>\r\n      {state.doctorView.isLoaded &&\r\n        (<div className=\"flex col-12\">\r\n          <div className=\"col-12 flex graphics-center\">\r\n            <Graphics3d ref={graphics3d} store={state} dispatch={dispatch} />\r\n          </div>\r\n        </div>\r\n        )}\r\n\r\n      {showProgressBar ? objPrgBarVis : null}\r\n    </div >\r\n  );\r\n}\r\n\r\nexport default DoctorView;\r\n","import React from 'react';\r\nimport { Button } from 'react-bootstrap';\r\nimport { Link } from 'react-router-dom';\r\n\r\nexport default function Home() {\r\n  return (<div className=\"col-12 p-0 flex fill center\">\r\n    <h2 className=\"header\">I am a</h2>\r\n    <div className=\"col-12 p-0 flex center\">\r\n      <Button className=\"m-2 button-main button-large\"> <Link to=\"/frontend-demo/doctor\">Doctor</Link></Button>\r\n      <Button className=\"m-2 button-main button-large\"> <Link to=\"/frontend-demo/nurse\">Nurse</Link> </Button>\r\n      <Button className=\"m-2 button-main button-large\"> <Link to=\"/frontend-demo/radiologist\">Radiologist</Link> </Button>\r\n    </div>\r\n\r\n  </div>)\r\n}","import React, { useContext, useEffect } from 'react';\r\nimport { StoreActionType } from '../../context/constants';\r\nimport { AppContext } from '../../context/context';\r\nimport PatientList from '../shared/PatientList';\r\nimport Graphics3d from '../visualization/engine/Graphics3d';\r\nimport Loader from \"react-loader-spinner\";\r\nimport \"react-loader-spinner/dist/loader/css/react-spinner-loader.css\";\r\nimport { useHistory } from \"react-router-dom\";\r\n\r\nexport default function NurseView() {\r\n  const [state, dispatch] = useContext(AppContext);\r\n  let history = useHistory();\r\n  const graphics3d = React.useRef<Graphics3d>(null);\r\n  const volSet = state.visState.volumeSet;\r\n  let numVolumes = 0;\r\n  if (volSet !== null && volSet !== undefined) {\r\n    numVolumes = volSet.getNumVolumes();\r\n  }\r\n\r\n  const closeVis = () => {\r\n    dispatch({ type: StoreActionType.SET_LOADER, showLoader: false});\r\n    // dispatch({ type: StoreActionType.SET_VOLUME_SET, volumeSet: null });\r\n    // dispatch({ type: StoreActionType.SET_VOLUME_INDEX, volumeIndex: 0 });\r\n    dispatch({ type: StoreActionType.SET_IS_LOADED, isLoaded: false });\r\n    // dispatch({ type: StoreActionType.SET_FILENAME, fileName: \"\" });\r\n    // dispatch({ type: StoreActionType.SET_ERR_ARRAY, arrErrors: [] });\r\n    // dispatch({ type: StoreActionType.SET_TEXTURE3D, texture3d: null });\r\n  }\r\n\r\n    //auto-nav to doctor view if 4d volume or close if came from doctor view\r\n    // if (numVolumes > 1) {\r\n    //     console.log(\"history: \", history)\r\n    //     if (history.location.pathname === \"/doctor\") {\r\n    //         console.log(\"closed vis\");\r\n    //         closeVis();\r\n    //     }\r\n    //     else {\r\n    //         history.push(\"/doctor\");\r\n    //         history.replace(\"/doctor\");\r\n    //     }\r\n    // }\r\n\r\n  const dateFormatting = (date: Date) => {\r\n    const time = date.toDateString()\r\n    return time;\r\n  };\r\n\r\n  return (\r\n    <div className=\"col-12 p-0 flex fill\">{!state.doctorView.isLoaded &&\r\n      <PatientList isNurse={true}></PatientList>}\r\n      {state.doctorView.isLoaded && (<div className=\"overlay flex\">\r\n        <div className=\"col-3 p-3 flex left\">\r\n          <div className=\"col-12 p-0 flex left data-header\">\r\n            Status\r\n       </div>\r\n          <h3 className=\"data-large\">\r\n            {state.doctorView.status}\r\n          </h3>\r\n          <div className=\"col-12 p-0 flex left data-header\">\r\n            Est. Rate of Leakage\r\n       </div>\r\n          <h3 className=\"data-large\">\r\n            {state.doctorView.rateOfLeakage} ml/s\r\n       </h3>\r\n          <div className=\"col-12 p-0 flex left data-header\">\r\n            Est. Time of Stroke\r\n       </div>\r\n          <h3 className=\"data-large\">\r\n            {state.doctorView.timeOfStroke} s\r\n          </h3>\r\n        </div>\r\n        <div className=\"col-6 p-0\">\r\n        </div>\r\n        <div className=\"col-3 p-4 flex right top\">\r\n          <div className=\"col-12 p-0 data-header flex right\">\r\n            {state.doctorView.title}\r\n          </div>\r\n          <div className=\"col-12 p-0 data-header flex right\">\r\n            {dateFormatting(state.doctorView.date)}\r\n          </div>\r\n          <button className=\"button-main\" onClick={() => closeVis()}>Close</button>\r\n        </div>\r\n      </div>)}\r\n\r\n      <div className=\"loader-container\">\r\n            <Loader\r\n                type=\"ThreeDots\"\r\n                color=\"#95afcd\"\r\n                height={250}\r\n                width={250}\r\n                visible={state.showLoader}\r\n            />\r\n        </div>\r\n      {state.doctorView.isLoaded &&\r\n        (<div className=\"col-12 flex graphics-center\">\r\n          <Graphics3d ref={graphics3d} store={state} dispatch={dispatch} />\r\n        </div>)}\r\n    </div>)\r\n}","import React, { useEffect, useContext, useState } from 'react';\r\nimport { Form } from 'react-bootstrap';\r\nimport { StoreActionType } from '../../context/constants';\r\nimport { AppContext } from '../../context/context';\r\n\r\ninterface CheckboxProps {\r\n  label: string,\r\n  defaultValue: boolean,\r\n  reset: boolean,\r\n  module: string,\r\n  name: string\r\n}\r\n\r\nexport default function Checkbox({ label, reset, defaultValue, module, name }: CheckboxProps) {\r\n\r\n  const [state, dispatch] = useContext(AppContext);\r\n  // Hecking typescript\r\n  // @ts-ignore\r\n  const optionModule = state.options[module as keyof Options]\r\n  const value = optionModule[name]\r\n\r\n  useEffect(() => {\r\n    console.log(reset);\r\n    if (reset) {\r\n      dispatchValue(defaultValue)\r\n    }\r\n  }, [reset])\r\n\r\n  const dispatchValue = (value: boolean) => {\r\n    dispatch({\r\n      type: StoreActionType.SET_INPUT,\r\n      payload: {\r\n        module, name, value\r\n      }\r\n    })\r\n  }\r\n\r\n  const handleChange = (e: React.ChangeEvent<any>) => {\r\n    dispatchValue(!value)\r\n  }\r\n\r\n  return (\r\n    <Form.Group controlId=\"formBasicPassword\" className=\"flex left\">\r\n      <Form.Check\r\n        type={'checkbox'}\r\n        checked={value}\r\n        label={label}\r\n        onChange={e => handleChange(e)}\r\n      />\r\n    </Form.Group>)\r\n}","import React, { useEffect, useContext, useState } from 'react';\r\nimport { Form } from 'react-bootstrap';\r\nimport { StoreActionType } from '../../context/constants';\r\nimport { AppContext } from '../../context/context';\r\n\r\ninterface InputProps {\r\n  label: string,\r\n  defaultValue: string,\r\n  placeholder?: string,\r\n  reset: boolean,\r\n  module: string,\r\n  name: string\r\n}\r\n\r\nexport default function Input({ label, reset, defaultValue, placeholder, module, name }: InputProps) {\r\n  const [state, dispatch] = useContext(AppContext);\r\n  // Hecking typescript\r\n  // @ts-ignore\r\n  const optionModule = state.options[module as keyof Options]\r\n  const value = optionModule[name]\r\n\r\n  useEffect(() => {\r\n    if (reset) {\r\n      dispatchValue(defaultValue)\r\n    }\r\n  }, [reset])\r\n\r\n  const dispatchValue = (value: string) => {\r\n    dispatch({\r\n      type: StoreActionType.SET_INPUT,\r\n      payload: {\r\n        module, name, value\r\n      }\r\n    })\r\n  }\r\n\r\n  const handleChange = (e: React.ChangeEvent<any>) => {\r\n    console.log(e);\r\n    dispatchValue(e.target.value);\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex\">\r\n      <Form.Group controlId={value} className=\"flex left\">\r\n        <Form.Label>{label}</Form.Label>\r\n        <Form.Control value={value} type=\"email\" placeholder={placeholder} onChange={e => handleChange(e)} />\r\n      </Form.Group>\r\n    </div >)\r\n}","import { faChevronCircleDown, faChevronCircleUp } from '@fortawesome/free-solid-svg-icons';\r\nimport { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport React, { useState } from 'react';\r\n\r\n\r\ninterface ModuleOptionsProps {\r\n  title: string\r\n}\r\n\r\nconst ModuleOptions: React.FunctionComponent<ModuleOptionsProps> = (props) => {\r\n  const [collapsed, setCollapsed] = useState(true);\r\n\r\n  return (\r\n    <div className=\"module-container col-12 p-1\" >\r\n      <h5 className=\"space-between header pointer col-12 p-0 flex\" onClick={() => setCollapsed(!collapsed)}>\r\n        {props.title}\r\n        <i>\r\n          <FontAwesomeIcon icon={collapsed ? faChevronCircleDown : faChevronCircleUp} />\r\n        </i>\r\n      </h5>\r\n      {!collapsed && (\r\n        <div className=\"flex text\">\r\n          {props.children}\r\n        </div>\r\n      )}\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default ModuleOptions","import React, { useContext, useState } from 'react';\r\nimport { AppContext } from '../../../context/context';\r\nimport Checkbox from '../../shared/Checkbox';\r\nimport Input from '../../shared/Input';\r\nimport ModuleOptions from '../ModuleOptions';\r\n\r\ninterface ModuleOptionsProps {\r\n  reset: boolean\r\n}\r\n\r\nexport default function ModuleFourOptions({ reset }: ModuleOptionsProps) {\r\n  const [, dispatch] = useContext(AppContext);\r\n\r\n  return (\r\n    <ModuleOptions title={\"Dynamic Spot Extraction Options (Module 4)\"}>\r\n      <div className=\"flex column fill col-12\">\r\n        <b className=\"fit p-0 flex\">\r\n          General Options\r\n          </b>\r\n        <Checkbox\r\n          label=\"Restart Enabled\"\r\n          defaultValue={true}\r\n          reset={reset}\r\n          name=\"enableRestart\"\r\n          module=\"moduleFour\" />\r\n        <Input\r\n          label=\"Vascular Mask Data Directory\"\r\n          defaultValue={\"C:\\\\Workspaces\\\\carl\"}\r\n          reset={reset}\r\n          placeholder=\"Your path goes here\"\r\n          name=\"vascularMaskDirectory\"\r\n          module=\"moduleTwo\" />\r\n        <Input\r\n          label=\"Output Data Directory\"\r\n          defaultValue={\"C:\\\\Workspaces\\\\carl\"}\r\n          reset={reset}\r\n          placeholder=\"Your path goes here\"\r\n          name=\"outputDataDirectory\"\r\n          module=\"moduleTwo\" />\r\n      </div>\r\n    </ModuleOptions >\r\n  )\r\n}","import React, { useContext, useState } from 'react';\r\nimport { AppContext } from '../../../context/context';\r\nimport Checkbox from '../../shared/Checkbox';\r\nimport Dropdown from '../../shared/Dropdown';\r\nimport Input from '../../shared/Input';\r\nimport ModuleOptions from '../ModuleOptions';\r\n\r\ninterface ModuleOptionsProps {\r\n  reset: boolean\r\n}\r\n\r\nexport default function ModuleOneOptions({ reset }: ModuleOptionsProps) {\r\n  const [, dispatch] = useContext(AppContext);\r\n\r\n  return (\r\n    <ModuleOptions title={\"Preprocessing Options (Module 1)\"}>\r\n      <div className=\"flex fill\">\r\n        <div className=\"col-6\">\r\n          <Checkbox\r\n            label=\"Process Timing Data\"\r\n            defaultValue={true}\r\n            reset={reset}\r\n            name=\"processTimingData\"\r\n            module=\"moduleOne\" />\r\n          <Checkbox\r\n            label=\"Build 4D Image Data Set\"\r\n            defaultValue={true}\r\n            reset={reset}\r\n            name=\"build4d\"\r\n            module=\"moduleOne\" />\r\n          <Checkbox\r\n            label=\"Build 3D Image Data Set\"\r\n            defaultValue={true}\r\n            reset={reset}\r\n            name=\"build3d\"\r\n            module=\"moduleOne\" />\r\n\r\n          <Checkbox\r\n            label=\"Compute 4D Summary\"\r\n            defaultValue={true}\r\n            reset={reset}\r\n            name=\"compute4dSummary\"\r\n            module=\"moduleOne\" />\r\n\r\n          <Checkbox\r\n            label=\"Save available data\"\r\n            defaultValue={true}\r\n            reset={reset}\r\n            name=\"saveAvailableData\"\r\n            module=\"moduleOne\" />\r\n        </div>\r\n\r\n        <div className=\"col-6\">\r\n\r\n          <Checkbox\r\n            label=\"Reload timing indices\"\r\n            defaultValue={true}\r\n            reset={reset}\r\n            name=\"reloadTimingIndices\"\r\n            module=\"moduleOne\" />\r\n\r\n          <Checkbox\r\n            label=\"Stop if options change\"\r\n            defaultValue={false}\r\n            reset={reset}\r\n            name=\"stopIfOptionsChange\"\r\n            module=\"moduleOne\" />\r\n\r\n          <Checkbox\r\n            label=\"Auto select largest\"\r\n            defaultValue={true}\r\n            reset={reset}\r\n            name=\"autoSelectLargest\"\r\n            module=\"moduleOne\" />\r\n          <Checkbox\r\n            label=\"Auto select first largest\"\r\n            defaultValue={false}\r\n            reset={reset}\r\n            name=\"autoSelectFirstLargest\"\r\n            module=\"moduleOne\" />\r\n          <Checkbox\r\n            label=\"Auto select last largest\"\r\n            defaultValue={true}\r\n            reset={reset}\r\n            name=\"autoSelectLastLargest\"\r\n            module=\"moduleOne\" />\r\n        </div>\r\n\r\n        <div className=\"col-12 flex left\">\r\n          <b className=\"col-12 p-0 flex left\">\r\n            Set time Separation\r\n          </b>\r\n          <div className=\"col-12 p-0 flex\">\r\n\r\n            <Input\r\n              label=\"Min\"\r\n              defaultValue={\"0\"}\r\n              reset={reset}\r\n              placeholder=\"\"\r\n              name=\"setTimeSeparationMin\"\r\n              module=\"moduleOne\" />\r\n\r\n            <Input\r\n              label=\"Max\"\r\n              defaultValue={\"60\"}\r\n              reset={reset}\r\n              placeholder=\"\"\r\n              name=\"setTimeSeparationMax\"\r\n              module=\"moduleOne\" />\r\n\r\n\r\n          </div>\r\n          <Input\r\n            label=\"Specify image set index\"\r\n            defaultValue={\"0\"}\r\n            reset={reset}\r\n            placeholder=\"\"\r\n            name=\"imageSetIndex\"\r\n            module=\"moduleOne\" />\r\n        </div>\r\n      </div>\r\n    </ModuleOptions>\r\n  )\r\n}","import React, { useContext, useEffect, useState } from 'react';\r\nimport { Dropdown as BsDropdown } from 'react-bootstrap';\r\nimport { StoreActionType } from '../../context/constants';\r\nimport { AppContext } from '../../context/context';\r\n\r\ninterface DropdownProps {\r\n  label: string,\r\n  defaultValue: number,\r\n  options: string[],\r\n  reset: boolean,\r\n  module: string,\r\n  name: string\r\n}\r\n\r\nexport default function Dropdown({ label, reset, defaultValue, options, module, name }: DropdownProps) {\r\n  const [state, dispatch] = useContext(AppContext);\r\n  // Hecking typescript\r\n  // @ts-ignore\r\n  const optionModule = state.options[module as keyof Options]\r\n  const value = optionModule[name]\r\n\r\n  useEffect(() => {\r\n    if (reset) {\r\n      dispatchValue(options[defaultValue])\r\n    }\r\n  }, [reset])\r\n\r\n  const dispatchValue = (value: string) => {\r\n    dispatch({\r\n      type: StoreActionType.SET_INPUT,\r\n      payload: {\r\n        module, name, value\r\n      }\r\n    })\r\n  }\r\n\r\n  const handleChange = (key: any, e: any) => {\r\n    console.log(e)\r\n    if (e?.target?.text) {\r\n      dispatchValue(e.target.text);\r\n    }\r\n  }\r\n\r\n  return (\r\n\r\n    <div className=\"flex left column mr-2\">\r\n      {label}\r\n      <BsDropdown id=\"dropdown-basic-button\" onSelect={handleChange}>\r\n        <BsDropdown.Toggle id={JSON.stringify(Math.random())}>{value}</BsDropdown.Toggle>\r\n        <BsDropdown.Menu >\r\n          {options.map((option, index) => (\r\n            <BsDropdown.Item href={`#/action-${index}`}>{option}</BsDropdown.Item>)\r\n          )}\r\n        </BsDropdown.Menu>\r\n      </BsDropdown>\r\n    </div>\r\n  )\r\n}","import React, { useContext, useState } from 'react';\r\nimport { AppContext } from '../../../context/context';\r\nimport Checkbox from '../../shared/Checkbox';\r\nimport Dropdown from '../../shared/Dropdown';\r\nimport Input from '../../shared/Input';\r\nimport ModuleOptions from '../ModuleOptions';\r\n\r\ninterface ModuleOptionsProps {\r\n  reset: boolean\r\n}\r\n\r\nexport default function ModuleThreeOptions({ reset }: ModuleOptionsProps) {\r\n  const [, dispatch] = useContext(AppContext);\r\n\r\n  return (\r\n    <ModuleOptions title={\"Adaptive Vascular Model Options (Module 3)\"}>\r\n      <div className=\"flex fill col-12\">\r\n        <div className=\"col-12 flex column py-2 px-0\">\r\n          <b className=\"fit p-0 flex\">\r\n            Binning Options\r\n            </b>\r\n\r\n          <Input\r\n            label=\"Minimum number of bins\"\r\n            defaultValue={\"50\"}\r\n            reset={reset}\r\n            placeholder=\"Your path goes here\"\r\n            name=\"minimumNumber\"\r\n            module=\"moduleThree\" />\r\n\r\n          <Input\r\n            label=\"Number of bins\"\r\n            defaultValue={\"400\"}\r\n            reset={reset}\r\n            placeholder=\"Your path goes here\"\r\n            name=\"numberOfBins\"\r\n            module=\"moduleThree\" />\r\n\r\n          <Input\r\n            label=\"Distribution Tail\"\r\n            defaultValue={\"0.01\"}\r\n            reset={reset}\r\n            placeholder=\"Your path goes here\"\r\n            name=\"minimumNumber\"\r\n            module=\"moduleThree\" />\r\n\r\n          <Dropdown\r\n            label=\"Feature\"\r\n            defaultValue={0}\r\n            reset={reset}\r\n            options={[\"Median Value\", \"Mode Value\", \"Cumulative Probability\"]}\r\n            name=\"feature\"\r\n            module=\"moduleThree\" />\r\n        </div>\r\n        <div className=\"col-12 flex column py-2 px-0\">\r\n          <b className=\"fit p-0 flex\">\r\n            Distribution Feature Range\r\n          </b>\r\n          <Input\r\n            label=\"Median Min\"\r\n            defaultValue={\"0.3\"}\r\n            reset={reset}\r\n            name=\"medianMin\"\r\n            module=\"moduleThree\" />\r\n\r\n          <Input\r\n            label=\"Median Max\"\r\n            defaultValue={\"0.4\"}\r\n            reset={reset}\r\n            name=\"medianMax\"\r\n            module=\"moduleThree\" />\r\n          <Checkbox\r\n            label=\"Non-negative values\"\r\n            defaultValue={true}\r\n            reset={reset}\r\n            name=\"nonNegativeValues\"\r\n            module=\"moduleThree\" />\r\n          <Checkbox\r\n            label=\"Non-zero values\"\r\n            defaultValue={true}\r\n            reset={reset}\r\n            name=\"nonZeroValues\"\r\n            module=\"moduleThree\" />\r\n        </div>\r\n      </div>\r\n    </ModuleOptions>\r\n  )\r\n}","import React, { useContext, useState } from 'react';\r\nimport { AppContext } from '../../../context/context';\r\nimport Checkbox from '../../shared/Checkbox';\r\nimport Dropdown from '../../shared/Dropdown';\r\nimport Input from '../../shared/Input';\r\nimport ModuleOptions from '../ModuleOptions';\r\n\r\ninterface ModuleOptionsProps {\r\n  reset: boolean\r\n}\r\n\r\nexport default function ModuleTwoOptions({ reset }: ModuleOptionsProps) {\r\n  const [, dispatch] = useContext(AppContext);\r\n\r\n  return (\r\n    <ModuleOptions title={\"Brain Segmentation Options (Module 2)\"}>\r\n      <div className=\"flex fill col-12 \">\r\n        <div className=\"col-12 flex column py-2 px-0\">\r\n          <b className=\"fit p-0 flex\">\r\n            General Options\r\n          </b>\r\n          <Input\r\n            label=\"Data Output Path\"\r\n            defaultValue={\"C:\\\\Workspaces\\\\carl\"}\r\n            reset={reset}\r\n            placeholder=\"Your path goes here\"\r\n            name=\"dataOutput\"\r\n            module=\"moduleTwo\" />\r\n          <Checkbox\r\n            label=\"Restart Enabled\"\r\n            defaultValue={true}\r\n            reset={reset}\r\n            name=\"restartEnabled\"\r\n            module=\"moduleTwo\" />\r\n          <Input\r\n            label=\"Minimum 3D\"\r\n            defaultValue={\"0.125\"}\r\n            reset={reset}\r\n            placeholder=\"\"\r\n            name=\"minimum3d\"\r\n            module=\"moduleTwo\" />\r\n        </div>\r\n\r\n        <div className=\"col-12 flex py-2 px-0\">\r\n          <b className=\"col-12 p-0 flex\">\r\n            Data Source\r\n        </b>\r\n          <Dropdown\r\n            label=\"Modality\"\r\n            defaultValue={0}\r\n            reset={reset}\r\n            options={[\"CT\", \"MR\"]}\r\n            name=\"modality\"\r\n            module=\"moduleTwo\" />\r\n          <Dropdown\r\n            label=\"Vendor\"\r\n            defaultValue={0}\r\n            reset={reset}\r\n            options={[\"Toshiba\", \"GE\"]}\r\n            name=\"vendor\"\r\n            module=\"moduleTwo\" />\r\n          <Dropdown\r\n            label=\"Scanner\"\r\n            defaultValue={0}\r\n            reset={reset}\r\n            options={[\"320\", \"LS\"]}\r\n            name=\"scanner\"\r\n            module=\"moduleTwo\" />\r\n          <Dropdown\r\n            label=\"Process\"\r\n            defaultValue={0}\r\n            reset={reset}\r\n            options={[\"DCE\", \"Single\"]}\r\n            name=\"process\"\r\n            module=\"moduleTwo\" />\r\n          <Dropdown\r\n            label=\"Region\"\r\n            defaultValue={0}\r\n            reset={reset}\r\n            options={[\"Brain\"]}\r\n            name=\"region\"\r\n            module=\"moduleTwo\" />\r\n          <Dropdown\r\n            label=\"Study\"\r\n            defaultValue={0}\r\n            reset={reset}\r\n            options={[\"ICH\", \"dCTA\", \"CTP\"]}\r\n            name=\"study\"\r\n            module=\"moduleTwo\" />\r\n        </div>\r\n\r\n        <div className=\"col-12 flex column py-2 px-0\">\r\n          <b className=\"fit p-0 flex\">\r\n            Image Set Time Series Thresholding\r\n        </b>\r\n          <Checkbox\r\n            label=\"Include Maximum Threshold\"\r\n            defaultValue={true}\r\n            reset={reset}\r\n            name=\"includeMinThreshold\"\r\n            module=\"moduleTwo\" />\r\n          <Checkbox\r\n            label=\"Include Minimum Threshold\"\r\n            defaultValue={true}\r\n            reset={reset}\r\n            name=\"includeMaxThreshold\"\r\n            module=\"moduleTwo\" />\r\n        </div>\r\n\r\n        <div className=\"col-12 flex column py-2 px-0\">\r\n          <b className=\"fit p-0 flex\">\r\n            Tissue Mask Generation\r\n        </b>\r\n          <Checkbox\r\n            label=\"Use morphological operations\"\r\n            defaultValue={true}\r\n            reset={reset}\r\n            name=\"useMorphologicalOperations\"\r\n            module=\"moduleTwo\" />\r\n          <Input\r\n            label=\"STRFI disk\"\r\n            defaultValue={\"5\"}\r\n            reset={reset}\r\n            name=\"strfiDisk\"\r\n            module=\"moduleTwo\" />\r\n          <Input\r\n            label=\"STRFI 3D\"\r\n            defaultValue={\"2\"}\r\n            reset={reset}\r\n            name=\"strfi3d\"\r\n            module=\"moduleTwo\" />\r\n        </div>\r\n\r\n        <div className=\"col-12 flex column py-2 px-0\">\r\n          <b className=\"fit p-0 flex\">\r\n            Brain Selection Algorithm Parameters\r\n        </b>\r\n          <Input\r\n            label=\"Image index range\"\r\n            defaultValue={\"All\"}\r\n            reset={reset}\r\n            placeholder=\"\"\r\n            name=\"imageIndexRange\"\r\n            module=\"moduleTwo\" />\r\n\r\n          <Input\r\n            label=\"Image index region\"\r\n            defaultValue={\"Minimum\"}\r\n            reset={reset}\r\n            placeholder=\"\"\r\n            name=\"imageRegion\"\r\n            module=\"moduleTwo\" />\r\n\r\n          <Input\r\n            label=\"minimumConnected\"\r\n            defaultValue={\"0.2\"}\r\n            reset={reset}\r\n            placeholder=\"\"\r\n            name=\"minimumConnected\"\r\n            module=\"moduleTwo\" />\r\n\r\n          <Input\r\n            label=\"Coarse radius\"\r\n            defaultValue={\"20\"}\r\n            reset={reset}\r\n            placeholder=\"\"\r\n            name=\"coarseRadius\"\r\n            module=\"moduleTwo\" />\r\n\r\n          <Input\r\n            label=\"STRFI radius\"\r\n            defaultValue={\"1.5\"}\r\n            reset={reset}\r\n            placeholder=\"\"\r\n            name=\"strfiRadius\"\r\n            module=\"moduleTwo\" />\r\n        </div>\r\n      </div>\r\n    </ModuleOptions>\r\n  )\r\n}","import React, { useState, useEffect} from 'react';\r\nimport { Button } from 'react-bootstrap';\r\nimport ModuleFourOptions from './module-options/ModuleFourOptions';\r\nimport ModuleOneOptions from './module-options/ModuleOneOptions';\r\nimport ModuleThreeOptions from './module-options/ModuleThreeOptions';\r\nimport ModuleTwoOptions from './module-options/ModuleTwoOptions';\r\nimport './RadiologistView.scss';\r\n\r\nexport default function RadiologistView() {\r\n  const [reset, setReset] = useState(false);\r\n\r\n  useEffect(() => {\r\n    if (reset) {\r\n      setReset(false);\r\n    }\r\n  }, [reset])\r\n\r\n  return (\r\n    <div className=\"flex center page\">\r\n      <div className=\"col-2\" />\r\n      <div className=\"col-8 py-3 px-0 flex options-container\">\r\n        <h4 className=\"header col-12 flex space-between\">\r\n          Options\r\n        <Button variant=\"light\" onClick={() => { setReset(true); }}>\r\n            Reset to Default\r\n        </Button>\r\n        </h4>\r\n        <ModuleOneOptions reset={reset}></ModuleOneOptions>\r\n        <ModuleTwoOptions reset={reset}></ModuleTwoOptions>\r\n        <ModuleThreeOptions reset={reset}></ModuleThreeOptions>\r\n        <ModuleFourOptions reset={reset}></ModuleFourOptions>\r\n      </div>\r\n      <div className=\"col-2\" />\r\n\r\n    </div >)\r\n}","/**\r\n * @fileOverview UiModalDemo\r\n * @author Epam\r\n * @version 1.0.0\r\n */\r\n\r\n\r\n// ********************************************************\r\n// Imports\r\n// ********************************************************\r\n\r\nimport React from 'react';\r\n\r\n\r\nimport { Container, Row, Col, Image, OverlayTrigger, Tooltip } from 'react-bootstrap';\r\nimport { Modal, Button } from 'react-bootstrap';\r\n\r\n// ********************************************************\r\n// Const\r\n// ********************************************************\r\n\r\n// ********************************************************\r\n// Class\r\n// ********************************************************\r\n\r\n/**\r\n * Class UiModalDemo some text later...\r\n */\r\nclass UiModalDemo extends React.Component {\r\n  /**\r\n   * @param {object} props - props from up level object\r\n   */\r\n  constructor(props) {\r\n    super(props);\r\n    this.onModalShow = this.onModalShow.bind(this);\r\n    this.onModalHide = this.onModalHide.bind(this);\r\n    this.onButton0 = this.onButton0.bind(this);\r\n    this.onButton1 = this.onButton1.bind(this);\r\n    this.onButton2 = this.onButton2.bind(this);\r\n    this.onButton3 = this.onButton3.bind(this);\r\n    this.onButton4 = this.onButton4.bind(this);\r\n    this.onButton5 = this.onButton5.bind(this);\r\n    this.onButton6 = this.onButton6.bind(this);\r\n    this.onButton7 = this.onButton7.bind(this);\r\n    this.onDemo = this.onDemo.bind(this);\r\n    this.state = {\r\n      showModalDemo: false\r\n    };\r\n  }\r\n  onModalShow() {\r\n    this.setState({ showModalDemo: true });\r\n  }\r\n  onModalHide() {\r\n    this.setState({ showModalDemo: false });\r\n  }\r\n  onDemo(index) {\r\n    const onSelectFunc = this.props.onSelectDemo;\r\n    const onHideFunc = this.props.onHide;\r\n    onHideFunc();\r\n    onSelectFunc(index);\r\n  }\r\n  onButton0() {\r\n    this.onDemo(0);\r\n  }\r\n  onButton1() {\r\n    this.onDemo(1);\r\n  }\r\n  onButton2() {\r\n    this.onDemo(2);\r\n  }\r\n  onButton3() {\r\n    this.onDemo(3);\r\n  }\r\n  onButton4() {\r\n    this.onDemo(4);\r\n  }\r\n  onButton5() {\r\n    this.onDemo(5);\r\n  }\r\n  onButton6() {\r\n    this.onDemo(6);\r\n  }\r\n  onButton7() {\r\n    this.onDemo(7);\r\n  }\r\n  render() {\r\n    const stateVis = this.props.stateVis;\r\n    const onHideFunc = this.props.onHide;\r\n\r\n    // icons description\r\n    const iconsSet = [\r\n      {\r\n        tooltip: 'Lungs 20101108 from ktx',\r\n        image: 'images/thumb_lungs.png',\r\n        alt: 'lungs',\r\n        func: this.onButton0,\r\n      },\r\n      {\r\n        tooltip: 'Brain set from ktx',\r\n        image: 'images/thumb_brain.png',\r\n        alt: 'lungs',\r\n        func: this.onButton1,\r\n      },\r\n      {\r\n        tooltip: 'Grandmother (gm3) from nifti',\r\n        image: 'images/thumb_gm3_512_512_165.png',\r\n        alt: 'gm3',\r\n        func: this.onButton2,\r\n      },\r\n      {\r\n        tooltip: 'Woman pelvis from dicom',\r\n        image: 'images/thumb_woman_pelvis.png',\r\n        alt: 'woman_pelvis',\r\n        func: this.onButton3,\r\n      },\r\n      {\r\n        tooltip: 'Lungs 00cba...957e from dicom',\r\n        image: 'images/thumb_ocb.png',\r\n        alt: 'lungs_ocb',\r\n        func: this.onButton4,\r\n      },\r\n      {\r\n        tooltip: 'CT 256^3 from ktx',\r\n        image: 'images/thumb_ct_256.png',\r\n        alt: 'ct_256',\r\n        func: this.onButton5,\r\n      },\r\n      {\r\n        tooltip: 'Lungs 256^3 from ktx',\r\n        image: 'images/thumb_lungs_256.png',\r\n        alt: 'lungs_256',\r\n        func: this.onButton6,\r\n      },\r\n      {\r\n        tooltip: 'Brain with ROI (colored) from Hdr+Img',\r\n        image: 'images/thumb_set.png',\r\n        alt: 'hdr_set_roi',\r\n        func: this.onButton7,\r\n      },\r\n    ];\r\n\r\n    const jsxModalDemo = \r\n      <Modal show={stateVis} onHide={onHideFunc} >\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>\r\n            Load demo data\r\n          </Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n\r\n          <Container>\r\n            <Row>\r\n              {iconsSet.map( (d, i) => {\r\n                const strId = `id_${i}`;\r\n                const strTooltip = d.tooltip;\r\n                const strImage = d.image;\r\n                const strAlt = d.alt;\r\n                const funcCallback = d.func;\r\n                return <Col xs={6} md={4} key={strId}>\r\n                  <OverlayTrigger\r\n                    placement=\"top\"\r\n                    delay={{ show: 150, hide: 300 }}\r\n                    overlay={\r\n                      <Tooltip id={strId}>\r\n                        {strTooltip}\r\n                      </Tooltip>\r\n                    }\r\n                  >\r\n                    <Button variant=\"light\" onClick={funcCallback} >\r\n                      <Image src={strImage} alt={strAlt} thumbnail />\r\n                    </Button>\r\n                  </OverlayTrigger>\r\n                </Col>\r\n              })}\r\n            </Row>\r\n          </Container>            \r\n\r\n        </Modal.Body>\r\n      </Modal>;\r\n\r\n    return jsxModalDemo;\r\n  } // end render\r\n} // end class\r\n\r\nexport default UiModalDemo;\r\n","/**\r\n * @fileOverview UiModalWinCW\r\n * @author Epam\r\n * @version 1.0.0\r\n */\r\n\r\n\r\n// ********************************************************\r\n// Imports\r\n// ********************************************************\r\n\r\n// special css for NoUiSlioder\r\nimport 'nouislider/distribute/nouislider.css';\r\n\r\nimport React from 'react';\r\n\r\n\r\nimport { Modal, Container, Row, Col, Button, ListGroup } from 'react-bootstrap';\r\n\r\nimport Nouislider from '../../../../node_modules/react-nouislider';\r\n\r\n// ********************************************************\r\n// Const\r\n// ********************************************************\r\n\r\nconst LARGE_NUMBER = 0x3FFFFFFF;\r\nconst DEFAULT_WIN_MIN = 650 - 2000 / 2;\r\nconst DEFAULT_WIN_MAX = 650 + 2000 / 2;\r\n\r\n// ********************************************************\r\n// Class\r\n// ********************************************************\r\n\r\nclass UiModalWindowCenterWidth extends React.Component {\r\n  constructor(props) {\r\n    super(props);\r\n\r\n    this.m_objCanvas = null;\r\n    this.m_dataMin = LARGE_NUMBER;\r\n    this.m_dataMax = LARGE_NUMBER;\r\n\r\n    this.onButtonCancel = this.onButtonCancel.bind(this);\r\n    this.onButtonApply = this.onButtonApply.bind(this);\r\n\r\n    this.state = {\r\n      showModalWindowCenterWidth: false,\r\n      windowMin: DEFAULT_WIN_MIN,\r\n      windowMax: DEFAULT_WIN_MAX, \r\n    };\r\n  } // end constructor\r\n  onModalHide() {\r\n    this.setState({ showModalWindowCenterWidth: false });\r\n  }\r\n  reset() {\r\n    // restore data params to initial for next lloading\r\n    this.m_dataMin = LARGE_NUMBER;\r\n    this.m_dataMax = LARGE_NUMBER;\r\n    this.setState({ windowMin: DEFAULT_WIN_MIN });\r\n    this.setState({ windowMax: DEFAULT_WIN_MAX });\r\n  }\r\n  //\r\n  onButtonCancel() {\r\n    // console.log('TODO: on Cancel ...');\r\n    this.reset();\r\n\r\n    const onHideFunc = this.props.onHide;\r\n    onHideFunc(false);\r\n  }\r\n  //\r\n  onButtonApply() {\r\n    // console.log('TODO: on Apply ...');\r\n\r\n    this.reset();\r\n\r\n    const store = this.props;\r\n    const loaderDicom = store.loaderDicom;\r\n    const volSet = store.volumeSet;\r\n\r\n    // set loader features according current modal properties (window min, max)\r\n    loaderDicom.m_windowCenter = (this.state.windowMin + this.state.windowMax) * 0.5;\r\n    loaderDicom.m_windowWidth = (this.state.windowMax - this.state.windowMin);\r\n\r\n    // apply for single slice dicom read\r\n    // select 1st slice and hash\r\n    const series = loaderDicom.m_slicesVolume.getSeries();\r\n    const numSeries = series.length;\r\n    for (let i = 0; i < numSeries; i++) {\r\n      const hashCode = series[i].m_hash;\r\n      loaderDicom.createVolumeFromSlices(volSet, i, hashCode);\r\n    }\r\n\r\n    // hide this modal\r\n    const onHideFunc = this.props.onHide;\r\n    onHideFunc(true);\r\n  }\r\n  //\r\n  componentDidMount() {\r\n    // use onRef to provide access to this for the parent component\r\n    // ini react hierarchy\r\n    this.props.onRef(this);\r\n    this.renderPreview();\r\n  }\r\n  componentWillUnmount() {\r\n    this.props.onRef(undefined);\r\n  }\r\n  componentDidUpdate() {\r\n    this.renderPreview();\r\n  }\r\n  drawSlice(ctx, wScreen, hScreen, imgData, dataDst, series, loaderDicom) {\r\n    const serie = series[0];\r\n    const slices = serie.m_slices;\r\n    const numSlices = slices.length;\r\n\r\n    // sort slices via slice location OR slice number\r\n    let minSliceNum = slices[0].m_sliceNumber;\r\n    let maxSliceNum = slices[0].m_sliceNumber;\r\n    for (let s = 0; s < numSlices; s++) {\r\n      const num = slices[s].m_sliceNumber;\r\n      minSliceNum = (num < minSliceNum) ? num : minSliceNum;\r\n      maxSliceNum = (num > maxSliceNum) ? num : maxSliceNum;\r\n    }\r\n    const difSlceNum = maxSliceNum - minSliceNum;\r\n    if (difSlceNum > 0) {\r\n      // sort slices by slice number (read from dicom tag)\r\n      slices.sort((a, b) => {\r\n        const zDif = a.m_sliceNumber - b.m_sliceNumber;\r\n        return zDif;\r\n      });\r\n    } else {\r\n      // sort slices by slice location (read from diocom tag)\r\n      slices.sort((a, b) => {\r\n        const zDif = a.m_sliceLocation - b.m_sliceLocation;\r\n        return zDif;\r\n      });\r\n    }\r\n    // assign new slice numbers according accending location\r\n    let ind = 0;\r\n    for (let s = 0; s < numSlices; s++) {\r\n      slices[s].m_sliceNumber = ind;\r\n      ind++;\r\n    }\r\n    loaderDicom.m_zDim = numSlices;\r\n\r\n    const indexCenter = Math.floor(numSlices / 2);\r\n    const slice = slices[indexCenter];\r\n    const sliceData16 = slice.m_image;\r\n    const xDim = slice.m_xDim;\r\n    const yDim = slice.m_yDim;\r\n    let maxVal = -LARGE_NUMBER;\r\n    let minVal = +LARGE_NUMBER;\r\n    const xyDim = xDim * yDim;\r\n    const zOff = 0;\r\n    let i;\r\n    for (i = 0; i < xyDim; i++) {\r\n      let valSrc = sliceData16[i];\r\n      // check big endian\r\n      if (!loaderDicom.m_littleEndian) {\r\n        const valBytesSwap = (valSrc >> 8) | ((valSrc << 8) & 0xffff);\r\n        valSrc = valBytesSwap;\r\n      }\r\n      // check pad value\r\n      valSrc = (valSrc === loaderDicom.m_padValue) ? 0 : valSrc;\r\n      \r\n      const valData = valSrc * loaderDicom.m_rescaleSlope + loaderDicom.m_rescaleIntercept;\r\n      minVal = (valData < minVal) ? valData : minVal;\r\n      maxVal = (valData > maxVal) ? valData : maxVal;\r\n    } // for (i) all slice pixels\r\n    // console.log(`Modal dcm. min/max val = ${minVal} / ${maxVal}`);\r\n    // this.m_dataMin = minVal;\r\n    // this.m_dataMax = maxVal;\r\n\r\n    const wMin = this.state.windowMin;\r\n    const wMax = this.state.windowMax;\r\n    const wc = Math.floor((wMax + wMin) * 0.5);\r\n    const ww = wMax - wMin;\r\n\r\n    const BITS_ACCUR = 11;\r\n    const BITS_IN_BYTE = 8;\r\n    const scale = Math.floor((1 << (BITS_IN_BYTE + BITS_ACCUR)) / (maxVal - minVal));\r\n    const TOO_MIN_SCALE = 4;\r\n    if (scale <= TOO_MIN_SCALE) {\r\n      console.log('Bad scaling: image will be 0');\r\n      return;\r\n    }\r\n    // const MAX_BYTE = 255;\r\n\r\n    // create temp data array: 8 bit image for this slice\r\n    const dataArray = new Uint8Array(xyDim);\r\n    const winMin = wc - ww * 0.5;\r\n    for (i = 0; i < xyDim; i++) {\r\n      let valSrc = sliceData16[i];\r\n      // check big endian\r\n      if (!loaderDicom.m_littleEndian) {\r\n        const valBytesSwap = (valSrc >> 8) | ((valSrc << 8) & 0xffff);\r\n        valSrc = valBytesSwap;\r\n      }\r\n      // check pad value\r\n      valSrc = (valSrc === loaderDicom.m_padValue) ? 0 : valSrc;\r\n      const valScaled = valSrc * loaderDicom.m_rescaleSlope + loaderDicom.m_rescaleIntercept;\r\n\r\n      let val = 0;\r\n      if (loaderDicom.m_rescaleHounsfield) {\r\n        // rescale for hounsfield units\r\n        val = Math.floor((valScaled - winMin) * 255 / ww);\r\n      } else {\r\n        // usual (default) rescale\r\n        val = Math.floor(127 + (valScaled - wc) * 128 / (ww / 2));\r\n      }\r\n      val = (val >= 0) ? val : 0;\r\n      val = (val < 255) ? val : 255;\r\n      dataArray[zOff + i] = val;\r\n    } // for i\r\n\r\n    // draw 8 but image into window\r\n    let j = 0;\r\n    const xStep = xDim / wScreen;\r\n    const yStep = yDim / hScreen;\r\n    let ay = 0.0; \r\n    for (let y = 0; y < hScreen; y++, ay += yStep) {\r\n      const ySrc = Math.floor(ay);\r\n      const yOff = ySrc * xDim;\r\n      let ax = 0.0;\r\n      for (let x = 0; x < wScreen; x++, ax += xStep) {\r\n        const xSrc = Math.floor(ax);\r\n        const val = dataArray[zOff + yOff + xSrc];\r\n        dataDst[j + 0] = val;\r\n        dataDst[j + 1] = val;\r\n        dataDst[j + 2] = val;\r\n        dataDst[j + 3] = 255; // opacity\r\n        j += 4;\r\n      } // for x\r\n    } // for y\r\n    ctx.putImageData(imgData, 0, 0);\r\n  } // end draw slice\r\n  //\r\n  // render preview window with slice and selected window properties\r\n  //\r\n  renderPreview() {\r\n    const objCanvas = this.m_objCanvas;\r\n    if (objCanvas === null) {\r\n      return;\r\n    }\r\n\r\n    const wScreen = objCanvas.clientWidth;\r\n    const hScreen = objCanvas.clientHeight;\r\n\r\n    const ctx = objCanvas.getContext('2d');\r\n    const store = this.props;\r\n\r\n    // clear screen\r\n    ctx.fillStyle = 'rgb(40, 40, 40)';\r\n    ctx.fillRect(0, 0, wScreen, hScreen);\r\n\r\n    // destination buffer to write\r\n    const imgData = ctx.createImageData(wScreen, hScreen);\r\n    const dataDst = imgData.data;\r\n    let j = 0;\r\n    const TEST_RAINBOW = false;\r\n    if (TEST_RAINBOW) {\r\n      console.log(\"special rainbow test instead of slice render\");\r\n      for (let y = 0; y < hScreen; y++) {\r\n        for (let x = 0; x < wScreen; x++) {\r\n          let b = Math.floor(255.0 * x / wScreen);\r\n          let g = Math.floor(255.0 * y / hScreen);\r\n          let r = 50;\r\n          dataDst[j + 0] = r;\r\n          dataDst[j + 1] = g;\r\n          dataDst[j + 2] = b;\r\n          dataDst[j + 3] = 255;\r\n          j += 4;\r\n        }\r\n      }\r\n      ctx.putImageData(imgData, 0, 0);\r\n      return;\r\n    } // if test rainbow\r\n\r\n    const loaderDicom = store.loaderDicom;\r\n    if (loaderDicom === null) {\r\n      return;\r\n    }\r\n    const series = loaderDicom.m_slicesVolume.m_series;\r\n    if (series.length === 0) {\r\n      return;\r\n    }\r\n    this.drawSlice(ctx, wScreen, hScreen, imgData, dataDst, series, loaderDicom);\r\n  } // end render preview\r\n  //\r\n  // callbakc on user change window range (min, max)\r\n  //\r\n  onSliderWindowRange()\r\n  {\r\n    const arrVals = this.refs.sliderRange.slider.get();\r\n    const vMin = parseInt(arrVals[0]);\r\n    const vMax = parseInt(arrVals[1]);\r\n    this.setState({ windowMin: vMin });\r\n    this.setState({ windowMax: vMax });\r\n    // console.log(`slider min/max = ${vMin} / ${vMax}`);\r\n  }\r\n  getDataMinMax(store, loaderDicom) {\r\n    const series = loaderDicom.m_slicesVolume.m_series;\r\n    if (series.length === 0) {\r\n      return;\r\n    }\r\n    const serie = series[0];\r\n    const slices = serie.m_slices;\r\n    const slice = slices[0];\r\n    const sliceData16 = slice.m_image;\r\n    const xDim = slice.m_xDim;\r\n    const yDim = slice.m_yDim;\r\n    let maxVal = -LARGE_NUMBER;\r\n    let minVal = +LARGE_NUMBER;\r\n    const xyDim = xDim * yDim;\r\n    let i;\r\n    for (i = 0; i < xyDim; i++) {\r\n      let valSrc = sliceData16[i];\r\n      // check big endian\r\n      if (!loaderDicom.m_littleEndian) {\r\n        const valBytesSwap = (valSrc >> 8) | ((valSrc << 8) & 0xffff);\r\n        valSrc = valBytesSwap;\r\n      }\r\n      // check pad value\r\n      valSrc = (valSrc === loaderDicom.m_padValue) ? 0 : valSrc;\r\n      \r\n      const valData = valSrc * loaderDicom.m_rescaleSlope + loaderDicom.m_rescaleIntercept;\r\n      minVal = (valData < minVal) ? valData : minVal;\r\n      maxVal = (valData > maxVal) ? valData : maxVal;\r\n    } // for (i) all slice pixels\r\n    // console.log(`Modal dcm. min/max val = ${minVal} / ${maxVal}`);\r\n    this.m_dataMin = minVal;\r\n    this.m_dataMax = maxVal;\r\n    // console.log(`data min max ready`);\r\n  } // end get data min max\r\n  //\r\n  // Invoked from parent component once\r\n  // to initialize window range (if found in dicom tags)\r\n  // and detect data [min..max] range\r\n  //\r\n  initWindowRange() {\r\n    const store = this.props;\r\n    const loaderDicom = store.loaderDicom;\r\n    if (loaderDicom !== null) {\r\n      let isValid = true;\r\n      isValid = (loaderDicom.m_windowCenter === LARGE_NUMBER) ? false : isValid;\r\n      isValid = (loaderDicom.m_windowWidth === LARGE_NUMBER) ? false : isValid;\r\n      isValid = (loaderDicom.m_windowWidth <= 0) ? false : isValid;\r\n\r\n      if (isValid) {\r\n        // console.log('initWindowRange: use predefined in tags window center, width');\r\n        const wMin = Math.floor(loaderDicom.m_windowCenter - loaderDicom.m_windowWidth / 2);\r\n        const wMax = Math.floor(loaderDicom.m_windowCenter + loaderDicom.m_windowWidth / 2);\r\n        this.setState({ windowMin: wMin });\r\n        this.setState({ windowMax: wMax });\r\n      }\r\n      this.getDataMinMax(store, loaderDicom);\r\n    } // if loader dicom ready\r\n  } // end init\r\n  // render \r\n  render() {\r\n\r\n    //const stateVis = true;\r\n    const stateVis = this.props.stateVis;\r\n    const onHideFunc = this.props.onHide;\r\n\r\n    const stylePreview = {\r\n      width: '500px',\r\n      height: '400px',\r\n    };\r\n\r\n    const jsxCanvas = <canvas ref={ (mount) => {this.m_objCanvas = mount} } style={stylePreview} width=\"500px\" height=\"400px\" />;\r\n\r\n    const valToolTps = true;\r\n\r\n    let valMin = 0;\r\n    let valMax = 5000;\r\n    let valDelta = valMax - valMin;\r\n    let valStep = 50;\r\n    if (this.m_dataMin !== LARGE_NUMBER) {\r\n      valMin = this.m_dataMin;\r\n      valMax = this.m_dataMax;\r\n      valDelta = valMax - valMin;\r\n      valStep = Math.floor(valDelta / 32);\r\n    }\r\n\r\n    const rangeTwo = {\r\n      'min': Math.floor(valMin - valDelta / 4),\r\n      'max': Math.floor(valMax + valDelta / 4)\r\n    }\r\n    const wMin = Math.floor(this.state.windowMin);\r\n    const wMax = Math.floor(this.state.windowMax);\r\n    const wArr = [wMin, wMax];\r\n\r\n    const jxsModal = \r\n      <Modal show={stateVis} onHide={onHideFunc} size=\"xl\">\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>\r\n            Select window center and width to display Dicom\r\n          </Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n          <Container>\r\n            <Row>\r\n              <Col xs md lg=\"12\" ref={ (mount) => {this.m_objCol = mount} } >\r\n                <p className=\"text-center\">\r\n                  {jsxCanvas}\r\n                </p>\r\n              </Col>\r\n            </Row>\r\n\r\n            <ListGroup>\r\n              <ListGroup.Item>\r\n                Window range <p> </p>\r\n              </ListGroup.Item>\r\n              <ListGroup.Item>\r\n                <Nouislider onSlide={this.onSliderWindowRange.bind(this)} ref={'sliderRange'}\r\n                  range={rangeTwo}\r\n                  start={wArr}\r\n                  step={valStep}\r\n                  connect={true}\r\n                  tooltips={valToolTps} />\r\n              </ListGroup.Item>\r\n            </ListGroup>\r\n\r\n            <Row>\r\n              <Col xs md lg=\"5\">\r\n              </Col>\r\n              <Col xs md lg=\"2\">\r\n                <Button onClick={this.onButtonApply}>\r\n                  Apply\r\n                </Button>\r\n              </Col>\r\n              <Col xs md lg=\"5\">\r\n              </Col>\r\n            </Row>\r\n          </Container>\r\n\r\n        </Modal.Body>\r\n      </Modal>\r\n    return jxsModal;\r\n  } // end render\r\n} // end class UiWindowCenterWidth\r\n\r\nexport default UiModalWindowCenterWidth;\r\n","/**\r\n * @fileOverview UiModalGoogle\r\n * @author Epam\r\n * @version 1.0.0\r\n */\r\n\r\n\r\n// ********************************************************\r\n// Imports\r\n// ********************************************************\r\n\r\nimport React from 'react';\r\n\r\n\r\nimport { Modal, ListGroup, OverlayTrigger, Tooltip } from 'react-bootstrap';\r\n\r\n// ********************************************************\r\n// Const\r\n// ********************************************************\r\n\r\n// ********************************************************\r\n// Class\r\n// ********************************************************\r\n\r\n/**\r\n * Class UiModalGoogle some text later...\r\n */\r\nclass UiModalGoogle extends React.Component {\r\n  /**\r\n   * @param {object} props - props from up level object\r\n   */\r\n  constructor(props) {\r\n    super(props);\r\n    this.onModalShow = this.onModalShow.bind(this);\r\n    this.onModalHide = this.onModalHide.bind(this);\r\n    this.onClick = this.onClick.bind(this);\r\n\r\n    this.onDemo = this.onDemo.bind(this);\r\n    this.state = {\r\n      showModalDemo: false\r\n    };\r\n  }\r\n  onModalShow() {\r\n    this.setState({ showModalDemo: true });\r\n  }\r\n  onModalHide() {\r\n    this.setState({ showModalDemo: false });\r\n  }\r\n  onDemo(index) {\r\n    const onSelectFunc = this.props.onSelectDemo;\r\n    const onHideFunc = this.props.onHide;\r\n    onHideFunc();\r\n    onSelectFunc(index);\r\n  }\r\n  logObject(strTitle, obj) {\r\n    let str = '';\r\n    for (let prp in obj) {\r\n      if (str.length > 0) {\r\n        str += '\\n';\r\n      }\r\n      str += prp + ' = ' + obj[prp];\r\n    }\r\n    console.log(`${strTitle}\\n${str}`);\r\n  }\r\n  static getIndex(arrMenu, strElem) {\r\n    const len = arrMenu.length;\r\n    for (let i = 0; i < len; i++) {\r\n      if (arrMenu[i].text === strElem) {\r\n        return i;\r\n      }\r\n    }\r\n    return -1;\r\n  }\r\n  onClick(evt) {\r\n    this.m_onHideFunc();\r\n    const strTextMenu = evt.target.innerHTML;\r\n    const ind = UiModalGoogle.getIndex(this.m_arrMenu, strTextMenu);\r\n    if ((ind >= 0) && (this.m_funcDemo !== undefined)) {\r\n      // perform action on cliked demo index\r\n      //console.log(`onClick: element = ${ind}`);\r\n      this.m_funcDemo(ind);\r\n    }\r\n  }\r\n  render() {\r\n    const arrMenu = this.props.arrMenu;\r\n    this.m_arrMenu = arrMenu;\r\n    const stateVis = this.props.stateVis;\r\n    this.m_onHideFunc = this.props.onHide;\r\n    this.m_funcDemo =  this.props.onSelectDemo;\r\n\r\n    const jsxModalDemo = \r\n      <Modal show={stateVis} onHide={this.m_onHideFunc} >\r\n        <Modal.Header closeButton>\r\n          <Modal.Title>\r\n            Load from Google cloud\r\n          </Modal.Title>\r\n        </Modal.Header>\r\n        <Modal.Body>\r\n\r\n          <ListGroup>\r\n\r\n            {arrMenu.map( (d, i) => {\r\n              const strId = `id_${i}`;\r\n              const strTooltip = d.tooltip;\r\n              return <OverlayTrigger \r\n                key={strId} \r\n                placement=\"top\"\r\n                delay={{ show: 150, hide: 300 }}\r\n                overlay={\r\n                  <Tooltip id={strId}>\r\n                    {strTooltip}\r\n                  </Tooltip>\r\n                }\r\n              >\r\n                <ListGroup.Item key={strId} onClick={this.onClick}  > \r\n                  {d.text}\r\n                </ListGroup.Item>\r\n              </OverlayTrigger>\r\n            })}\r\n\r\n          </ListGroup>\r\n\r\n        </Modal.Body>\r\n      </Modal>;\r\n\r\n    return jsxModalDemo;\r\n  } // end render\r\n} // end class\r\n\r\nexport default UiModalGoogle;\r\n","/**\r\n * @fileOverview LoaderUrlDicom\r\n * @author Epam\r\n * @version 1.0.0\r\n */\r\n\r\n\r\n// ********************************************************\r\n// Imports\r\n// ********************************************************\r\n\r\nimport FileTools from './FileTools';\r\nimport LoadResult from '../LoadResult';\r\nimport Volume from '../Volume';\r\nimport FileLoader from './FileLoader';\r\nimport LoaderDicom from './LoaderDicom';\r\n\r\nimport Texture3D from '../Texture3D';\r\nimport { StoreActionType, ModeView, Modes3d } from '../../../../context/constants';\r\n\r\n\r\n// ********************************************************\r\n// Const\r\n// ********************************************************\r\n\r\n// const DEBUG_PRINT_INDI_SLICE_INFO = false;\r\n// const DEBUG_PRINT_TAGS_INFO = false;\r\n\r\nconst NEED_TEXTURE_SIZE_4X = true;\r\n\r\n// ********************************************************\r\n// Classs\r\n// ********************************************************\r\nclass LoaderUrlDicom {\r\n  constructor(store) {\r\n    this.m_store = store;\r\n    this.m_arrFileNames = null;\r\n    this.m_errors = [];\r\n    this.m_loaders = [];\r\n    this.m_loaderDicom = null;\r\n\r\n    this.callbackReadProgress = this.callbackReadProgress.bind(this);\r\n    this.callbackReadComplete = this.callbackReadComplete.bind(this);\r\n    this.m_fileName = '???';\r\n  }\r\n  /**\r\n   * Progress read callback\r\n   * \r\n   * @param {number ratio01 - ratio in range [0..1]\r\n   */\r\n  callbackReadProgress(ratio01) {\r\n    const ratioPrc = Math.floor(ratio01 * 100);\r\n    const store = this.m_store;\r\n    const uiapp = store.uiApp;\r\n    if (ratioPrc === 0) {\r\n      uiapp.doShowProgressBar('Loading...');\r\n    }\r\n    if (ratioPrc >= 99) {\r\n      // console.log(`callbackReadProgress. hide on = ${ratio01}`);\r\n      uiapp.doHideProgressBar();\r\n    } else {\r\n      uiapp.doSetProgressBarRatio(ratioPrc);\r\n    }\r\n  } // callback progress\r\n  /**\r\n   * Invoked after read finished (or may be with error)\r\n   * \r\n   * @param {number codeResult - one from LoadResult.XXX\r\n   */\r\n  callbackReadComplete(codeResult) {\r\n    // console.log(`LoaderUrlDicom.callbackReadComplete: code = ${codeResult}`);\r\n    if (codeResult !== LoadResult.SUCCESS) {\r\n      console.log(`onCompleteFromUrlKtx. Bad result: ${codeResult}`);\r\n      const arrErrors = [];\r\n      const strErr = LoadResult.getResultString(codeResult);\r\n      arrErrors.push(strErr);\r\n      this.finalizeFailedLoadedVolume(this.m_volume, this.m_fileName, arrErrors);\r\n      return;\r\n    } else {\r\n      this.finalizeSuccessLoadedVolume(this.m_volume, this.m_fileName);\r\n    }\r\n  }\r\n  /**\r\n   * End action if loading failed\r\n   * \r\n   * @param {object} vol - destination readed volume\r\n   * @param {string} fileNameIn - file name need to display\r\n   * @param {object} arrErrors - array of string with error messages\r\n   */\r\n  finalizeFailedLoadedVolume(vol, fileNameIn, arrErrors) {\r\n    // invoke notification\r\n    const store = this.m_store;\r\n    store.dispatch({ type: StoreActionType.SET_IS_LOADED, isLoaded: false });\r\n    store.dispatch({ type: StoreActionType.SET_VOLUME, volume: null });\r\n    store.dispatch({ type: StoreActionType.SET_ERR_ARRAY, arrErrors: arrErrors });\r\n    store.dispatch({ type: StoreActionType.SET_FILENAME, fileName: fileNameIn });\r\n    const uiapp = store.uiApp;\r\n    uiapp.doHideProgressBar();\r\n  }\r\n  /**\r\n   * On the end of success loading dicom folder\r\n   * \r\n   * @param {object} vol - destination volume\r\n   * @param {string} fileNameIn - short file name for readed\r\n   */\r\n  finalizeSuccessLoadedVolume(vol, fileNameIn) {\r\n    if (vol.m_dataArray !== null)\r\n    {\r\n      if (NEED_TEXTURE_SIZE_4X) {\r\n        vol.makeDimensions4x();\r\n      }\r\n      // invoke notification\r\n      const store = this.m_store;\r\n      store.dispatch({ type: StoreActionType.SET_VOLUME, volume: vol });\r\n      store.dispatch({ type: StoreActionType.SET_IS_LOADED, isLoaded: true });\r\n      store.dispatch({ type: StoreActionType.SET_FILENAME, fileName: fileNameIn });\r\n      store.dispatch({ type: StoreActionType.SET_ERR_ARRAY, arrErrors: [] });\r\n      const tex3d = new Texture3D();\r\n      tex3d.createFromRawVolume(vol);\r\n      store.dispatch({ type: StoreActionType.SET_TEXTURE3D, texture3d: tex3d });\r\n      store.dispatch({ type: StoreActionType.SET_MODE_VIEW, modeView: ModeView.VIEW_2D });\r\n      store.dispatch({ type: StoreActionType.SET_MODE_3D, mode3d: Modes3d.RAYCAST });\r\n    }\r\n  }\r\n  /**\r\n   * \r\n   * @param {object} arrFileNames - array of file names (with URL) \r\n   * @param {bool} fromGoogle - true if use google headers\r\n   * \r\n   */\r\n  loadFromUrlArray(arrFileNames, fromGoogle) {\r\n    if (arrFileNames === undefined) {\r\n      console.log('LoaderUrlDicom: no argument in constr');\r\n    }\r\n    const tp = typeof arrFileNames;\r\n    if (tp !== 'object') {\r\n      console.log(`LoaderUrlDicom: bad argument type: ${tp}, but expected object`);\r\n    }\r\n    this.m_arrFileNames = arrFileNames;\r\n\r\n    const fileTools = new FileTools();\r\n    let i;\r\n    const numFiles = this.m_arrFileNames.length;\r\n\r\n    console.log(`LoaderUrlDicom.loadFromUrlArray: start loading: ${numFiles} files`);\r\n    console.log(`LoaderUrlDicom.loadFromUrlArray: from ${arrFileNames[0]} .. to ${arrFileNames[numFiles - 1]}  `);\r\n\r\n    this.m_loaderDicom = new LoaderDicom(numFiles, false);\r\n\r\n    this.m_volume = new Volume();\r\n    const callbackProgress = this.callbackReadProgress;\r\n    const callbackComplete = this.callbackReadComplete;\r\n    callbackProgress(0.0);\r\n\r\n    this.m_loaderDicom.m_numLoadedFiles = numFiles;\r\n    this.m_loaderDicom.m_filesLoadedCounter = 0;\r\n    this.m_loaderDicom.m_numFailsLoad = 0;\r\n\r\n    // declare loaders array\r\n    for (let i = 0; i < numFiles; i++) {\r\n      this.m_loaderDicom.m_errors[i] = -1;\r\n      this.m_loaderDicom.m_loaders[i] = null;\r\n    }\r\n\r\n    this.m_loaderDicom.m_zDim  = numFiles;\r\n    for (i = 0; i < numFiles; i++) {\r\n      const fileNameUrl = this.m_arrFileNames[i];\r\n      const isValid = fileTools.isValidUrl(fileNameUrl);\r\n      if (!isValid) {\r\n        console.log(`LoaderUrlDicom.loadFromUrlArray: url is not valid = ${fileNameUrl}`);\r\n        return false;\r\n      }\r\n\r\n      if (i === 0) {\r\n        this.m_fileName = fileTools.getFileNameFromUrl(fileNameUrl);\r\n      }\r\n\r\n      // create loader for cur file\r\n      this.m_loaders[i] = new FileLoader(fileNameUrl);\r\n      const loader = this.m_loaders[i];\r\n      const okLoader = this.m_loaderDicom.runLoader(this.m_volume, fileNameUrl,\r\n        loader, i, callbackProgress, callbackComplete, fromGoogle);\r\n      if (!okLoader) {\r\n        return false;\r\n      }\r\n    } // for (i)\r\n    // console.log('LoaderUrlDicom.loadFromUrlArray: func finished success');\r\n    return true;\r\n  } // end of load from url array\r\n\r\n\r\n} // end class LoaderUrlDicom\r\n\r\nexport default LoaderUrlDicom;\r\n","//\r\n//\r\n//\r\n\r\n// **********************************************\r\n// Imports\r\n// **********************************************\r\n\r\n// 31.08.2020. Daikon reader\r\nimport daikon from  'daikon';\r\nimport DicomSliceInfo from './dicomsliceinfo';\r\nimport LoadResult from '../LoadResult';\r\nimport LoaderDicom from './LoaderDicom';\r\nimport DicomTagInfo from './LoaderDicom';\r\n\r\nimport { StoreActionType } from '../../../../context/constants';\r\nimport DicomSlice from './dicomslice';\r\n\r\n// **********************************************\r\n// Const\r\n// **********************************************\r\n\r\n// read dicom via daikon: print every tag readed\r\nconst NEED_DEBUG_PRINT_TAGS = false;\r\n\r\n// future possible development:\r\n// deep debug: develop read dicomdir file\r\nconst READ_DICOMDIR = false;\r\n\r\n// **********************************************\r\n// Class\r\n// **********************************************\r\n\r\nclass LoaderDcmDaikon {\r\n  constructor(){ \r\n    this.m_loaderDicom = null;\r\n  }\r\n  //\r\n  // see example read\r\n  // https://github.com/mbarnig/dumpDICOMDIRarchive/blob/master/dumpDICOMDIR.js\r\n  //\r\n  loadDicomfir(fileName, strContent) {\r\n    const dataFile = new DataView(strContent);\r\n    let image = null;\r\n    try {\r\n      image = daikon.Series.parseImage(dataFile);\r\n    } catch (err) {\r\n      console.log(\"error parse dcm file buffer\");\r\n      return LoadResult.BAD_DICOM;\r\n    }\r\n    if ((image === undefined) || (image === null)) {\r\n      return LoadResult.BAD_DICOM;\r\n    }\r\n    const TAG_DIRECTORY_REC = [0x0004, 0x1220];\r\n    let ind;\r\n    // slice location detect (to correct slices order on z)\r\n    ind = daikon.Utils.dec2hex(TAG_DIRECTORY_REC[0]) + daikon.Utils.dec2hex(TAG_DIRECTORY_REC[1]);\r\n    const tagDirRec = image.tags[ind];\r\n    if (tagDirRec !== undefined) {\r\n      const numEntries = tagDirRec.value.length;\r\n      for (let k = 0; k < numEntries; k++) {\r\n        let dirEntry = tagDirRec.value[k];\r\n        if ((dirEntry.element === 57344) && (dirEntry.group === 65534)) {\r\n          const numSub = dirEntry.value.length;\r\n          for (let s = 0; s < numSub; s++) {\r\n            let elemSub = dirEntry.value[s];\r\n            if ((elemSub.element === 5168) && (elemSub.group === 4)) {\r\n              //const str = elemSub.value[0];\r\n              //console.log(`elem sub val = ${str}`);\r\n            }\r\n            if ((elemSub.element === 5376) && (elemSub.group === 4)) {\r\n              const fold = elemSub.value[0];\r\n              const fname = elemSub.value[1];\r\n              console.log(`image nm = ${fold} / ${fname}`);\r\n            }\r\n          } // for s, all sub elemenst \r\n        } // if entry with patient and image information\r\n      } // for k all entries in dir\r\n    } // if dir rec found\r\n    return LoadResult.SUCCESS;\r\n  }\r\n  // load single slice, using file index\r\n  loadSingleSlice(fileIndex, fileName, strContent) {\r\n    // console.log(\"loadSingleSlice [\" + fileIndex.toString() + \"]\");\r\n    const dataFile = new DataView(strContent);\r\n    let image = null;\r\n    try {\r\n      image = daikon.Series.parseImage(dataFile);\r\n    } catch (err) {\r\n      console.log(\"error parse dcm file buffer\");\r\n      return LoadResult.BAD_DICOM;\r\n    }\r\n    if ((image === undefined) || (image === null)) {\r\n      return LoadResult.BAD_DICOM;\r\n    }\r\n    // console.log(\"dcm parse completed\");\r\n    const yDim = image.getRows();\r\n    const xDim = image.getCols();\r\n    const bits = image.getBitsAllocated();\r\n    if ((bits !== 8) && (bits !== 16)) {\r\n      console.log('Parse Dicom data. Strange bits per pixel = ' + bits.toString());\r\n    }\r\n    // data for hash code evaluate\r\n    const patientName = image.getPatientName();\r\n    const studyDescr = image.getImageDescription();\r\n    const studyDate = image.getStudyDate();\r\n    const seriesTime = image.getStudyTime();\r\n    const seriesDescr = image.getSeriesDescription();\r\n    const bodyPartExamined = 'NonExistInDiakonReader';\r\n    //const hasPixels = image.hasPixelData();\r\n    //const isComp = image.isCompressed();\r\n\r\n\r\n    const dicomInfo = this.m_loaderDicom.m_dicomInfo;\r\n    //const volSlice = this.m_loaderDicom.m_slicesVolume.getNewSlice();\r\n    const volSlice = new DicomSlice();\r\n    volSlice.m_sliceNumber = fileIndex;\r\n    volSlice.m_sliceLocation = -1;\r\n    volSlice.m_patientName = patientName;\r\n    volSlice.m_studyDescr = studyDescr;\r\n    volSlice.m_studyDate = studyDate;\r\n    volSlice.m_seriesTime = seriesTime;\r\n    volSlice.m_seriesDescr  = seriesDescr;\r\n    volSlice.m_bodyPartExamined = bodyPartExamined;\r\n    volSlice.buildHash();\r\n\r\n    this.m_loaderDicom.m_minSlice = 0;\r\n    this.m_loaderDicom.m_maxSlice = 0;\r\n    this.m_loaderDicom.m_pixelSpacing.x = 0.0;\r\n    this.m_loaderDicom.m_pixelSpacing.y = 0.0;\r\n    this.m_loaderDicom.m_pixelSpacing.z = 0.0;\r\n    this.m_loaderDicom.m_xDim = xDim;\r\n    this.m_loaderDicom.m_yDim = yDim;\r\n    if (fileIndex < this.m_loaderDicom.m_slicesVolume.m_minSlice) {\r\n      this.m_loaderDicom.m_slicesVolume.m_minSlice = fileIndex;\r\n    }\r\n    if (fileIndex > this.m_loaderDicom.m_slicesVolume.m_maxSlice) {\r\n      this.m_loaderDicom.m_slicesVolume.m_maxSlice = fileIndex;\r\n    }\r\n    this.m_loaderDicom.m_newTagEvent.detail.fileName = fileName;\r\n\r\n    const sliceInfo = new DicomSliceInfo();\r\n    const strSlice = 'Slice ' + fileIndex.toString();\r\n    sliceInfo.m_sliceName = strSlice;\r\n    sliceInfo.m_fileName = fileName;\r\n    sliceInfo.m_tags = [];\r\n    dicomInfo.m_sliceInfo.push(sliceInfo);\r\n\r\n    const TAG_PADDING_VALUE = [0x0028, 0x0120];\r\n    const knownTags = [\r\n      // image dims\r\n      daikon.Tag.TAG_ROWS, daikon.Tag.TAG_COLS, daikon.Tag.TAG_ACQUISITION_MATRIX, \r\n      daikon.Tag.TAG_NUMBER_OF_FRAMES, daikon.Tag.TAG_NUMBER_TEMPORAL_POSITIONS,\r\n      // voxel dims\r\n      daikon.Tag.TAG_PIXEL_SPACING, daikon.Tag.TAG_SLICE_THICKNESS, daikon.Tag.TAG_SLICE_GAP,\r\n      daikon.Tag.TAG_TR, daikon.Tag.TAG_FRAME_TIME, \r\n      // datatype\r\n      daikon.Tag.TAG_BITS_ALLOCATED, daikon.Tag.TAG_BITS_STORED,\r\n      daikon.Tag.TAG_PIXEL_REPRESENTATION, daikon.Tag.TAG_HIGH_BIT, \r\n      daikon.Tag.TAG_PHOTOMETRIC_INTERPRETATION, daikon.Tag.TAG_SAMPLES_PER_PIXEL,\r\n      daikon.Tag.TAG_PLANAR_CONFIG, daikon.Tag.TAG_PALETTE_RED, daikon.Tag.TAG_PALETTE_GREEN,\r\n      daikon.Tag.TAG_PALETTE_BLUE,\r\n\r\n      // data scale\r\n      daikon.Tag.TAG_DATA_SCALE_SLOPE, daikon.Tag.TAG_DATA_SCALE_INTERCEPT,\r\n      daikon.Tag.TAG_DATA_SCALE_ELSCINT, daikon.Tag.TAG_PIXEL_BANDWIDTH,\r\n\r\n      // range\r\n      daikon.Tag.TAG_IMAGE_MIN, daikon.Tag.TAG_IMAGE_MAX,\r\n      daikon.Tag.TAG_WINDOW_CENTER, daikon.Tag.TAG_WINDOW_WIDTH,\r\n\r\n      // description\r\n      daikon.Tag.TAG_PATIENT_NAME, daikon.Tag.TAG_PATIENT_ID,\r\n      daikon.Tag.TAG_STUDY_DATE, daikon.Tag.TAG_STUDY_TIME,\r\n      daikon.Tag.TAG_STUDY_DES, daikon.Tag.TAG_IMAGE_TYPE,\r\n      daikon.Tag.TAG_IMAGE_COMMENTS, daikon.Tag.TAG_SEQUENCE_NAME,\r\n      daikon.Tag.TAG_MODALITY,\r\n\r\n      daikon.Tag.TAG_FRAME_OF_REF_UID,\r\n      daikon.Tag.TAG_STUDY_UID,\r\n\r\n      // volume id\r\n      daikon.Tag.TAG_SERIES_DESCRIPTION, daikon.Tag.TAG_SERIES_INSTANCE_UID,\r\n      daikon.Tag.TAG_SERIES_NUMBER, daikon.Tag.TAG_ECHO_NUMBER,\r\n      daikon.Tag.TAG_TEMPORAL_POSITION,\r\n\r\n      // slice id\r\n      daikon.Tag.TAG_IMAGE_NUM, daikon.Tag.TAG_SLICE_LOCATION,\r\n\r\n      // orientation\r\n      daikon.Tag.TAG_IMAGE_ORIENTATION, daikon.Tag.TAG_IMAGE_POSITION,\r\n      daikon.Tag.TAG_SLICE_LOCATION_VECTOR,\r\n      // lut shape\r\n      daikon.Tag.TAG_LUT_SHAPE,\r\n      // pixel padding value\r\n      TAG_PADDING_VALUE,\r\n    ];\r\n\r\n    // some default values\r\n    const TAG_PATIENT_BIRTH_DATE = [0x0010, 0x0030];\r\n    const TAG_BODY_PART_EXAMINED = [0x0018, 0x0015];\r\n    const TAG_INSTITUTION_NAME = [0x0008, 0x0080];\r\n    const TAG_OPERATORS_NAME = [0x0008, 0x1070];\r\n    const TAG_PHYSICANS_NAME = [0x0008, 0x0090];\r\n\r\n    dicomInfo.m_patientName = image.getPatientName();\r\n    dicomInfo.m_patientDateOfBirth = daikon.Image.getSingleValueSafely(image.getTag(TAG_PATIENT_BIRTH_DATE[0], \r\n      TAG_PATIENT_BIRTH_DATE[1]), 0);\r\n    dicomInfo.m_seriesDescr = seriesDescr;\r\n\r\n    dicomInfo.m_studyDescr = studyDescr;\r\n    dicomInfo.m_studyDate = studyDate;\r\n    dicomInfo.m_seriesTime = seriesTime;\r\n    dicomInfo.m_bodyPartExamined = daikon.Image.getSingleValueSafely(image.getTag(TAG_BODY_PART_EXAMINED[0], \r\n      TAG_BODY_PART_EXAMINED[1]), 0);\r\n    dicomInfo.m_institutionName = daikon.Image.getSingleValueSafely(image.getTag(TAG_INSTITUTION_NAME[0], \r\n      TAG_INSTITUTION_NAME[1]), 0);\r\n    dicomInfo.m_operatorsName = daikon.Image.getSingleValueSafely(image.getTag(TAG_OPERATORS_NAME[0], \r\n      TAG_OPERATORS_NAME[1]), 0);\r\n    dicomInfo.m_physicansName = daikon.Image.getSingleValueSafely(image.getTag(TAG_PHYSICANS_NAME[0], \r\n      TAG_PHYSICANS_NAME[1]), 0);\r\n\r\n    // save all known tags to info array (can be displayed in app UI)\r\n    const numKnownTags = knownTags.length;\r\n    for (let k = 0; k < numKnownTags; k++) {\r\n      const ind = daikon.Utils.dec2hex(knownTags[k][0]) + daikon.Utils.dec2hex(knownTags[k][1]);\r\n      const tag = image.tags[ind];\r\n      if (tag !== undefined) {\r\n        const val = tag.value;\r\n        const group = tag.group;\r\n        const element = tag.element;\r\n\r\n        // const sliceInfo = dicomInfo.m_sliceInfo[0];\r\n        const tagInfo = new DicomTagInfo();\r\n        tagInfo.m_tag = '(' + \r\n          LoaderDicom.numberToHexString(group) + ',' + \r\n          LoaderDicom.numberToHexString(element) + ')';\r\n        const strTagName = this.m_loaderDicom.m_dictionary.getTextDesc(group, element);\r\n        tagInfo.m_attrName = (strTagName.length > 1) ? strTagName : '';\r\n  \r\n        // let strVal = LoaderDicom.getAttrValueAsString(tag);\r\n        let strVal = '';\r\n        if (val !== null) {\r\n          strVal = val.toString();\r\n        }\r\n  \r\n        tagInfo.m_attrValue = strVal;\r\n        sliceInfo.m_tags.push(tagInfo);\r\n        if (NEED_DEBUG_PRINT_TAGS) {\r\n          console.log('tag readed = ' + group.toString() + ', ' + element.toString() + ', v = ' + strVal);\r\n        }\r\n      } // if non null tag\r\n    } // for k all known tags\r\n\r\n    let ind;\r\n    // slice location detect (to correct slices order on z)\r\n    ind = daikon.Utils.dec2hex(daikon.Tag.TAG_SLICE_LOCATION[0]) + daikon.Utils.dec2hex(daikon.Tag.TAG_SLICE_LOCATION[1]);\r\n    const tagSLoc = image.tags[ind];\r\n    if (tagSLoc !== undefined) {\r\n      let sliceLoc = tagSLoc.value[0];\r\n      volSlice.m_sliceLocation = sliceLoc;\r\n      this.m_sliceLocMin = (sliceLoc < this.m_sliceLocMin) ? sliceLoc : this.m_sliceLocMin;\r\n      this.m_sliceLocMax = (sliceLoc > this.m_sliceLocMax) ? sliceLoc : this.m_sliceLocMax;\r\n    }\r\n    // slice number\r\n    ind = daikon.Utils.dec2hex(daikon.Tag.TAG_IMAGE_NUM[0]) + daikon.Utils.dec2hex(daikon.Tag.TAG_IMAGE_NUM[1]);\r\n    const tagSlNum = image.tags[ind];\r\n    if (tagSlNum !== undefined) {\r\n      if (tagSlNum.value !== null) {\r\n        let sliceNumber = tagSlNum.value[0];\r\n        volSlice.m_sliceNumber = sliceNumber;\r\n      }\r\n    }\r\n    // samples per pixel\r\n    ind = daikon.Utils.dec2hex(daikon.Tag.TAG_SAMPLES_PER_PIXEL[0]) + daikon.Utils.dec2hex(daikon.Tag.TAG_SAMPLES_PER_PIXEL[1]);\r\n    const tagSamPerPix = image.tags[ind];\r\n    if (tagSamPerPix !== undefined) {\r\n      let samPerPixel = tagSamPerPix.value[0];\r\n      this.m_loaderDicom.m_samplesPerPixel = samPerPixel;\r\n    }\r\n\r\n    // read pixel padding value\r\n    ind = daikon.Utils.dec2hex(0x0028) + daikon.Utils.dec2hex(0x0120);\r\n    const tagPPV = image.tags[ind];\r\n    if (tagPPV !== undefined) {\r\n      let valPad = tagPPV.value[0];\r\n      if (valPad < 0) {\r\n        valPad = -(valPad ^ 0xffff) - 1;\r\n      }\r\n      // console.log('val pad = ' + valPad);\r\n      this.m_loaderDicom.m_padValue = valPad;\r\n    }\r\n    // read window center\r\n    ind = daikon.Utils.dec2hex(daikon.Tag.TAG_WINDOW_CENTER[0]) + daikon.Utils.dec2hex(daikon.Tag.TAG_WINDOW_CENTER[1]);\r\n    const tagWinCen = image.tags[ind];\r\n    if (tagWinCen !== undefined) {\r\n      this.m_loaderDicom.m_windowCenter = tagWinCen.value[0];\r\n    }\r\n    // read window width\r\n    ind = daikon.Utils.dec2hex(daikon.Tag.TAG_WINDOW_WIDTH[0]) + daikon.Utils.dec2hex(daikon.Tag.TAG_WINDOW_WIDTH[1]);\r\n    const tagWinWid = image.tags[ind];\r\n    if (tagWinWid !== undefined) {\r\n      this.m_loaderDicom.m_windowWidth = tagWinWid.value[0];\r\n    }\r\n    // read rescale intercept\r\n    ind = daikon.Utils.dec2hex(daikon.Tag.TAG_DATA_SCALE_INTERCEPT[0]) + daikon.Utils.dec2hex(daikon.Tag.TAG_DATA_SCALE_INTERCEPT[1]);\r\n    const tagResInt = image.tags[ind];\r\n    if (tagResInt !== undefined) {\r\n      this.m_loaderDicom.m_rescaleIntercept = tagResInt.value[0];\r\n    }\r\n    // read rescale slope\r\n    ind = daikon.Utils.dec2hex(daikon.Tag.TAG_DATA_SCALE_SLOPE[0]) + daikon.Utils.dec2hex(daikon.Tag.TAG_DATA_SCALE_SLOPE[1]);\r\n    const tagResSlo = image.tags[ind];\r\n    if (tagResSlo !== undefined) {\r\n      this.m_loaderDicom.m_rescaleSlope = tagResSlo.value[0];\r\n    }\r\n    // read rescale type\r\n    const TAG_RESCALE_TYPE = [0x0028, 0x1054];\r\n    ind = daikon.Utils.dec2hex(TAG_RESCALE_TYPE[0]) + daikon.Utils.dec2hex(TAG_RESCALE_TYPE[1]);\r\n    const tagResTyp = image.tags[ind];\r\n    if (tagResTyp !== undefined) {\r\n      if ((tagResTyp.value !== null) && (tagResTyp.value[0] === 'HU')) {\r\n        this.m_loaderDicom.m_rescaleHounsfield = true;\r\n      }\r\n    }\r\n\r\n    // read pixel representation\r\n    ind = daikon.Utils.dec2hex(daikon.Tag.TAG_PIXEL_REPRESENTATION[0]) + daikon.Utils.dec2hex(daikon.Tag.TAG_PIXEL_REPRESENTATION[1]);\r\n    const tagPixRep = image.tags[ind];\r\n    if (tagPixRep !== undefined) {\r\n      if (tagPixRep.value[0] === 1) {\r\n        this.m_loaderDicom.m_pixelRepresentaionSigned = true;\r\n      }\r\n    }\r\n\r\n\r\n    // read pixel spacing on xy (physical dimensions)\r\n    ind = daikon.Utils.dec2hex(daikon.Tag.TAG_PIXEL_SPACING[0]) + daikon.Utils.dec2hex(daikon.Tag.TAG_PIXEL_SPACING[1]);\r\n    const tagPS = image.tags[ind];\r\n    if (tagPS !== undefined) {\r\n      let arrSpa = tagPS.value;\r\n      const VAL_2 = 2;\r\n      if (arrSpa.length === VAL_2) {\r\n        this.m_loaderDicom.m_pixelSpacing.x = parseFloat(arrSpa[0]);\r\n        this.m_loaderDicom.m_pixelSpacing.y = parseFloat(arrSpa[1]);\r\n      }\r\n    }\r\n    // read pixel spacing on z (physical dimensions)\r\n    ind = daikon.Utils.dec2hex(daikon.Tag.TAG_SLICE_THICKNESS[0]) + daikon.Utils.dec2hex(daikon.Tag.TAG_SLICE_THICKNESS[1]);\r\n    const tagSLT = image.tags[ind];\r\n    if (tagSLT !== undefined) {\r\n      let arrThick = tagSLT.value;\r\n      if (arrThick.length === 1) {\r\n        this.m_loaderDicom.m_pixelSpacing.z = parseFloat(arrThick[0]);\r\n      }\r\n      // console.log('val pad = ' + valPad);\r\n    }\r\n\r\n    // get image position (x,y,z), help to detect volume physical size\r\n    ind = daikon.Utils.dec2hex(daikon.Tag.TAG_IMAGE_POSITION[0]) + daikon.Utils.dec2hex(daikon.Tag.TAG_IMAGE_POSITION[1]);\r\n    const tagImPos = image.tags[ind];\r\n    if (tagImPos !== undefined) {\r\n      const NUM_COMPONENTS_3 = 3;\r\n      if (tagImPos.value.length === NUM_COMPONENTS_3) {\r\n        // eslint-disable-next-line\r\n        const xPos = tagImPos.value[0];\r\n        // eslint-disable-next-line\r\n        const yPos = tagImPos.value[1];\r\n        // eslint-disable-next-line\r\n        const zPos = tagImPos.value[2];\r\n        this.m_loaderDicom.m_imagePosMin.x = (xPos < this.m_loaderDicom.m_imagePosMin.x) ? xPos : this.m_loaderDicom.m_imagePosMin.x;\r\n        this.m_loaderDicom.m_imagePosMin.y = (yPos < this.m_loaderDicom.m_imagePosMin.y) ? yPos : this.m_loaderDicom.m_imagePosMin.y;\r\n        this.m_loaderDicom.m_imagePosMin.z = (zPos < this.m_loaderDicom.m_imagePosMin.z) ? zPos : this.m_loaderDicom.m_imagePosMin.z;\r\n        this.m_loaderDicom.m_imagePosMax.x = (xPos > this.m_loaderDicom.m_imagePosMax.x) ? xPos : this.m_loaderDicom.m_imagePosMax.x;\r\n        this.m_loaderDicom.m_imagePosMax.y = (yPos > this.m_loaderDicom.m_imagePosMax.y) ? yPos : this.m_loaderDicom.m_imagePosMax.y;\r\n        this.m_loaderDicom.m_imagePosMax.z = (zPos > this.m_loaderDicom.m_imagePosMax.z) ? zPos : this.m_loaderDicom.m_imagePosMax.z;\r\n        if (NEED_DEBUG_PRINT_TAGS) {\r\n          console.log(`TAG. image position x,y,z = ${xPos}, ${yPos}, ${zPos}`);\r\n        } // if print\r\n      } // if 3 components in array\r\n    } // if tag exists\r\n\r\n    // read transfer syntax (detect big endian)\r\n    ind = daikon.Utils.dec2hex(daikon.Tag.TAG_TRANSFER_SYNTAX[0]) + daikon.Utils.dec2hex(daikon.Tag.TAG_TRANSFER_SYNTAX[1]);\r\n    const tagTraSyn = image.tags[ind];\r\n    if (tagTraSyn !== undefined) {\r\n      let arrStrTra = tagTraSyn.value;\r\n      if (arrStrTra[0] === \"1.2.840.10008.1.2.2\") {\r\n        this.m_loaderDicom.m_littleEndian = false;\r\n      }\r\n      // console.log('val pad = ' + valPad);\r\n    }\r\n\r\n    // add volume slice to slices volume (and manage series)\r\n    this.m_loaderDicom.m_slicesVolume.addSlice(volSlice);\r\n\r\n    // check correct read image\r\n    const pixels = image.getRawData();\r\n    const numBytesPixelsRead = pixels.byteLength;\r\n    const VAL_8 = 8;\r\n    const numBytesPixelsExpected = xDim * yDim * Math.floor(bits / VAL_8) * this.m_loaderDicom.m_samplesPerPixel;\r\n    if (numBytesPixelsRead !== numBytesPixelsExpected) {\r\n      console.log('Error read Dicom via Diakon parser');\r\n      return LoadResult.ERROR_COMPRESSED_IMAGE_NOT_SUPPORTED;\r\n    }\r\n\r\n    // create pixels storage in volume\r\n    if (this.m_loaderDicom.m_pixelRepresentaionSigned) {\r\n      volSlice.m_image = new Int16Array(xDim * yDim);\r\n    } else {\r\n      volSlice.m_image = new Uint16Array(xDim * yDim);\r\n    }\r\n\r\n    // copy pixels (ArrayBuffer) into volSlice.m_image\r\n    const numPixels = xDim * yDim;\r\n    if (this.m_loaderDicom.m_samplesPerPixel === 1) {\r\n      const pixSrc = new Uint16Array(pixels);\r\n      for (let i = 0; i < numPixels; i++) {\r\n        volSlice.m_image[i] = pixSrc[i];\r\n      } // for i\r\n    } // if 1 sample per pixel\r\n    else if (this.m_loaderDicom.m_samplesPerPixel === 3) {\r\n      const pixSrc = new Uint8Array(pixels);\r\n      let j = 0;\r\n      for (let i = 0; i < numPixels; i++, j += 3) {\r\n        const bVal = pixSrc[j + 0];\r\n        const gVal = pixSrc[j + 1];\r\n        const rVal = pixSrc[j + 2];\r\n        volSlice.m_image[i] = Math.floor( (bVal + gVal + rVal) / 3 );\r\n      } // for i\r\n    } // if samples per pixel is 3\r\n    // store x, y dims\r\n    volSlice.m_xDim = xDim;\r\n    volSlice.m_yDim = yDim;\r\n    return LoadResult.SUCCESS;\r\n  } // end load single slice\r\n  //\r\n  // read 1 slice during reading multiple dcm files\r\n  //\r\n  readSlice(loader, fileIndex, fileName, strContent) {\r\n    this.m_loaderDicom = loader;\r\n    const ret = this.loadSingleSlice(fileIndex, fileName, strContent);\r\n    return ret;\r\n  }\r\n  // read 1 slice\r\n  readSingleSlice(dispatch, loader, fileIndex, fileName, strContent) {\r\n    this.m_loaderDicom = loader;\r\n    let ret;\r\n    if (!READ_DICOMDIR) {\r\n      ret = this.loadSingleSlice(fileIndex, fileName, strContent);\r\n    } else {\r\n      ret = this.loadDicomfir(fileName, strContent);\r\n    }\r\n    if (ret !== LoadResult.SUCCESS) {\r\n      return ret;\r\n    }\r\n    \r\n    // save dicomInfo to store\r\n    const dicomInfo = this.m_loaderDicom.m_dicomInfo;\r\n    dispatch({ type: StoreActionType.SET_DICOM_INFO, dicomInfo: dicomInfo });\r\n    // save dicom loader to store\r\n    dispatch({ type: StoreActionType.SET_LOADER_DICOM, loaderDicom: this.m_loaderDicom });\r\n    return ret;\r\n  }\r\n\r\n}\r\n\r\n\r\nexport default LoaderDcmDaikon;\r\n\r\n","//\r\n//\r\n//\r\n\r\n// **********************************************\r\n// Import\r\n// **********************************************\r\n\r\nimport VolumeSet from '../VolumeSet';\r\nimport LoadResult from '../LoadResult';\r\nimport FileTools from './FileTools';\r\nimport FileLoader from './FileLoader';\r\nimport LoaderDcmDaikon from './LoaderDcmDaikon';\r\nimport LoaderDicom from './LoaderDicom';\r\n// import DicomSlicesVolume from './dicomslicesvolume';\r\n\r\n// **********************************************\r\n// Const\r\n// **********************************************\r\n\r\nconst DEBUG_PRINT_TAGS_INFO = false;\r\n\r\n// **********************************************\r\n// Class\r\n// **********************************************\r\n\r\nclass LoaderDcmUrlDaikon {\r\n  constructor() {\r\n    this.m_loaderDaikon = new LoaderDcmDaikon();\r\n    this.readReadyFileList = this.readReadyFileList.bind(this);\r\n  }\r\n  readFromUrl(volSet, strUrl, callbackComplete, callbackProgress) {\r\n    // check arguments\r\n    console.assert(volSet != null, \"Null volume\");\r\n    console.assert(volSet instanceof VolumeSet, \"Should be volume set\");\r\n    console.assert(strUrl != null, \"Null string url\");\r\n    console.assert(typeof(strUrl) === 'string', \"Should be string in url\");\r\n\r\n    // replace file name to 'file_list.txt'\r\n    const ft = new FileTools();\r\n    const isValidUrl = ft.isValidUrl(strUrl);\r\n    if (!isValidUrl) {\r\n      console.log(`readFromUrl: not vaild URL = = ${strUrl} `);\r\n      return false;\r\n    }\r\n    this.m_folder = ft.getFolderNameFromUrl(strUrl);\r\n    const urlFileList = this.m_folder + '/file_list.txt';\r\n    console.log(`readFromUrl: load file = ${urlFileList} `);\r\n\r\n    callbackProgress(0.0);\r\n    \r\n    const fileLoader = new FileLoader(urlFileList);\r\n    this.m_fileListCounter = 0;\r\n    fileLoader.readFile((arrBuf) => {\r\n      this.m_fileListCounter += 1;\r\n      if (this.m_fileListCounter === 1) {\r\n        const okRead = this.readReadyFileList(volSet, arrBuf, callbackComplete, callbackProgress);\r\n        return okRead;\r\n      }\r\n      return true;\r\n    }, (errMsg) => {\r\n      console.log(`Error read file: ${errMsg}`);\r\n      // callbackComplete(LoadResult.ERROR_CANT_OPEN_URL, null, 0, null);\r\n      return false;\r\n    }); // get file from server\r\n    return true;\r\n  } // end read from url\r\n  //\r\n  readReadyFileList(volSet, arrBuf, callbackComplete, callbackProgress) {\r\n    const uint8Arr = new Uint8Array(arrBuf);\r\n    const strFileContent = String.fromCharCode.apply(null, uint8Arr);\r\n\r\n    const LEN_LOG = 64;\r\n    const strLog = strFileContent.substr(0, LEN_LOG);\r\n    console.log(`Loaded file list. Started with:  ${strLog} ...`);\r\n\r\n    const arrFileNames = strFileContent.split('\\n');\r\n\r\n    let numFiles = arrFileNames.length;\r\n    // check last empty elements\r\n    const MIN_FILE_NAME_SIZE = 4;\r\n    for (let i = numFiles - 1; i >= 0; i--) {\r\n      if (arrFileNames[i].endsWith('\\r')) {\r\n        arrFileNames[i] = arrFileNames[i].substring(0, arrFileNames[i].length - 1);\r\n      }\r\n      if (arrFileNames[i].length < MIN_FILE_NAME_SIZE) {\r\n        arrFileNames.pop();\r\n      }\r\n    }\r\n    numFiles = arrFileNames.length;\r\n    this.m_loaders = [];\r\n    this.m_errors = [];\r\n    // declare slices array\r\n    for (let i = 0; i < numFiles; i++) {\r\n      // this.m_slices[i] = null;\r\n      this.m_errors[i] = -1;\r\n      this.m_loaders[i] = null;\r\n    }\r\n    \r\n\r\n    const zDim = numFiles;\r\n    console.log(`Loaded file list. ${numFiles} files will be loaded. 1st file in list is = ${arrFileNames[0]}`);\r\n    console.log(`Loaded file list. Last file in list is = ${arrFileNames[numFiles - 1]}`);\r\n\r\n    this.m_loaderDaikon.m_loaderDicom = new LoaderDicom(numFiles);\r\n\r\n    // physical dimension\r\n    this.m_loaderDaikon.m_loaderDicom.m_pixelSpacing = {\r\n      x: 0.0,\r\n      y: 0.0,\r\n      z: 0.0,\r\n    };\r\n    this.m_boxSize = {\r\n      x: 1.0,\r\n      y: 1.0,\r\n      z: 1.0,\r\n    };\r\n    this.m_filesLoadedCounter = 0;\r\n    this.m_numFailsLoad = 0;\r\n    this.m_numLoadedFiles = numFiles;\r\n\r\n    this.m_loaderDaikon.m_loaderDicom.m_imagePosMin = {\r\n      // eslint-disable-next-line\r\n      x: +1.0e12,\r\n      // eslint-disable-next-line\r\n      y: +1.0e12,\r\n      // eslint-disable-next-line\r\n      z: +1.0e12\r\n    };\r\n    this.m_loaderDaikon.m_loaderDicom.m_imagePosMax = {\r\n      // eslint-disable-next-line\r\n      x: -1.0e12,\r\n      // eslint-disable-next-line\r\n      y: -1.0e12,\r\n      // eslint-disable-next-line\r\n      z: -1.0e12\r\n    };\r\n\r\n    // eslint-disable-next-line\r\n    this.m_loaderDaikon.m_sliceLocMin = +1.0e12;\r\n    // eslint-disable-next-line\r\n    this.m_loaderDaikon.m_sliceLocMax = -1.0e12;\r\n\r\n    for (let i = 0; (i < this.m_numLoadedFiles) && (this.m_numFailsLoad < 1); i++) {\r\n      const urlFile = `${this.m_folder}/${arrFileNames[i]}`;\r\n      // console.log(`trying read file ${urlFile} from web`);\r\n\r\n      this.m_loaders[i] = new FileLoader(urlFile);\r\n      const loader = this.m_loaders[i];\r\n      loader.readFile((fileArrBu) => {\r\n        const ratioLoaded = this.m_filesLoadedCounter / this.m_numLoadedFiles;\r\n        const VAL_MASK = 7;\r\n        if ((callbackProgress !== undefined) && ((this.m_filesLoadedCounter & VAL_MASK) === 0)) {\r\n          //console.log(`LoadDcmUrlDaikon. Progress = ${ratioLoaded}`);\r\n          callbackProgress(ratioLoaded);\r\n        }\r\n        //if ((callbackProgress !== undefined) &&\r\n        //  (this.m_filesLoadedCounter + 1 === this.m_numLoadedFiles)) {\r\n        //  callbackProgress(1.0);\r\n        //}\r\n        const ret = this.m_loaderDaikon.loadSingleSlice(i, urlFile, fileArrBu);\r\n        if (ret !== LoadResult.SUCCESS) {\r\n          return ret;\r\n        }\r\n        // console.log(`LoadDcmUrlDaikon. Loaded/All = ${this.m_filesLoadedCounter} / ${this.m_numLoadedFiles}`);\r\n        this.m_filesLoadedCounter += 1;\r\n        if (this.m_filesLoadedCounter === this.m_numLoadedFiles) {\r\n          // Finalize physic dimension\r\n          if (DEBUG_PRINT_TAGS_INFO) {\r\n            console.log(`slice location (min, max) = ${this.m_sliceLocMin}, ${this.m_sliceLocMax}`);\r\n          }\r\n          const imagePosBox = {\r\n            x: this.m_loaderDaikon.m_loaderDicom.m_imagePosMax.x - this.m_loaderDaikon.m_loaderDicom.m_imagePosMin.x,\r\n            y: this.m_loaderDaikon.m_loaderDicom.y - this.m_loaderDaikon.m_loaderDicom.m_imagePosMin.y,\r\n            z: this.m_loaderDaikon.m_loaderDicom.m_imagePosMax.z - this.m_loaderDaikon.m_loaderDicom.m_imagePosMin.z\r\n          };\r\n          const TOO_MIN = 0.00001;\r\n          let zBox;\r\n          if (Math.abs(this.m_loaderDaikon.m_loaderDicom.m_pixelSpacing.z) > TOO_MIN) {\r\n            zBox = this.m_loaderDaikon.m_loaderDicom.m_pixelSpacing.z * zDim;\r\n          } else {\r\n            zBox = imagePosBox.z;\r\n            if (Math.abs(zBox) < TOO_MIN) {\r\n              zBox = imagePosBox.x;\r\n              if (Math.abs(zBox) < TOO_MIN) {\r\n                zBox = imagePosBox.y;\r\n              }\r\n            }\r\n          } // if pixel spacing 0\r\n          if (zBox < TOO_MIN) {\r\n            zBox = 1.0;\r\n          }\r\n          const xDim = this.m_loaderDaikon.m_loaderDicom.m_xDim;\r\n          const yDim = this.m_loaderDaikon.m_loaderDicom.m_yDim;\r\n  \r\n          this.m_loaderDaikon.m_loaderDicom.m_pixelSpacing.z = zBox / zDim;\r\n          this.m_boxSize.z = zDim * this.m_loaderDaikon.m_loaderDicom.m_pixelSpacing.z;\r\n          this.m_boxSize.x = xDim * this.m_loaderDaikon.m_loaderDicom.m_pixelSpacing.x;\r\n          this.m_boxSize.y = yDim * this.m_loaderDaikon.m_loaderDicom.m_pixelSpacing.y;\r\n          console.log(`LoadDcmUrlDaikon. Volume local phys dim: ${this.m_boxSize.x} * ${this.m_boxSize.y} * ${this.m_boxSize.z}`);\r\n\r\n          // TODO: add hash\r\n          let series = this.m_loaderDaikon.m_loaderDicom.m_slicesVolume.getSeries();\r\n          if (series.length === 0) {\r\n            this.m_loaderDaikon.m_loaderDicom.m_slicesVolume.buildSeriesInfo();\r\n            series = this.m_loaderDaikon.m_loaderDicom.m_slicesVolume.getSeries();\r\n          }\r\n          const indexSerie = 0;\r\n          const hash = series[indexSerie].m_hash;\r\n          const errStatus = this.m_loaderDaikon.m_loaderDicom.createVolumeFromSlices(volSet, indexSerie,  hash);\r\n          if (callbackProgress !== null) {\r\n            callbackProgress(1.0);\r\n          }\r\n\r\n          if (callbackComplete !== null) {\r\n            callbackComplete(errStatus);\r\n            return true;\r\n          }\r\n        } // if last file\r\n      }); // file buffer is ready to parse\r\n  \r\n    } // for i all files\r\n\r\n    return LoadResult.SUCCESS;\r\n  } // end readReadyFileList\r\n\r\n} // end class LoaderDcmUrlDaikon\r\n\r\nexport default LoaderDcmUrlDaikon;","export default {\r\n  // special demo dialog file locations\r\n  //\r\n\r\n  demoUrls: [\r\n  ],\r\n\r\n  googleCloudDemoActivce: false,\r\n  arrMenuGoogle: [\r\n    {\r\n      text: 'Demo lungs AA',\r\n      tooltip: 'Load some lungs model',\r\n    },\r\n    {\r\n      text: 'Demo head BB',\r\n      tooltip: 'Load some strange head',\r\n    },\r\n    {\r\n      text: 'Demo alien CC',\r\n      tooltip: 'Write here smth please',\r\n    },\r\n  ],\r\n  demoWomanPelvisPrefix : '',\r\n  demoWomanPelvisUrls : [\r\n  ],\r\n  demoLungsPrefix: '',\r\n  demoLungsUrls: [\r\n  ],\r\n\r\n};","/**\r\n * @fileOverview UiOpenMenu\r\n * @author Epam\r\n * @version 1.0.0\r\n */\r\n\r\n\r\n// ********************************************************\r\n// Imports\r\n// ********************************************************\r\n\r\n\r\nimport React from 'react';\r\n//\r\nimport { NavDropdown, Button, Modal, InputGroup, FormControl, } from 'react-bootstrap';\r\n// import { gzip, ungzip } from 'node-gzip';\r\nimport pako from 'pako';\r\n// import { WEBGL } from '../../../WebGL';\r\nimport VolumeSet from '../engine/VolumeSet';\r\nimport Volume from '../engine/Volume';\r\nimport Texture3D from '../engine/Texture3D';\r\n\r\nimport UiModalDemo from './UiModalDemo';\r\nimport UiModalGoogle from './UiModalGoogle';\r\nimport UiModalWindowCenterWidth from './UiModalWinCW';\r\n// import UiModalDicomSeries from './UiModalDicomSeries';\r\nimport { StoreActionType, ModeView, Modes3d } from '../../../context/constants';\r\n\r\n// import { timingSafeEqual } from 'crypto';\r\nimport LoadResult from '../engine/LoadResult';\r\nimport FileTools from '../engine/loaders/FileTools';\r\nimport LoaderDicom from '../engine/loaders/LoaderDicom';\r\nimport LoaderHdr from '../engine/loaders/LoaderHdr';\r\n\r\nimport LoaderUrlDicom from '../engine/loaders/LoaderUrlDicom';\r\nimport LoaderDcmDaikon from '../engine/loaders/LoaderDcmDaikon';\r\nimport LoaderDcmUrlDaikon from '../engine//loaders/LoadDcmUrlDiakon';\r\n\r\nimport httpClient from '../../../utils/httpClient';\r\nimport config from '../config/config';\r\n\r\n// ********************************************************\r\n// Const\r\n// ********************************************************\r\n\r\n/** Need to have demo menu */\r\nconst NEED_DEMO_MENU = true;\r\n\r\n/** deep artificially fix volume texture size to 4 * N */\r\nconst NEED_TEXTURE_SIZE_4X = true;\r\n\r\n// use daikon parser for Dicom (*dcm) file loading\r\nconst READ_DICOM_VIA_DAIKON = true;\r\n\r\n// ********************************************************\r\n// Class\r\n// ********************************************************\r\n\r\n\r\n/**\r\n * Class UiOpenMenu some text later...\r\n */\r\nclass UiOpenMenu extends React.Component {\r\n  /**\r\n   * @param {object} props - props from up level object\r\n   */\r\n  constructor(props) {\r\n    super(props);\r\n    this.onButtonLocalFile = this.onButtonLocalFile.bind(this);\r\n    this.handleFileSelected = this.handleFileSelected.bind(this);\r\n    this.onFileContentReadSingleFile = this.onFileContentReadSingleFile.bind(this);\r\n    this.onFileContentReadMultipleDicom = this.onFileContentReadMultipleDicom.bind(this);\r\n    this.onFileContentReadMultipleHdr = this.onFileContentReadMultipleHdr.bind(this);\r\n    this.setErrorString = this.setErrorString.bind(this);\r\n\r\n    this.onModalUrlShow = this.onModalUrlShow.bind(this);\r\n    this.onModalUrlHide = this.onModalUrlHide.bind(this);\r\n    this.onClickLoadUrl = this.onClickLoadUrl.bind(this);\r\n    this.callbackReadCompleteUrlKtxNii = this.callbackReadCompleteUrlKtxNii.bind(this);\r\n\r\n    this.onModalDemoOpenShow = this.onModalDemoOpenShow.bind(this);\r\n    this.onModalDemoOpenHide = this.onModalDemoOpenHide.bind(this);\r\n    this.onDemoSelected = this.onDemoSelected.bind(this);\r\n\r\n    this.onModalWindowCWHide = this.onModalWindowCWHide.bind(this);\r\n\r\n    this.onModalGoogleShow = this.onModalGoogleShow.bind(this);\r\n    this.onModalGoogleHide = this.onModalGoogleHide.bind(this);\r\n    this.onGoogleSelected = this.onGoogleSelected.bind(this);\r\n\r\n    this.onModalDicomSeriesHide = this.onModalDicomSeriesHide.bind(this);\r\n    this.onDicomSerieSelected = this.onDicomSerieSelected.bind(this);\r\n\r\n    this.callbackReadProgress = this.callbackReadProgress.bind(this);\r\n    this.callbackReadComplete = this.callbackReadComplete.bind(this);\r\n    this.callbackReadSingleDicomComplete = this.callbackReadSingleDicomComplete.bind(this);\r\n    this.callbackReadMultipleComplete = this.callbackReadMultipleComplete.bind(this);\r\n    this.callbackCompleteMultipleDicom = this.callbackCompleteMultipleDicom.bind(this);\r\n\r\n    this.m_fileNameOnLoad = '';\r\n    this.m_fileName = '';\r\n    this.m_fileIndex = 0;\r\n    this.m_fileReader = null;\r\n    this.state = {\r\n      strUrl: '',\r\n      showModalUrl: false,\r\n      showModalDemo: false,\r\n      showModalGoogle: false,\r\n      showModalWindowCW: false,\r\n      onLoadCounter: 1,\r\n    };\r\n    this.m_volumeSet = null;\r\n    this.m_volumeRoi = null;\r\n    this.m_updateEnable = true;\r\n    this.roiMode = false;\r\n    this.api = new httpClient();\r\n  }\r\n  finalizeSuccessLoadedVolume(volSet, fileNameIn) {\r\n    const { store, dispatch } = this.props;\r\n\r\n    console.assert(volSet instanceof VolumeSet, \"finalizeSuccessLoadedVolume: should be VolumeSet\");\r\n    console.assert(volSet.getNumVolumes() >= 1, \"finalizeSuccessLoadedVolume: should be more or 1 volume\");\r\n    const indexVol = 0;\r\n\r\n    const vol = volSet.getVolume(indexVol);\r\n    console.assert(vol !== null, \"finalizeSuccessLoadedVolume: should be non zero volume\");\r\n\r\n    if (vol.m_dataArray !== null) {\r\n      console.log(`success loaded volume from ${fileNameIn}`);\r\n      if (NEED_TEXTURE_SIZE_4X) {\r\n        vol.makeDimensions4x();\r\n      }\r\n      // invoke notification\r\n\r\n      // send update (repaint) if was loaded prev model\r\n      if (store.isLoaded) {\r\n        dispatch({ type: StoreActionType.SET_IS_LOADED, isLoaded: false });\r\n      }\r\n      console.log(\"------------check volume:\\n\", volSet.checkVolume());\r\n\r\n      dispatch({ type: StoreActionType.SET_VOLUME_SET, volumeSet: volSet });\r\n      dispatch({ type: StoreActionType.SET_VOLUME_INDEX, volumeIndex: volSet.getNumVolumes() - 1 });\r\n      dispatch({ type: StoreActionType.SET_IS_LOADED, isLoaded: true });\r\n      dispatch({ type: StoreActionType.SET_FILENAME, fileName: fileNameIn });\r\n      dispatch({ type: StoreActionType.SET_ERR_ARRAY, arrErrors: [] });\r\n      const tex3d = new Texture3D();\r\n      tex3d.createFromRawVolume(vol);\r\n      dispatch({ type: StoreActionType.SET_TEXTURE3D, texture3d: tex3d });\r\n      dispatch({ type: StoreActionType.SET_MODE_VIEW, modeView: ModeView.VIEW_2D });\r\n      dispatch({ type: StoreActionType.SET_MODE_3D, mode3d: Modes3d.RAYCAST });\r\n    }\r\n  }\r\n  setErrorString(strErr) {\r\n    const { dispatch } = this.props;\r\n    const arrErrors = [];\r\n    arrErrors.push(strErr);\r\n    dispatch({ type: StoreActionType.SET_IS_LOADED, isLoaded: false });\r\n    dispatch({ type: StoreActionType.SET_ERR_ARRAY, arrErrors: arrErrors });\r\n    dispatch({ type: StoreActionType.SET_VOLUME_SET, volume: null });\r\n  }\r\n  finalizeFailedLoadedVolume(fileNameIn, arrErrors) {\r\n    console.assert(arrErrors !== undefined);\r\n    // invoke notification\r\n    const { store, dispatch } = this.props;\r\n    dispatch({ type: StoreActionType.SET_IS_LOADED, isLoaded: false });\r\n    dispatch({ type: StoreActionType.SET_VOLUME_SET, volume: null });\r\n    dispatch({ type: StoreActionType.SET_ERR_ARRAY, arrErrors: arrErrors });\r\n    dispatch({ type: StoreActionType.SET_FILENAME, fileName: fileNameIn });\r\n\r\n    const uiapp = store.visState.uiApp;\r\n    uiapp.doHideProgressBar();\r\n  }\r\n  callbackReadProgress(ratio01) {\r\n    const ratioPrc = Math.floor(ratio01 * 100);\r\n    const { store } = this.props;\r\n    const uiapp = store.visState.uiApp;\r\n    if (uiapp !== null) {\r\n      if (ratioPrc === 0) {\r\n        uiapp.doShowProgressBar('Loading...');\r\n      }\r\n      if (ratioPrc >= 99) {\r\n        uiapp.doHideProgressBar();\r\n      } else {\r\n        uiapp.doSetProgressBarRatio(ratioPrc);\r\n      }\r\n    }\r\n  } // callback progress\r\n  callbackReadComplete(errCode) {\r\n    if (errCode === undefined) {\r\n      console.log('callbackReadComplete. should be errCode');\r\n    } else {\r\n      if (errCode !== LoadResult.SUCCESS) {\r\n        const strErr = LoadResult.getResultString(errCode);\r\n        this.setErrorString(strErr);\r\n      }\r\n    }\r\n    const { store } = this.props;\r\n    const uiapp = store.visState.uiApp;\r\n    // console.log(`callbackReadComplete wiyth err = ${loadErrorCode}`);\r\n    uiapp.doHideProgressBar();\r\n\r\n    if (errCode === LoadResult.SUCCESS) {\r\n      // console.log('callbackReadComplete finished OK');\r\n      this.finalizeSuccessLoadedVolume(this.m_volumeSet, this.m_fileName);\r\n    } else {\r\n      console.log(`callbackReadComplete failed! reading ${this.m_fileName} file`, errCode);\r\n      const arrErr = [];\r\n      const strErr = LoadResult.getResultString(errCode);\r\n      arrErr.push(strErr);\r\n      this.finalizeFailedLoadedVolume(this.m_fileName, arrErr);\r\n    }\r\n  }\r\n  callbackReadSingleDicomComplete(errCode) {\r\n    if (errCode === LoadResult.SUCCESS) {\r\n      // console.log('TODO: UI select window center /width ...');\r\n\r\n      const { dispatch } = this.props;\r\n      dispatch({ type: StoreActionType.SET_VOLUME_SET, volumeSet: this.m_volumeSet });\r\n      dispatch({ type: StoreActionType.SET_VOLUME_INDEX, volumeIndex: 0 });\r\n      // save dicom loader to store\r\n      dispatch({ type: StoreActionType.SET_LOADER_DICOM, loaderDicom: this.m_loader });\r\n\r\n      // setup modal: window min, max\r\n      this.childModalWindowCenterWidth.initWindowRange();\r\n\r\n      // show modal: select window center, width\r\n      this.setState({ showModalWindowCW: true });\r\n      return; // do nothing immediately after: wait for dialog\r\n    }\r\n    this.callbackReadComplete(errCode);\r\n  }\r\n  callbackReadMultipleComplete(errCode) {\r\n    if (errCode !== LoadResult.SUCCESS) {\r\n      const strErr = LoadResult.getResultString(errCode);\r\n      this.setErrorString(strErr);\r\n    }\r\n  }\r\n  onFileReadSingleUncompressedFile(strContent, callbackProgress, callbackComplete, callbackCompleteSingleDicom) {\r\n    if (this.m_fileName.endsWith('.ktx') || this.m_fileName.endsWith('.KTX')) {\r\n      // if read ktx\r\n      this.m_volumeSet.readFromKtx(strContent, callbackProgress, callbackComplete);\r\n    } else if (this.m_fileName.endsWith('.nii') || this.m_fileName.endsWith('.NII')) {\r\n      this.m_volumeSet.readFromNifti(strContent, callbackProgress, callbackComplete);\r\n    } else if (this.m_fileName.endsWith('.dcm') || this.m_fileName.endsWith('.DCM')) {\r\n      this.m_loader = new LoaderDicom();\r\n      this.m_loader.m_zDim = 1;\r\n      this.m_loader.m_numFiles = 1;\r\n      this.m_volumeSet.readFromDicom(this.m_loader, strContent, callbackProgress, callbackCompleteSingleDicom);\r\n    } else if (this.m_fileName.endsWith('.hdr') || this.m_fileName.endsWith('.HDR')) {\r\n      // readOk = vol.readFromHdrHeader(strContent, callbackProgress, callbackComplete);\r\n      console.log(`cant read single hdr file: ${this.m_fileName}`);\r\n      // readStatus = LoadResult.BAD_HEADER;\r\n    } else if (this.m_fileName.endsWith('.img') || this.m_fileName.endsWith('.IMG')) {\r\n      // readOk = vol.readFromHdrImage(strContent, callbackProgress, callbackComplete);\r\n      console.log(`cant read single img file: ${this.m_fileName}`);\r\n      // readStatus = LoadResult.BAD_HEADER;\r\n    } else {\r\n      console.log(`onFileContentReadSingleFile: unknown file type: ${this.m_fileName}`);\r\n    }\r\n  }\r\n  onFileContentReadSingleFile() {\r\n    let strContent = this.m_fileReader.result;\r\n    this.onFileReadSingleBuffer(strContent);\r\n  }\r\n  //\r\n  // daikon read individual slice from file buffer (one from multiple files)\r\n  // strContent is ArrayBuffer\r\n  readSliceDicomViaDaikon(fileIndex, fileName, strContent) {\r\n    const loaderDaikon = new LoaderDcmDaikon();\r\n    const ret = loaderDaikon.readSlice(this.m_loader, fileIndex, fileName, strContent);\r\n    return ret;\r\n  } // end read single slice via daikon\r\n  //\r\n  // based on local file read\r\n  // read from string content in this.m_fileReader.result\r\n  //\r\n  onFileReadSingleBuffer(strContent) {\r\n    // daikon read\r\n    // strContent is ArrayBuffer\r\n    if ((this.m_fileName.endsWith('.dcm') || this.m_fileName.endsWith('.DCM')) && READ_DICOM_VIA_DAIKON) {\r\n      const loaderDcm = new LoaderDcmDaikon();\r\n      const { dispatch } = this.props;\r\n      const fileIndex = this.m_fileIndex;\r\n      const fileName = this.m_fileName;\r\n      this.m_loader = new LoaderDicom(1);\r\n      const ret = loaderDcm.readSingleSlice(dispatch, this.m_loader, fileIndex, fileName, strContent);\r\n      this.callbackReadSingleDicomComplete(ret);\r\n      return ret;\r\n    }\r\n    //console.log(\"webgl available: \", WEBGL.isWebGLAvailable());\r\n\r\n    console.log('UiOpenMenu. onFileReadSingleBuffer ...');\r\n    // console.log(`file content = ${strContent.substring(0, 64)}`);\r\n    // console.log(`onFileContentRead. type = ${typeof strContent}`);\r\n    this.m_volumeSet = new VolumeSet();\r\n    // add empty [0]-th volume in set to read single file\r\n    this.m_volumeSet.addVolume(new Volume())\r\n    const callbackProgress = this.callbackReadProgress;\r\n    const callbackComplete = this.callbackReadComplete;\r\n    const callbackCompleteSingleDicom = this.callbackReadSingleDicomComplete;\r\n\r\n\r\n    if (this.m_fileName.endsWith('.ktx') || this.m_fileName.endsWith('.KTX')) {\r\n      // if read ktx\r\n      this.m_volumeSet.readFromKtx(strContent, callbackProgress, callbackComplete);\r\n    } else if (this.m_fileName.endsWith('.nii') || this.m_fileName.endsWith('.NII')) {\r\n      this.m_volumeSet.readFromNifti(strContent, callbackProgress, callbackComplete);\r\n    } else if (this.m_fileName.endsWith('.dcm') || this.m_fileName.endsWith('.DCM')) {\r\n      this.m_loader = new LoaderDicom();\r\n      this.m_loader.m_zDim = 1;\r\n      this.m_loader.m_numFiles = 1;\r\n      this.m_volumeSet.readFromDicom(this.m_loader, strContent, callbackProgress, callbackCompleteSingleDicom);\r\n      // save dicomInfo to store\r\n      const dicomInfo = this.m_loader.m_dicomInfo;\r\n      const sliceInfo = dicomInfo.m_sliceInfo[0];\r\n      sliceInfo.m_fileName = this.m_fileName;\r\n      sliceInfo.m_sliceName = 'Slice 0';\r\n      const { dispatch } = this.props;\r\n      dispatch({ type: StoreActionType.SET_DICOM_INFO, dicomInfo: dicomInfo });\r\n    } else if (this.m_fileName.endsWith('.hdr') || this.m_fileName.endsWith('.HDR')) {\r\n      // readOk = vol.readFromHdrHeader(strContent, callbackProgress, callbackComplete);\r\n      console.log(`cant read single hdr file: ${this.m_fileName}`);\r\n      // readStatus = LoadResult.BAD_HEADER;\r\n    } else if (this.m_fileName.endsWith('.img') || this.m_fileName.endsWith('.IMG')) {\r\n      // readOk = vol.readFromHdrImage(strContent, callbackProgress, callbackComplete);\r\n      console.log(`cant read single img file: ${this.m_fileName}`);\r\n      // readStatus = LoadResult.BAD_HEADER;\r\n    } else {\r\n      console.log(`onFileContentReadSingleFile: unknown file type: ${this.m_fileName}`);\r\n    }\r\n\r\n  }\r\n  //\r\n  // read hdr/img. content is in this.m_fileReader.result\r\n  //\r\n  onFileContentReadMultipleHdr() {\r\n    const VALID_NUM_FILES_2 = 2;\r\n    const VALID_NUM_FILES_4 = 4;\r\n    if ((this.m_numFiles !== VALID_NUM_FILES_2) && (this.m_numFiles !== VALID_NUM_FILES_4)) {\r\n      console.log(`onFileContentReadMultipleHdr: can read ${VALID_NUM_FILES_2} or ${VALID_NUM_FILES_4} files for multiple hdr loader`);\r\n      return;\r\n    }\r\n\r\n    const isHdr = this.m_fileName.endsWith('hdr') || this.m_fileName.endsWith('HDR');\r\n    console.log(`onFileContentReadMultipleHdr: read file ${this.m_fileName}. Ratio=${this.m_fileIndex} / ${this.m_numFiles}`);\r\n    this.m_fileIndex++;\r\n    const ratioLoad = this.m_fileIndex / this.m_numFiles;\r\n    const strContent = this.m_fileReader.result;\r\n    // const lenContent = strContent.length;\r\n\r\n    if (this.m_fileIndex <= 1) {\r\n      // add single volume to set\r\n      if (this.m_volumeSet.getNumVolumes() === 0) {\r\n        this.m_volumeSet.addVolume(new Volume());\r\n      }\r\n      this.callbackReadProgress(0.0);\r\n    }\r\n\r\n    if ((this.m_numFiles === VALID_NUM_FILES_4) && (this.m_volumeRoi === null)) {\r\n      this.m_volumeRoi = new Volume();\r\n    }\r\n\r\n    const callbackProgress = null;\r\n    const callbackComplete = null;\r\n\r\n    const regExpFileName = /([\\S]+)\\.[\\S]+/;\r\n    const fnameArr = regExpFileName.exec(this.m_fileName);\r\n    const numFN = fnameArr.length;\r\n    let detectedMask = false;\r\n    let detectedIntensity = false;\r\n    if (numFN === 2) {\r\n      const fname = fnameArr[1];\r\n      if (fname.endsWith('_mask')) {\r\n        detectedMask = true;\r\n      }\r\n      if (fname.endsWith('_intn')) {\r\n        detectedIntensity = true;\r\n      }\r\n    }\r\n    let volDst = this.m_volumeSet.getVolume(0);\r\n    if (this.m_fileIndex > VALID_NUM_FILES_2) {\r\n      volDst = this.m_volumeRoi;\r\n    }\r\n    if (detectedIntensity) {\r\n      volDst = this.m_volumeSet.getVolume(0);\r\n    }\r\n    if (detectedMask) {\r\n      volDst = this.m_volumeRoi;\r\n      this.roiMode = true;\r\n      // console.log('mask vol by name');\r\n      if (this.m_numFiles !== VALID_NUM_FILES_4) {\r\n        console.log('You need to load 4 files, if one of them has _mask in name');\r\n        return;\r\n      }\r\n    }\r\n\r\n    // read header or image from src files\r\n    let readOk = false;\r\n    if (isHdr) {\r\n      readOk = this.m_loader.readFromBufferHeader(volDst, strContent, callbackProgress, callbackComplete);\r\n    } else {\r\n      readOk = this.m_loader.readFromBufferImage(volDst, strContent, callbackProgress, callbackComplete);\r\n    }\r\n\r\n    // create final volume from readed data\r\n    volDst = this.m_volumeSet.getVolume(0);\r\n    if (readOk && (this.m_fileIndex === this.m_numFiles)) {\r\n      let ok = false;\r\n      if (this.m_numFiles === VALID_NUM_FILES_2) {\r\n        ok = this.m_loader.createVolumeFromHeaderAndImage(volDst);\r\n      } else if (this.m_numFiles === VALID_NUM_FILES_4) {\r\n        // intensity data 16 -> 8 bpp\r\n        ok = this.m_loader.createVolumeFromHeaderAndImage(volDst);\r\n        if (ok) {\r\n          // mix 8 bpp intensity and roi pixels\r\n          ok = this.m_loader.createRoiVolumeFromHeaderAndImage(volDst, this.m_volumeRoi);\r\n        }\r\n      }\r\n      this.callbackReadProgress(1.0);\r\n      if (!ok) {\r\n        this.callbackReadComplete(LoadResult.FAIL);\r\n      } else {\r\n        this.callbackReadComplete(LoadResult.SUCCESS);\r\n      }\r\n    }\r\n\r\n    // read again new file\r\n    if (this.m_fileIndex < this.m_numFiles) {\r\n      this.callbackReadProgress(ratioLoad);\r\n      this.m_fileReader.onloadend = this.onFileContentReadMultipleHdr;\r\n      const file = this.m_files[this.m_fileIndex];\r\n      this.m_fileName = file.name;\r\n      this.m_fileReader.readAsArrayBuffer(file);\r\n    }\r\n\r\n  } // on multuple hdr\r\n  // on complete read multuple dicom\r\n  callbackCompleteMultipleDicom(errCode) {\r\n    if (errCode !== LoadResult.SUCCESS) {\r\n      const strErr = LoadResult.getResultString(errCode);\r\n      this.setErrorString(strErr);\r\n    }\r\n  }\r\n  //\r\n  // read from string content in this.m_fileReader.result\r\n  //\r\n  onFileContentReadMultipleDicom() {\r\n    // console.log('UiOpenMenu. onFileContentReadMultipleDicom ...');\r\n    const strContent = this.m_fileReader.result;\r\n    this.m_fileIndex++;\r\n    const ratioLoad = this.m_fileIndex / this.m_numFiles;\r\n    // console.log(`onFileContentReadMultipleDicom. r = ${ratioLoad}`);\r\n    const callbackProgress = null;\r\n    // const callbackComplete = this.callbackReadMultipleComplete;\r\n\r\n    if (this.m_fileIndex <= 1) {\r\n      // add new volume to volume set on the first slice\r\n      const vol = new Volume();\r\n      this.m_volumeSet.addVolume(vol);\r\n      // init progress on the first file loading\r\n      this.callbackReadProgress(0.0);\r\n    }\r\n\r\n    // FIX 05/06/2020: read multiple dicom callback complete\r\n    // can be invoked with error code\r\n    const callbackColmpleteVoid = this.callbackCompleteMultipleDicom;\r\n\r\n    let readStatus;\r\n\r\n    if (READ_DICOM_VIA_DAIKON) {\r\n      readStatus = this.readSliceDicomViaDaikon(this.m_fileIndex - 1, this.m_fileName, strContent);\r\n    } else {\r\n      readStatus = this.m_volumeSet.readSingleSliceFromDicom(this.m_loader, this.m_fileIndex - 1,\r\n        this.m_fileName, ratioLoad, strContent, callbackProgress, callbackColmpleteVoid);\r\n    }\r\n\r\n    if (readStatus !== LoadResult.SUCCESS) {\r\n      console.log('onFileContentReadMultipleDicom. Error read individual file');\r\n    }\r\n    if ((readStatus === LoadResult.SUCCESS) && (this.m_fileIndex === this.m_numFiles)) {\r\n      // setup global vars\r\n      const { dispatch } = this.props;\r\n      dispatch({ type: StoreActionType.SET_VOLUME_INDEX, volumeIndex: 0 });\r\n      dispatch({ type: StoreActionType.SET_VOLUME_SET, volumeSet: this.m_volumeSet });\r\n\r\n      // save dicom loader to store\r\n      dispatch({ type: StoreActionType.SET_LOADER_DICOM, loaderDicom: this.m_loader });\r\n      // stop show loading progress bar\r\n      this.callbackReadProgress(1.0);\r\n      this.callbackReadComplete(LoadResult.SUCCESS);\r\n\r\n      this.childModalWindowCenterWidth.initWindowRange();\r\n\r\n      // show modal: select window center, width\r\n      this.setState({ showModalWindowCW: true });\r\n      return; // do nothing immediately after: wait for dialog\r\n      /*\r\n\r\n      const numSeries = this.m_loader.m_slicesVolume.m_series.length;\r\n      console.log(`num series = ${numSeries}`);\r\n      const series = this.m_loader.m_slicesVolume.getSeries();\r\n      // save loaded series description to store\r\n      if (numSeries === 1) {\r\n        const indexSerie = 0;\r\n        const hash = series[indexSerie].m_hash;\r\n        this.m_loader.createVolumeFromSlices(this.m_volumeSet, indexSerie, hash);\r\n        this.finalizeSuccessLoadedVolume(this.m_volumeSet, this.m_fileName);\r\n        console.log(`onFileContentReadMultipleDicom read all ${this.m_numFiles} files`);\r\n      } else {\r\n        // now we have loaded more then 1 series from dicon files set\r\n        for (let i = 0; i < numSeries; i++) {\r\n          const hashCode = series[i].m_hash;\r\n          this.m_loader.createVolumeFromSlices(this.m_volumeSet, i, hashCode);\r\n        }\r\n        this.finalizeSuccessLoadedVolume(this.m_volumeSet, this.m_fileName);\r\n        console.log(`onFileContentReadMultipleDicom create ${numSeries} volumes for ${this.m_numFiles} files`);\r\n\r\n        // setup dicom series (volumes info) for global store: select volume later\r\n        const {store, dispatch} = this.props;\r\n        dispatch({ type: StoreActionType.SET_DICOM_SERIES, dicomSeries: series });\r\n      }\r\n\r\n      this.callbackReadProgress(1.0);\r\n      this.callbackReadComplete(LoadResult.SUCCESS);\r\n      */\r\n    } // end if successfully read all files (multiple dicom read)\r\n    // read again new file\r\n    if (readStatus === LoadResult.SUCCESS) {\r\n      if (this.m_fileIndex < this.m_numFiles) {\r\n        // print console loading progress\r\n        const NUM_PARTS_REPORT = 16;\r\n        const STEP_PROGRESS = Math.floor(this.m_numFiles / NUM_PARTS_REPORT);\r\n        if ((this.m_fileIndex % STEP_PROGRESS) === 0) {\r\n          // console.log(`onFileContentReadMultipleDicom. Loading completed = ${ratioLoad}`);\r\n          this.callbackReadProgress(ratioLoad);\r\n        }\r\n\r\n        this.m_fileReader.onloadend = this.onFileContentReadMultipleDicom;\r\n        const file = this.m_files[this.m_fileIndex];\r\n        this.m_fileName = file.name;\r\n        this.m_fileReader.readAsArrayBuffer(file);\r\n      } // if still need files\r\n    } else {\r\n      const arrErr = [];\r\n      const strErr = this.props.store.arrErrors[0];\r\n      arrErr.push(strErr);\r\n      this.finalizeFailedLoadedVolume(this.m_fileName, arrErr);\r\n    } // if result is not success\r\n  }\r\n  //\r\n  // Perform open file after it selected in dialog\r\n  handleFileSelected(evt) {\r\n    if (evt.target.files !== undefined) {\r\n      let numFiles = evt.target.files.length;\r\n      console.log(`UiOpenMenu. Trying to open ${numFiles} files`);\r\n      if (numFiles <= 0) {\r\n        return;\r\n      }\r\n      console.log(`UiOpenMenu. handleFileSelected. file[0] = ${evt.target.files[0].name}`);\r\n      this.m_volumeSet = new VolumeSet();\r\n      if (numFiles === 1) {\r\n        const file = evt.target.files[0];\r\n        this.m_fileName = file.name;\r\n\r\n        //  read gzip\r\n        if (this.m_fileName.endsWith('.gz')) {\r\n          const { store } = this.props;\r\n          if (store.visState.uiApp !== null) {\r\n            store.visState.uiApp.doShowProgressBar('read gzip..');\r\n          }\r\n          this.props.dispatch({ type: StoreActionType.SET_LOADER, showLoader: true});\r\n          // here will be result raw buffer\r\n          this.m_unzippedBuffer = null;\r\n\r\n          // remove last 3 chars form file name string\r\n          this.m_fileName = this.m_fileName.slice(0, -3);\r\n\r\n\r\n          const reader = new FileReader();\r\n          reader.readAsArrayBuffer(file);\r\n          const _this = this;\r\n          reader.onload = function (e) {\r\n            try {\r\n              let t0 = performance.now();\r\n              this.m_unzippedBuffer = pako.inflate(e.target.result);\r\n              console.log(\"time to unzip: \", performance.now() - t0);\r\n              // close progress\r\n              store.visState.uiApp.doShowProgressBar('render volume..');\r\n\r\n              // now all chunks are read. Need to check raw ungzipped buffer\r\n              const sizeBuffer = this.m_unzippedBuffer.length;\r\n              if (sizeBuffer < 128) {\r\n                console.log('Too small ungzipped data: ' + sizeBuffer.toString() + ' bytes. cannot read volume data');\r\n                return;\r\n              }\r\n              // check correct nifti header after extract raw bytes from gzip\r\n              const headTemplate = [0x00, 0x00, 0x01, 0x5c];\r\n              let correctHead0 = true;\r\n              for (let i = 0; i < 4; i++) {\r\n                if (this.m_unzippedBuffer[i] !== headTemplate[i]) {\r\n                  correctHead0 = false;\r\n                }\r\n              }\r\n              let correctHead1 = true;\r\n              for (let i = 0; i < 4; i++) {\r\n                if (this.m_unzippedBuffer[i] !== headTemplate[3 - i]) {\r\n                  correctHead1 = false;\r\n                }\r\n              }\r\n              if (!correctHead0 && !correctHead1) {\r\n                console.log('Wrong nifi header, cant read gzipped file');\r\n                return;\r\n              }\r\n              console.log('ungzip done with ' + sizeBuffer.toString() + ' bytes. Correct nifti header detected');\r\n              // process raw data buffer\r\n              _this.onFileReadSingleBuffer(this.m_unzippedBuffer);\r\n            } catch (err) {\r\n              console.log(err);\r\n            }\r\n          }\r\n          return;\r\n        } // if gzipped file\r\n\r\n        this.m_fileReader = new FileReader();\r\n        this.m_fileReader.onloadend = this.onFileContentReadSingleFile;\r\n        this.m_fileReader.onerror = function (err) {\r\n          console.log(\"an error occured\", err)\r\n        }\r\n        this.m_fileReader.readAsArrayBuffer(file);\r\n      } else if (numFiles === 2) {\r\n        // custom logic fo loading a thing with a mask (will break if ur not careful)\r\n        const mskInd = [evt.target.files[0], evt.target.files[1]].findIndex(el => el.name.toLowerCase().includes('mask'));\r\n\r\n        if (mskInd === -1) throw new Error(\"You need a mask file\");\r\n\r\n        const file = evt.target.files[1 - mskInd];\r\n        const mask = evt.target.files[mskInd];\r\n\r\n        if (!file.name.endsWith('.gz') || !mask.name.endsWith('.gz')) throw new Error(\"both should be compressed\");\r\n\r\n        const { store } = this.props;\r\n        if (store.visState.uiApp !== null) store.visState.uiApp.doShowProgressBar('read gzip..');\r\n\r\n        const f_reader = new FileReader();\r\n        const m_reader = new FileReader();\r\n        f_reader.readAsArrayBuffer(file);\r\n        m_reader.readAsArrayBuffer(mask);\r\n\r\n        const handleEach = (resolve, reject) => {\r\n          return (e) => {\r\n            try {\r\n              let t0 = performance.now();\r\n              const m_unzippedBuffer = pako.inflate(e.target.result);\r\n              console.log(\"time to unzip: \", performance.now() - t0);\r\n              // close progress\r\n              store.visState.uiApp.doShowProgressBar('render volume..');\r\n\r\n              // now all chunks are read. Need to check raw ungzipped buffer\r\n              const sizeBuffer = m_unzippedBuffer.length;\r\n              if (sizeBuffer < 128) {\r\n                console.log('Too small ungzipped data: ' + sizeBuffer.toString() + ' bytes. cannot read volume data');\r\n                return;\r\n              }\r\n              // check correct nifti header after extract raw bytes from gzip\r\n              const headTemplate = [0x00, 0x00, 0x01, 0x5c];\r\n              let correctHead0 = true;\r\n              for (let i = 0; i < 4; i++) {\r\n                if (m_unzippedBuffer[i] !== headTemplate[i]) {\r\n                  correctHead0 = false;\r\n                }\r\n              }\r\n              let correctHead1 = true;\r\n              for (let i = 0; i < 4; i++) {\r\n                if (m_unzippedBuffer[i] !== headTemplate[3 - i]) {\r\n                  correctHead1 = false;\r\n                }\r\n              }\r\n              if (!correctHead0 && !correctHead1) {\r\n                console.log('Wrong nifi header, cant read gzipped file');\r\n                return;\r\n              }\r\n              console.log('ungzip done with ' + sizeBuffer.toString() + ' bytes. Correct nifti header detected');\r\n\r\n              // pass on unzipped data buffer\r\n              resolve(m_unzippedBuffer);\r\n            } catch (err) {\r\n              console.log(err);\r\n              reject(err);\r\n            }\r\n          }\r\n        }\r\n\r\n        const f_promise = new Promise((resolve, reject) => {\r\n          f_reader.onload = handleEach(resolve, reject);\r\n        });\r\n\r\n        const m_promise = new Promise((resolve, reject) => {\r\n          m_reader.onload = handleEach(resolve, reject);\r\n        });\r\n\r\n        const _this = this;\r\n\r\n        Promise.all([f_promise, m_promise])\r\n          .then(([f_buf, m_buf]) => {\r\n            //when both reader have finished, will have two buffers\r\n            _this.m_volumeSet = new VolumeSet();\r\n            _this.m_volumeSet.addVolume(new Volume())\r\n            const callbackProgress = this.callbackReadProgress;\r\n            const callbackComplete = this.callbackReadComplete;\r\n            _this.m_volumeSet.readFromNifti(f_buf, callbackProgress, callbackComplete, m_buf);\r\n          })\r\n          .catch((e) => {\r\n            console.log('Big OOf', e);\r\n          });\r\n\r\n        return;\r\n      } else {\r\n        // not single file was open\r\n        this.m_files = Array.from(evt.target.files); // FileList -> Array\r\n        this.m_fileIndex = 0;\r\n        this.m_numFiles = numFiles;\r\n        this.m_fileReader = new FileReader();\r\n        // if multiple files, create Dicom loader\r\n        this.m_loader = null;\r\n        if (evt.target.files[0].name.endsWith(\".dcm\")) {\r\n\r\n          // remove non-dcm files\r\n          let numFilesNew = 0;\r\n          for (let i = numFiles - 1; i >= 0; i--) {\r\n            if (this.m_files[i].name.endsWith(\".dcm\")) {\r\n              numFilesNew++;\r\n            } else {\r\n              this.m_files.splice(i, 1);\r\n            }\r\n\r\n          }\r\n          numFiles = numFilesNew;\r\n          this.m_numFiles = numFilesNew;\r\n\r\n          this.m_loader = new LoaderDicom(numFiles);\r\n          const dicomInfo = this.m_loader.m_dicomInfo;\r\n\r\n          // save dicomInfo to store\r\n          const { dispatch } = this.props;\r\n          dispatch({ type: StoreActionType.SET_DICOM_INFO, dicomInfo: dicomInfo });\r\n\r\n          // save dicom loader to store\r\n          dispatch({ type: StoreActionType.SET_LOADER_DICOM, loaderDicom: this.m_loader });\r\n\r\n          this.m_fileReader.onloadend = this.onFileContentReadMultipleDicom;\r\n        } else if ((evt.target.files[0].name.endsWith(\".hdr\")) || (evt.target.files[0].name.endsWith(\".img\"))) {\r\n          this.m_loader = new LoaderHdr(numFiles);\r\n          this.m_fileReader.onloadend = this.onFileContentReadMultipleHdr;\r\n        } else {\r\n          const { store } = this.props;\r\n          if (store.visState.uiApp !== null) {\r\n            store.visState.uiApp.doShowProgressBar('read gzip..');\r\n          }\r\n          // here will be result raw buffer\r\n          this.m_unzippedBuffer = null;\r\n\r\n          // remove last 3 chars form file name string\r\n          this.m_fileName = this.m_fileName.slice(0, -3);\r\n\r\n\r\n          const reader = new FileReader();\r\n          reader.readAsArrayBuffer(file);\r\n          const _this = this;\r\n          reader.onload = function (e) {\r\n            try {\r\n              let t0 = performance.now();\r\n              this.m_unzippedBuffer = pako.inflate(e.target.result);\r\n              console.log(\"time to unzip: \", performance.now() - t0);\r\n              // close progress\r\n              store.visState.uiApp.doShowProgressBar('render volume..');\r\n\r\n              // now all chunks are read. Need to check raw ungzipped buffer\r\n              const sizeBuffer = this.m_unzippedBuffer.length;\r\n              if (sizeBuffer < 128) {\r\n                console.log('Too small ungzipped data: ' + sizeBuffer.toString() + ' bytes. cannot read volume data');\r\n                return;\r\n              }\r\n              // check correct nifti header after extract raw bytes from gzip\r\n              const headTemplate = [0x00, 0x00, 0x01, 0x5c];\r\n              let correctHead0 = true;\r\n              for (let i = 0; i < 4; i++) {\r\n                if (this.m_unzippedBuffer[i] !== headTemplate[i]) {\r\n                  correctHead0 = false;\r\n                }\r\n              }\r\n              let correctHead1 = true;\r\n              for (let i = 0; i < 4; i++) {\r\n                if (this.m_unzippedBuffer[i] !== headTemplate[3 - i]) {\r\n                  correctHead1 = false;\r\n                }\r\n              }\r\n              if (!correctHead0 && !correctHead1) {\r\n                console.log('Wrong nifi header, cant read gzipped file');\r\n                return;\r\n              }\r\n              console.log('ungzip done with ' + sizeBuffer.toString() + ' bytes. Correct nifti header detected');\r\n              // process raw data buffer\r\n              _this.onFileReadSingleBuffer(this.m_unzippedBuffer);\r\n            } catch (err) {\r\n              console.log(err);\r\n            }\r\n          }\r\n          return;\r\n        }\r\n        //const vol = new Volume();\r\n        //this.m_volume = vol;\r\n        this.m_volumeRoi = null;\r\n\r\n        const file = evt.target.files[0];\r\n        this.m_fileName = file.name;\r\n        this.m_fileReader.readAsArrayBuffer(file);\r\n      }\r\n    } // if event is mnot empty\r\n  }\r\n\r\n  buildFileSelector() {\r\n    const fileSelector = document.createElement('input');\r\n    fileSelector.setAttribute('type', 'file');\r\n    fileSelector.setAttribute('accept', '.ktx,.dcm,.nii,.hdr,.h,.img,.gz');\r\n    fileSelector.setAttribute('multiple', '');\r\n    fileSelector.onchange = this.handleFileSelected;\r\n    return fileSelector;\r\n  }\r\n  onButtonLocalFile(evt) {\r\n    // console.log('onButtonLocalFile started');\r\n    evt.preventDefault();\r\n    this.m_fileSelector.click();\r\n  }\r\n  //\r\n  onModalUrlShow() {\r\n    console.log(`onModalUrlShow`);\r\n    this.setState({ strUrl: '' });\r\n    this.setState({ showModalUrl: true });\r\n  }\r\n  onModalUrlHide() {\r\n    console.log(`onModalUrlHide`);\r\n    this.setState({ showModalUrl: false });\r\n  }\r\n  onChangeUrlString(evt) {\r\n    const str = evt.target.value;\r\n    this.setState({ strUrl: str });\r\n    // console.log(`onChangeUrlString. str = ${str}`)\r\n  }\r\n  callbackReadCompleteUrlKtxNii(codeResult) {\r\n    if (codeResult !== LoadResult.SUCCESS) {\r\n      console.log(`onCompleteFromUrlKtx. Bad result: ${codeResult}`);\r\n\r\n      const arrErrors = [];\r\n      const strErr = LoadResult.getResultString(codeResult);\r\n      arrErrors.push(strErr);\r\n      this.finalizeFailedLoadedVolume(this.m_fileName, arrErrors);\r\n      return;\r\n    } else {\r\n      this.finalizeSuccessLoadedVolume(this.m_volumeSet, this.m_fileName);\r\n      this.callbackReadComplete(LoadResult.SUCCESS, null, 0, null);\r\n    }\r\n  }\r\n  loadFromUrl(strUrl) {\r\n    const fileTools = new FileTools();\r\n    const isValid = fileTools.isValidUrl(strUrl);\r\n    if (isValid) {\r\n      this.m_url = strUrl;\r\n\r\n      this.m_fileName = fileTools.getFileNameFromUrl(strUrl);\r\n      this.m_volumeSet = new VolumeSet();\r\n      this.m_volumeSet.addVolume(new Volume());\r\n\r\n      if (strUrl.endsWith('.ktx')) {\r\n        const callbackProgress = this.callbackReadProgress;\r\n        const callbackComplete = this.callbackReadCompleteUrlKtxNii;\r\n        this.callbackReadProgress(0.0);\r\n        this.m_volumeSet.readFromKtxUrl(strUrl, callbackProgress, callbackComplete);\r\n        // if KTX\r\n      } else if (strUrl.endsWith('.nii')) {\r\n        const callbackProgress = this.callbackReadProgress;\r\n        const callbackComplete = this.callbackReadCompleteUrlKtxNii;\r\n        this.callbackReadProgress(0.0);\r\n        this.m_volumeSet.readFromNiiUrl(strUrl, callbackProgress, callbackComplete);\r\n        // if NII (Nifti format)\r\n      } else if (strUrl.endsWith('.dcm')) {\r\n        if (READ_DICOM_VIA_DAIKON) {\r\n          const loaderUrlDcm = new LoaderDcmUrlDaikon();\r\n          const ret = loaderUrlDcm.readFromUrl(this.m_volumeSet, strUrl, this.callbackReadCompleteUrlKtxNii, this.callbackReadProgress);\r\n          return ret;\r\n        }\r\n\r\n        const callbackProgress = this.callbackReadProgress;\r\n        const callbackComplete = this.callbackReadCompleteUrlKtxNii;\r\n        this.callbackReadProgress(0.0);\r\n        this.m_volumeSet.readFromDicomUrl(strUrl, callbackProgress, callbackComplete);\r\n        // if Dicom\r\n      } else if (strUrl.endsWith('.h')) {\r\n        const callbackProgress = this.callbackReadProgress;\r\n        const callbackComplete = this.callbackReadCompleteUrlKtxNii;\r\n        this.callbackReadProgress(0.0);\r\n        this.m_volumeSet.readFromHdrUrl(strUrl, callbackProgress, callbackComplete);\r\n        // if Hdr\r\n      } else {\r\n        console.log(`UiOpenMenu. Unknow file type from URL = ${strUrl}`);\r\n      }\r\n\r\n      // if valid url\r\n    } else {\r\n      const strErr = `UiOpenMenu. Bad URL = ${strUrl}`;\r\n      console.log(strErr);\r\n      this.setErrorString(strErr);\r\n    }\r\n  }\r\n  onClickLoadUrl() {\r\n    this.setState({ showModalUrl: false });\r\n    const strUrl = this.state.strUrl;\r\n    console.log(`onClickLoadUrl with strUrl = ${strUrl}`);\r\n    this.loadFromUrl(strUrl);\r\n  }\r\n  //\r\n  onModalDemoOpenShow() {\r\n    this.setState({ showModalDemo: true });\r\n  }\r\n  onModalDemoOpenHide() {\r\n    this.setState({ showModalDemo: false });\r\n  }\r\n  //\r\n  arrNumToStr(arrNums) {\r\n    const numLet = arrNums.length;\r\n    let str = '';\r\n    for (let i = 0; i < numLet; i++) {\r\n      const n = arrNums[i];\r\n      str = str.concat(String.fromCharCode(n));\r\n    }\r\n    return str;\r\n  }\r\n  onModalGoogleShow() {\r\n    this.setState({ showModalGoogle: true });\r\n  }\r\n  onModalGoogleHide() {\r\n    this.setState({ showModalGoogle: false });\r\n  }\r\n  onGoogleSelected(index) {\r\n    // perform action on click i-th item in Google cloud menu . Or remove this menu completely\r\n    console.log(`onGoogleSelected(${index}) ... `);\r\n  }\r\n  onDemoSelected(index) {\r\n    const arr = config.demoUrls;\r\n    if (arr.length >= 8) {\r\n      const fileName = arr[index];\r\n      console.log(`onDemoSelected: load file ${fileName}, config[ ${index} ]`);\r\n      this.loadFromUrl(fileName);\r\n      return;\r\n    }\r\n    let fileName = '';\r\n    if (index === 0) {\r\n      // 20101108.ktx\r\n      // const FN_ENCODED = 'http://www.e-joufs.sv/qsjwbuf/nfe4xfc/ebub/luy/31212219.luy';\r\n      const FN_ENCODED = 'https://med3web.pqfotpvsdf.fqbn.dpn/nfe4xfc3131/31212219.luy';\r\n      const ft = new FileTools();\r\n      fileName = ft.decodeUrl(FN_ENCODED);\r\n      // console.log(`onDemoSelected. enc = ${fileName}`);\r\n    } else if (index === 1) {\r\n      // set00.ktx\r\n      // const FN_ENCO = 'http://www.e-joufs.sv/qsjwbuf/nfe4xfc/ebub/luy/tfu11.luy';\r\n      const FN_ENCO = 'https://med3web.pqfotpvsdf.fqbn.dpn/nfe4xfc3131/tfu11.luy';\r\n      const ft = new FileTools();\r\n      fileName = ft.decodeUrl(FN_ENCO);\r\n      // console.log(`onDemoSelected. enc = ${fileName}`);\r\n    } else if (index === 2) {\r\n      // gm3 nii\r\n      // const FN_GM_ENCODED = 'http://www.e-joufs.sv/qsjwbuf/nfe4xfc/ebub/ojguj/hn4_623_623_276.ojj';\r\n      const FN_GM_ENCODED = 'https://med3web.pqfotpvsdf.fqbn.dpn/nfe4xfc3131/hn4_623_623_276.ojj';\r\n      const ft = new FileTools();\r\n      fileName = ft.decodeUrl(FN_GM_ENCODED);\r\n      // fileName = ft.encodeUrl(FN_GM_DECODED);\r\n      // console.log(`onDemoSelected. enc = ${fileName}`);\r\n    } else if (index === 3) {\r\n      const numUrls = config.demoWomanPelvisUrls.length;\r\n      if (numUrls === 0) {\r\n        // woman pelvis\r\n        // const FN_WOMM_ENCODED = 'http://www.e-joufs.sv/qsjwbuf/nfe4xfc/ebub/ejdpn/xpnbo_qfmwjt/wig.:12.edn';\r\n        const FN_WOMM_ENCODED = 'https://med3web.pqfotpvsdf.fqbn.dpn/nfe4xfc3131/xpnbo_qfmwjt/wig.:12.edn';\r\n        const ft = new FileTools();\r\n        fileName = ft.decodeUrl(FN_WOMM_ENCODED);\r\n      } else {\r\n        const strPrefix = config.demoWomanPelvisPrefix;\r\n        // console.log(`config. prefix = ${strPrefix}`);\r\n        const arrFileNames = [];\r\n        for (let i = 0; i < numUrls; i++) {\r\n          const strFn = config.demoWomanPelvisUrls[i];\r\n          const url = `${strPrefix}${strFn}`;\r\n          arrFileNames.push(url);\r\n        }\r\n        const { store } = this.props;\r\n        const loader = new LoaderUrlDicom(store);\r\n        const GOOGLE_HEADER = false;\r\n        loader.loadFromUrlArray(arrFileNames, GOOGLE_HEADER);\r\n        return;\r\n      }\r\n    } else if (index === 4) {\r\n      const numUrls = config.demoLungsUrls.length;\r\n      if (numUrls === 0) {\r\n        // lungs dicom 00cba..957e.dcm\r\n        // const FN_OCB_ENCODED = 'http://www.e-joufs.sv/qsjwbuf/nfe4xfc/ebub/ejdpn/11dcb1:2gb5be73dd4311b768bfc:68f/145784245dcfg6fb26gg:f1d91:1611b.edn';\r\n        const FN_OCB_ENCODED = 'https://med3web.pqfotpvsdf.fqbn.dpn/nfe4xfc3131/11dcb1:2gb5be73dd4311b768bfc:68f/145784245dcfg6fb26gg:f1d91:1611b.edn';\r\n        const ft = new FileTools();\r\n        fileName = ft.decodeUrl(FN_OCB_ENCODED);\r\n      } else {\r\n        const strPrefix = config.demoLungsPrefix;\r\n        console.log(`config. Lungs prefix = ${strPrefix}`);\r\n        const arrFileNames = [];\r\n        for (let i = 0; i < numUrls; i++) {\r\n          const strFn = config.demoLungsUrls[i];\r\n          const url = `${strPrefix}${strFn}`;\r\n          arrFileNames.push(url);\r\n        }\r\n        const { store } = this.props;\r\n        const loader = new LoaderUrlDicom(store);\r\n        const GOOGLE_HEADER = false;\r\n        loader.loadFromUrlArray(arrFileNames, GOOGLE_HEADER);\r\n        return;\r\n      }\r\n    } else if (index === 5) {\r\n      // ct_256_256_256.ktx\r\n      // const FN_CT256_ENCODED = 'http://www.e-joufs.sv/qsjwbuf/nfe4xfc/ebub/luy/du_367_367_367.luy';\r\n      const FN_CT256_ENCODED = 'https://med3web.pqfotpvsdf.fqbn.dpn/nfe4xfc3131/du_367_367_367.luy';\r\n      const ft = new FileTools();\r\n      fileName = ft.decodeUrl(FN_CT256_ENCODED);\r\n      // fileName = ft.encodeUrl(FN_CT256_DECODED);\r\n      // console.log(`onDemoSelected. enc = ${fileName}`);\r\n    } else if (index === 6) {\r\n      // lungs_256_256_256.ktx\r\n      // const FN_LUNGS256_ENCODED = 'http://www.e-joufs.sv/qsjwbuf/nfe4xfc/ebub/luy/mvoht_367_367_367.luy';\r\n      const FN_LUNGS256_ENCODED = 'https://med3web.pqfotpvsdf.fqbn.dpn/nfe4xfc3131/mvoht_367_367_367.luy';\r\n      const ft = new FileTools();\r\n      fileName = ft.decodeUrl(FN_LUNGS256_ENCODED);\r\n      // fileName = ft.encodeUrl(FN_LUNGS256_DECODED);\r\n      // console.log(`onDemoSelected. enc = ${fileName}`);\r\n    } else if (index === 7) {\r\n      // hdr set (roi)\r\n      // const FN_HDRSET_ENCODED = 'http://www.e-joufs.sv/qsjwbuf/nfe4xfc/ebub/ies/tfu_jouo.i';\r\n      const FN_HDRSET_ENCODED = 'https://med3web.pqfotpvsdf.fqbn.dpn/nfe4xfc3131/ies/tfu_jouo.i';\r\n      const ft = new FileTools();\r\n      fileName = ft.decodeUrl(FN_HDRSET_ENCODED);\r\n    } else {\r\n      console.log(`onDemoSelected. not implemented for index = ${index}`);\r\n    }\r\n    if (fileName.length > 0) {\r\n      this.loadFromUrl(fileName);\r\n    } // if fileName not empty\r\n  } // end of onDemoSelected\r\n  //\r\n  shouldComponentUpdate() {\r\n    return true;\r\n  }\r\n  onModalDicomSeriesHide() {\r\n    const arrEmpty = [];\r\n    const { dispatch } = this.props;\r\n    dispatch({ type: StoreActionType.SET_DICOM_SERIES, dicomSeries: arrEmpty });\r\n  }\r\n  onDicomSerieSelected(indexSelected) {\r\n    const { store, dispatch } = this.props;\r\n    const series = store.dicomSeries;\r\n    const serieSelected = series[indexSelected];\r\n    const hash = serieSelected.m_hash;\r\n    this.m_loader.createVolumeFromSlices(this.m_volumeSet, indexSelected, hash);\r\n    this.finalizeSuccessLoadedVolume(this.m_volumeSet, this.m_fileName);\r\n    console.log(`onFileContentReadMultipleDicom read all ${this.m_numFiles} files`);\r\n\r\n    // clear modal\r\n    dispatch({ type: StoreActionType.SET_DICOM_SERIES, dicomSeries: [] });\r\n  }\r\n  //\r\n  onModalWindowCWHide(needShow) {\r\n    this.setState({ showModalWindowCW: false });\r\n    if (needShow) {\r\n      this.finalizeSuccessLoadedVolume(this.m_volumeSet, this.m_fileName);\r\n      // setup dicom series (volumes info) for global store: select volume later\r\n      const { store, dispatch } = this.props;\r\n      let series = null;\r\n      if (this.m_loader !== undefined) {\r\n        series = this.m_loader.m_slicesVolume.getSeries();\r\n        dispatch({ type: StoreActionType.SET_DICOM_SERIES, dicomSeries: series });\r\n      }\r\n      // update graphics 2d window\r\n      const gra = store.graphics2d;\r\n      if (gra !== null) {\r\n        gra.forceUpdate();\r\n      }\r\n    }\r\n  }\r\n  //\r\n  // invoked after render\r\n  //\r\n  componentDidMount() {\r\n    this.m_fileSelector = this.buildFileSelector();\r\n    const fileNameOnLoad = this.m_fileNameOnLoad;\r\n    // console.log(`UiOpenMenu. componentDidMount. fnonl = ${fileNameOnLoad}`);\r\n    if ((fileNameOnLoad.length > 0) && (this.state.onLoadCounter > 0)) {\r\n      this.setState({ onLoadCounter: 0 });\r\n      const TIMEOUT_MS = 50;\r\n      setTimeout(this.loadFromUrl(fileNameOnLoad), TIMEOUT_MS);\r\n    }\r\n  }\r\n  // render\r\n  render() {\r\n    const isGoogle = config.googleCloudDemoActivce;\r\n\r\n    const fileNameOnLoad = this.props.fileNameOnLoad;\r\n    this.m_fileNameOnLoad = fileNameOnLoad;\r\n    // console.log(`UiOpenMenu. render. fnol = ${this.m_fileNameOnLoad}`);\r\n    let jsxOnLoad = '';\r\n    if (fileNameOnLoad.length > 2) {\r\n      jsxOnLoad = <p></p>;\r\n      return jsxOnLoad;\r\n    }\r\n\r\n    const jsGoo = (isGoogle) ?\r\n      <NavDropdown.Item onClick={this.onModalGoogleShow} >\r\n        <i className=\"fas fa-brain\"></i>\r\n        Google cloud models\r\n      </NavDropdown.Item> :\r\n      <p></p>;\r\n\r\n    const jsDemo = (NEED_DEMO_MENU) ?\r\n      <NavDropdown.Item href=\"#actionOpenDemo\" onClick={this.onModalDemoOpenShow} >\r\n        <i className=\"fas fa-brain\"></i>\r\n        Demo models Open\r\n      </NavDropdown.Item> :\r\n      <p></p>;\r\n\r\n    const jsVidiver = (isGoogle || NEED_DEMO_MENU) ?\r\n      <NavDropdown.Divider /> :\r\n      <p></p>;\r\n\r\n    // const store = this.props;\r\n    // const isVisibleDicomSeries = (store.dicomSeries.length !== 0);\r\n\r\n    const jsxOpenMenu =\r\n      <NavDropdown id=\"basic-nav-dropdown\" title={\r\n        <div style={{ display: 'inline-block' }}>\r\n          Open\r\n          <i className=\"fas fa-folder-open ml-1\"></i>\r\n        </div>\r\n      } >\r\n        <NavDropdown.Item href=\"#actionOpenComputer\" onClick={evt => this.onButtonLocalFile(evt)}>\r\n          <i className=\"fas fa-desktop\"></i>\r\n          Computer\r\n        </NavDropdown.Item>\r\n        <NavDropdown.Item href=\"#actionOpenUrl\" onClick={this.onModalUrlShow} >\r\n          <i className=\"fas fa-globe-americas\"></i>\r\n          Url\r\n        </NavDropdown.Item>\r\n\r\n        {jsVidiver}\r\n\r\n        {jsGoo}\r\n\r\n        {jsDemo}\r\n\r\n        <Modal show={this.state.showModalUrl} onHide={this.onModalUrlHide} >\r\n          <Modal.Title>\r\n            Load data from external source\r\n          </Modal.Title>\r\n\r\n          <Modal.Header closeButton>\r\n            <Modal.Body>\r\n\r\n              <InputGroup className=\"mb-3\">\r\n                <InputGroup.Prepend>\r\n                  <InputGroup.Text id=\"inputGroup-sizing-default\">\r\n                    Input URL to open\r\n                  </InputGroup.Text>\r\n                </InputGroup.Prepend>\r\n                <FormControl\r\n                  placeholder=\"Enter URL here\"\r\n                  aria-label=\"Default\"\r\n                  aria-describedby=\"inputGroup-sizing-default\"\r\n                  onChange={this.onChangeUrlString.bind(this)} />\r\n                <InputGroup.Append>\r\n                  <Button variant=\"outline-secondary\" onClick={this.onClickLoadUrl}>\r\n                    Load\r\n                  </Button>\r\n                </InputGroup.Append>\r\n              </InputGroup>\r\n\r\n            </Modal.Body>\r\n          </Modal.Header>\r\n        </Modal>\r\n\r\n        <UiModalDemo stateVis={this.state.showModalDemo}\r\n          onHide={this.onModalDemoOpenHide} onSelectDemo={this.onDemoSelected} />\r\n        <UiModalGoogle stateVis={this.state.showModalGoogle}\r\n          onHide={this.onModalGoogleHide} onSelectDemo={this.onGoogleSelected}\r\n          arrMenu={config.arrMenuGoogle} />\r\n        <UiModalWindowCenterWidth stateVis={this.state.showModalWindowCW} volSet={this.m_volumeSet}\r\n          onHide={this.onModalWindowCWHide} onRef={ref => (this.childModalWindowCenterWidth = ref)} />\r\n\r\n      </NavDropdown>\r\n\r\n    // return (jsxOnLoad.length > 1) ? jsxOnLoad : jsxOpenMenu;\r\n    return <div></div> //jsxOpenMenu;\r\n  }\r\n}\r\n\r\nexport default UiOpenMenu;\r\n//export default UiOpenMenu;\r\n","import React, { useContext, useEffect, useState } from 'react';\r\nimport { Nav, Navbar as BootstrapNavbar } from 'react-bootstrap';\r\nimport { NavLink } from 'react-router-dom';\r\nimport { AppContext } from '../../context/context';\r\nimport UiOpenMenu from '../visualization/ui/UiOpenMenu';\r\nimport { useLocation } from \"react-router-dom\";\r\n\r\nexport default function Navbar() {\r\n  const [state, dispatch] = useContext(AppContext);\r\n  let location = useLocation();\r\n  useEffect(() => {\r\n    let fileNameOnLoad = '';\r\n    const strSearch = window.location.search;\r\n    if (strSearch.length > 0) {\r\n      // console.log(`UiApp. componentDidMount. app search = ${strSearch}`);\r\n      const strReg = /\\\\?url=(\\S+)/;\r\n      const arr = strSearch.match(strReg);\r\n      if (arr === null) {\r\n        console.log('arguments should be in form: ?url=www.xxx.yy/zz/ww');\r\n        return;\r\n      }\r\n      fileNameOnLoad = arr[1];\r\n\r\n      const regA = /^((ftp|http|https):\\/\\/)?(([\\S]+)\\.)?([\\S]+)\\.([A-z]{2,})(:\\d{1,6})?\\/[\\S]+/;\r\n      const regB = /(ftp|http|https):\\/\\/([\\d]+)\\.([\\d]+)\\.([\\d]+)\\.([\\d]+)(:([\\d]+))?\\/([\\S]+)/;\r\n      const isValidA = fileNameOnLoad.match(regA);\r\n      const isValidB = fileNameOnLoad.match(regB);\r\n      if ((isValidA === null) && (isValidB === null)) {\r\n        console.log(`Not valid URL = ${fileNameOnLoad}`);\r\n        return;\r\n      }\r\n      setm_fileNameOnLoad(fileNameOnLoad);\r\n    }\r\n  }, [])\r\n\r\n  const [m_fileNameOnLoad, setm_fileNameOnLoad] = useState(\"\")\r\n  return (\r\n    <BootstrapNavbar expand=\"lg\" className=\"fit\">\r\n      <BootstrapNavbar.Toggle aria-controls=\"basic-navbar-nav\" />\r\n      <BootstrapNavbar.Collapse id=\"basic-navbar-nav\">\r\n        <Nav className=\"mr-auto\">\r\n          <UiOpenMenu store={state} dispatch={dispatch} fileNameOnLoad={m_fileNameOnLoad} />\r\n        </Nav>\r\n        <NavLink className=\"p-1\" activeStyle={{fontWeight: 'bold' }} exact to=\"/frontend-demo\">Home</NavLink>\r\n        <NavLink className=\"p-1\" activeStyle={{fontWeight: 'bold' }} exact to=\"/frontend-demo/doctor\">Doctor</NavLink>\r\n        <NavLink className=\"p-1\" activeStyle={{fontWeight: 'bold' }} exact to=\"/frontend-demo/nurse\">Nurse</NavLink>\r\n        <NavLink className=\"p-1\" activeStyle={{fontWeight: 'bold' }} exact to=\"/frontend-demo/radiologist\">Options</NavLink>\r\n      </BootstrapNavbar.Collapse>\r\n    </BootstrapNavbar>)\r\n}\r\n","import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';\r\nimport React, { useContext } from 'react';\r\nimport { StoreActionType } from '../../context/constants';\r\nimport { AppContext } from '../../context/context';\r\nimport { Notification as NotificationType } from '../../context/types';\r\n\r\ninterface LoadingCircleProps {\r\n  notification: NotificationType\r\n}\r\n\r\nexport default function Notification({ notification }: LoadingCircleProps) {\r\n  const [state, dispatch] = useContext(AppContext)\r\n  const { header, body, isVisible, timer, icon, spin, status } = notification;\r\n\r\n  if (timer) {\r\n    setTimeout(() => {\r\n      dispatch({\r\n        type: StoreActionType.SET_NOTIFICATION,\r\n        payload: {\r\n          body: '',\r\n          header: '',\r\n          isVisible: false,\r\n        }\r\n      });\r\n    }, timer)\r\n  }\r\n\r\n  if (isVisible || timer) {\r\n    return (\r\n      <div className={`notification flex center column ${status}`}>\r\n        <div className=\"notification-header\">\r\n          {icon && <FontAwesomeIcon icon={icon} spin={spin} className=\"mr-2\" />}\r\n          {header}\r\n        </div>\r\n        <div className=\"notification-body\">\r\n          {body}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n  return null;\r\n}","import React, { useContext, useEffect } from 'react';\r\nimport { Route, Switch } from 'react-router-dom';\r\nimport './App.css';\r\nimport DoctorView from './components/doctor/DoctorView';\r\nimport Home from './components/Home';\r\nimport NurseView from './components/nurse/NurseView';\r\nimport RadiologistView from './components/radiologist/RadiologistView';\r\nimport Navbar from './components/shared/Navbar';\r\nimport StoreActionType from './context/constants/ActionTypes';\r\nimport Notification from './components/shared/Notification';\r\nimport { AppContext } from './context/context';\r\n\r\n\r\nfunction App() {\r\n  const [state, dispatch] = useContext(AppContext)\r\n\r\n\r\n  useEffect(() => {\r\n    dispatch({ type: StoreActionType.SET_PATIENT_DATA, payload: [\r\n      [\r\n        \"355056963916367154422305871670634494196\",\r\n        \"2021-03-23T18:44:08-07:00\",\r\n        null,\r\n        5,\r\n        100,\r\n        \"0\",\r\n        false,\r\n        \"C:\\\\Users\\\\Keenan\\\\Git\\\\carl-server\\\\data\\\\Study2\",\r\n        null,\r\n        null,\r\n        null,\r\n        null,\r\n        null,\r\n        \"2020-01-01T09:00:00-08:00\"\r\n      ]\r\n    ] });\r\n    dispatch({ type: StoreActionType.UPDATE_BIOMARKER_DATA, payload: [\r\n      [\r\n        \"355056963916367154422305871670634494196\",\r\n        \"V0\",\r\n        5\r\n      ]\r\n    ] });\r\n    dispatch({ type: StoreActionType.UPDATE_BIOMARKER_DATA, payload: [\r\n      [\r\n        \"355056963916367154422305871670634494196\",\r\n        \"K1\",\r\n        0.00148\r\n      ]\r\n    ] });\r\n   }, [dispatch])\r\n\r\n\r\n  return (\r\n    <div className=\"App flex column\">\r\n      <Navbar />\r\n      <Switch>\r\n        <Route path=\"/frontend-demo/doctor\">\r\n          <DoctorView></DoctorView>\r\n        </Route>\r\n        <Route path=\"/frontend-demo/radiologist\">\r\n          <RadiologistView></RadiologistView>\r\n        </Route>\r\n        <Route path=\"/frontend-demo/nurse\">\r\n          <NurseView></NurseView>\r\n        </Route>\r\n        <Route exact path=\"/frontend-demo/\">\r\n          <Home />\r\n        </Route>\r\n      </Switch>\r\n      <Notification notification={state.notification} />\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\nimport { AppContextProvider } from './context/context';\r\nimport { BrowserRouter } from 'react-router-dom';\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <AppContextProvider>\r\n      <BrowserRouter>\r\n        <App />\r\n      </BrowserRouter>\r\n    </AppContextProvider>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n"],"sourceRoot":""}