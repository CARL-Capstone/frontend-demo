(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{102:function(e,t,i){},121:function(e,t,i){},131:function(e,t,i){},132:function(e,t,i){"use strict";i.r(t);var r=i(2),a=i(0),s=i.n(a),n=i(27),o=i.n(n),l=(i(79),i(11)),m=i(12),u=(i(80),i(5)),h=i(6),c=i(69),d=i(141),_=i(137),f=i(50),v=i.n(f),p=i(33),g=i(17),S=i(22),x=i(21),y={SET_IS_LOADED:0,SET_FILENAME:1,SET_VOLUME_SET:2,SET_VOLUME_INDEX:3,SET_TEXTURE3D:4,SET_MODE_VIEW:5,SET_MODE_2D:6,SET_SLIDER_2D:7,SET_MODE_3D:8,SET_SLIDER_3DR:9,SET_SLIDER_3DG:10,SET_SLIDER_3DB:11,SET_SLIDER_Opacity:12,SET_SLIDER_Isosurface:13,SET_SLIDER_Brightness:14,SET_SLIDER_Cut:15,SET_SLIDER_Quality:16,SET_SLIDER_ErRadius:17,SET_SLIDER_ErDepth:18,SET_VOLUME_Renderer:19,SET_2D_TOOLS_INDEX:20,SET_2D_ZOOM:21,SET_2D_X_POS:22,SET_2D_Y_POS:23,SET_GRAPHICS_2D:24,SET_UI_APP:25,SET_DICOM_INFO:26,SET_IS_TOOL3D:27,SET_SLIDER_Contrast3D:28,SET_ERR_ARRAY:29,SET_MODE_3Droi:30,SET_DICOM_SERIES:31,SET_LOADER_DICOM:32,SET_FILENAMES:33,SET_PATIENT_DATA:34,UPDATE_PATIENT_DATA:35,SET_NOTIFICATION:36,SET_PHASETIMES:37,UPDATE_BIOMARKER_DATA:38,SET_SCANID:39,SET_3D_ZOOM:40,SET_SPOT_COLOR:69,SET_VOLUME_OPACITY:420,SET_SHOW_VENOUS_STRUCTURE:"360 no-scope",SET_INPUT:41,SET_LOADER:42},b={VIEW_NA:-1,VIEW_MPR:0,VIEW_2D:1,VIEW_3D_LIGHT:2,VIEW_3D:3,VIEW_COUNT:4},T={NA:-1,SAGGITAL:0,CORONAL:1,TRANSVERSE:2},O={NA:-1,ISO:0,RAYCAST:1,RAYFAST:2,EREASER:3},D={NA:-1,ISO:0,RAYCAST:1},R=i(45),w=i(3),j=i(1),X=function(){function e(){Object(u.a)(this,e),this.m_useWebGL2=void 0}return Object(h.a)(e,[{key:"createWebGLContext",value:function(){this.canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");var e=this.canvas.getContext("webgl2");return this.m_useWebGL2=1,null==e?(console.log("WebGL 2 not supported, moving to webgl 1"),e=this.canvas.getContext("webgl"),this.m_useWebGL2=0):console.log("WebGL 2 context created"),e}},{key:"getCanvas",value:function(){return this.canvas}},{key:"useWebGL2",value:function(){return this.m_useWebGL2}}]),e}(),E=Math.PI/720,I=function(){function e(t,i,r,a,s){Object(u.a)(this,e),this.rotateAmount=E,this.m_callback=s,this.m_mesh=a,this.m_wireMesh=null,this.m_camera=i,this.m_target=new j.U(0,0,0),this.m_scene=r,this.m_button=e.EVENT_BUTTON_NA,this.domElem=t,this.m_pressedLeft=!1,this.m_pressedRight=!1,this.m_prevMouse={x:-1,y:-1},this.m_prevTime=-1,this.m_deltaTime=0,this.m_spherical=new j.O,this.m_sphericalDelta=new j.O,this.m_spherical.set(0,0,0),this.m_sphericalDelta.set(0,0,0),this.m_autoRotate=!1,this.m_minDistance=.3,this.m_maxDistance=2.5,this.m_minAzimuthAngle=-1/0,this.m_maxAzimuthAngle=1/0,this.m_minPolarAngle=0,this.m_maxPolarAngle=2*Math.PI,this.m_enableDamping=!1,this.m_dampingFactor=.25,this.isEraserMode=!1}return Object(h.a)(e,[{key:"setEraserMode",value:function(e){this.isEraserMode=e}},{key:"setMesh",value:function(e){this.m_mesh=e}},{key:"setWireMesh",value:function(e){this.m_wireMesh=e}},{key:"setScene",value:function(e){this.m_scene=e}},{key:"getX",value:function(e){return e-this.domElem.offsetLeft}},{key:"getY",value:function(e){return e-this.domElem.offsetTop}},{key:"autoSpin",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.autoRotateInterval&&(clearInterval(this.autoRotateInterval),this.autoRotateInterval=void 0),t&&(this.autoRotateInterval=setInterval((function(){return e._autoSpin()}),1e3/30))}},{key:"_autoSpin",value:function(){var e=new j.y;e.identity();var t=new j.y;t.makeRotationAxis(new j.U(0,1,0),E),e.multiply(t).multiply(this.m_mesh.matrix),this.m_mesh.rotation.setFromRotationMatrix(e),this.m_wireMesh&&(e.identity(),e.multiply(t).multiply(this.m_wireMesh.matrix),this.m_wireMesh.rotation.setFromRotationMatrix(e)),this.m_callback()}},{key:"updateTime",value:function(e,t){if(0!==e||0!==t){var i=(new Date).getTime();if(this.m_prevTime=this.m_prevTime>0?this.m_prevTime:i,this.m_deltaTime=i-this.m_prevTime,this.m_prevTime=i,this.m_mesh){var r=new j.y,a=new j.y,s=new j.y,n=new j.U;n.copy(this.m_target).sub(this.m_camera.position).normalize(),a.makeRotationAxis(this.m_camera.up,.018*e),r.makeRotationAxis(n.cross(this.m_camera.up),.018*t),s.identity(),s.multiply(a).multiply(r).multiply(this.m_mesh.matrix),this.m_mesh.rotation.setFromRotationMatrix(s),this.m_wireMesh&&(s.identity(),s.multiply(a).multiply(r).multiply(this.m_wireMesh.matrix),this.m_wireMesh.rotation.setFromRotationMatrix(s)),this.m_callback()}}}},{key:"onMouseDown",value:function(e,t,i){this.m_pressedLeft=!0,this.m_prevMouse={x:e,y:t},this.m_spherical.set(0,0,0),this.m_sphericalDelta.set(0,0,0),this.m_prevTime=(new Date).getTime(),this.ctrlKey=i}},{key:"onMouseUp",value:function(){this.m_pressedLeft=!1,this.m_prevMouse.x=-1,this.m_prevMouse.y=-1}},{key:"onMouseMove",value:function(e,t){this.m_prevMouse.x<0&&(this.m_prevMouse.x=e,this.m_prevMouse.y=t);var i=e-this.m_prevMouse.x,r=t-this.m_prevMouse.y;this.m_prevMouse.x=e,this.m_prevMouse.y=t,this.m_pressedLeft&&this.updateTime(i,r)}},{key:"onZoom",value:function(e){var t=.2*e,i=this.m_camera.position.length(),r=this.m_camera.position.sub(this.m_target);r.normalize(),i+=t,i=Math.max(i,.3),i=Math.min(i,2.5),r.multiplyScalar(i),this.m_camera.position.set(r.x,r.y,r.z),this.m_camera.lookAt(this.m_target),this.m_camera.updateMatrixWorld()}},{key:"setZoom",value:function(e){var t=e,i=this.m_camera.position.sub(this.m_target);i.normalize(),t=Math.max(t,.3),t=Math.min(t,2.5),i.multiplyScalar(t),this.m_camera.position.set(i.x,i.y,i.z),this.m_camera.lookAt(this.m_target),this.m_camera.updateMatrixWorld()}}]),e}();I.EVENT_BUTTON_NA=-1,I.EVENT_BUTTON_LEFT=0,I.EVENT_BUTTON_CENTER=1,I.EVENT_BUTTON_RIGHT=2;var A=i.p+"static/media/backface.3dc9d515.vert",M=i.p+"static/media/backface.84a75448.frag",C=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment=""}return Object(h.a)(e,[{key:"create",value:function(e){var t=this,i=new j.p(j.m);i.setResponseType("text");var r=new j.p(j.m);r.setResponseType("text"),i.load(A,(function(i){t.m_strShaderVertex=i,r.load(M,(function(i){t.m_strShaderFragment=i;var r=new j.M({vertexShader:t.m_strShaderVertex,fragmentShader:t.m_strShaderFragment,side:j.c,depthTest:!0,depthFunc:j.t,blending:j.C});e&&e(r)}))}))}}]),e}(),F=i.p+"static/media/frontface.6197e7b1.vert",V=i.p+"static/media/frontface.7ecf0644.frag",U=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment="",this.m_uniforms={texBF:{type:"t",value:null},PlaneX:{type:"v4",value:new j.V(-1,0,0,.5)},PlaneY:{type:"v4",value:new j.V(0,-1,0,.5)},PlaneZ:{type:"v4",value:new j.V(0,0,-1,.5)}}}return Object(h.a)(e,[{key:"create",value:function(e,t){var i=this;this.m_uniforms.texBF.value=e;var r=new j.p(j.m);r.setResponseType("text");var a=new j.p(j.m);a.setResponseType("text"),r.load(F,(function(e){i.m_strShaderVertex=e,a.load(V,(function(e){i.m_strShaderFragment=e;var r=new j.M({uniforms:i.m_uniforms,vertexShader:i.m_strShaderVertex,fragmentShader:i.m_strShaderFragment,side:j.r,depthTest:!0,depthFunc:j.u,blending:j.C});t&&t(r)}),(function(e){console.log("Shader load failed! because of error "+e.target.status+", "+e.target.statusText)}))}))}}]),e}(),P=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment="",this.m_defines={backCullMode:1},this.m_uniforms={texBF:{type:"t",value:null},texFF:{type:"t",value:null}}}return Object(h.a)(e,[{key:"create",value:function(e,t){return this.m_uniforms.texBF.value=e,this.m_uniforms.texFF.value=t,this.m_strShaderVertex="\n      varying vec3 pos;\n      attribute vec3 uvw;\n      varying vec4 screenpos;\n      void main() {\n        pos = uvw;\n        screenpos = (projectionMatrix  * modelViewMatrix * vec4(position, 1.0));\n        gl_Position =  screenpos;\n      }\n    ",this.m_strShaderFragment="\n      precision highp float;\n      precision highp int;\n      uniform sampler2D texFF;\n      uniform sampler2D texBF;\n\n      varying vec3 pos;\n      varying vec4 screenpos;\n      void main() {\n      vec2 tc = screenpos.xy / screenpos.w * 0.5 + 0.5;\n      vec3 back  = texture2D(texBF, tc, 0.0).xyz;\n      vec3 front = texture2D(texFF, tc, 0.0).xyz;\n      float cullvalue = length(pos - back) - length(front - back);\n\n\n      #if backCullMode == 1\n        if (cullvalue < -0.001)\n          discard;\n      #endif\n      #if backCullMode == 0\n        if (cullvalue > 0.001)\n          discard;\n      #endif\n\n        gl_FragColor = vec4(0.5, 0.0, 1.0, 1.0);\n        //gl_FragColor = vec4(cullvalue, cullvalue, cullvalue, 1.0);\n        //gl_FragColor = vec4(front, 1.0);\n      }\n    ",new j.M({uniforms:this.m_uniforms,defines:this.m_defines,vertexShader:this.m_strShaderVertex,fragmentShader:this.m_strShaderFragment,side:j.r,wireframe:!0,depthTest:!1,polygonOffset:!1,polygonOffsetFactor:-4,polygonOffsetUnits:-4})}}]),e}(),N=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment="",this.m_uniforms={texBuffer:{type:"t",value:null}}}return Object(h.a)(e,[{key:"create",value:function(e){return this.m_uniforms.texBuffer.value=e,this.m_strShaderVertex="\n      varying vec4 screenpos;\n      void main() {\n        screenpos = (projectionMatrix  * modelViewMatrix * vec4(position, 1.0));\n        gl_Position =  screenpos;\n      }\n    ",this.m_strShaderFragment="\n      precision highp float;\n      precision highp int;\n      uniform sampler2D texBuffer;\n\n      varying vec4 screenpos;\n      void main() {\n        vec2 tc = screenpos.xy / screenpos.w * 0.5 + 0.5;\n        gl_FragColor = texture2D(texBuffer, tc, 0.0);\n      }\n    ",new j.M({uniforms:this.m_uniforms,vertexShader:this.m_strShaderVertex,fragmentShader:this.m_strShaderFragment,side:j.r,depthTest:!0,depthFunc:j.u,blending:j.C})}}]),e}(),k=i.p+"static/media/clipplane.7ba65be0.vert",L=i.p+"static/media/clipplane.d594e568.frag",B=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment="",this.m_uniforms={MVP:{type:"m4"},texBF:{type:"t"}}}return Object(h.a)(e,[{key:"create",value:function(e,t){var i=this;this.m_uniforms.texBF.value=e;var r=new j.p(j.m);r.setResponseType("text");var a=new j.p(j.m);a.setResponseType("text"),r.load(k,(function(e){i.m_strShaderVertex=e,a.load(L,(function(e){i.m_strShaderFragment=e;var r=new j.M({uniforms:i.m_uniforms,vertexShader:i.m_strShaderVertex,fragmentShader:i.m_strShaderFragment,side:j.n,depthTest:!1,depthWrite:!1});t&&t(r)}))}))}}]),e}(),z=i.p+"static/media/rendertotexture.b51229d9.vert",G=i.p+"static/media/rendertotexture.1f755ade.frag",W=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment="",this.m_uniforms={texTF:{type:"t",value:null},texVolume:{type:"t",value:null},texRoiId:{type:"t",value:null},texRoiColor:{type:"t",value:null},RoiVolumeTex:{type:"t",value:null},texVolumeMask:{type:"t",value:null},texVolumeAO:{type:"t",value:null},lightDir:{type:"v3",value:new j.U(0,0,0)},texBF:{type:"t",value:null},texFF:{type:"t",value:null},t_function1min:{type:"v4",value:new j.V(0,0,0,0)},t_function1max:{type:"v4",value:new j.V(0,0,0,0)},t_function2min:{type:"v4",value:new j.V(0,0,0,0)},t_function2max:{type:"v4",value:new j.V(0,0,0,0)},stepSize:{type:"v4",value:new j.V(0,0,0,0)},texSize:{type:"f",value:0},isoThreshold:{type:"f",value:0},brightness3D:{type:"f",value:0},contrast3D:{type:"f",value:0},colorMap1D:{type:"t",value:null},heatMap1D:{type:"t",value:null},opacityBarrier:{type:"f",value:0},volumeOpacity:{type:"f",value:1},tileCountX:{type:"f",value:0},volumeSizeZ:{type:"f",value:0},xDim:{type:"f",value:0},yDim:{type:"f",value:0},zDim:{type:"f",value:0},ssaoOffsets:{type:"v3v"},SPOTcolor:{type:"v3",value:new j.U(1,1,1)},showSolids:{type:"b",value:!0}},this.m_defines={isoRenderFlag:0,MaskFlag:0,useAmbientTex:0,useWebGL2:1}}return Object(h.a)(e,[{key:"create",value:function(e,t,i,r,a,s,n,o){var l=this;this.m_uniforms.texTF.value=e,this.m_uniforms.texVolume.value=t,this.m_uniforms.texVolumeMask.value=i,this.m_uniforms.texVolumeAO.value=r,this.m_uniforms.texBF.value=a,this.m_uniforms.texFF.value=s,this.m_uniforms.ssaoOffsets.value=n;var m=new j.p(j.m);m.setResponseType("text");var u=new j.p(j.m);u.setResponseType("text"),m.load(z,(function(e){l.m_strShaderVertex=e,u.load(G,(function(e){l.m_strShaderFragment=e;var t=new j.M({uniforms:l.m_uniforms,defines:l.m_defines,vertexShader:l.m_strShaderVertex,fragmentShader:l.m_strShaderFragment,side:j.c,depthTest:!0,depthFunc:j.t,blending:j.C});o&&o(t)}))}))}}]),e}(),H=i.p+"static/media/interpolation.ae2f2bf4.vert",q=i.p+"static/media/interpolation.b65fb94f.frag",Y=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment="",this.m_uniforms={isoSurfTexel:{type:"v2",value:null},texIsoSurface:{type:"t",value:null}},this.m_defines={isoRenderFlag:0}}return Object(h.a)(e,[{key:"create",value:function(e,t){var i=this;this.m_uniforms.texIsoSurface.value=e;var r=new j.p(j.m);r.setResponseType("text");var a=new j.p(j.m);a.setResponseType("text"),r.load(H,(function(e){i.m_strShaderVertex=e,a.load(q,(function(e){i.m_strShaderFragment=e;var r=new j.M({uniforms:i.m_uniforms,defines:i.m_defines,vertexShader:i.m_strShaderVertex,fragmentShader:i.m_strShaderFragment,side:j.c});t&&t(r)}))}))}}]),e}(),Z=i.p+"static/media/volumerender.0fdf551f.vert",K=i.p+"static/media/volumerender.00647b63.frag",Q=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment="",this.m_uniforms={isoSurfTexel:{type:"v2",value:null},lightDir:{type:"v3",value:new j.U(0,0,0)},texTF:{type:"t",value:null},texVolume:{value:null},texRoiId:{type:"t",value:null},texRoiColor:{type:"t",value:null},RoiVolumeTex:{type:"t",value:null},texVolumeMask:{type:"t",value:null},texVolumeAO:{type:"t",value:null},texBF:{type:"t",value:null},texFF:{type:"t",value:null},texIsoSurface:{type:"t",value:null},colorMap1D:{type:"t",value:null},heatMap1D:{type:"t",value:null},t_function1min:{type:"v4",value:new j.V(0,0,0,0)},t_function1max:{type:"v4",value:new j.V(0,0,0,0)},t_function2min:{type:"v4",value:new j.V(0,0,0,0)},t_function2max:{type:"v4",value:new j.V(0,0,0,0)},stepSize:{type:"v4",value:new j.V(0,0,0,0)},texSize:{type:"f",value:0},isoThreshold:{type:"f",value:0},brightness3D:{type:"f",value:0},contrast3D:{type:"f",value:0},tileCountX:{type:"f",value:0},volumeSizeZ:{type:"f",value:0},opacityBarrier:{type:"f",value:0},volumeOpacity:{type:"f",value:1},xDim:{type:"f",value:0},yDim:{type:"f",value:0},zDim:{type:"f",value:0},ssaoOffsets:{type:"v3v"},SPOTcolor:{type:"v3",value:new j.U(1,1,1)},showSolids:{type:"b",value:!0}},this.m_defines={isoRenderFlag:0,MaskFlag:0,useAmbientTex:0,useWebGL2:1}}return Object(h.a)(e,[{key:"create",value:function(e,t,i,r,a,s,n,o,l){var m=this;this.m_uniforms.texTF.value=e,this.m_uniforms.texVolume.value=t,this.m_uniforms.texVolumeMask.value=i,this.m_uniforms.texVolumeAO.value=r,this.m_uniforms.texBF.value=a,this.m_uniforms.texFF.value=s,this.m_uniforms.texIsoSurface.value=n,this.m_uniforms.ssaoOffsets.value=o;var u=new j.p(j.m);u.setResponseType("text");var h=new j.p(j.m);h.setResponseType("text"),u.load(Z,(function(e){m.m_strShaderVertex=e,h.load(K,(function(e){m.m_strShaderFragment=e;var t=new j.M({uniforms:m.m_uniforms,defines:m.m_defines,vertexShader:m.m_strShaderVertex,fragmentShader:m.m_strShaderFragment,side:j.c,depthTest:!0,depthFunc:j.t,blending:j.C});l&&l(t)}))}))}}]),e}(),J=i.p+"static/media/blur.a62df0a0.vert",$=i.p+"static/media/blur.d95db93c.frag",ee=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment="";this.m_uniforms={texVolume:{type:"t",value:null},texVolumeRoi:{type:"t",value:null},texRoiColor:{type:"t",value:null},texSegInUse:{type:"t",value:null},texelSize:{type:"v3",value:null},tileCountX:{type:"f",value:16},volumeSizeZ:{type:"f",value:256},xDim:{type:"f",value:256},yDim:{type:"f",value:256},blurSigma:{type:"f",value:.8},contrast:{type:"f",value:1},brightness:{type:"f",value:0},curZ:{type:"f",value:0},save_flag:{type:"b",value:!0}},this.m_defines={renderRoiMap:0,useWebGL2:1}}return Object(h.a)(e,[{key:"create",value:function(e,t,i,r,a,s){var n=this;this.m_uniforms.texVolume.value=e,this.m_uniforms.texVolume.value=e,this.m_uniforms.texVolumeRoi.value=t,this.m_uniforms.texRoiColor.value=r,this.m_uniforms.texSegInUse.value=a,this.m_uniforms.texelSize.value=i;var o=new j.p(j.m);o.setResponseType("text");var l=new j.p(j.m);l.setResponseType("text"),o.load(J,(function(e){n.m_strShaderVertex=e,l.load($,(function(e){n.m_strShaderFragment=e;var t=new j.M({uniforms:n.m_uniforms,defines:n.m_defines,vertexShader:n.m_strShaderVertex,fragmentShader:n.m_strShaderFragment});s&&s(t)}))}))}}]),e}(),te=i.p+"static/media/createAO.a62df0a0.vert",ie=i.p+"static/media/createAO.bae764f9.frag",re=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment="";var t=1/256,i=256;this.m_uniforms={texVolume:{type:"t",value:null},vectorsTex:{type:"t",value:null},texelSize:{type:"v3",value:new j.U(t,t,t)},tileCountX:{type:"f",value:16},volumeSizeZ:{type:"f",value:i},xDim:{type:"f",value:i},yDim:{type:"f",value:i},curZ:{type:"f",value:i},isoThreshold:{type:"f",value:i},vectorsSize:{type:"i",value:null}},this.m_defines={useWebGL2:1}}return Object(h.a)(e,[{key:"create",value:function(e,t,i,r,a,s){var n=this;this.m_uniforms.texVolume.value=e,this.m_uniforms.vectorsTex.value=i,this.m_uniforms.texelSize.value=t,this.m_uniforms.vectorsSize.value=r,this.m_uniforms.isoThreshold.value=a;var o=new j.p(j.m);o.setResponseType("text");var l=new j.p(j.m);l.setResponseType("text"),o.load(te,(function(e){n.m_strShaderVertex=e,l.load(ie,(function(e){n.m_strShaderFragment=e;var t=new j.M({uniforms:n.m_uniforms,defines:n.m_defines,vertexShader:n.m_strShaderVertex,fragmentShader:n.m_strShaderFragment});s&&s(t)}))}))}}]),e}(),ae=function e(){Object(u.a)(this,e),this.m_point=new j.U,this.m_next=null},se=function(){function e(t){Object(u.a)(this,e),this.create(t)}return Object(h.a)(e,[{key:"create",value:function(e){this.m_numPoints=0,this.m_numAllocatedPoints=e,this.m_points=new Array(e),this.m_voxels=new Array(4096);for(var t=0;t<e;t++)this.m_points[t]=new ae,this.m_points[t].m_point.set(0,0,0),this.m_points[t].m_next=null}},{key:"getNumPoints",value:function(){return this.m_numPoints}},{key:"findPointSlow",value:function(e,t,i){for(var r=0;r<this.m_numPoints;r++){var a=e-this.m_points[r].m_point.x,s=t-this.m_points[r].m_point.y,n=i-this.m_points[r].m_point.z;if(a*a+s*s+n*n<1e-8)return r}return-1}},{key:"addPoint",value:function(e,t,i){var r=this.findPointSlow(e,t,i);if(r>=0)return r;if(this.m_numPoints>=this.m_numAllocatedPoints)return-1;var a=this.m_numPoints;return this.m_points[a]=new ae,this.m_points[a].m_point.set(e,t,i),this.m_points[a].m_next=null,this.m_numPoints++,a}}]),e}(),ne=function e(t,i,r){Object(u.a)(this,e);this.m_indices=new Int32Array(3),this.m_indices[0]=t,this.m_indices[1]=i,this.m_indices[2]=r},oe=function(){function e(t){Object(u.a)(this,e),this.create(t)}return Object(h.a)(e,[{key:"create",value:function(e){this.m_numTriangles=0,this.m_numAllocatedTriangles=e,this.m_triangles=new Array(e);for(var t=0;t<e;t++)this.m_triangles[t]=new ne(-1,-1,-1)}},{key:"getNumTriangles",value:function(){return this.m_numTriangles}},{key:"addTriangle",value:function(e,t,i){return this.m_numTriangles>=this.m_numAllocatedTriangles?-1:(this.m_triangles[this.m_numTriangles].m_indices[0]=e,this.m_triangles[this.m_numTriangles].m_indices[1]=t,this.m_triangles[this.m_numTriangles].m_indices[2]=i,this.m_numTriangles++,1)}}]),e}(),le=function e(){Object(u.a)(this,e),this.va=new j.U,this.vb=new j.U,this.vc=new j.U},me=function(){function e(){Object(u.a)(this,e),this.m_numAllocated=0,this.m_numStacked=0,this.m_stack=null}return Object(h.a)(e,[{key:"create",value:function(e){for(var t=20,i=0;i<e;i++)t*=4;this.m_numAllocated=t,this.m_stack=new Array(this.m_numAllocated);for(var r=0;r<this.m_numAllocated;r++)this.m_stack[r]=new le;this.m_numStacked=0}},{key:"getStackDepth",value:function(){return this.m_numStacked}},{key:"isEmpty",value:function(){return 0===this.m_numStacked}},{key:"push",value:function(e,t,i){return this.m_numStacked>=this.m_numAllocated?-1:(this.m_stack[this.m_numStacked].va=e,this.m_stack[this.m_numStacked].vb=t,this.m_stack[this.m_numStacked].vc=i,this.m_numStacked++,1)}},{key:"pop",value:function(){return this.m_numStacked<=0?null:(this.m_numStacked--,this.m_stack[this.m_numStacked])}}]),e}(),ue=function(){function e(){Object(u.a)(this,e),this.m_pointSet=null,this.m_triangleSet=null}return Object(h.a)(e,[{key:"create",value:function(e,t){var i=.5257311121,r=.8506508083,a=[-i,0,+r,+i,0,+r,-i,0,-r,+i,0,-r,0,+r,+i,0,+r,-i,0,-r,+i,0,-r,-i,+r,+i,0,-r,+i,0,+r,-i,0,-r,-i,0],s=[0,4,1,0,9,4,9,5,4,4,5,8,4,8,1,8,10,1,8,3,10,5,3,8,5,2,3,2,7,3,7,10,3,7,6,10,7,11,6,11,0,6,0,1,6,6,1,10,9,0,11,9,11,2,9,2,5,7,2,11];this.m_pointSet=new se(12);for(var n=0,o=0;o<12;o++,n+=3){var l=a[n+0],m=a[n+1],u=a[n+2];this.m_pointSet.addPoint(l,m,u)}this.m_triangleSet=new oe(20),n=0;for(var h=0;h<20;h++,n+=3){var c=s[n+0],d=s[n+1],_=s[n+2];this.m_triangleSet.addTriangle(c,_,d)}this.subDivideMesh(t);for(var f=this.m_pointSet.getNumPoints(),v=0;v<f;v++)this.m_pointSet.m_points[v].m_point.x*=e.x,this.m_pointSet.m_points[v].m_point.y*=e.y,this.m_pointSet.m_points[v].m_point.z*=e.z;return 1}},{key:"getNumTriangles",value:function(){return this.m_triangleSet.m_numTriangles}},{key:"getNumVertices",value:function(){return this.m_pointSet.m_numPoints}},{key:"getVertex",value:function(e){return this.m_pointSet.m_points[e].m_point}},{key:"getTriangle",value:function(e){return this.m_triangleSet.m_triangles[e].m_indices}},{key:"saveGeoToPlyFile",value:function(e){var t="ply\nformat ascii 1.0\ncomment tetrahedron mesh\n",i=this.m_pointSet.m_numPoints,r=i.toString();t=(t=(t=(t=(t=t.concat("element vertex ")).concat(r)).concat("\n")).concat("property float x\nproperty float y\nproperty float z\n")).concat("element face ");var a=this.m_triangleSet.m_numTriangles,s=a.toString();t=(t=(t=(t=t.concat(s)).concat("\n")).concat("property list uchar int vertex_indices\n")).concat("end_header\n");for(var n=0;n<i;n++){var o=this.m_pointSet.m_points[n].m_point,l=o.x.toString(),m=o.y.toString(),u=o.z.toString();t=(t=(t=(t=(t=(t=t.concat(l)).concat(" ")).concat(m)).concat(" ")).concat(u)).concat(" 1.0\n")}for(var h=0;h<a;h++){var c=this.m_triangleSet.m_triangles[h].m_indices,d="3 ".concat(c[0]," ").concat(c[1]," ").concat(c[2],"\n");t=t.concat(d)}var _=(new TextEncoder).encode(t),f=new Blob([_],{type:"application/octet-stream"}),v=URL.createObjectURL(f),p=document.createElement("a");p.setAttribute("href",v),p.setAttribute("download",e);var g=document.createEvent("MouseEvents");g.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),p.dispatchEvent(g)}},{key:"saveGeoToObjFile",value:function(e){for(var t="# Tetrahedron test geo\n",i=this.m_pointSet.m_numPoints,r=i.toString(),a=this.m_triangleSet.m_numTriangles,s=a.toString(),n=0;n<i;n++){var o=this.m_pointSet.m_points[n].m_point,l=o.x.toString(),m=o.y.toString(),u=o.z.toString();t=(t=(t=(t=(t=(t=(t=t.concat("v  ")).concat(l)).concat(" ")).concat(m)).concat(" ")).concat(u)).concat("\n")}var h="# ".concat(r," vertices\n");t=(t=t.concat(h)).concat("g TetraObj\n");for(var c=0;c<a;c++){var d=this.m_triangleSet.m_triangles[c].m_indices,_=1+d[0],f=1+d[1],v=1+d[2],p="f ".concat(_," ").concat(f," ").concat(v,"\n");t=t.concat(p)}var g="# ".concat(s," triangles\n");t=t.concat(g);var S=(new TextEncoder).encode(t),x=new Blob([S],{type:"application/octet-stream"}),y=URL.createObjectURL(x),b=document.createElement("a");b.setAttribute("href",y),b.setAttribute("download",e);var T=document.createEvent("MouseEvents");T.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),b.dispatchEvent(T)}},{key:"subDivideMesh",value:function(e){if(0===e)return 1;var t=new me;t.create(e);var i=new me;i.create(e);for(var r=this.m_triangleSet.getNumTriangles(),a=0;a<r;a++){var s=this.m_triangleSet.m_triangles[a].m_indices,n=s[0],o=s[1],l=s[2],m=this.m_pointSet.m_points[n].m_point,u=this.m_pointSet.m_points[o].m_point,h=this.m_pointSet.m_points[l].m_point,c=t.push(m,u,h);if(c<1)return c}for(var d=t,_=i,f=0;f<e;f++){for(var v=d.getStackDepth(),p=0;p<v;p++){var g=d.pop();if(null===g)return-1;var S=g.va,x=g.vb,y=g.vc,b=new j.U,T=new j.U,O=new j.U;b.addVectors(S,x),b.normalize(),T.addVectors(x,y),T.normalize(),O.addVectors(y,S),O.normalize(),_.push(S,b,O),_.push(x,T,b),_.push(y,O,T),_.push(b,T,O)}var D=d;d=_,_=D}var R=d.getStackDepth(),w=Math.floor(3*R*.6);for(this.m_triangleSet.create(R),this.m_pointSet.create(w);!d.isEmpty();){var X=d.pop(),E=X.va,I=X.vb,A=X.vc,M=this.m_pointSet.addPoint(E.x,E.y,E.z),C=this.m_pointSet.addPoint(I.x,I.y,I.z),F=this.m_pointSet.addPoint(A.x,A.y,A.z),V=this.m_triangleSet.addTriangle(M,C,F);if(1!==V)return V}var U=this.m_pointSet.getNumPoints(),P=this.m_triangleSet.getNumTriangles();return U>w||P>R?-10:1}}]),e}(),he=function(){function e(t){Object(u.a)(this,e),this.rendererBlur=t.renderer,this.sceneBlur=t.scene,this.cameraOrtho=t.camera,this.xDim=t.xDim,this.yDim=t.yDim,this.zDim=t.zDim,this.texVolumeAO=null,this.vectorsTex=null}return Object(h.a)(e,[{key:"_setAOVectorTex",value:function(){var e=255,t=new ue,i=new j.U(.5,.5,.5);if(!(t.create(i,2)<1)){this.numAOVectors=t.getNumVertices(),this.vectors=new Uint8Array(4*this.numAOVectors);for(var r=0;r<this.numAOVectors;r++){var a=t.getVertex(r);this.vectors[4*r+0]=(a.x+.5)*e,this.vectors[4*r+1]=(a.y+.5)*e,this.vectors[4*r+2]=(a.z+.5)*e,this.vectors[4*r+3]=e}this.vectorsTex=new j.k(this.vectors,this.numAOVectors,1,j.J),this.vectorsTex.wrapS=j.g,this.vectorsTex.wrapT=j.g,this.vectorsTex.magFilter=j.B,this.vectorsTex.minFilter=j.B,this.vectorsTex.needsUpdate=!0}}},{key:"set",value:function(e,t){var i=this;null===this.vectorsTex&&this._setAOVectorTex(),this.xDimAO=this.xDim,this.yDimAO=this.yDim,this.zDimAO=this.zDim,this.bufferTextureAO=new j.W(this.xDimAO,this.yDimAO,{minFilter:j.v,magFilter:j.v,format:j.J,type:j.S,depthBuffer:!1}),this.ambientVolumeTexCPU=new Uint8Array(this.xDimAO*this.yDimAO*this.zDimAO),0===this.isWebGL2?this.texVolumeAO=new j.k(this.ambientVolumeTexCPU,this.xTex,this.yTex,j.b):(this.texVolumeAO=new j.l(this.ambientVolumeTexCPU,this.xDimAO,this.yDimAO,this.zDimAO),this.texVolumeAO.format=j.K),this.texVolumeAO.wrapS=j.g,this.texVolumeAO.wrapT=j.g,this.texVolumeAO.wrapR=j.g,this.texVolumeAO.magFilter=j.v,this.texVolumeAO.minFilter=j.v,this.texVolumeAO.needsUpdate=!0;var r=new j.U(1/this.xDim,1/this.yDim,1/this.zDim);(new re).create(e,r,this.vectorsTex,this.numAOVectors,t,(function(e){i.materialAO=e,e.uniforms.tileCountX.value=i.zTexDivSqrt,e.uniforms.volumeSizeZ.value=i.zDim,i.setAmbientTextureWebGL2(),i.texVolumeAO.needsUpdate=!0}))}},{key:"setAmbientTextureWebGL2",value:function(){var e=new Uint8Array(4*this.xDimAO*this.yDimAO),t=this.rendererBlur.getContext();console.log("AO WebGL2");for(var i=0;i<this.zDimAO;++i){this.materialAO.uniforms.curZ.value=i/(this.zDimAO-1),this.materialAO.uniforms.curZ.needsUpdate=!0,this.sceneBlur.overrideMaterial=this.materialAO,this.rendererBlur.render(this.sceneBlur,this.cameraOrtho,this.bufferTextureAO),this.sceneBlur.overrideMaterial=null,t.readPixels(0,0,this.xDimAO,this.yDimAO,t.RGBA,t.UNSIGNED_BYTE,e);for(var r=i*this.xDimAO*this.yDimAO,a=0;a<this.yDimAO;a++)for(var s=0;s<this.xDimAO;s++)this.ambientVolumeTexCPU[s+a*this.xDimAO+r]=e[4*(s+a*this.xDimAO)]}console.log("AO WebGL2 End")}},{key:"get",value:function(){return this.texVolumeAO}}]),e}(),ce=function(){function e(){Object(u.a)(this,e),this.selectedROIs=null,this.transferFuncRgba=null,this.transferFuncTexture=null,this.texRoiColor=null,this.texRoiId=null,this.numRois=256,this.m_handleColors=[{r:0,g:0,b:0},{r:255,g:128,b:64},{r:255,g:0,b:0},{r:128,g:64,b:64},{r:128,g:0,b:0},{r:64,g:64,b:64},{r:128,g:128,b:128},{r:192,g:192,b:192},{r:255,g:255,b:255},{r:255,g:255,b:255}]}return Object(h.a)(e,[{key:"init",value:function(e,t){this.selectedROIs=new Uint8Array(4*this.numRois),this.numTfPixels=256,this.transferFuncRgba=new Uint8Array(4*this.numTfPixels),this.texRoiColor=null,e&&(this.texRoiId=this.createSelectedRoiMap(),this.texRoiColor=this.createRoiColorMap(t))}},{key:"createTransferFuncTexture",value:function(){for(var e=null,t=0,i=255,r=22.95,a=76.5,s=.43*i,n=135.15,o=0;o<this.numTfPixels;o++)o>r&&o<51&&(t=(o-r)/28.05),o>51&&o<a&&(t=(a-o)/25.5),o>s&&o<n&&(t=(o-s)/(n-s)),o>n&&(t=1),this.transferFuncRgba[4*o+0]=i,this.transferFuncRgba[4*o+1]=0,this.transferFuncRgba[4*o+1+1]=0,this.transferFuncRgba[4*o+1+1+1]=i*t/12,o>s&&(this.transferFuncRgba[4*o+0]=255,this.transferFuncRgba[4*o+1]=210,this.transferFuncRgba[4*o+1+1]=180,this.transferFuncRgba[4*o+1+1+1]=i*t/3);return(e=new j.k(this.transferFuncRgba,this.numTfPixels,1,j.J)).wrapS=j.g,e.wrapT=j.g,e.magFilter=j.B,e.minFilter=j.B,e.needsUpdate=!0,this.transferFuncTexture=e,e}},{key:"setTransferFuncColors",value:function(e){this.transferFuncCtrlPtsRgb=[];for(var t=0;t<e.length;t++)this.transferFuncCtrlPtsRgb.push(new j.U(e[t].r,e[t].g,e[t].b))}},{key:"updateTransferFuncTexture",value:function(e,t){if(null===this.transferFuncRgba)return null;for(var i=0;i<e.length-1;i++)for(var r=Math.floor(e[i]),a=Math.floor(e[i+1]),s=r;s<a;s++){var n=(s-r)/(a-r),o=(1-n)*this.m_handleColors[i].r+n*this.m_handleColors[i+1].r,l=(1-n)*this.m_handleColors[i].g+n*this.m_handleColors[i+1].g,m=(1-n)*this.m_handleColors[i].b+n*this.m_handleColors[i+1].b;this.transferFuncRgba[4*s+0]=o,this.transferFuncRgba[4*s+1]=l,this.transferFuncRgba[4*s+2]=m;var u=t[i]>0?t[i]:0,h=t[i+1]>0?t[i+1]:0;this.transferFuncRgba[4*s+3]=255*(h*n+(1-n)*u)}return this.transferFuncTexture.needsUpdate=!0,this.transferFuncRgba}},{key:"createRoiColorMap",value:function(e){var t=null;if(null!==e)t=new j.k(e,256,1,j.J);else{for(var i=new Uint8Array(4*this.numRois),r=0;r<this.numRois;r++)i[4*r+0]=255,i[4*r+1]=0,i[4*r+2]=0,i[4*r+3]=255;t=new j.k(i,this.numRois,1,j.J)}return t.wrapS=j.g,t.wrapT=j.g,t.magFilter=j.B,t.minFilter=j.B,t.needsUpdate=!0,t}},{key:"createSelectedRoiMap",value:function(){for(var e=0;e<this.numRois;e++)this.selectedROIs[4*e]=e<50||e>240?0:255,this.selectedROIs[4*e+1]=0,this.selectedROIs[4*e+2]=0,this.selectedROIs[4*e+3]=0;var t=new j.k(this.selectedROIs,256,1,j.J);return t.wrapS=j.g,t.wrapT=j.g,t.magFilter=j.B,t.minFilter=j.B,t.needsUpdate=!0,t}},{key:"updateSelectedRoiMap",value:function(e){for(var t=0;t<this.numRois;t++)e[t]?this.selectedROIs[4*t]=255:this.selectedROIs[4*t]=0;this.texRoiId.needsUpdate=!0}},{key:"updateSelectedRoi",value:function(e,t){this.selectedROIs[4*e]=t?255:0,console.log("initMatBlure: ".concat(this.initMatBlure)),this.texRoiId.needsUpdate=!0}}]),e}(),de=function(){function e(){Object(u.a)(this,e),this.bufferBF=null,this.bufferFF=null,this.bufferRenderToTexture=null,this.isoThreshold=0,this.volTextureMask=null,this.geometry=null,this.lastSize=[],this.lastDepth=[],this.lastRotationVector=[],this.lastTarget=[],this.lastMode=[],this.lastBackDistance=[],this.resetflag=!1,this.bufferTextureCPU=null}return Object(h.a)(e,[{key:"createUpdatableVolumeMask",value:function(e,t){this.xDim=e.xDim,this.yDim=e.yDim,this.zDim=e.zDim,this.bufferBF=e.bufBF,this.bufferFF=e.bufFF,this.bufferRenderToTexture=e.bufTex,this.bufferMask=new Uint8Array(this.xDim*this.yDim*this.zDim),this.bufferTextureCPU=t;for(var i=0;i<this.zDim;i++)for(var r=0;r<this.yDim;r++)for(var a=0;a<this.xDim;a++)this.bufferMask[a+r*this.xDim+i*this.xDim*this.yDim]=255;return this.updatableTextureMask&&this.updatableTextureMask.dispose(),this.updatableTextureMask=new j.l(this.bufferMask,this.xDim,this.yDim,this.zDim),this.updatableTextureMask.format=j.K,this.updatableTextureMask.type=j.S,this.updatableTextureMask.wrapS=j.g,this.updatableTextureMask.wrapT=j.g,this.updatableTextureMask.magFilter=j.v,this.updatableTextureMask.minFilter=j.v,this.updatableTextureMask.needsUpdate=!0,this.updatableTextureMask}},{key:"eraseStart",value:function(e,t,i,r,a){this.isoThreshold=r;var s=Math.round(e),n=Math.round(t);this.eraserMouseDown=!0;var o=4*(n*i+s),l=4*(Math.floor(n/3)*Math.floor(i/3)+Math.floor(s/3)),m=this.bufferRenderToTexture[l+3];if(2!==m){var u=this.bufferBF[o+0]-this.bufferFF[o+0],h=this.bufferBF[o+1]-this.bufferFF[o+1],c=this.bufferBF[o+2]-this.bufferFF[o+2],d=new j.U(u,h,c),_=Math.sqrt(u*u+h*h+c*c);u=u/_*m+.5+this.bufferFF[o+0],h=h/_*m+.5+this.bufferFF[o+1],c=c/_*m+.5+this.bufferFF[o+2],this.erasePixels(u,h,c,d,a,m),this.updatableTextureMask.needsUpdate=!0}}},{key:"onMouseUp",value:function(){this.orbitControl.onMouseUp(),this.lockEraserBuffersUpdating=!1,this.eraserMouseDown=!1,this.renderState=this.RENDER_STATE.ONCE}},{key:"setEraserRadius",value:function(e){this.radius=e}},{key:"setEraserDepth",value:function(e){this.depth=e}},{key:"erasePixels",value:function(e,t,i,r,a,s){for(var n=Math.floor(e*this.xDim),o=Math.floor(t*this.yDim),l=Math.floor(i*this.zDim),m=new j.U,u=new j.U,h=1.4*1.4,c=0,d=0,_=0,f=0,v=0,p=-Math.min(2,l);p<=Math.min(2,this.zDim-1-l);p++)for(var g=-Math.min(2,o);g<=Math.min(2,this.yDim-1-o);g++)for(var S=-Math.min(2,n);S<=Math.min(2,this.xDim-1-n);S++){var x=l+p;v=n+S+(o+g)*this.xDim+x*this.xDim*this.yDim;var y=1-Math.exp(-(S*S+g*g+p*p)/(2*h));f+=y;var b=this.bufferTextureCPU[v];c+=b*y*(-S/h),d+=b*y*(-g/h),_+=b*y*(-p/h)}u.set(c/f,d/f,_/f),m.copy(u),m.normalize();var T=this.xDim/this.zDim,O=new j.j(this.radius,this.radius,this.depth,180,this.depth),D=new j.z(O,null),R=new j.U(0,0,1);D.quaternion.setFromUnitVectors(R,m.clone().normalize().multiplyScalar(-1)),D.position.copy(new j.U(n,o,l)),!0===a&&(this.prevDistance=s,this.resetflag=!1);if(!1===this.resetflag)if(Math.abs(this.prevDistance-s)<.05){this.prevDistance=s,this.point=new j.U(0,0,0),this.queue=[],this.queue.push(this.point);-5;for(var w=!1;this.queue.length>0;){this.point=this.queue.pop();var X=this.point.clone();if(X.z*=T,X.applyAxisAngle(new j.U(1,0,0),-D.rotation.x),X.applyAxisAngle(new j.U(0,1,0),-D.rotation.y),X.applyAxisAngle(new j.U(0,0,1),D.rotation.z),!(Math.sqrt(X.x*X.x+X.y*X.y)>this.radius||Math.abs(X.z)>this.depth||X.z<-5))for(var E=this.point.x-1;E<=this.point.x+1;E++)for(var I=this.point.y-1;I<=this.point.y+1;I++)for(var A=this.point.z-1;A<=this.point.z+1;A++){var M=n+Math.round(E),C=o+Math.round(I),F=l+Math.round(A);if(v=M+C*this.xDim+F*this.xDim*this.yDim,0!==this.bufferMask[v]){var V=255*this.isoThreshold-.01*255;this.bufferTextureCPU[v]>=V&&(w=!0,this.bufferMask[v]=0,this.queue.push(new j.U(E,I,A)))}}}!0===w&&(this.lastSize.push(this.radius),this.lastDepth.push(this.depth),this.lastRotationVector.push(new j.U(-D.rotation.x,-D.rotation.y,D.rotation.z)),this.lastTarget.push(new j.U(n,o,l)),this.lastBackDistance.push(-Math.round(Math.abs(Math.tan(r.normalize().angleTo(u.normalize())))*this.radius))),this.updatableTextureMask.needsUpdate=!0}else this.resetflag=!1}},{key:"undoLastErasing",value:function(){if(0!==this.lastSize.length){var e=this.lastTarget.pop(),t=this.lastRotationVector.pop(),i=Math.round(this.lastSize.pop()),r=this.lastDepth.pop(),a=this.lastBackDistance.pop(),s=this.xDim/this.zDim;for(this.point=new j.U(0,0,0),this.queue=[],this.queue.push(this.point);this.queue.length>0;){this.point=this.queue.pop();var n=this.point.clone();if(n.z*=s,n.applyAxisAngle(new j.U(1,0,0),t.x),n.applyAxisAngle(new j.U(0,1,0),t.y),n.applyAxisAngle(new j.U(0,0,1),t.z),!(Math.sqrt(n.x*n.x+n.y*n.y)>i||n.z>r||n.z<a))for(var o=0,l=this.point.x-1;l<=this.point.x+1;l++)for(var m=this.point.y-1;m<=this.point.y+1;m++)for(var u=this.point.z-1;u<=this.point.z+1;u++){var h=e.x+Math.round(l),c=e.y+Math.round(m),d=e.z+Math.round(u);o=h+c*this.xDim+d*this.xDim*this.xDim,0===this.bufferMask[o]&&(this.bufferMask[o]=255,this.queue.push(new j.U(l,m,u)))}}this.updatableTextureMask.needsUpdate=!0}}}]),e}(),_e=function(){function e(){Object(u.a)(this,e),this.transferFunc=null,this.xDim=0,this.yDim=0,this.zDim=0,this.bufferTextureCPU=null,this.eraser=null}return Object(h.a)(e,[{key:"initRenderer",value:function(e,t){var i=this;this.sceneBlur=new j.L;this.numRois=256,this.cameraOrtho=new j.F(this.xDim/-2,this.xDim/2,this.yDim/2,this.yDim/-2,.1,100);var r=new X;this.context=r.createWebGLContext(),this.canvas3d=r.getCanvas(),this.rendererBlur=new j.X({canvas:this.canvas3d,context:this.context}),this.ambientTexture=new he({xDim:this.xDim,yDim:this.yDim,zDim:this.zDim,renderer:this.rendererBlur,scene:this.sceneBlur,camera:this.cameraOrtho}),console.log("rendererBlur done");var a=new j.I(1,1);this.rendererBlur.setSize(this.xDim,this.yDim),this.transferFunc=new ce,this.transferFunc.init(e,t);var s=new j.U(1/this.xDim,1/this.yDim,1/this.zDim);(new ee).create(this.origVolumeTex,this.RoiVolumeTex,s,this.transferFunc.texRoiColor,this.transferFunc.texRoiId,(function(t){var r=new j.z(a,t);t.uniforms.volumeSizeZ.value=i.zDim,t.uniforms.xDim.value=i.xDim,t.uniforms.yDim.value=i.yDim,t.defines.useWebGL2=i.isWebGL2,i.material=t,i.sceneBlur.add(r),!1===e?i.switchToBlurRender():i.switchToRoiMapRender(),console.log("isRoiVolume: ".concat(e)),i.setVolumeTexture(.8)})),this.vectorsTex=null}},{key:"createTransferFuncTexture",value:function(){return null!==this.transferFunc?this.transferFunc.createTransferFuncTexture():null}},{key:"setTransferFuncColors",value:function(e){this.transferFunc.setTransferFuncColors(e)}},{key:"updateTransferFuncTexture",value:function(e,t){return this.transferFunc.updateTransferFuncTexture(e,t)}},{key:"switchToRoiMapRender",value:function(){this.material.defines.renderRoiMap=1,this.material.needsUpdate=!0}},{key:"switchToBlurRender",value:function(){this.material.defines.renderRoiMap=0,this.material.needsUpdate=!0}},{key:"setVolumeTexture",value:function(e){this.material&&"undefined"!==typeof this.material?(console.log("blur material NOT null"),this.setVolumeTextureWebGL2(e),this.updatableTexture.needsUpdate=!0):console.log("blur material null")}},{key:"updateVolumeTextureWithMask",value:function(){null===this.eraser.bufferMask&&console.log("volTextureMask null");for(var e=0;e<this.zDim;e++)for(var t=e*this.xDim*this.yDim,i=0;i<this.yDim;i++)for(var r=i*this.xDim,a=0;a<this.xDim;a++){var s=a+r+t,n=this.arrPixels[s],o=s;this.zDim>5&&(0===e||e===this.zDim-1||0===this.eraser.bufferMask[s])&&(n=0),this.bufferR[o]=n}this.origVolumeTex.needsUpdate=!0,this.setVolumeTexture(1)}},{key:"setVolumeTextureWebGL2",value:function(e){this.material.uniforms.blurSigma.value=e,this.material.uniforms.blurSigma.needsUpdate=!0;for(var t=new Uint8Array(4*this.xDim*this.yDim),i=this.rendererBlur.getContext(),r=1;r<this.zDim-1;++r){this.material.uniforms.curZ.value=r/this.zDim,this.material.uniforms.curZ.needsUpdate=!0,this.rendererBlur.render(this.sceneBlur,this.cameraOrtho,this.bufferTexture),i.readPixels(0,0,this.xDim,this.yDim,i.RGBA,i.UNSIGNED_BYTE,t);var a=r*this.xDim*this.yDim;if(this.isRoiVolume)for(var s=0;s<this.yDim;s++)for(var n=0;n<this.xDim;n++){var o=4*(n+s*this.xDim),l=o+4*a;this.bufferTextureCPU[l]=t[o],this.bufferTextureCPU[l+1]=t[o+1],this.bufferTextureCPU[l+2]=t[o+2],this.bufferTextureCPU[l+3]=t[o+3]}else for(var m=0;m<this.yDim;m++)for(var u=0;u<this.xDim;u++)this.bufferTextureCPU[u+m*this.xDim+a]=t[4*(u+m*this.xDim)]}}},{key:"set3DTextureFrom1Byte",value:function(){this.bufferTextureCPU=new Uint8Array(this.xDim*this.yDim*this.zDim),this.bufferR=new Uint8Array(this.xDim*this.yDim*this.zDim);for(var e=0;e<this.zDim;e++)for(var t=e*this.xDim*this.yDim,i=0;i<this.yDim;i++)for(var r=i*this.xDim,a=0;a<this.xDim;a++){var s=a+r+t,n=this.arrPixels[s+0],o=s;this.zDim>5&&(0===e||e===this.zDim-1)&&(n=0),this.bufferR[o+0]=n,this.bufferTextureCPU[o+0]=n}console.log("setBufferRgbaFrom1Bytes for 3d texture")}},{key:"set3DTextureFrom4Bytes",value:function(){this.isRoiVolume&&(this.bufferRoi=new Uint8Array(this.xDim*this.yDim*this.zDim),this.bufferTextureCPU=new Uint8Array(4*this.xDim*this.yDim*this.zDim),console.log("ROI")),this.bufferR=new Uint8Array(this.xDim*this.yDim*this.zDim);for(var e=0;e<this.zDim;e++)for(var t=e*this.xDim*this.yDim,i=0;i<this.yDim;i++)for(var r=i*this.xDim,a=0;a<this.xDim;a++){var s=a,n=4*(s+r+t),o=this.arrPixels[n+0],l=this.arrPixels[n+3],m=s+r+t;a<2||a>this.xDim-4||i<2||i>this.yDim-4||e<2||e>this.zDim-4?this.bufferR[m+0]=0:this.bufferR[m+0]=o,this.bufferTextureCPU[4*m+0]=o,this.bufferTextureCPU[4*m+1]=o,this.bufferTextureCPU[4*m+2]=o,this.bufferTextureCPU[4*m+3]=o,this.bufferRoi[m+0]=l}console.log("setBufferRgbaFrom4Bytes for 3D texture")}},{key:"createRoiColorMap",value:function(e){return this.transferFunc.createRoiColorMap(e)}},{key:"createSelectedRoiMap",value:function(){return this.createSelectedRoiMap()}},{key:"updateSelectedRoiMap",value:function(e){this.transferFunc.updateSelectedRoiMap(e),this.setVolumeTexture(1)}},{key:"updateSelectedRoi",value:function(e,t){this.transferFunc.updateSelectedRoi(e,t),this.setVolumeTexture(1)}},{key:"createUpdatableVolumeTex",value:function(e,t,i){this.isWebGL2=1,this.arrPixels=e.m_dataArray;var r=e.m_xDim,a=e.m_yDim,s=e.m_zDim;this.xDim=r,this.yDim=a,this.zDim=s,this.isRoiVolume=t,this.RoiVolumeTex=null,t?(this.set3DTextureFrom4Bytes(),this.RoiVolumeTex=new j.l(this.bufferRoi,this.xDim,this.yDim,this.zDim),this.RoiVolumeTex.format=j.K,this.RoiVolumeTex.type=j.S,this.RoiVolumeTex.wrapS=j.g,this.RoiVolumeTex.wrapT=j.g,this.RoiVolumeTex.magFilter=j.B,this.RoiVolumeTex.minFilter=j.B,this.RoiVolumeTex.needsUpdate=!0):this.set3DTextureFrom1Byte(),this.bufferTexture=new j.W(this.xDim,this.yDim,{minFilter:j.v,magFilter:j.v,format:j.J,type:j.S,depthBuffer:!1}),this.origVolumeTex&&this.origVolumeTex.dispose(),this.origVolumeTex=new j.l(this.bufferR,this.xDim,this.yDim,this.zDim),this.origVolumeTex.format=j.K,this.origVolumeTex.type=j.S,this.origVolumeTex.wrapR=j.g,this.origVolumeTex.wrapS=j.g,this.origVolumeTex.wrapT=j.g,this.origVolumeTex.magFilter=j.B,this.origVolumeTex.minFilter=j.B,this.origVolumeTex.needsUpdate=!0;var n=j.K;return t&&(n=j.J),this.updatableTexture=new j.l(this.bufferTextureCPU,this.xDim,this.yDim,this.zDim),this.updatableTexture.format=n,this.updatableTexture.type=j.S,this.updatableTexture.wrapR=j.g,this.updatableTexture.wrapS=j.g,this.updatableTexture.wrapT=j.g,this.updatableTexture.magFilter=j.v,this.updatableTexture.minFilter=j.v,this.zDim>1&&this.initRenderer(t,i),this.updatableTexture.needsUpdate=!0,this.eraser=new de,this.updatableTexture}},{key:"createUpdatableVolumeMask",value:function(e){return this.eraser.createUpdatableVolumeMask(e,this.bufferTextureCPU)}}]),e}(),fe=function(){function e(){Object(u.a)(this,e),this.m_palette=[{name:"amygdala",roiColor:"0.247059 0.584314 0.270588 1",roiId:139,position:"right",isBrain:!0},{name:"amygdala",roiColor:"0.309804 0.929412 0.054902 1",roiId:118,position:"left",isBrain:!0},{name:"angular gyrus",roiColor:"0.686275 0.231373 0.152941 1",roiId:19,position:"right",isBrain:!0},{name:"angular gyrus",roiColor:"0.811765 0.486275 0.117647 1",roiId:159,position:"left",isBrain:!0},{name:"anterior limb of internal capsule",roiColor:"0.309804 0.203922 0.462745 1",roiId:128,position:"right",isBrain:!0},{name:"anterior limb of internal capsule",roiColor:"0.435294 0.733333 0.027451 1",roiId:43,position:"left",isBrain:!0},{roiColor:"0.937255 0.94902 0.513725 1",roiId:20,name:"brain stem",isBrain:!0},{name:"caudate nucleus",roiColor:"0.74902 0.278431 0.141176 1",roiId:53,position:"right",isBrain:!0},{name:"caudate nucleus",roiColor:"0.184314 0.0745098 0.356863 1",roiId:39,position:"left",isBrain:!0},{name:"cerebellum",roiColor:"0.811765 0.458824 0.952941 1",roiId:76,position:"right",isBrain:!0},{name:"cerebellum",roiColor:"0.247059 0.113725 0.843137 1",roiId:67,position:"left",isBrain:!0},{name:"cingulate region",roiColor:"0.623529 0.45098 0.666667 1",roiId:7,position:"right",isBrain:!0},{name:"cingulate region",roiColor:"0.937255 0.631373 0.505882 1",roiId:27,position:"left",isBrain:!0},{roiColor:"0.937255 0.301961 0.470588 1",roiId:133,name:"corpus callosum",isBrain:!0},{name:"cuneus",roiColor:"0.435294 0.513725 0.768627 1",roiId:175,position:"right",isBrain:!0},{name:"cuneus",roiColor:"0.937255 0.729412 0.192157 1",roiId:54,position:"left",isBrain:!0},{name:"fornix",roiColor:"0.937255 0.415686 0.847059 1",roiId:254,position:"right",isBrain:!0},{name:"fornix",roiColor:"0.811765 0.67451 0.980392 1",roiId:29,position:"left",isBrain:!0},{roiColor:"0.247059 0.466667 0.105882 1",roiId:233,name:"fourth ventricle",isBrain:!0},{name:"frontal lobe WM",roiColor:"0.560784 0.290196 0.215686 1",roiId:17,position:"right",isBrain:!0},{name:"frontal lobe WM",roiColor:"0.498039 0.662745 0.101961 1",roiId:30,position:"left",isBrain:!0},{name:"globus palladus",roiColor:"0.0588235 0.843137 0.168627 1",roiId:11,position:"right",isBrain:!0},{name:"globus palladus",roiColor:"0.247059 0.74902 0.447059 1",roiId:12,position:"left",isBrain:!0},{name:"hippocampal formation",roiColor:"0.498039 0.709804 0.619608 1",roiId:36,position:"right",isBrain:!0},{name:"hippocampal formation",roiColor:"0.121569 0.4 0.972549 1",roiId:101,position:"left",isBrain:!0},{name:"inferior frontal gyrus",roiColor:"0.247059 0.85098 0.0666667 1",roiId:75,position:"right",isBrain:!0},{name:"inferior frontal gyrus",roiColor:"0.937255 0.662745 0.329412 1",roiId:15,position:"left",isBrain:!0},{name:"inferior occipital gyrus",roiColor:"0.0588235 0.643137 0.643137 1",roiId:97,position:"right",isBrain:!0},{name:"inferior occipital gyrus",roiColor:"0.247059 0.411765 0.568627 1",roiId:37,position:"left",isBrain:!0},{name:"inferior temporal gyrus",roiColor:"0.247059 0.00392157 0.796078 1",roiId:140,position:"right",isBrain:!0},{name:"inferior temporal gyrus",roiColor:"0.87451 0.819608 0.541176 1",roiId:164,position:"left",isBrain:!0},{name:"insula",roiColor:"0.623529 0.886275 0.356863 1",roiId:4,position:"right",isBrain:!0},{name:"insula",roiColor:"0.560784 0.698039 0.12549 1",roiId:108,position:"left",isBrain:!0},{name:"lateral front-orbital gyrus",roiColor:"0.435294 0.501961 0.203922 1",roiId:6,position:"right",isBrain:!0},{name:"lateral front-orbital gyrus",roiColor:"1 0.8 0.00784314 1",roiId:90,position:"left",isBrain:!0},{name:"lateral occipitotemporal gyrus",roiColor:"0.0588235 0.027451 0.470588 1",roiId:99,position:"right",isBrain:!0},{name:"lateral occipitotemporal gyrus",roiColor:"0.937255 0.101961 0.913725 1",roiId:196,position:"left",isBrain:!0},{name:"lateral ventricle",roiColor:"0.435294 0.176471 0.568627 1",roiId:8,position:"right",isBrain:!0},{name:"lateral ventricle",roiColor:"0.74902 0.764706 0.247059 1",roiId:3,position:"left",isBrain:!0},{name:"lingual gyrus",roiColor:"0.435294 0.458824 0.47451 1",roiId:112,position:"right",isBrain:!0},{name:"lingual gyrus",roiColor:"0.811765 0.0941176 0.301961 1",roiId:69,position:"left",isBrain:!0},{name:"medial front-orbital gyrus",roiColor:"0.87451 0.364706 0.384314 1",roiId:1,position:"right",isBrain:!0},{name:"medial front-orbital gyrus",roiColor:"0.811765 0.160784 0.247059 1",roiId:85,position:"left",isBrain:!0},{name:"medial frontal gyrus",roiColor:"0.435294 0.615686 0.0705882 1",roiId:114,position:"right",isBrain:!0},{name:"medial frontal gyrus",roiColor:"0.184314 0.372549 0.423529 1",roiId:9,position:"left",isBrain:!0},{name:"medial occipitotemporal gyrus",roiColor:"0.247059 0.368627 0.211765 1",roiId:165,position:"right",isBrain:!0},{name:"medial occipitotemporal gyrus",roiColor:"1 0.843137 0.254902 1",roiId:119,position:"left",isBrain:!0},{name:"middle frontal gyrus",roiColor:"0.623529 0.905882 0.113725 1",roiId:2,position:"right",isBrain:!0},{name:"middle frontal gyrus",roiColor:"0.686275 0.0901961 0.811765 1",roiId:50,position:"left",isBrain:!0},{name:"middle occipital gyrus",roiColor:"0.686275 0.933333 0.698039 1",roiId:63,position:"right",isBrain:!0},{name:"middle occipital gyrus",roiColor:"0.435294 0.0588235 0.964706 1",roiId:154,position:"left",isBrain:!0},{name:"middle temporal gyrus",roiColor:"0.937255 0.498039 0.67451 1",roiId:130,position:"right",isBrain:!0},{name:"middle temporal gyrus",roiColor:"0.498039 0.768627 0.439216 1",roiId:64,position:"left",isBrain:!0},{name:"nucleus accumbens",roiColor:"1 0.807843 0.529412 1",roiId:25,position:"right",isBrain:!0},{name:"nucleus accumbens",roiColor:"0.0588235 0.65098 0.0509804 1",roiId:72,position:"left",isBrain:!0},{name:"occipital lobe WM",roiColor:"0.0588235 0.368627 0.552941 1",roiId:45,position:"right",isBrain:!0},{name:"occipital lobe WM",roiColor:"0.0588235 0.639216 0.839216 1",roiId:73,position:"left",isBrain:!0},{name:"occipital pole",roiColor:"0.74902 0.494118 0.419608 1",roiId:132,position:"right",isBrain:!0},{name:"occipital pole",roiColor:"0.247059 0.807843 0.74902 1",roiId:251,position:"left",isBrain:!0},{name:"parahippocampal gyrus",roiColor:"0.121569 0.847059 0.00392157 1",roiId:125,position:"right",isBrain:!0},{name:"parahippocampal gyrus",roiColor:"0.247059 0.0705882 0.321569 1",roiId:18,position:"left",isBrain:!0},{name:"parietal lobe WM",roiColor:"1 0.4 0.223529 1",roiId:105,position:"right",isBrain:!0},{name:"parietal lobe WM",roiColor:"0.309804 0.678431 0.639216 1",roiId:57,position:"left",isBrain:!0},{name:"postcentral gyrus",roiColor:"0.560784 0.478431 0.2 1",roiId:110,position:"right",isBrain:!0},{name:"postcentral gyrus",roiColor:"0.498039 0.576471 0.027451 1",roiId:74,position:"left",isBrain:!0},{name:"posterior limb of internal capsule inc. cerebral peduncle",roiColor:"1 0.917647 0.576471 1",roiId:35,position:"right",isBrain:!0},{name:"posterior limb of internal capsule inc. cerebral peduncle",roiColor:"0.435294 0.490196 0.0784314 1",roiId:34,position:"left",isBrain:!0},{name:"precentral gyrus",roiColor:"0.184314 0.709804 0.615686 1",roiId:5,position:"right",isBrain:!0},{name:"precentral gyrus",roiColor:"0.87451 0.560784 1 1",roiId:80,position:"left",isBrain:!0},{name:"precuneus",roiColor:"1 0.654902 0.223529 1",roiId:32,position:"right",isBrain:!0},{name:"precuneus",roiColor:"1 0 0.211765 1",roiId:56,position:"left",isBrain:!0},{name:"putamen",roiColor:"1 0.831373 0.227451 1",roiId:16,position:"right",isBrain:!0},{name:"putamen",roiColor:"0.372549 0.678431 0.32549 1",roiId:14,position:"left",isBrain:!0},{name:"subthalamic nucleus",roiColor:"0.184314 0.545098 0.619608 1",roiId:23,position:"right",isBrain:!0},{name:"subthalamic nucleus",roiColor:"0.309804 0.686275 0.243137 1",roiId:33,position:"left",isBrain:!0},{name:"superior frontal gyrus",roiColor:"0.87451 0.380392 0.768627 1",roiId:10,position:"right",isBrain:!0},{name:"superior frontal gyrus",roiColor:"1 0.113725 0.396078 1",roiId:70,position:"left",isBrain:!0},{name:"superior occipital gyrus",roiColor:"0.372549 0.0431373 0.537255 1",roiId:38,position:"right",isBrain:!0},{name:"superior occipital gyrus",roiColor:"0.623529 0.301961 0.2 1",roiId:98,position:"left",isBrain:!0},{name:"superior parietal lobule",roiColor:"0.247059 0.843137 0.407843 1",roiId:88,position:"right",isBrain:!0},{name:"superior parietal lobule",roiColor:"0.87451 0.533333 0.254902 1",roiId:52,position:"left",isBrain:!0},{name:"superior temporal gyrus",roiColor:"0.498039 0.721569 0.996078 1",roiId:145,position:"right",isBrain:!0},{name:"superior temporal gyrus",roiColor:"1 0.67451 0.45098 1",roiId:61,position:"left",isBrain:!0},{name:"supramarginal gyrus",roiColor:"0.87451 0.45098 0.270588 1",roiId:60,position:"right",isBrain:!0},{name:"supramarginal gyrus",roiColor:"0.623529 0.0235294 0.654902 1",roiId:41,position:"left",isBrain:!0},{name:"temporal lobe WM",roiColor:"0.498039 0.603922 0.768627 1",roiId:59,position:"right",isBrain:!0},{name:"temporal lobe WM",roiColor:"0.87451 0.411765 0.368627 1",roiId:83,position:"left",isBrain:!0},{name:"thalamus",roiColor:"0.0588235 0.796078 0.866667 1",roiId:203,position:"right",isBrain:!0},{name:"thalamus",roiColor:"0.74902 0.984314 0.341176 1",roiId:102,position:"left",isBrain:!0},{roiColor:"0.811765 0.258824 0.823529 1",roiId:232,name:"third ventricle",isBrain:!0},{name:"uncus",roiColor:"0.121569 0.352941 0.196078 1",roiId:26,position:"right",isBrain:!0},{name:"uncus",roiColor:"0.623529 0.117647 0.14902 1",roiId:62,position:"left",isBrain:!0},{name:"xxx_brain_internal",roiColor:"0.8 0.8 0.1 1",roiId:150,position:"left",isBrain:!0},{name:"xxx_brain_core",roiColor:"0.2 0.8 0.2 1",roiId:250,position:"left",isBrain:!0}],this.createBytePalette256()}return Object(h.a)(e,[{key:"createBytePalette256",value:function(){var e;for(this.m_palette256=new Uint8Array(1024),e=0;e<1024;e++)this.m_palette256[e]=0;var t=this.m_palette.length;for(e=0;e<t;e++){var i=this.m_palette[e].roiId,r=this.m_palette[e].roiColor.split(" "),a=Math.floor(255*parseFloat(r[0])),s=Math.floor(255*parseFloat(r[1])),n=Math.floor(255*parseFloat(r[2])),o=4*parseInt(i,10);this.m_palette256[o+0]=a,this.m_palette256[o+1]=s,this.m_palette256[o+2]=n,this.m_palette256[o+3]=255}}},{key:"getPalette",value:function(){return this.m_palette}},{key:"getPalette256",value:function(){return this.m_palette256}}]),e}(),ve="72px Arial",pe=function(){function e(){Object(u.a)(this,e),this.m_textWidth=0,this.m_textHeight=0,this.m_canvas=document.createElement("canvas"),this.m_ctx=this.m_canvas.getContext("2d")}return Object(h.a)(e,[{key:"drawText",value:function(t,i){this.m_canvas.width=1024,this.m_canvas.height=512,this.m_ctx.fillStyle="rgba(255, 255, 255, 0)";this.m_ctx.fillRect(0,0,512,128),this.m_ctx.font=ve,this.m_ctx.fillStyle=i,this.m_ctx.strokeStyle=i,this.m_ctx.textAlign="left",this.m_ctx.textBaseline="top",this.m_ctx.lineWidth=2;var r=0===t.length?"?":t;this.m_textWidth=Math.floor(this.m_ctx.measureText(r).width),this.m_textHeight=e.getFontHeight(ve),this.m_canvas.width=e.ceilPowerOfTwo(this.m_textWidth),this.m_canvas.height=e.ceilPowerOfTwo(this.m_textHeight),this.m_ctx.fillStyle="rgba(255, 255, 255, 0)",this.m_ctx.fillRect(0,0,this.m_canvas.width,this.m_canvas.height),this.m_ctx.font=ve,this.m_ctx.fillStyle=i,this.m_ctx.strokeStyle=i,this.m_ctx.textAlign="left",this.m_ctx.textBaseline="top",this.m_ctx.fillText(r,0,0)}},{key:"width",get:function(){return this.m_canvas.width}},{key:"height",get:function(){return this.m_canvas.height}},{key:"textWidth",get:function(){return this.m_textWidth}},{key:"textHeight",get:function(){return this.m_textHeight}}],[{key:"getFontHeight",value:function(e){var t=document.getElementsByTagName("body")[0],i=document.createElement("div"),r=document.createTextNode("GyW~ig^");i.appendChild(r),i.setAttribute("style","font:".concat(e,";position:absolute;top:0;left:0")),t.appendChild(i);var a=i.offsetHeight;return t.removeChild(i),a}},{key:"ceilPowerOfTwo",value:function(e){for(var t=1;t<30;t++){var i=1<<t;if(i>=e)return i}return-1}}]),e}(),ge=function(e){Object(S.a)(i,e);var t=Object(x.a)(i);function i(e){var r;return Object(u.a)(this,i),(r=t.call(this)).m_canvas=new pe,r.m_align=new j.T(0,0),r.m_side=j.n,r.m_antialias=!0,r.m_text=e,r}return Object(h.a)(i,[{key:"getText",value:function(){return this.m_text}},{key:"setText",value:function(e){this.m_text!==e&&(this.m_text=e,this.updateText())}},{key:"getFont",value:function(){return this.m_font}},{key:"updateText",value:function(){console.log("Use virtual method for ".concat(this.m_text))}},{key:"cleanUp",value:function(){this.texture&&this.texture.dispose()}},{key:"applyAntiAlias",value:function(){!1===this.antialias&&(this.texture.magFilter=j.B,this.texture.minFilter=j.w)}}]),i}(j.D),Se=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment="",this.m_uniforms={texture1:{type:"t",value:null}},this.m_strShaderVertex="\n      varying vec3 vecNormal;\n      varying vec3 vecPos;\n      varying vec2 vecUV;\n      void main() {\n        vecPos = position;\n        vecNormal = normal;\n        vecUV = uv;\n        gl_Position = vec4(position, 1.0);\n      }\n    ",this.m_strShaderFragment="\n      varying vec3 vecNormal;\n      varying vec3 vecPos;\n      varying vec2 vecUV;\n\n      uniform sampler2D texture1;\n\n      void main() {\n        vec2 texCoord = vecUV;\n        vec4 vColTex = texture2D(texture1, texCoord, 0.0);\n        float sum = (vColTex.x + vColTex.y + vColTex.z) / 3.0;\n        if (sum < 20.0 / 256.0)\n          discard;\n        gl_FragColor = vec4(vColTex.x, vColTex.y, vColTex.z, sum);\n      }\n    "}return Object(h.a)(e,[{key:"create",value:function(e){this.m_uniforms.texture1.value=e,this.m_material=new j.M({blending:j.i,blendEquation:j.a,blendSrc:j.P,blendDst:j.E,uniforms:this.m_uniforms,vertexShader:this.m_strShaderVertex,fragmentShader:this.m_strShaderFragment}),this.m_material.needsUpdate=!0}}]),e}(),xe=function(e){Object(S.a)(i,e);var t=Object(x.a)(i);function i(e){var r;return Object(u.a)(this,i),(r=t.call(this,e)).m_mesh=null,r.m_material=null,r.m_renderedTextHeight=0,r.m_xMin=3,r.m_xMax=-3,r.m_yMin=3,r.m_yMax=-3,r}return Object(h.a)(i,[{key:"getRenderedTextHeight",value:function(){return this.m_renderedTextHeight}},{key:"updateText",value:function(e,t,r,a,s,n,o){var l=this;this.cleanUp(),null!==this.m_mesh&&(this.remove(this.m_mesh),this.m_mesh=null,this.m_material=null),this.m_canvas.drawText(this.m_text,o),this.m_renderedTextHeight=r;var m=r,u=m*(this.m_canvas.m_textWidth/this.m_canvas.m_textHeight);if(this.m_texture=new j.Q(this.m_canvas.m_canvas),this.m_texture.needsUpdate=!0,null===this.m_material){this.m_matTexturePlain=new Se,this.m_matTexturePlain.create(this.m_texture),this.m_material=this.m_matTexturePlain.m_material,this.m_material.blending=j.i,this.m_material.blendEquation=j.a,this.m_material.blendSrc=j.P,this.m_material.blendDst=j.E,this.m_geometry=new j.s;var h=this.m_canvas.m_textWidth/this.m_canvas.m_canvas.width,c=this.m_canvas.m_textHeight/this.m_canvas.m_canvas.height;this.m_xMin=i.getXMin(e,a,u),this.m_xMax=i.getXMax(e,a,u),this.m_yMin=i.getYMin(t,s,m),this.m_yMax=i.getYMax(t,s,m);var d=.05,_=new j.U(this.m_xMin,this.m_yMin,d),f=new j.U(this.m_xMax,this.m_yMin,d),v=new j.U(this.m_xMin,this.m_yMax,d),p=new j.U(this.m_xMax,this.m_yMax,d);this.m_geometry.vertices.push(_),this.m_geometry.vertices.push(f),this.m_geometry.vertices.push(v),this.m_geometry.vertices.push(p),this.m_geometry.faceVertexUvs[0].push([new j.T(0,1-c),new j.T(h,1-c),new j.T(0,1)]),this.m_geometry.faceVertexUvs[0].push([new j.T(h,1),new j.T(0,1),new j.T(h,1-c)]);var g=new j.U;j.R.getNormal(_,f,v,g),this.m_geometry.faces.push(new j.o(0,1,2,g)),this.m_geometry.faces.push(new j.o(3,2,1,g)),this.m_mesh=new j.z(this.m_geometry,this.m_material),this.add(this.m_mesh);var S=document.createElement("canvas"),x=S.getContext("2d");S.width=32,S.height=32,x.fillStyle=n,x.fillRect(0,0,S.width,S.height);var y=new j.Q(S);y.needsUpdate=!0,this.m_matTextureBox=new Se,this.m_matTextureBox.create(y,(function(e){l.m_boxMaterial=e;var t=.06;l.m_boxGeometry=new j.s;var i,r=new j.U(l.m_xMin,l.m_yMin,t),a=new j.U(l.m_xMax,l.m_yMin,t),s=new j.U(l.m_xMin,l.m_yMax,t),n=new j.U(l.m_xMax,l.m_yMax,t);l.m_boxGeometry.vertices.push(r),l.m_boxGeometry.vertices.push(a),l.m_boxGeometry.vertices.push(s),l.m_boxGeometry.vertices.push(n),j.R.getNormal(r,a,s,i),l.m_boxGeometry.faces.push(new j.o(0,1,2,i)),l.m_boxGeometry.faces.push(new j.o(3,2,1,i)),l.m_boxMesh=new j.z(l.m_boxGeometry,l.m_boxMaterial),l.add(l.m_boxMesh)}))}else this.m_material.map=this.m_texture}}],[{key:"getXMin",value:function(e,t,r){return t===i.ALIGN_LEFT?e:t===i.ALIGN_RIGHT?e-r:t===i.ALIGN_CENTER?e-.5*r:0}},{key:"getXMax",value:function(e,t,r){return t===i.ALIGN_LEFT?e+r:t===i.ALIGN_RIGHT?e:t===i.ALIGN_CENTER?e+.5*r:0}},{key:"getYMin",value:function(e,t,r){return t===i.ALIGN_TOP?e-r:t===i.ALIGN_BOTTOM?e:t===i.ALIGN_CENTER?e-.5*r:0}},{key:"getYMax",value:function(e,t,r){return t===i.ALIGN_TOP?e:t===i.ALIGN_BOTTOM?e+r:t===i.ALIGN_CENTER?e+.5*r:0}}]),i}(ge);xe.ALIGN_LEFT=0,xe.ALIGN_RIGHT=1,xe.ALIGN_TOP=2,xe.ALIGN_BOTTOM=3,xe.ALIGN_CENTER=4;var ye=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment=""}return Object(h.a)(e,[{key:"create",value:function(){return this.m_strShaderVertex="\n      void main() {\n        gl_Position = vec4(position, 1.0);\n      }\n    ",this.m_strShaderFragment="\n      void main() {\n        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n      }\n    ",new j.M({vertexShader:this.m_strShaderVertex,fragmentShader:this.m_strShaderFragment,wireframe:!0})}}]),e}(),be=.11,Te=function(){function e(t,i,r,a,s,n,o){Object(u.a)(this,e),this.createWithMaterial(t,i,r,a,s,n,o),this.m_xS=r,this.m_yS=a,this.m_xE=s,this.m_yE=n}return Object(h.a)(e,[{key:"createWithMaterial",value:function(e,t,i,r,a,s,n){this.m_scene=e,this.m_lineWidth=t;var o=new j.T(a-i,s-r),l=new j.T(+o.y,-o.x);l.normalize(),l.multiplyScalar(t);var m=new j.U(i-l.x,r-l.y,be),u=new j.U(i+l.x,r+l.y,be),h=new j.U(a-l.x,s-l.y,be),c=new j.U(a+l.x,s+l.y,be);this.m_geo=new j.s,this.m_geo.vertices.push(m),this.m_geo.vertices.push(u),this.m_geo.vertices.push(h),this.m_geo.vertices.push(c);var d=new j.U(0,0,1);this.m_geo.faces.push(new j.o(0,1,3,d)),this.m_geo.faces.push(new j.o(3,2,0,d)),this.m_mesh=new j.z(this.m_geo,n),this.m_scene.add(this.m_mesh),console.log("Line added to scene: ".concat(i,",").concat(r," -> ").concat(a,",").concat(s," "))}},{key:"getRenderObject",value:function(){return this.m_mesh}},{key:"getxS",value:function(){return this.m_xS}},{key:"getyS",value:function(){return this.m_yS}},{key:"getxE",value:function(){return this.m_xE}},{key:"getyE",value:function(){return this.m_yE}}]),e}(),Oe=function(){function e(t,i){Object(u.a)(this,e),this.m_scene=t,this.m_lineWidth=i,this.m_runningState=!1,this.m_xPixelSize=-1,this.m_yPixelSize=-1;var r=new ye;this.m_linesMaterial=r.create(),this.m_distances=[],this.m_vertexes=[],this.m_xStart=-1,this.m_yStart=-1,this.m_textWidthScr=.03,this.m_textColor="rgba(255, 255, 255, 255)",this.m_textBgColor="rgb(65, 65, 65)",this.m_zoom=1}return Object(h.a)(e,[{key:"clearLines",value:function(){for(var e=this.m_distances.length,t=0;t<e;++t){var i=this.m_distances.pop();this.m_scene.remove(i.line.getRenderObject()),this.m_scene.remove(i.text)}this.m_runningState=!1,this.m_vertexes=[]}},{key:"updateLines",value:function(e,t,i){for(var r=this.m_distances.length,a=0;a<r;++a){this.m_scene.remove(this.m_distances[a].line.getRenderObject()),this.m_scene.remove(this.m_distances[a].text);var s=(this.m_vertexes[2*a].xZ-t)/e-(1-1/e),n=(this.m_vertexes[2*a].yZ-i)/e+(1-1/e);if(null==this.m_vertexes[2*a+1])break;var o=(this.m_vertexes[2*a+1].xZ-t)/e-(1-1/e),l=(this.m_vertexes[2*a+1].yZ-i)/e+(1-1/e),m=new Te(this.m_scene,this.m_lineWidth,s,n,o,l,this.m_linesMaterial);this.m_distances[a].line=m,this.m_distances[a].text.updateText(.5*(s+o)-0,.5*(n+l)-0,this.m_textWidthScr,xe.ALIGN_CENTER,xe.ALIGN_CENTER,this.m_textBgColor,this.m_textColor),this.m_scene.add(this.m_distances[a].text)}}},{key:"updateZoom",value:function(e){this.m_zoom=e}},{key:"setPixelSize",value:function(e,t){this.m_xPixelSize=e,this.m_yPixelSize=t}},{key:"isRunning",value:function(){return this.m_runningState}},{key:"onMouseDown",value:function(e,t,i,r,a){this.m_runningState=!this.m_runningState;var s=(e+(1-1/i))*i+r,n=(t-(1-1/i))*i+a;if(this.m_runningState){this.m_xStart=e,this.m_yStart=t;var o=new Te(this.m_scene,this.m_lineWidth,e,t,e,t,this.m_linesMaterial),l=new xe("0 mm");l.updateText(e,t,this.m_textWidthScr,xe.ALIGN_CENTER,xe.ALIGN_CENTER,this.m_textBgColor,this.m_textColor),this.m_scene.add(l),this.m_distances.push({line:o,text:l}),this.m_vertexes.push({xZ:s,yZ:n})}else this.m_vertexes.push({xZ:s,yZ:n}),this.m_xStart=-1,this.m_yStart=-1}},{key:"test",value:function(){new Te(this.m_scene,this.m_lineWidth,-1,1,-.5,.5,this.m_linesMaterial)}},{key:"onMouseMove",value:function(e,t,i){if(this.m_runningState){var r=this.m_distances.pop();this.m_scene.remove(r.line.getRenderObject());var a=new Te(this.m_scene,this.m_lineWidth,this.m_xStart,this.m_yStart,e,t,this.m_linesMaterial);this.m_scene.remove(r.text);var s="".concat((i*Math.sqrt((e-this.m_xStart)*(e-this.m_xStart)*this.m_xPixelSize*this.m_xPixelSize+(t-this.m_yStart)*(t-this.m_yStart)*this.m_yPixelSize*this.m_yPixelSize)).toFixed(2)," mm"),n=new xe(s);n.updateText(.5*(e+this.m_xStart)-0,.5*(t+this.m_yStart)-0,this.m_textWidthScr,xe.ALIGN_CENTER,xe.ALIGN_CENTER,this.m_textBgColor,this.m_textColor),this.m_scene.add(n),this.m_distances.push({line:a,text:n})}}},{key:"updateVertexes",value:function(e,t,i){this.m_vertexes=[];for(var r=0;r<this.m_distances.length;++r){var a=(this.m_distances[r].line.getxS()+(1-1/e))*e+t,s=(this.m_distances[r].line.getyS()-(1-1/e))*e+i;this.m_vertexes.push({xZ:a,yZ:s}),a=(this.m_distances[r].line.getxE()+(1-1/e))*e+t,s=(this.m_distances[r].line.getyE()-(1-1/e))*e+i,this.m_vertexes.push({xZ:a,yZ:s})}}}]),e}(),De="distance",Re="angle",we="area",je="rect",Xe="text",Ee="grad",Ie="cobr",Ae="bifi",Me="zoom",Ce="delete",Fe="edit",Ve=function(){function e(t,i,r){Object(u.a)(this,e),this.m_width=i,this.m_height=r,this.m_material=null,this.m_mesh=null,console.log("Graphics2d create size = ".concat(i," * ").concat(r)),this.m_scene=t,this.m_materialsTex2d=null,this.m_material=null,this.m_zoom=1,this.m_savePosX=0,this.m_savePosY=0,this.m_posX=0,this.m_posY=0,this.m_move=!1,this.m_wProjScreen=i,this.m_hProjScreen=r,this.m_showTileTexture=!1;var a=1/i,s=1/r;this.m_lineWidth=2*(a>s?a:s),this.m_lineWidth=.002,this.m_textTime=-1e3,this.m_text=null,this.m_toolType=De,this.m_distanceTool=new Oe(this.m_scene,this.m_lineWidth)}return Object(h.a)(e,[{key:"set2dToolType",value:function(e){this.m_toolType=e}},{key:"onFileLoaded",value:function(){this.m_distanceTool.clearLines(),this.m_angleTool.clearLines(),this.m_areaTool.clearLines(),this.m_rectTool.clearLines(),this.m_textTool.clear(),this.m_deleteTool.clearLines(),this.m_editTool.clearLines()}},{key:"clear2DTools",value:function(){this.m_distanceTool.clearLines(),this.m_angleTool.clearLines(),this.m_areaTool.clearLines(),this.m_rectTool.clearLines(),this.m_textTool.clear(),this.m_deleteTool.clearLines(),this.m_editTool.clearLines()}},{key:"default2DTools",value:function(){this.m_zoom=1,this.m_posX=0,this.m_posY=0,this.m_savePosX=0,this.m_savePosY=0,this.m_materialsTex2d.m_uniforms.posX.value=this.m_posX,this.m_materialsTex2d.m_uniforms.posY.value=this.m_posY,this.m_materialsTex2d.m_uniforms.zoom.value=this.m_zoom,this.updateLines()}},{key:"fov2Tan",value:function(e){return Math.tan(j.x.degToRad(.5*e))}},{key:"tan2Fov",value:function(e){return 2*j.x.radToDeg(Math.atan(e))}},{key:"onKeyDown",value:function(e,t){}},{key:"onMouseDown",value:function(e,t){if(null!==this.m_volumeData&&null!==this.m_volumeHeader&&!(e>this.m_wProjScreen||t>this.m_hProjScreen)&&!this.m_levelSetMode){var i=2*e-1,r=2*t-1;switch(this.m_toolType){case De:this.m_distanceTool.onMouseDown(i,r,this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen);break;case Re:this.m_angleTool.onMouseDown(i,r,this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen);break;case Xe:this.m_textTool.onMouseDown(i,r,this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen);break;case we:this.m_areaTool.onMouseDown(i,r,this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen);break;case je:this.m_rectTool.onMouseDown(i,r,this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen);break;case Ee:case Ie:case Ae:break;case Me:this.m_move=!0,this.m_moveTool.onMouseDown(i,r);break;case Ce:this.m_deleteTool.onMouseDown(i,r,this.m_distanceTool.m_distances,this.m_angleTool.m_angles,this.m_rectTool.m_areas,this.m_areaTool.m_distances,this.m_textTool.m_textArr,this.m_distanceTool.m_vertexes,this.m_angleTool.m_vertexes,this.m_rectTool.m_vertexes,this.m_areaTool.m_vertexes2,this.m_areaTool.m_last_lengths,this.m_areaTool.m_vertexes,this.m_areaTool,this.m_textTool.m_vertexes),console.log("".concat(this.m_areaTool.last_length));break;case Fe:this.m_editTool.onMouseDown();break;default:console.log("Unexpected 2d tool")}}}},{key:"onMouseUp",value:function(e,t){if(null!==this.m_volumeData&&null!==this.m_volumeHeader&&!(e>this.m_wProjScreen||t>this.m_hProjScreen)){var i=2*e-1,r=2*t-1;if(this.m_levelSetMode)return null!==this.m_levelSetCircle&&this.clearLevelSetCenter(),void this.drawLevelSetCenter(i,r);switch(this.m_toolType){case De:case Re:case we:case je:case Xe:case Ie:case Ae:break;case Me:this.m_move=!1,this.m_moveTool.onMouseUp(),this.m_savePosX=this.m_posX,this.m_savePosY=this.m_posY;break;case Ce:break;case Fe:this.m_editTool.onMouseUp();break;default:console.log("Unexpected 2d tool")}}}},{key:"onMouseMove",value:function(e,t){if(null!==this.m_volumeData&&null!==this.m_volumeHeader&&!(e>this.m_wProjScreen||t>this.m_hProjScreen)){var i=2*e-1,r=2*t-1;switch(this.m_toolType){case De:this.m_distanceTool.onMouseMove(i,r,this.m_zoom);break;case Re:this.m_angleTool.onMouseMove(i,r);break;case we:this.m_areaTool.onMouseMove(i,r);break;case je:this.m_rectTool.onMouseMove(i,r,this.m_zoom);break;case Xe:case Ee:case Ie:case Ae:break;case Me:this.m_move&&this.updateMove(i,r);break;case Ce:this.m_deleteTool.onMouseMove(i,r,this.m_zoom,this.m_distanceTool.m_distances,this.m_angleTool.m_angles,this.m_rectTool.m_areas,this.m_areaTool.m_distances,this.m_textTool.m_textArr);break;case Fe:this.m_editTool.onMouseMove(i,r,this.m_zoom,this.m_distanceTool.m_distances,this.m_angleTool.m_angles,this.m_rectTool.m_areas,this.m_areaTool.m_distances,this.m_areaTool,this.m_textTool,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen),this.m_distanceTool.updateVertexes(this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen),this.m_angleTool.updateVertexes(this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen);break;default:console.log("Unexpected 2d tool")}}}},{key:"onMouseWheel",value:function(e){switch(this.m_toolType){case De:case Re:case we:case je:case Xe:case Ie:case Ae:break;case Me:this.m_zoomTool.onMouseWheel(e),this.updateZoom(),this.createMarkLinesAndText();break;case Ce:case Fe:break;default:console.log("Unexpected 2d tool")}}},{key:"updateLines",value:function(){this.m_distanceTool.updateLines(this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen),this.m_angleTool.updateLines(this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen),this.m_rectTool.updateLines(this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen),this.m_textTool.updateAll(this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen),this.m_areaTool.updateLines(this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen),this.m_deleteTool.updateLines(this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen),this.m_editTool.updateLines(this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen)}},{key:"updateMove",value:function(e,t){var i=2-2*this.m_zoom,r=this.m_moveTool.onMouseMove(e,t);this.m_savePosX+r.x<=Math.abs(i)&&this.m_savePosX+r.x>0?(this.m_posX=this.m_savePosX+r.x,this.m_materialsTex2d.m_uniforms.posX.value=this.m_posX):this.m_savePosX+r.x>Math.abs(i)?(this.m_posX=Math.abs(i),this.m_materialsTex2d.m_uniforms.posX.value=this.m_posX):(this.m_posX=0,this.m_materialsTex2d.m_uniforms.posX.value=this.m_posX),this.m_savePosY+r.y>=-1*Math.abs(i)&&this.m_savePosY+r.y<0?(this.m_posY=this.m_savePosY+r.y,this.m_materialsTex2d.m_uniforms.posY.value=this.m_posY):this.m_savePosY+r.y<-1*Math.abs(i)?(this.m_posY=-1*Math.abs(i),this.m_materialsTex2d.m_uniforms.posY.value=this.m_posY):(this.m_posY=0,this.m_materialsTex2d.m_uniforms.posY.value=this.m_posY),this.updateLines()}},{key:"updateZoom",value:function(){this.m_materialsTex2d.m_uniforms.zoom.value=this.m_zoomTool.m_zoom,this.m_zoom=this.m_zoomTool.m_zoom;var e=2-2*this.m_zoom;this.m_posX>e&&(this.m_posX=e,this.m_materialsTex2d.m_uniforms.posX.value=this.m_posX),this.m_posY<-1*e&&this.m_posY<0&&(this.m_posY=-1*e,this.m_materialsTex2d.m_uniforms.posY.value=this.m_posY),this.updateLines()}},{key:"updateText",value:function(){}}],[{key:"shortenString",value:function(e){var t=e,i=e.length;if(i>20){var r=e.substring(0,6),a=e.substring(i-5,i);t="".concat(r,"...").concat(a)}return t}}]),e}(),Ue=.1,Pe=149/255,Ne=175/255,ke=205/255,Le=205/255,Be=149/255,ze=149/255,Ge=108/255,We=78/255,He=78/255,qe=.0025,Ye=.0033,Ze=.0025,Ke=.0029,Qe=175,Je=[-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$e=[-1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1],et=function(){function e(t){var i=this;Object(u.a)(this,e),this.curFileDataType=t.curFileDataType,this.sceneReadyCounter=0,this.renderCounter=0,this.scene=new j.L,this.sceneClipPlane=new j.L,this.scene23D=new j.L,this.graphics23d=null,this.sceneSphere=new j.L,this.meshSphere=null,this.newScene=new j.L,this.renderScene=0,this.planeGeometry=null,this.props=t,this.mesh=null,this.renderer=null,this.texTF=null,this.volTexture=null,this.origVolumeTex=null,this.texRoiId=null,this.texRoiColor=null,this.RoiVolumeTex=null,this.volTextureMask=null,this.texVolumeAO=null,this.bfTexture=null,this.ffTexture=null,this.renderToTexture=null,this.geometry=null,this.geometrySphere=null,this.geometryWireFrameSphere=null,this.matBF=null,this.matFF=null,this.matScreenTex=null,this.matWireFrame=null,this.matRenderToTexture=null,this.matVolumeRender=null,this.volumeUpdater=null,this.checkFrameBufferMode=0,this.eraserStarted=!1,this.lockEraserBuffersUpdating=!1,this.SPOTcolor=new j.U(1,0,0),this.volumeOpacity=1,this.showSolids=!0,this.dispatch=t.dispatch,this.volumeReady=!1,this.planeCenterPt=new j.U(-.5,-.5,.7);var r=new X;this.context=r.createWebGLContext(),this.isWebGL2=r.useWebGL2(),this.canvas3d=r.getCanvas(),this.renderer=new j.X({antialias:!1,canvas:this.canvas3d,preserveDrawingBuffer:!0,context:this.context}),this.renderer.autoClearStencil=!1,this.renderer.autoClearColor=!1,this.renderer||console.log("cant create 3d renderer"),this.windowWidth=Math.floor(t.width),this.windowHeight=Math.floor(t.height),console.log("Window: ".concat(this.windowWidth," x ").concat(this.windowHeight));var a=this.windowWidth/this.windowHeight;this.camera=new j.G(60,a,.01,3),this.camera.position.z=10,this.renderer.setSize(this.windowWidth,this.windowHeight),this.renderer.setClearColor(0),t.mount.appendChild(this.renderer.domElement),this.orbitControl=new I(this.renderer.domElement,this.camera,this.scene,this.mesh,(function(){i.updateCutPlanes(),i.updateLightDir()})),this.renderer.gammaInput=!0,this.renderer.gammaOutput=!0,this.RENDER_STATE={ENABLED:0,ONCE:1,DISABLED:2},this.renderState=this.RENDER_STATE.ENABLED,this.fps=0,this.isoThreshold=0,this.isEraseMode=!1,this.eraserRadius=10,this.eraserDepth=20,this.eraserSrart=!1,this.lockEraserBuffersUpdating=!1,this.eraserMouseDown=!1,this.m_eraser=null,this.isSculptingMode=!1,this.sculptingCapturedVertex=null,this.sculptingSphereCenter=new j.U(0,0,0),this.sculptingSphereSize=1,this.vBoxVirt={x:1,y:1,z:1}}return Object(h.a)(e,[{key:"setFileDataType",value:function(e){this.curFileDataType=e}},{key:"removeSphereFromSphereScene",value:function(){null!==this.meshSphere&&this.sceneSphere.remove(this.meshSphere),this.meshSphere=null,this.geometrySphere=null}},{key:"addSphereToSphereScene",value:function(){var e=new ue,t=new j.U(.5,.5,.5),i=e.create(t,2);if(i<1)return i;for(var r=e.getNumVertices(),a=e.getNumTriangles(),s=[],n=[],o=[],l=0;l<r;l++){var m=e.getVertex(l),u=new j.U(m.x,m.y,m.z);s.push(m.x,m.y,m.z),u.normalize(),o.push(u.x,u.y,u.z)}for(var h=0,c=0;h<a;h++,c+=3){var d=e.getTriangle(h);n.push(d[0],d[1],d[2])}this.geometrySphere=new j.f;var _=new Float32Array(s),f=new Float32Array(o),v=new Uint8Array(n);return this.geometrySphere.addAttribute("position",new j.e(_,3)),this.geometrySphere.addAttribute("normal",new j.e(f,3)),this.geometrySphere.setIndex(new j.e(v,1)),this.computeGeometrySphereUVs(),this.meshSphere=new j.z(this.geometrySphere),this.sceneSphere.add(this.meshSphere),this.meshSphere}},{key:"updateMeshSphere",value:function(){}},{key:"isVolumeLoaded",value:function(){return null!==this.matVolumeRender}},{key:"fov2Tan",value:function(e){return Math.tan(j.x.degToRad(.5*e))}},{key:"tan2Fov",value:function(e){return 2*j.x.radToDeg(Math.atan(e))}},{key:"screenshot",value:function(e,t){if(null===this.renderer)return null;var i=null;if("undefined"===typeof e)i=this.renderer.domElement.toDataURL("image/png");else{var r=this.camera.aspect,a=this.camera.fov,s=this.fov2Tan(this.camera.fov)*Math.min(this.windowWidth,this.windowHeight)/this.windowHeight,n=e/t;this.camera.aspect=n,this.camera.fov=this.tan2Fov(s/Math.min(n,1)),this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t),this.render(),i=this.renderer.domElement.toDataURL("image/png"),this.camera.aspect=r,this.camera.fov=a,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.windowWidth,this.windowHeight),this.render()}return i}},{key:"setMaskFlag",value:function(e){this.matVolumeRender.defines.MaskFlag=e,this.matVolumeRender.needsUpdate=!0,this.matRenderToTexture.defines.MaskFlag=e,this.matRenderToTexture.needsUpdate=!0}},{key:"switchToTool23D",value:function(e){this.Tool23D=e,this.Tool23D?this.graphics23d=new Ve(this.scene23D,this.windowWidth,this.windowHeight):this.graphics23d=null}},{key:"switchToVolumeRender",value:function(){null!==this.matVolumeRender&&null!==this.matRenderToTexture&&(this.isRoiVolume>0?(this.matVolumeRender.defines.isoRenderFlag=4,this.matVolumeRender.needsUpdate=!0,this.matRenderToTexture.defines.isoRenderFlag=4,this.matRenderToTexture.needsUpdate=!0,this.renderState=this.RENDER_STATE.ONCE):(this.matVolumeRender.defines.isoRenderFlag=0,this.matVolumeRender.needsUpdate=!0,this.matRenderToTexture.defines.isoRenderFlag=0,this.matRenderToTexture.needsUpdate=!0,this.renderState=this.RENDER_STATE.ONCE))}},{key:"switchToFullVolumeRender",value:function(){null!==this.matVolumeRender&&null!==this.matRenderToTexture&&(this.isRoiVolume>0?(this.matVolumeRender.defines.isoRenderFlag=4,this.matVolumeRender.needsUpdate=!0,this.matRenderToTexture.defines.isoRenderFlag=4,this.matRenderToTexture.needsUpdate=!0,this.renderState=this.RENDER_STATE.ONCE):(this.matVolumeRender.defines.isoRenderFlag=3,this.matVolumeRender.needsUpdate=!0,this.matRenderToTexture.defines.isoRenderFlag=3,this.matRenderToTexture.needsUpdate=!0,this.renderState=this.RENDER_STATE.ONCE))}},{key:"switchToIsosurfRender",value:function(){null!==this.matVolumeRender&&null!==this.matRenderToTexture&&(this.isRoiVolume>0?(this.matVolumeRender.defines.isoRenderFlag=5,this.matVolumeRender.needsUpdate=!0,this.matRenderToTexture.defines.isoRenderFlag=5,this.matRenderToTexture.needsUpdate=!0,this.renderState=this.RENDER_STATE.ONCE,this.volumeUpdater.switchToRoiMapRender()):(this.matVolumeRender.defines.isoRenderFlag=1,this.matVolumeRender.needsUpdate=!0,this.matRenderToTexture.defines.isoRenderFlag=1,this.matRenderToTexture.needsUpdate=!0,this.renderState=this.RENDER_STATE.ONCE))}},{key:"switchToFLATRender",value:function(){null!==this.matVolumeRender&&null!==this.matRenderToTexture&&(this.matVolumeRender.defines.isoRenderFlag=2,this.matVolumeRender.needsUpdate=!0,this.matRenderToTexture.defines.isoRenderFlag=2,this.matRenderToTexture.needsUpdate=!0,this.renderState=this.RENDER_STATE.ONCE)}},{key:"setIsoThresholdValue",value:function(e){null!==this.matVolumeRender&&null!==this.matRenderToTexture&&(this.matRenderToTexture.uniforms.isoThreshold.value=e,this.matRenderToTexture.uniforms.isoThreshold.needsUpdate=!0,this.matVolumeRender.uniforms.isoThreshold.value=e,this.matVolumeRender.uniforms.isoThreshold.needsUpdate=!0,this.isoThreshold=e,this.renderState=this.RENDER_STATE.ONCE)}},{key:"setVolumeOpacity",value:function(e){null!==this.matVolumeRender&&null!==this.matRenderToTexture&&(this.matRenderToTexture.uniforms.volumeOpacity.value=e,this.matRenderToTexture.uniforms.volumeOpacity.needsUpdate=!0,this.matVolumeRender.uniforms.volumeOpacity.value=e,this.matVolumeRender.uniforms.volumeOpacity.needsUpdate=!0,this.volumeOpacity=e,this.renderState=this.RENDER_STATE.ONCE)}},{key:"setSpotColor",value:function(e,t,i){null!==this.matVolumeRender&&null!==this.matRenderToTexture&&(this.matRenderToTexture.uniforms.SPOTcolor.value=new j.U(e,t,i),this.matRenderToTexture.uniforms.SPOTcolor.needsUpdate=!0,this.matVolumeRender.uniforms.SPOTcolor.value=new j.U(e,t,i),this.matVolumeRender.uniforms.SPOTcolor.needsUpdate=!0,this.SPOTcolor=new j.U(e,t,i),this.renderState=this.RENDER_STATE.ONCE)}},{key:"showVenousStructure",value:function(e){null!==this.matVolumeRender&&null!==this.matRenderToTexture&&(this.matRenderToTexture.uniforms.showSolids.value=e,this.matRenderToTexture.uniforms.showSolids.needsUpdate=!0,this.matVolumeRender.uniforms.showSolids.value=e,this.matVolumeRender.uniforms.showSolids.needsUpdate=!0,this.showSolids=e,this.renderState=this.RENDER_STATE.ONCE)}},{key:"setOpacityBarrier",value:function(e){null!==this.matVolumeRender&&null!==this.matRenderToTexture&&(this.matVolumeRender.uniforms.opacityBarrier.value=Qe*e,this.matVolumeRender.uniforms.opacityBarrier.needsUpdate=!0,this.matRenderToTexture.uniforms.opacityBarrier.value=Qe*e,this.matRenderToTexture.uniforms.opacityBarrier.needsUpdate=!0)}},{key:"updateBrightness",value:function(e){null!==this.matRenderToTexture&&(this.matRenderToTexture.uniforms.brightness3D.value=e,this.matRenderToTexture.uniforms.brightness3D.needsUpdate=!0),null!==this.matVolumeRender&&(this.matVolumeRender.uniforms.brightness3D.value=e,this.matVolumeRender.uniforms.brightness3D.needsUpdate=!0)}},{key:"updateContrast",value:function(e){null!==this.matVolumeRender&&null!==this.matRenderToTexture&&(this.matRenderToTexture.uniforms.contrast3D.value=e,this.matVolumeRender.uniforms.contrast3D.value=e,this.matRenderToTexture.uniforms.contrast3D.needsUpdate=!0,this.matVolumeRender.uniforms.contrast3D.needsUpdate=!0)}},{key:"setAmbientTextureMode",value:function(e){this.texVolumeAO&&this.texVolumeAO.dispose(),this.volumeUpdater.ambientTexture.set(this.volTexture,e),this.texVolumeAO=this.volumeUpdater.ambientTexture.get(),this.matRenderToTexture.defines.useAmbientTex=1,this.matVolumeRender.defines.useAmbientTex=1,this.matRenderToTexture.needsUpdate=!0,this.matVolumeRender.needsUpdate=!0,this.matRenderToTexture.uniforms.texVolumeAO.value=this.texVolumeAO,this.matRenderToTexture.uniforms.texVolumeAO.needsUpdate=!0,this.matVolumeRender.uniforms.texVolumeAO.value=this.texVolumeAO,this.matVolumeRender.uniforms.texVolumeAO.needsUpdate=!0}},{key:"offAmbientTextureMode",value:function(){this.texVolumeAO&&this.texVolumeAO.dispose(),this.matRenderToTexture.defines.useAmbientTex=0,this.matVolumeRender.defines.useAmbientTex=0,this.matRenderToTexture.needsUpdate=!0,this.matVolumeRender.needsUpdate=!0}},{key:"updateZCutPlane",value:function(e){this.planeCenterPt.z=1.4*e,this.updateCutPlanes()}},{key:"setTransferFuncVec3",value:function(e,t){null!==this.matRenderToTexture&&(this.matRenderToTexture.uniforms.t_function1min.value=0===t?new j.V(Ue,0,0,e[0]):new j.V(0,.8,0,e[0]),this.matRenderToTexture.uniforms.t_function1min.needsUpdate=!0,this.matRenderToTexture.uniforms.t_function1max.value=new j.V(Pe,Ne,ke,e[1]),this.matRenderToTexture.uniforms.t_function1max.needsUpdate=!0,this.matRenderToTexture.uniforms.t_function2min.value=new j.V(Le,Be,ze,e[2]),this.matRenderToTexture.uniforms.t_function2min.needsUpdate=!0,this.matRenderToTexture.uniforms.t_function2max.value=new j.V(Ge,We,He,e[2]),this.matRenderToTexture.uniforms.t_function2max.needsUpdate=!0,this.matRenderToTexture.uniforms.stepSize.value=new j.V(qe,Ye,Ze,Ke),this.matRenderToTexture.uniforms.stepSize.needsUpdate=!0,this.matVolumeRender.uniforms.t_function1min.value=0===t?new j.V(Ue,0,0,e[0]):new j.V(0,.8,0,e[0]),this.matVolumeRender.uniforms.t_function1min.needsUpdate=!0,this.matVolumeRender.uniforms.t_function1max.value=new j.V(Pe,Ne,ke,e[1]),this.matVolumeRender.uniforms.t_function1max.needsUpdate=!0,this.matVolumeRender.uniforms.t_function2min.value=new j.V(Le,Be,ze,e[2]),this.matVolumeRender.uniforms.t_function2min.needsUpdate=!0,this.matVolumeRender.uniforms.t_function2max.value=new j.V(Ge,We,He,e[2]),this.matVolumeRender.uniforms.t_function2max.needsUpdate=!0,this.matVolumeRender.uniforms.stepSize.value=new j.V(qe,Ye,Ze,Ke),this.matVolumeRender.uniforms.stepSize.needsUpdate=!0)}},{key:"computeGeometryUVs",value:function(e,t){this.geometry.computeBoundingBox();var i=this.geometry.boundingBox.max,r=this.geometry.boundingBox.min,a=new j.U(0-r.x,0-r.y,0-r.z),s=new j.U(i.x-r.x,i.y-r.y,i.z-r.z);this.geo_offset1=new j.U(0,0,0),this.geo_offset1=a,this.geo_offset2=new j.U(0,0,0),this.geo_offset2.x=e.x+.5,this.geo_offset2.y=e.y-.5,this.geo_offset2.z=e.z-.5,this.geo_scale=new j.U(0,0,0),this.geo_scale.x=(t.x-e.x)/s.x,this.geo_scale.y=(t.y-e.y)/s.y,this.geo_scale.z=(t.z-e.z)/s.z;for(var n=new Float32Array(3*this.geometry.getAttribute("position").count),o=0;o<this.geometry.getAttribute("position").count;o++){var l=this.geometry.getAttribute("position").getX(o),m=this.geometry.getAttribute("position").getY(o),u=this.geometry.getAttribute("position").getZ(o);n[3*o+0]=-l,n[3*o+1]=m,n[3*o+2]=u}this.geometry.addAttribute("uvw",new j.e(n,3)),this.geometry.getAttribute("uvw").needsUpdate=!0}},{key:"computeGeometrySphereUVs",value:function(){for(var e=new Float32Array(3*this.geometrySphere.getAttribute("position").count),t=0;t<this.geometrySphere.getAttribute("position").count;t++){var i=this.geometrySphere.getAttribute("position").getX(t),r=this.geometrySphere.getAttribute("position").getY(t),a=this.geometrySphere.getAttribute("position").getZ(t);e[3*t+0]=-i/this.vBoxVirt.x,e[3*t+1]=+r/this.vBoxVirt.y,e[3*t+2]=+a/this.vBoxVirt.z}this.geometrySphere.addAttribute("uvw",new j.e(e,3)),this.geometrySphere.getAttribute("uvw").needsUpdate=!0}},{key:"createClipPlaneGeometry",value:function(){var e=this;(new B).create(this.bfTexture,(function(t){e.planeGeometry=new j.H(2,2);var i=new j.z(e.planeGeometry,t);e.sceneClipPlane.add(i)}))}},{key:"updateClipPlaneGeometry",value:function(){var e=new Float32Array(3*this.planeGeometry.getAttribute("position").count),t=new j.y;t.getInverse(this.mesh.matrix);var i=new j.y;i.getInverse(this.camera.projectionMatrix);var r=new j.y;r.copy(this.camera.matrixWorld);for(var a=0;a<this.planeGeometry.getAttribute("position").count;a++){var s=new j.U;s.x=this.planeGeometry.getAttribute("position").getX(a),s.y=this.planeGeometry.getAttribute("position").getY(a),s.z=this.planeGeometry.getAttribute("position").getZ(a)+.001,s.applyMatrix4(i),s.applyMatrix4(r),s.applyMatrix4(t),e[3*a+0]=-s.x,e[3*a+1]=s.y,e[3*a+2]=s.z}this.planeGeometry.addAttribute("uvw",new j.e(e,3)),this.planeGeometry.getAttribute("uvw").needsUpdate=!0}},{key:"getScreen2WorldTransform",value:function(){var e=new j.y;e.getInverse(this.mesh.matrix);var t=new j.y;t.getInverse(this.camera.projectionMatrix);var i=new j.y;return i.copy(this.camera.matrixWorld),t.multiply(i),t.multiply(e),t}},{key:"initWithVolume",value:function(e,t,i,r,a,s){var n,o=this,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:.9,u=null===(n=this.mesh)||void 0===n?void 0:n.matrix,h=this.camera.clone(),c=t.x>t.y?t.x:t.y;c=t.z>c?t.z:c,this.vBoxVirt.x=t.x/c,this.vBoxVirt.y=t.y/c,this.vBoxVirt.z=t.z/c,this.isoThreshold=this.curFileDataType.thresholdIsosurf,this.volume=e,this.nonEmptyBoxMin=i,this.nonEmptyBoxMax=r,this.matWireFrame=null,this.removeSphereFromSphereScene();var d=new P;this.matWireFrame=d.create(this.bfTexture,this.ffTexture),this.addSphereToSphereScene(),this.renderScene=0,this.sceneReadyCounter=0,this.renderCounter=0;var _=null,f=null,v=null;if(this.sceneClipPlane&&(this.sceneClipPlane=new j.L),this.scene){null!==this.mesh&&this.scene.remove(this.mesh),null!==this.geometry&&this.geometry.dispose(),this.mesh=null,this.geometry=new j.f,this.geometry.fromGeometry(new j.d(1,1,1)),this.computeGeometryUVs(i,r),this.geometry.scale(this.vBoxVirt.x,this.vBoxVirt.y,this.vBoxVirt.z),this.camera.position.set(0,0,m),this.camera.lookAt(new j.U(0,0,0));var p=this.volume.m_xDim,g=this.volume.m_yDim,S=this.volume.m_zDim;console.log("3D tex size = ".concat(p," ").concat(g," ").concat(S)),this.volTexture&&this.volTexture.dispose(),this.eraserStarted=!1,this.isRoiVolume=a,this.roiPalette=null;var x=new fe;this.roiPalette=x.getPalette256();var y=4,b=250,T=0,O=1,D=2,X=this.roiPalette[b*y+T],E=this.roiPalette[b*y+O],I=this.roiPalette[b*y+D];if(console.log("RoiPalette: pal[250] = ".concat(I,", ").concat(E,", ").concat(X)),this.volumeUpdater=new _e,this.volTexture=this.volumeUpdater.createUpdatableVolumeTex(this.volume,a,this.roiPalette),this.origVolumeTex=this.volumeUpdater.origVolumeTex,this.texTF=this.volumeUpdater.createTransferFuncTexture(),this.volTextureMask&&this.volTextureMask.dispose(),this.texVolumeAO&&this.texVolumeAO.dispose(),this.renderer.getContext().getExtension("EXT_color_buffer_float")){this.bfTexture&&this.bfTexture.dispose(),this.bfTexture=new j.W(this.windowWidth,this.windowHeight,{minFilter:j.v,magFilter:j.v,format:j.J,type:j.q,depthBuffer:!0});var A=4;this.bufferBFTextureCPU=new Float32Array(A*this.windowWidth*this.windowHeight),this.ffTexture&&this.ffTexture.dispose(),this.ffTexture=new j.W(this.windowWidth,this.windowHeight,{minFilter:j.v,magFilter:j.v,format:j.J,type:j.q,depthBuffer:!0}),this.bufferFFTextureCPU=new Float32Array(A*this.windowWidth*this.windowHeight),this.renderfTexture&&this.renderToTexture.dispose();var M=3;this.xSmallTexSize=Math.floor(this.windowWidth/M),this.ySmallTexSize=Math.floor(this.windowHeight/M),this.renderToTexture=new j.W(this.xSmallTexSize,this.ySmallTexSize,{minFilter:j.B,magFilter:j.B,format:j.J,type:j.q,depthBuffer:!0}),this.bufferRenderToTextureCPU=new Float32Array(A*this.xSmallTexSize*this.ySmallTexSize)}else console.log("cant create float texture");if(this.createClipPlaneGeometry(),this.matWireFrame&&(this.matWireFrame.uniforms.texBF.value=this.bfTexture,this.matWireFrame.uniforms.texBF.needsUpdate=!0,this.matWireFrame.uniforms.texFF.value=this.ffTexture,this.matWireFrame.uniforms.texFF.needsUpdate=!0),v=new N,this.matScreenTex=v.create(this.ffTexture),(new C).create((function(e){o.matBF=e,o.sceneReadyCounter++})),(_=new U).m_uniforms.PlaneX.value=new j.V(-1,0,0,.5),_.m_uniforms.PlaneY.value=new j.V(0,-1,0,.5),_.m_uniforms.PlaneZ.value=new j.V(0,0,-1,.5),_.create(this.bfTexture.texture,(function(e){o.matFF=e,o.sceneReadyCounter++})),this.mesh=new j.z(this.geometry),l&&u)this.mesh.rotation.setFromRotationMatrix(u),this.camera.copy(h,!0),this.camera.updateMatrixWorld();else{var F=new j.y;F.identity(),F.set.apply(F,Je),this.mesh.rotation.setFromRotationMatrix(F),this.meshSphere&&this.meshSphere.rotation.setFromRotationMatrix(F)}this.orbitControl.setMesh(this.mesh),this.orbitControl.setWireMesh(this.meshSphere);for(var V=[],k=64,L=0;L<k;++L){var B=2*Math.random()-1,z=2*Math.random()-1,G=-Math.random();V.push(new j.U(B,z,G))}var H=["volumeOpacity","SPOTcolor","showSolids"],q=function(e){return e&&H.reduce((function(t,i){return Object(w.a)(Object(w.a)({},t),{},Object(R.a)({},i,e.m_uniforms[i]))}),{})},Z=function(e,t){return t&&Object.keys(t).forEach((function(i){return e.m_uniforms[i]=t[i]}))},K=q(this.matRenderToTextureThreeGS);this.matRenderToTextureThreeGS=new W,Z(this.matRenderToTextureThreeGS,K),this.matRenderToTextureThreeGS.m_uniforms.colorMap1D.value=this.colorMapTexture,this.matRenderToTextureThreeGS.create(this.texTF,this.volTexture,null,this.texVolumeAO,this.bfTexture.texture,this.ffTexture.texture,V,(function(e){e.uniforms.t_function1min.value=new j.V(Ue,0,0,o.curFileDataType.thresholdTissue1),e.uniforms.t_function1max.value=new j.V(Pe,Ne,ke,o.curFileDataType.thresholdTissue2),e.uniforms.t_function2min.value=new j.V(Le,Be,ze,o.curFileDataType.thresholdIsosurf),e.uniforms.t_function2max.value=new j.V(Ge,We,He,o.curFileDataType.thresholdIsosurf),e.uniforms.stepSize.value=new j.V(qe,Ye,Ze,Ke),e.uniforms.texSize.value=p,e.uniforms.isoThreshold.value=o.curFileDataType.thresholdIsosurf,e.uniforms.brightness3D.value=o.curFileDataType.brightness,e.uniforms.opacityBarrier.value=Qe*o.curFileDataType.opacityTissue,e.uniforms.volumeSizeZ.value=S,e.uniforms.xDim.value=p,e.uniforms.yDim.value=g,e.uniforms.lightDir.value=new j.U(o.curFileDataType.lightDirComp,o.curFileDataType.lightDirComp,o.curFileDataType.lightDirComp),e.uniforms.needsUpdate=!0,o.matRenderToTexture=e,o.sceneReadyCounter++}));var J=3;(f=new Y).m_uniforms.isoSurfTexel.value=new j.T(J/this.windowWidth,J/this.windowHeight),f.create(this.renderToTexture.texture,(function(e){e.uniforms.needsUpdate=!0,o.sceneReadyCounter++})),K=q(this.matSkullThreeGS),this.matSkullThreeGS=new Q,Z(this.matSkullThreeGS,K),this.matSkullThreeGS.m_uniforms.isoSurfTexel.value=new j.T(J/this.windowWidth,J/this.windowHeight),this.matSkullThreeGS.m_uniforms.colorMap1D.value=this.colorMapTexture,this.matSkullThreeGS.create(this.texTF,this.volTexture,null,this.texVolumeAO,this.bfTexture.texture,this.ffTexture.texture,this.renderToTexture.texture,V,(function(e){e.uniforms.t_function1min.value=new j.V(Ue,0,0,o.curFileDataType.thresholdTissue1),e.uniforms.t_function1max.value=new j.V(Pe,Ne,ke,o.curFileDataType.thresholdTissue2),e.uniforms.t_function2min.value=new j.V(Le,Be,ze,o.curFileDataType.thresholdIsosurf),e.uniforms.t_function2max.value=new j.V(Ge,We,He,o.curFileDataType.thresholdIsosurf),e.uniforms.stepSize.value=new j.V(qe,Ye,Ze,Ke),e.uniforms.texSize.value=p,e.uniforms.isoThreshold.value=o.curFileDataType.thresholdIsosurf,e.uniforms.brightness3D.value=o.curFileDataType.brightness,e.uniforms.volumeSizeZ.value=S,e.uniforms.xDim.value=p,e.uniforms.yDim.value=g,e.uniforms.opacityBarrier.value=Qe*o.curFileDataType.opacityTissue,e.uniforms.lightDir.value=new j.U(o.curFileDataType.lightDirComp,o.curFileDataType.lightDirComp,o.curFileDataType.lightDirComp),e.uniforms.needsUpdate=!0;var t=new j.A({color:16711680,shading:j.N});new j.z(new j.h(300,300,300),t).position.set(0,0,0),o.scene.add(o.mesh),o.matVolumeRender=e,s?o.switchToFLATRender():o.switchToVolumeRender(),o.mesh.material=o.matVolumeRender,o.meshSphere.material=o.matVolumeRender,o.sceneReadyCounter++}))}}},{key:"isSpinning",value:function(){return!this.orbitControl.autoRotateInterval}},{key:"setAutoSpin",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.setAnimate(e),e}},{key:"setAnimate",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.animateInterval&&(clearInterval(this.animateInterval),this.animateInterval=void 0),e&&(this.animateInterval=setInterval(this._animate.bind(this),1e3/30))}},{key:"_animate",value:function(){this.orbitControl._autoSpin()}},{key:"setTransferFuncColors",value:function(e){this.volumeUpdater.setTransferFuncColors(e)}},{key:"updateTransferFuncTexture",value:function(e,t){return this.volumeUpdater.updateTransferFuncTexture(e,t)}},{key:"updateSelectedRoiMap",value:function(e){this.volumeUpdater.updateSelectedRoiMap(e)}},{key:"updateCutPlanes",value:function(){if(this.mesh){var e=new j.y;1===this.renderScene?e.getInverse(e.extractRotation(this.meshSphere.matrix)):e.getInverse(e.extractRotation(this.mesh.matrix));var t=new j.U(-1,0,0),i=new j.U(0,-1,0),r=new j.U(0,0,-1),a=(new j.U).copy(this.planeCenterPt);a.applyMatrix4(e),t.applyMatrix4(e),i.applyMatrix4(e),r.applyMatrix4(e),null!==this.matFF&&(this.matFF.uniforms.PlaneX.value.x=t.x,this.matFF.uniforms.PlaneX.value.y=t.y,this.matFF.uniforms.PlaneX.value.z=t.z,this.matFF.uniforms.PlaneX.value.w=-a.dot(t),this.matFF.uniforms.PlaneY.value.x=i.x,this.matFF.uniforms.PlaneY.value.y=i.y,this.matFF.uniforms.PlaneY.value.z=i.z,this.matFF.uniforms.PlaneY.value.w=-a.dot(i),this.matFF.uniforms.PlaneZ.value.x=-r.x,this.matFF.uniforms.PlaneZ.value.y=r.y,this.matFF.uniforms.PlaneZ.value.z=r.z,this.matFF.uniforms.PlaneZ.value.w=-a.dot(r))}}},{key:"updateLightDir",value:function(){if(this.mesh){var e=new j.y;0===this.renderScene?e.getInverse(e.extractRotation(this.mesh.matrix)):e.getInverse(e.extractRotation(this.meshSphere.matrix));var t=new j.U(1,1,1);t.normalize(),t.applyMatrix4(e),t.x=-t.x,this.matRenderToTexture.uniforms.lightDir.value=t,this.matRenderToTexture.uniforms.lightDir.needsUpdate=!0,this.matVolumeRender.uniforms.lightDir.value=t,this.matVolumeRender.uniforms.lightDir.needsUpdate=!0}else console.log("UpdateLightDir call mesh is not created")}},{key:"setPresetView",value:function(e){var t=Je,i=new j.y;i.identity(),1===e&&(t=$e),i.set.apply(i,Object(p.a)(t)),this.mesh.rotation.setFromRotationMatrix(i),this.meshSphere&&this.meshSphere.rotation.setFromRotationMatrix(i)}},{key:"isReadyToRender",value:function(){return 5===this.sceneReadyCounter&&!(null===this.matVolumeRender||null===this.matBF||null===this.matFF||null===this.matRenderToTexture)}},{key:"render",value:function(){if(this.isReadyToRender())if(this.volumeReady||(this.dispatch({type:y.SET_LOADER,showLoader:!1}),this.volumeReady=!0),null!==this.matVolumeRender&&null!==this.matBF&&null!==this.matFF&&null!==this.matRenderToTexture){if(0===this.checkFrameBufferMode&&(this.checkFrameBufferMode=1),0===this.renderScene){this.updateLightDir(),this.updateClipPlaneGeometry(),this.updateCutPlanes(),this.renderer.setRenderTarget(this.bfTexture),this.renderer.clear(),this.renderer.state.buffers.depth.setClear(0),this.scene.overrideMaterial=this.matBF,this.renderer.render(this.scene,this.camera,this.bfTexture);var e=this.renderer.getContext();this.isEraseMode&&!this.lockEraserBuffersUpdating&&e.readPixels(0,0,this.windowWidth,this.windowHeight,e.RGBA,e.FLOAT,this.bufferBFTextureCPU),this.renderer.setRenderTarget(this.ffTexture),this.renderer.clear(),this.renderer.state.buffers.depth.setClear(1),this.renderer.render(this.sceneClipPlane,this.camera,this.ffTexture),this.scene.overrideMaterial=this.matFF,this.renderer.render(this.scene,this.camera,this.ffTexture),this.isEraseMode&&!this.lockEraserBuffersUpdating&&e.readPixels(0,0,this.windowWidth,this.windowHeight,e.RGBA,e.FLOAT,this.bufferFFTextureCPU),this.renderer.setRenderTarget(),this.renderer.clear(),this.renderer.state.buffers.depth.setClear(0),this.scene.overrideMaterial=this.matRenderToTexture,this.renderer.render(this.scene,this.camera,this.renderToTexture),this.isEraseMode&&!this.lockEraserBuffersUpdating&&e.readPixels(0,0,this.xSmallTexSize,this.ySmallTexSize,e.RGBA,e.FLOAT,this.bufferRenderToTextureCPU),this.scene.overrideMaterial=null,this.renderer.render(this.scene,this.camera),this.renderer.autoClearDepth=!1,this.Tool23D&&this.renderer.render(this.scene23D,this.camera),this.renderer.autoClearDepth=!0}this.renderCounter++}else;}},{key:"setStepsize",value:function(e){var t=1/(100+700*e);null!==this.matRenderToTexture&&(this.matRenderToTexture.uniforms.stepSize.value=new j.V(t,t,t,t),this.matRenderToTexture.uniforms.needsUpdate=!0),null!==this.matVolumeRender&&(this.matVolumeRender.uniforms.stepSize.value=new j.V(t,t,t,t),this.matVolumeRender.uniforms.needsUpdate=!0)}},{key:"getVertexProjectionToScreen",value:function(e,t){var i=e.clone();i.applyMatrix4(this.meshSphere.matrixWorld),i.project(this.camera);var r=.5*this.windowWidth,a=.5*this.windowHeight,s=r+r*i.x,n=a+a*i.y;t.x=s,t.y=n;var o=e.clone();return o.applyMatrix4(this.meshSphere.matrixWorld),o.applyMatrix3(this.camera.normalMatrix),o.z}},{key:"setEraserMode",value:function(e){if(this.isEraseMode=e,this.orbitControl.setEraserMode(e),!this.eraserStarted&&e){this.eraserStarted=!0;var t={xDim:this.volume.m_xDim,yDim:this.volume.m_yDim,zDim:this.volume.m_zDim,bufBF:this.bufferBFTextureCPU,bufFF:this.bufferFFTextureCPU,bufTex:this.bufferRenderToTextureCPU};this.volTextureMask=this.volumeUpdater.createUpdatableVolumeMask(t),this.matSkullThreeGS.m_uniforms.texVolumeMask.value=this.volTextureMask,this.matRenderToTextureThreeGS.m_uniforms.texVolumeMask.value=this.volTextureMask}e?this.setMaskFlag(1):this.setMaskFlag(0)}},{key:"undoEraser",value:function(){this.volumeUpdater.eraser.undoLastErasing()}},{key:"setEraserStart",value:function(e){this.eraserStart=e}},{key:"onMouseDown",value:function(e,t){this.Tool23D?this.graphics23d.onMouseDown(e/this.windowWidth,t/this.windowHeight):(this.orbitControl.onMouseDown(e,t),1===this.checkFrameBufferMode&&(this.renderState=this.RENDER_STATE.ENABLED,this.eraserMouseDown=!0,this.isEraseMode&&this.eraserStart&&(this.lockEraserBuffersUpdating=!0,this.volumeUpdater.eraser.eraseStart(e,t,this.windowWidth,this.matVolumeRender.uniforms.isoThreshold.value,!0))))}},{key:"onMouseMove",value:function(e,t){this.Tool23D?this.graphics23d.onMouseMove(e/this.windowWidth,t/this.windowHeight):1===this.checkFrameBufferMode&&(this.renderState=this.RENDER_STATE.ENABLED,this.isEraseMode&&this.eraserMouseDown&&this.eraserStart?this.volumeUpdater.eraser.eraseStart(e,t,this.windowWidth,this.matVolumeRender.uniforms.isoThreshold.value,!1):this.orbitControl.onMouseMove(e,t))}},{key:"onMouseUp",value:function(e,t){this.Tool23D?this.graphics23d.onMouseUp(e/this.windowWidth,t/this.windowHeight):(this.orbitControl.onMouseUp(),1===this.checkFrameBufferMode&&(this.lockEraserBuffersUpdating=!1,this.eraserMouseDown=!1,this.renderState=this.RENDER_STATE.ONCE))}},{key:"onMouseWheel",value:function(e){var t=Math.max(-1,Math.min(1,e.deltaY||-e.detail));this.orbitControl.onZoom(-t),1===this.checkFrameBufferMode&&(this.renderState=this.RENDER_STATE.ONCE)}}]),e}(),tt=function(e){Object(S.a)(i,e);var t=Object(x.a)(i);function i(e){var r;return Object(u.a)(this,i),(r=t.call(this,e)).onMode=r.onMode.bind(Object(g.a)(r)),r.isLoaded=!1,r.volume=null,r.start=r.start.bind(Object(g.a)(r)),r.stop=r.stop.bind(Object(g.a)(r)),r.animate=r.animate.bind(Object(g.a)(r)),r.renderScene=r.renderScene.bind(Object(g.a)(r)),r.setVolRenderToStore=r.setVolRenderToStore.bind(Object(g.a)(r)),r.m_mount=null,r.m_volumeRenderer3D=null,r.m_distanceTool=null,r.m_renderer=null,r.m_frameId=null,r.m_prevMode=O.RAYCAST,r.m_fileDataType={thresholdIsosurf:.46,thresholdTissue1:.09,thresholdTissue2:.3,opacityTissue:.53,startRotX:.5*-Math.PI,startRotY:Math.PI,lightDirComp:-.5773,brightness:.56},r.state={wRender:0,hRender:0},r}return Object(h.a)(i,[{key:"setVolRenderToStore",value:function(e){var t=this.props.dispatch;t({type:y.SET_VOLUME_Renderer,volumeRenderer:e}),t({type:y.SET_SLIDER_3DR,slider3d_r:Number.parseFloat(.09)}),t({type:y.SET_SLIDER_3DG,slider3d_g:Number.parseFloat(.3)}),t({type:y.SET_SLIDER_3DB,slider3d_b:Number.parseFloat(.46)}),t({type:y.SET_SLIDER_Opacity,sliderOpacity:Number.parseFloat(.53)}),t({type:y.SET_SLIDER_Isosurface,sliderIsosurface:Number.parseFloat(.46)}),t({type:y.SET_SLIDER_Brightness,sliderBrightness:Number.parseFloat(.56)}),t({type:y.SET_SLIDER_Cut,sliderCut:Number.parseFloat(1)}),t({type:y.SET_SLIDER_Quality,sliderQuality:Number.parseFloat(.35)})}},{key:"start",value:function(){null===this.m_frameId&&(this.m_frameId=requestAnimationFrame(this.animate))}},{key:"stop",value:function(){cancelAnimationFrame(this.m_frameId),this.m_frameId=null}},{key:"animate",value:function(){this.renderScene(),this.m_frameId=window.requestAnimationFrame(this.animate)}},{key:"renderScene",value:function(){null!==this.m_volumeRenderer3D&&this.m_volumeRenderer3D.render()}},{key:"onMode",value:function(e){this.props.dispatch({type:y.SET_MODE_3D,mode3d:e})}},{key:"componentDidMount",value:function(){this.props.dispatch({type:y.SET_LOADER,showLoader:!0});var e=this.m_mount.clientWidth>0?this.m_mount.clientWidth:200,t=this.m_mount.clientHeight>0?this.m_mount.clientHeight:200;0===this.state.wRender&&(this.setState({wRender:e}),this.setState({hRender:t}));var i=this.props,r=i.store,a=i.dispatch;if(null===this.m_volumeRenderer3D&&(this.m_volumeRenderer3D=new et({curFileDataType:this.m_fileDataType,width:e,height:t,mount:this.m_mount,dispatch:a})),this.setVolRenderToStore(this.m_volumeRenderer3D),null!==this.volume&&!1===this.isLoaded&&null!==this.m_volumeRenderer3D){var s=r.visState.volumeSet,n=r.visState.volumeIndex,o=4===s.getVolume(n).m_bytesPerVoxel,l=r.visState.mode3d===O.RAYFAST;this.m_volumeRenderer3D.initWithVolume(this.volume,this.volume.m_boxSize,{x:0,y:0,z:0},{x:1,y:1,z:1},o,l,r.doctorView.zoom,r.visState.volumeOpacity),this.isLoaded=!0}this.start(),this.m_mount.focus()}},{key:"componentDidUpdate",value:function(e){var t=e.store,i=this.props,r=i.store,a=i.dispatch;if(t.visState.volumeIndex!==r.visState.volumeIndex){this.isLoaded=!1,this.m_volumeRenderer3D.volumeReady&&(a({type:y.SET_LOADER,showLoader:!0}),this.m_volumeRenderer3D.volumeReady=!1),this.stop();var s=r.visState.volumeSet.getVolume(r.visState.volumeIndex);null!==s&&(this.volume=s);var n=r.visState.mode3d===O.RAYFAST,o=4===s.m_bytesPerVoxel;this.m_volumeRenderer3D.initWithVolume(this.volume,this.volume.m_boxSize,{x:0,y:0,z:0},{x:1,y:1,z:1},o,n,!0,r.doctorView.zoom,r.visState.volumeOpacity),this.m_volumeRenderer3D.setVolumeOpacity(r.visState.volumeOpacity),this.isLoaded=!0,this.start()}else if(t.visState.spotColor!==r.visState.spotColor){var l;(l=this.m_volumeRenderer3D).setSpotColor.apply(l,Object(p.a)(r.visState.spotColor))}else t.visState.volumeOpacity!==r.visState.volumeOpacity?this.m_volumeRenderer3D.setVolumeOpacity(r.visState.volumeOpacity):t.visState.showVenousStructure!==r.visState.showVenousStructure&&this.m_volumeRenderer3D.showVenousStructure(r.visState.showVenousStructure)}},{key:"componentWillUnmount",value:function(){this.stop(),null!==this.m_renderer&&this.m_mount.removeChild(this.m_renderer.domElement),this.m_volumeRenderer3D=null}},{key:"_onMouseMove",value:function(e){if(null!==this.m_volumeRenderer3D){var t=this.m_mount.getBoundingClientRect(),i=e.clientX-t.left,r=e.clientY-t.top;this.m_volumeRenderer3D.onMouseMove(i,-(this.state.hRender-r),this.props.ereaseStart)}}},{key:"_onMouseDown",value:function(e){if(null!==this.m_volumeRenderer3D){var t=this.m_mount.getBoundingClientRect(),i=e.clientX-t.left,r=e.clientY-t.top;this.m_volumeRenderer3D.onMouseDown(i,-(this.state.hRender-r),this.props.ereaseStart)}}},{key:"_onMouseUp",value:function(){null!==this.m_volumeRenderer3D&&this.m_volumeRenderer3D.onMouseUp()}},{key:"_onWheel",value:function(e){null!==this.m_volumeRenderer3D&&this.m_volumeRenderer3D.onMouseWheel(e)}},{key:"onClick",value:function(e){e.stopPropagation()}},{key:"onTouchStart",value:function(e){if(void 0!==this.m_mount&&null!==this.m_mount){var t=e.changedTouches,i=t.length;if(i>=2&&console.log("onTouchStart. numTouches == 2"),i>=1){var r=this.m_mount.getBoundingClientRect(),a=t[i-1].pageX-r.left,s=t[i-1].pageY-r.top;null!==this.m_volumeRenderer3D&&this.m_volumeRenderer3D.onMouseDown(a,this.state.hRender-s,this.props.ereaseStart)}}}},{key:"onTouchMove",value:function(e){if(void 0!==this.m_mount&&null!==this.m_mount){var t=e.changedTouches,i=t.length;if(i>=2&&console.log("onTouchStart. numTouches == 2"),i>=1){var r=this.m_mount.getBoundingClientRect(),a=t[i-1].pageX-r.left,s=t[i-1].pageY-r.top;null!==this.m_volumeRenderer3D&&this.m_volumeRenderer3D.onMouseMove(a,this.state.hRender-s,this.props.ereaseStart)}}}},{key:"onTouchEnd",value:function(){null!==this.m_volumeRenderer3D&&this.m_volumeRenderer3D.onMouseUp()}},{key:"render",value:function(){var e=this,t=this.props.store,i=null,a=t.visState.volumeSet;if(a&&a.getNumVolumes()>0){var s=t.visState.volumeIndex;i=a.getVolume(s)}null!==i&&(this.volume=i);var n=t.visState.mode3d,o=t.visState.modeView;null!==this.m_volumeRenderer3D&&(this.m_volumeRenderer3D.switchToTool23D(t.visState.isTool3D),o!==b.VIEW_3D?(n===O.RAYCAST&&(this.m_prevMode=O.RAYCAST,console.log("colors: ",t.visState.slider3d_r,t.visState.slider3d_g,t.visState.slider3d_b),this.m_volumeRenderer3D.switchToVolumeRender()),n===O.ISO&&(this.m_prevMode=O.ISO,this.m_volumeRenderer3D.switchToIsosurfRender(),this.m_volumeRenderer3D.setIsoThresholdValue(t.visState.sliderIsosurface)),n===O.RAYFAST&&(this.m_prevMode=O.RAYFAST,this.m_volumeRenderer3D.switchToFLATRender()),n===O.EREASER&&(this.m_prevMode=O.RAYFAST,this.m_volumeRenderer3D.switchToIsosurfRender(),this.m_volumeRenderer3D.setIsoThresholdValue(t.visState.sliderIsosurface),this.m_volumeRenderer3D.volumeUpdater.eraser.setEraserRadius(t.visState.sliderErRadius),this.m_volumeRenderer3D.volumeUpdater.eraser.setEraserDepth(t.visState.sliderErDepth))):this.m_volumeRenderer3D.switchToFullVolumeRender(),this.m_volumeRenderer3D.setVolumeOpacity(t.visState.volumeOpacity),this.m_volumeRenderer3D.setOpacityBarrier(t.visState.sliderOpacity),this.m_volumeRenderer3D.updateBrightness(t.visState.sliderBrightness),this.m_volumeRenderer3D.updateZCutPlane(t.visState.sliderCut-.5),this.m_volumeRenderer3D.setStepsize(t.visState.sliderQuality),this.m_volumeRenderer3D.updateContrast(t.visState.sliderContrast3D)),null!==this.m_volumeRenderer3D&&this.m_volumeRenderer3D.render();var l={width:"100%",height:"100%",opacity:this.isLoaded?"1":"0"},m=Object(r.jsx)("div",{style:l,ref:function(t){e.m_mount=t},onMouseMove:this._onMouseMove.bind(this),onMouseDown:this._onMouseDown.bind(this),onMouseUp:this._onMouseUp.bind(this),onTouchStart:this.onTouchStart.bind(this),onTouchEnd:this.onTouchEnd.bind(this),onTouchMove:this.onTouchMove.bind(this),className:"graphics-display",onClick:this.onClick.bind(this),onWheel:this._onWheel.bind(this)}),u=Object(r.jsx)("div",{width:"100%",height:"100%",ref:function(t){e.m_mount=t},onMouseMove:this._onMouseMove.bind(this),onMouseDown:this._onMouseDown.bind(this),onMouseUp:this._onMouseUp.bind(this),onTouchStart:this.onTouchStart.bind(this),onTouchEnd:this.onTouchEnd.bind(this),onTouchMove:this.onTouchMove.bind(this),onClick:this.onClick.bind(this),tabIndex:"1",className:"graphics-display",onWheel:this._onWheel.bind(this)});return this.state.wRender>0?u:m}}]),i}(s.a.Component),it=i(67),rt=function(e){Object(S.a)(i,e);var t=Object(x.a)(i);function i(e){var r;return Object(u.a)(this,i),(r=t.call(this,e)).m_xDim=0,r.m_yDim=0,r.m_zDim=0,r.m_bytesPerVoxel=0,r.m_dataArray=null,r.m_dataSize=0,r.m_boxSize={x:0,y:0,z:0},r.m_phase=0,r.m_xIcon=0,r.m_yIcon=0,r.m_dataIcon=null,r}return Object(h.a)(i,[{key:"createEmptyBytesVolume",value:function(e,t,i){this.m_xDim=e,this.m_yDim=t,this.m_zDim=i;var r=e*t*i;this.m_bytesPerVoxel=1,this.m_dataArray=new Uint8Array(r),this.m_dataSize=r,this.m_boxSize={x:e,y:t,z:i};for(var a=0;a<r;a++)this.m_dataArray[a]=0}},{key:"createIcon",value:function(){console.assert(this.m_xDim>0),console.assert(this.m_yDim>0),console.assert(this.m_zDim>0),console.assert(null!==this.m_dataArray);var e=this.m_xDim>this.m_yDim?this.m_xDim:this.m_yDim,t=e/64,i=Math.floor(this.m_zDim/2)*this.m_xDim*this.m_yDim;this.m_xIcon=64,this.m_yIcon=this.m_xIcon;var r=this.m_xIcon*this.m_yIcon;this.m_dataIcon=new Uint8Array(r);for(var a=0;a<r;a++)this.m_dataIcon[a]=0;for(var s=Math.floor(64*this.m_xDim/e),n=Math.floor(64*this.m_yDim/e),o=Math.floor(this.m_xIcon/2-s/2),l=Math.floor(this.m_yIcon/2-n/2),m=0;m<n;m++)for(var u=Math.floor(m*t),h=0;h<s;h++){var c=Math.floor(h*t),d=this.m_dataArray[c+u*this.m_xDim+i],_=h+o,f=m+l;this.m_dataIcon[_+f*this.m_xIcon]=d}}},{key:"makeDimensions4x",value:function(){if(!(this.m_zDim<4)){var e=this.m_xDim+3&-4,t=this.m_yDim+3&-4,i=this.m_zDim+3&-4;if(this.m_xDim!==e||this.m_yDim!==t||this.m_zDim!==i){console.log("Volume. makeDimensions4x. Convert into ".concat(e,"*").concat(t,"*").concat(i));var r,a=e*t*i,s=this.m_bytesPerVoxel,n=a*s,o=new Uint8Array(a*s);for(r=0;r<n;r++)o[r]=0;console.log("Volume info: xyzDim = ".concat(this.m_xDim,"*").concat(this.m_yDim,"*").concat(this.m_zDim)),console.log("Volume info: bpp = ".concat(this.m_bytesPerVoxel)),console.log("Volume info: dataSize = ".concat(this.m_dataSize));var l=this.m_xDim*this.m_yDim;if(1===this.m_bytesPerVoxel)for(var m=0;m<this.m_zDim;m++)for(var u=m*l,h=m*e*t,c=0;c<this.m_yDim;c++)for(var d=c*this.m_xDim,_=c*e,f=0;f<this.m_xDim;f++){var v=f+d+u,p=this.m_dataArray[v];o[f+_+h]=p}else if(4===this.m_bytesPerVoxel)for(var g=0;g<this.m_zDim;g++)for(var S=g*l,x=g*e*t,y=0;y<this.m_yDim;y++)for(var b=y*this.m_xDim,T=y*e,O=0;O<this.m_xDim;O++){var D=4*(O+b+S),R=this.m_dataArray[D+0],w=this.m_dataArray[D+1],j=this.m_dataArray[D+2],X=this.m_dataArray[D+3],E=4*(O+T+x);o[E+0]=R,o[E+1]=w,o[E+2]=j,o[E+3]=X}this.m_xDim=e,this.m_yDim=t,this.m_zDim=i,this.m_dataArray=o,this.m_dataSize=a}}}},{key:"render",value:function(){return Object(r.jsx)("p",{children:">"})}}]),i}(s.a.Component),at=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,null,[{key:"getResultString",value:function(t){switch(t){case e.SUCCESS:return"Success";case e.UNKNOWN:return"Unknown";case e.BAD_DICOM:return"Bad Dicom";case e.BAD_HEADER:return"Bad header";case e.UNSUPPORTED_ENDIANNESS:return"Unsupported endianness";case e.UNSUPPORTED_COLOR_FORMAT:return"Unsupported color format";case e.WRONG_HEADER_DATA_SIZE:return"Wrong header data size";case e.WRONG_HEADER_DIMENSIONS:return"Wrong header dimensions";case e.WRONG_HEADER_DATA_TYPE:return"Wrong header data type";case e.WRONG_HEADER_BITS_PER_PIXEL:return"Wrong header bits per pixel";case e.WRONG_HEADER_MAGIC:return"Wrong header magic";case e.ERROR_PROCESS_HISTOGRAM:return"Wrong histogram";case e.WRONG_IMAGE_DIM_X:return"Wrong image dim x";case e.WRONG_IMAGE_DIM_Y:return"Wrong image dim y";case e.WRONG_IMAGE_DIM_Z:return"Wrong image dim z";case e.ERROR_PIXELS_TAG_NOT_FOUND:return"Pixels tag is not found";case e.ERROR_NO_MEMORY:return"No memory during loading";case e.ERROR_CANT_OPEN_URL:return"Cant open file via url";case e.ERROR_WRONG_NUM_SLICES:return"Wrong number of slices";case e.ERROR_HISTOGRAM_DETECT_RIDGES:return"Error detect histogram ridges";case e.ERROR_SCALING:return"Error scaling 16 bit data into 8 bit";case e.ERROR_INVALID_SLICE_INDEX:return"Invalid slice index. Possible reason: incomplete dicom folder";case e.ERROR_TOO_SMALL_DATA_SIZE:return"Too small input data size";case e.ERROR_TOO_LARGE_DATA_SIZE:return"Too large input data size";case e.ERROR_COMPRESSED_IMAGE_NOT_SUPPORTED:return"Compressed image formats read is not supported";default:return"Unknown error code"}}}]),e}();at.SUCCESS=0,at.UNKNOWN=1,at.BAD_DICOM=2,at.BAD_HEADER=3,at.UNSUPPORTED_ENDIANNESS=4,at.UNSUPPORTED_COLOR_FORMAT=5,at.WRONG_HEADER_DATA_SIZE=6,at.WRONG_HEADER_DIMENSIONS=7,at.WRONG_HEADER_DATA_TYPE=8,at.WRONG_HEADER_BITS_PER_PIXEL=9,at.WRONG_HEADER_MAGIC=10,at.ERROR_PROCESS_HISTOGRAM=11,at.WRONG_IMAGE_DIM_X=12,at.WRONG_IMAGE_DIM_Y=13,at.ERROR_PIXELS_TAG_NOT_FOUND=14,at.ERROR_NO_MEMORY=15,at.ERROR_CANT_OPEN_URL=16,at.ERROR_WRONG_NUM_SLICES=17,at.ERROR_HISTOGRAM_DETECT_RIDGES=18,at.ERROR_SCALING=19,at.ERROR_INVALID_SLICE_INDEX=20,at.ERROR_TOO_SMALL_DATA_SIZE=21,at.ERROR_TOO_LARGE_DATA_SIZE=22,at.ERROR_COMPRESSED_IMAGE_NOT_SUPPORTED=23;var st,nt=null,ot=function(){function e(t){Object(u.a)(this,e),nt||(nt=this),this.m_url=t,this.m_request=null,this.readFile=this.readFile.bind(this)}return Object(h.a)(e,[{key:"readFile",value:function(e,t){var i=this;if(this.m_request=new XMLHttpRequest,this.m_request||console.log("Cant create object request"),!("withCredentials"in this.m_request))return this.m_request=null,void console.log("This browser cant support CORS requests");this.m_request.open("GET",this.m_url,!0),this.m_request.responseType="arraybuffer",this.m_request.addEventListener("load",(function(t){var i=t.target.response;if(null===i)console.log("Bad response type. Expect object type in response.");else if(e){var r=new TextDecoder("utf-8"),a=i.byteLength;a>4e3&&(a=4e3);var s=i.slice(0,a),n=r.decode(s);"<!DOCTYPE"===n.substr(0,9)&&console.log("Error load data from URL. Read result is "+n),e(i)}}),!1),this.m_request.addEventListener("error",(function(){var e="Error accessing file ".concat(i.m_url);t(e)}),!1),this.m_request.send();if(404===this.m_request.status){var r="Cant access url =  ".concat(this.m_url);t(r)}}}]),e}(),lt=6403,mt=6407,ut=6408,ht=function(){function e(){Object(u.a)(this,e),this.m_header={m_id:"",m_endianness:0,m_glType:0,m_glTypeSize:0,m_glFormat:0,m_glInternalFormat:0,m_glBaseInternalFormat:0,m_pixelWidth:0,m_pixelHeight:0,m_pixelDepth:0,m_numberOfArrayElements:0,m_numberOfFaces:0,m_numberOfMipmapLevels:0,m_bytesOfKeyValueData:0},this.m_boxSize={x:0,y:0,z:0}}return Object(h.a)(e,[{key:"readFromBuffer",value:function(t,i,r,a){var s=new Uint8Array(i),n=0;if(void 0!==r&&r(0),0===s.length)return void 0!==a&&a(at.BAD_HEADER),at.BAD_HEADER;var o,l=[171,75,84,88,32,49,49,187,13,10,26,10],m=l.length,u=!0;for(o=0;o<m;o++){if(s[n]!==l[o]){u=!1;break}this.m_header.m_id+=String.fromCharCode(s[n]),n+=1}if(!u)return console.log("KTX HEADER IS WRONG"),void 0!==a&&a(at.BAD_HEADER),at.BAD_HEADER;var h=67305985;if(this.m_header.m_endianness=e.readInt(s,n),n+=4,this.m_header.m_endianness!==h){var c=this.m_header.m_endianness.toString(16);return console.log("ENDIANNESS IS WRONG. Found = ".concat(c," , but should be = ").concat(h.toString(16))),void 0!==a&&a(at.UNSUPPORTED_ENDIANNESS),at.UNSUPPORTED_ENDIANNESS}if(this.m_header.m_glType=e.readInt(s,n),n+=4,this.m_header.m_glTypeSize=e.readInt(s,n),n+=4,this.m_header.m_glFormat=e.readInt(s,n),n+=4,this.m_header.m_glFormat!==lt&&this.m_header.m_glFormat!==mt&&this.m_header.m_glFormat!==ut)return console.log("KTX header.m_glFormat is WRONG"),void 0!==a&&a(at.UNSUPPORTED_COLOR_FORMAT),at.UNSUPPORTED_COLOR_FORMAT;this.m_header.m_glInternalFormat=e.readInt(s,n),n+=4,this.m_header.m_glBaseInternalFormat=e.readInt(s,n),n+=4,this.m_header.m_pixelWidth=e.readInt(s,n),n+=4,this.m_header.m_pixelHeight=e.readInt(s,n),n+=4,this.m_header.m_pixelDepth=e.readInt(s,n),n+=4,t.m_xDim=this.m_header.m_pixelWidth,t.m_yDim=this.m_header.m_pixelHeight,t.m_zDim=this.m_header.m_pixelDepth;var d=this.m_header,_=8192;if(d.m_pixelWidth<4||d.m_pixelHeight<4||d.m_pixelDepth<4)return console.log("KTX dims too small: ".concat(d.m_pixelWidth," * ").concat(d.m_pixelHeight," * ").concat(d.m_pixelDepth)),void 0!==a&&a(at.WRONG_IMAGE_DIM_X),at.WRONG_IMAGE_DIM_X;if(d.m_pixelWidth>_||d.m_pixelHeight>_||d.m_pixelDepth>_)return console.log("KTX dims too large: ".concat(d.m_pixelWidth," * ").concat(d.m_pixelHeight," * ").concat(d.m_pixelDepth)),void 0!==a&&a(at.WRONG_IMAGE_DIM_X),at.WRONG_IMAGE_DIM_X;this.m_header.m_numberOfArrayElements=e.readInt(s,n),n+=4,this.m_header.m_numberOfFaces=e.readInt(s,n),n+=4,this.m_header.m_numberOfMipmapLevels=e.readInt(s,n),n+=4,this.m_header.m_bytesOfKeyValueData=e.readInt(s,n),n+=4;var f=0;if(this.m_header.m_glFormat===lt?f=1:this.m_header.m_glFormat===mt?f=3:this.m_header.m_glFormat===ut&&(f=4),this.m_header.m_bytesOfKeyValueData>0){var v,p,g,S,x,y,b=n;for(n+=this.m_header.m_bytesOfKeyValueData;b<n;){var T="",O=void 0;for(O=s[b+=4];0!==O;b++)0!==(O=s[b])&&(T=T.concat(String.fromCharCode(O)));if(console.log("UDataString = ".concat(T)),"fBoxMin"===T)v=e.readFloat(s,b),b+=4,p=e.readFloat(s,b),b+=4,g=e.readFloat(s,b),b+=4,console.log("vBoxMix = ".concat(v," * ").concat(p," * ").concat(g));else if("fBoxMax"===T){S=e.readFloat(s,b),b+=4,x=e.readFloat(s,b),b+=4,y=e.readFloat(s,b),b+=4,this.m_boxSize.x=S-v,this.m_boxSize.y=x-p,this.m_boxSize.z=y-g,console.log("vBox = ".concat(this.m_boxSize.x," * ").concat(this.m_boxSize.y," * ").concat(this.m_boxSize.z));break}}}this.m_dataSize=e.readInt(s,n),n+=4;var D,R=this.m_header.m_pixelWidth*this.m_header.m_pixelHeight*this.m_header.m_pixelDepth*f;if(this.m_dataSize!==R)return console.log("!!! not implemented yet"),void 0!==a&&a(at.WRONG_HEADER_DATA_SIZE),at.WRONG_HEADER_DATA_SIZE;this.m_dataArray=new Uint8Array(this.m_dataSize);var w=!1;for(D=29;D>=0&&!w;D--){1<<D<this.m_dataSize&&(w=!0)}D++;(D-=3)<=0&&(D=1);for(var j=(1<<D)-1,X=0;X<this.m_dataSize;X++){if(this.m_dataArray[X]=s[n],n+=1,void 0!==r&&0===(X&j)&&X>0)r(X/this.m_dataSize)}if(0===this.m_boxSize.x){var E=.3;this.m_boxSize.x=E*this.m_header.m_pixelWidth,this.m_boxSize.x=E*this.m_header.m_pixelWidth,this.m_boxSize.y=E*this.m_header.m_pixelHeight,this.m_boxSize.z=E*this.m_header.m_pixelDepth,console.log("vBox = ".concat(this.m_boxSize.x," * ").concat(this.m_boxSize.y," * ").concat(this.m_boxSize.z))}return t.m_bytesPerVoxel=f,t.m_dataArray=this.m_dataArray,t.m_dataSize=this.m_dataSize,t.m_boxSize=this.m_boxSize,console.log("KTX Loaded successfully with dim = ".concat(t.m_xDim,"*").concat(t.m_yDim,"*").concat(t.m_zDim,". bpp=").concat(t.m_bytesPerVoxel)),this.m_isLoadedSuccessfull=!0,void 0!==r&&r(1),void 0!==a&&a(at.SUCCESS),at.SUCCESS}},{key:"readFromUrl",value:function(e,t,i,r){var a=this;console.log("LoadedKtx. staring read ".concat(t)),this.m_fileLoader=new ot(t),this.m_fileLoader.readFile((function(t){a.readFromBuffer(e,t,i,r)}),(function(e){console.log("LoaderKtx. Error read file: ".concat(e)),r(at.ERROR_CANT_OPEN_URL,null,0,null)}))}}],[{key:"readInt",value:function(e,t){for(var i=0,r=0;r<4;r++){i=(i<<8)+e[t+3-r]}return i}},{key:"readFloat",value:function(e,t){var i=new ArrayBuffer(4),r=new DataView(i);r.setUint8(0,e[t+0]),r.setUint8(1,e[t+1]),r.setUint8(2,e[t+2]),r.setUint8(3,e[t+3]);return r.getFloat32(0,!0)}}]),e}(),ct=function(){function e(){Object(u.a)(this,e),this.m_mouseDown=!1,this.m_indexMoved=-1,this.m_numHandles=10,this.m_handleColors=[{r:0,g:0,b:0},{r:255,g:128,b:64},{r:255,g:0,b:0},{r:128,g:64,b:64},{r:128,g:0,b:0},{r:64,g:64,b:64},{r:128,g:128,b:128},{r:192,g:192,b:192},{r:255,g:255,b:255},{r:255,g:255,b:255}],this.m_handleX=[0,22,40,55,61,115,118,125,160,255],this.m_handleY=[0,0,.3,.12,0,0,.4,.8,.95,1],this.m_proj=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],this.m_handleColors.length!==this.m_numHandles&&console.log("Wrong array this.m_handleColors: ".concat(this.m_handleColors.length," !== ").concat(this.m_numHandles))}return Object(h.a)(e,[{key:"render",value:function(e,t,i,r,a){this.m_xMin=t,this.m_yMin=i,this.m_wScreen=r,this.m_hScreen=a;var s,n,o=Math.floor(r/50);this.m_radCircle=o,e.lineWidth=1,e.strokeStyle="#000000",s=-1,n=-1;for(var l=0;l<this.m_numHandles;l++){var m=this.m_handleX[l],u=this.m_handleY[l],h=t+Math.floor(r*m/255),c=i+Math.floor(a-1-a*u/1);this.m_proj[l].x=h,this.m_proj[l].y=c,l>0&&(e.beginPath(),e.moveTo(s,n),e.lineTo(h,c),e.stroke()),s=h,n=c}for(var d=0;d<this.m_numHandles;d++){var _=this.m_handleX[d],f=this.m_handleY[d],v=t+Math.floor(r*_/255),p=i+Math.floor(a-1-a*f/1),g=this.m_handleColors[d].r.toString(16),S=this.m_handleColors[d].g.toString(16),x=this.m_handleColors[d].b.toString(16);g=1===g.length?"0"+g:g,S=1===S.length?"0"+S:S,x=1===x.length?"0"+x:x;var y="#".concat(g).concat(S).concat(x);e.fillStyle=y,e.beginPath(),e.ellipse(v,p,o,o,0,0,2*Math.PI),e.fill(),e.stroke()}}},{key:"onMouseDown",value:function(e,t){for(var i=0;i<this.m_numHandles;i++){var r=e-this.m_proj[i].x,a=t-this.m_proj[i].y;r*r+a*a<=this.m_radCircle*this.m_radCircle&&(console.log("Picked point ".concat(i)),this.m_mouseDown=!0,this.m_indexMoved=i)}return!1}},{key:"onMouseUp",value:function(){return this.m_mouseDown=!1,!1}},{key:"onMouseMove",value:function(e,t){if(this.m_mouseDown){var i,r;i=0===this.m_indexMoved||this.m_indexMoved===this.m_numHandles-1?this.m_proj[this.m_indexMoved].x:(i=(i=e)<this.m_proj[this.m_indexMoved-1].x?this.m_proj[this.m_indexMoved-1].x:i)>this.m_proj[this.m_indexMoved+1].x?this.m_proj[this.m_indexMoved+1].x:i,(r=t)<this.m_yMin&&(r=this.m_yMin),r>this.m_yMin+this.m_hScreen&&(r=this.m_yMin+this.m_hScreen),this.m_proj[this.m_indexMoved].x=i,this.m_proj[this.m_indexMoved].y=r;var a=255*(i-this.m_xMin)/this.m_wScreen,s=1*(this.m_yMin+this.m_hScreen-1-r)/this.m_hScreen;return this.m_handleX[this.m_indexMoved]=a,this.m_handleY[this.m_indexMoved]=s,!0}return!1}}]),e}(),dt=function(e){Object(S.a)(i,e);var t=Object(x.a)(i);function i(e){var r;return Object(u.a)(this,i),(r=t.call(this,e)).m_histogram=[],r.m_numColors=0,r.m_transfFunc=new ct,r.m_transfFuncCallback=void 0,r.m_transfFuncUpdateCallback=void 0,r.setSize=r.setSize.bind(Object(g.a)(r)),r.onMouseDown=r.onMouseDown.bind(Object(g.a)(r)),r.onMouseUp=r.onMouseUp.bind(Object(g.a)(r)),r.onMouseMove=r.onMouseMove.bind(Object(g.a)(r)),r.state={width:0,height:220},r}return Object(h.a)(i,[{key:"componentDidMount",value:function(){this.updateCanvas(),window.addEventListener("resize",this.handleResize,!1),this.setSize()}},{key:"componentDidUpdate",value:function(){this.updateCanvas(),window.removeEventListener("resize",this.handleResize,!1)}},{key:"handleResize",value:function(){this.setSize()}},{key:"setSize",value:function(){var e=this.m_canvasOwner;if(e){var t=e.clientWidth-2,i=e.clientHeight-2;this.setState({width:t}),this.setState({height:i})}}},{key:"getVolumeHistogram",value:function(e){var t,i=e.m_xDim,r=e.m_yDim,a=e.m_zDim,s=e.m_dataArray,n=i*r*a;for(this.m_numColors=256,this.m_histogram=new Array(this.m_numColors),t=0;t<this.m_numColors;t++)this.m_histogram[t]=0;for(t=0;t<n;t++){var o=s[t];this.m_histogram[o]++}var l=0;for(t=0;t<this.m_numColors;t++)l=this.m_histogram[t]>l?this.m_histogram[t]:l;var m=1/(l+=.001);for(t=0;t<this.m_numColors;t++)this.m_histogram[t]*=m;this.smoothHistogram(),this.getMaxPeak()}},{key:"assignArray",value:function(e,t){this.m_numColors=e,this.m_histogram=t}},{key:"getLastMaxIndex",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=4,r=!1;for(e=this.m_numColors-i;e>i;e--)if(this.m_histogram[e]>t&&this.m_histogram[e]>this.m_histogram[e-2]&&this.m_histogram[e]>this.m_histogram[e+2]){r=!0;break}return r?e:(console.log("getLastMaxIndex. Not found!"),-1)}},{key:"getMaxPeak",value:function(){var e;this.m_peakIndex=-1;var t=this.m_histogram,i=0;for(e=this.m_numColors-4;e>12;e--)if(t[e]>t[e-1]&&t[e]>t[e+1]&&t[e]>t[e-2]&&t[e]>t[e+2]){var r=t[e];r>i&&(i=r,this.m_peakIndex=e)}}},{key:"smoothHistogram",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1.2,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=60,r=Math.floor(this.m_numColors/i),a=32;r>a&&(r=a);var s,n=1/(2*e*e),o=new Array(this.m_numColors),l=0;for(s=0;s<this.m_numColors;s++){for(var m=0,u=0,h=-r;h<=r;h++){var c=s+h,d=h/r,_=Math.exp(-d*d*n);c>=0&&c<this.m_numColors&&(m+=this.m_histogram[c]*_,u+=_)}l=(m/=u)>l?m:l,o[s]=m}if(t)for(s=0;s<this.m_numColors;s++)this.m_histogram[s]=o[s]/l;else for(s=0;s<this.m_numColors;s++)this.m_histogram[s]=o[s]}},{key:"onMouseDown",value:function(e){if(void 0!==this.m_transfFuncCallback&&void 0!==this.m_transfFuncUpdateCallback){var t=this.refs.canvasHistogram.getBoundingClientRect(),i=e.clientX-t.left,r=e.clientY-t.top;this.m_transfFunc.onMouseDown(i,r)&&this.forceRender()}}},{key:"onMouseUp",value:function(e){if(void 0!==this.m_transfFuncCallback&&void 0!==this.m_transfFuncUpdateCallback){var t=this.refs.canvasHistogram.getBoundingClientRect(),i=e.clientX-t.left,r=e.clientY-t.top;this.m_transfFunc.onMouseUp(i,r)&&this.forceRender()}}},{key:"onMouseMove",value:function(e){if(void 0!==this.m_transfFuncCallback&&void 0!==this.m_transfFuncUpdateCallback){var t=this.refs.canvasHistogram.getBoundingClientRect(),i=e.clientX-t.left,r=e.clientY-t.top;this.m_transfFunc.onMouseMove(i,r)&&this.forceRender()}}},{key:"updateCanvas",value:function(){if(void 0!==this.refs.canvasHistogram){var e=this.refs.canvasHistogram.getContext("2d"),t=this.refs.canvasHistogram.clientWidth,i=this.refs.canvasHistogram.clientHeight;e.fillStyle="rgb(220, 220, 220)",e.fillRect(0,0,t,i);var r=this.props.volume;null!==r&&this.getVolumeHistogram(r);var a=Math.floor(.01*t),s=Math.floor(.99*t),n=Math.floor(.05*i),o=Math.floor(.95*i),l=s-a,m=o-n;e.lineWidth=1,e.strokeStyle="#0a0a0a",e.moveTo(a,o),e.lineTo(a,n),e.stroke(),e.moveTo(a,o),e.lineTo(s,o),e.stroke(),e.font="10px Arial",e.fillStyle="rgb(120, 20, 20)",e.textBaseline="top",e.textAlign="center";var u,h=1;this.m_peakIndex>0&&(h=(h=2*this.m_histogram[this.m_peakIndex])>1?1:h);var c,d,_;for(u=0;u<=4;u++){var f=a+Math.floor(l*u/4);e.moveTo(f,o),e.lineTo(f,o+6),e.stroke();var v=Math.floor(0+this.m_numColors*u/4);e.textAlign=0===u?"left":4===u?"right":"center",e.fillText(v.toString(),f,o+4)}for(e.lineWidth=2,e.strokeStyle="#080808",e.fillStyle="#707070",e.beginPath(),e.moveTo(a,o),c=0;c<this.m_numColors;c++){d=a+Math.floor(l*c/this.m_numColors);var p=this.m_histogram[c]/h;p=p>=1?1:p,_=o-Math.floor(m*p),e.lineTo(d,_)}if(_=o,e.lineTo(d,_),e.closePath(),e.fill(),this.m_peakIndex>0){e.lineWidth=1,e.strokeStyle="#eeeeee";var g=a+Math.floor(l*this.m_peakIndex/this.m_numColors),S=this.m_histogram[this.m_peakIndex]/h;S=S>=1?1:S;var x=o-Math.floor(m*S);e.beginPath(),e.setLineDash([5,15]),e.moveTo(g,x),x=o,e.lineTo(g,x),e.stroke(),e.setLineDash([])}void 0!==this.m_transfFuncCallback&&void 0!==this.m_transfFuncUpdateCallback&&this.m_transfFunc.render(e,a,n,l,m)}}},{key:"forceRender",value:function(){this.setState({state:this.state}),void 0!==this.m_transfFuncCallback&&this.m_transfFuncCallback(this.m_transfFunc)}},{key:"render",value:function(){var e=this,t=this.props.volume;if(void 0===t)return Object(r.jsx)("p",{children:"UiHistogram.props volume is not defined !!!"});if(null===t)return Object(r.jsx)("p",{children:"vol is null"});this.m_transfFuncCallback=this.props.transfFunc,this.m_transfFuncUpdateCallback=this.props.transfFuncUpdate;var i=this.state.width||200,a=this.state.height||200;return console.log(i,a),Object(r.jsx)("div",{ref:function(t){e.m_canvasOwner=t},children:Object(r.jsx)("canvas",{ref:"canvasHistogram",width:i,height:a,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onMouseMove:this.onMouseMove})})}}]),i}(s.a.Component),_t=!1,ft=255,vt=function(){function e(){Object(u.a)(this,e),this.m_littleEndian=!0,this.m_header={m_id:"",m_endianness:0,m_glType:0,m_glTypeSize:0,m_glFormat:0,m_glInternalFormat:0,m_glBaseInternalFormat:0,m_pixelWidth:0,m_pixelHeight:0,m_pixelDepth:0,m_numberOfArrayElements:0,m_numberOfFaces:0,m_numberOfMipmapLevels:0,m_bytesOfKeyValueData:0},this.m_xDim=0,this.m_yDim=0,this.m_zDim=0,this.phases=1,this.m_boxSize={x:0,y:0,z:0}}return Object(h.a)(e,[{key:"readIntFromBuffer",value:function(e,t){return this.m_littleEndian?e[t+0]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24:e[t+3]|e[t+2]<<8|e[t+1]<<16|e[t+0]<<24}},{key:"readShortFromBuffer",value:function(e,t){return this.m_littleEndian?e[t+0]|e[t+1]<<8:e[t+1]|e[t+0]<<8}},{key:"readFloatFromBuffer",value:function(e,t){var i=new ArrayBuffer(4),r=new DataView(i);return r.setUint8(0,e[t+0]),r.setUint8(1,e[t+1]),r.setUint8(2,e[t+2]),r.setUint8(3,e[t+3]),r.getFloat32(0,this.m_littleEndian)}},{key:"readFromBuffer",value:function(e,t,i,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=new Uint8Array(t),n=s.length;if(null!==a&&a.length!==n)throw new Error("check your input arrays");var o=8,l=348,m=19,u=108,h=this.readFloatFromBuffer(s,u);console.log(h);var c=83886080*m+h;if(n<o)return r&&r(at.ERROR_TOO_SMALL_DATA_SIZE,null,0,null),!1;if(n>c)return r&&r(at.ERROR_TOO_LARGE_DATA_SIZE,null,0,null),!1;if(n<l)return console.error("Nifti header too small"),r&&r(at.BAD_HEADER,null,0,null),!1;var d=4,_=2,f=0,v=this.readIntFromBuffer(s,f);if(v>2<<24&&(this.m_littleEndian=!1,v=this.readIntFromBuffer(s,f)),f+=d,v!==l)return console.error("Nifti first int wrong: ".concat(v,", but should be ").concat(l)),r&&r(at.BAD_HEADER,null,0,null),!1;f+=10,f+=18,f+=d,f+=_,f+=1,f+=1;var p=this.readShortFromBuffer(s,f);f+=_;var g=3;if(p<g)return console.error("Nifti header wrong num dimensions: ".concat(p,", but should be at least 3")),r&&r(at.WRONG_HEADER_DIMENSIONS,null,0,null),!1;if(this.m_xDim=this.readShortFromBuffer(s,f),f+=_,this.m_yDim=this.readShortFromBuffer(s,f),f+=_,this.m_zDim=this.readShortFromBuffer(s,f),f+=_,4===p){this.phases=this.readShortFromBuffer(s,f),f+=_;this.readShortFromBuffer(s,f);f+=6}else f+=8;f+=d,f+=d,f+=d,f+=_;var S=this.readShortFromBuffer(s,f);f+=_;var x=this.readShortFromBuffer(s,f);f+=_;this.readShortFromBuffer(s,f);var y=2,b=4,T=16,O=256,D=512,R=0;if(R|=S===y,R|=S===b,R|=S===T,R|=S===O,!(R|=S===D))return console.error("Nifti header read. This data type (".concat(S,") is not supported")),r&&r(at.WRONG_HEADER_DATA_TYPE,null,0,null),!1;var w=8,j=16,X=32,E=x===w|x===j|x===X;if(!E)return console.error("Nifti wrong bitPix: ".concat(x,", but should be 8,16 or 32")),r&&r(at.WRONG_HEADER_BITS_PER_PIXEL,null,0,null),!1;f+=_;var I=this.readFloatFromBuffer(s,f);f+=d;var A=this.readFloatFromBuffer(s,f);f+=d;var M=this.readFloatFromBuffer(s,f);f+=d;this.readFloatFromBuffer(s,f);f+=d;this.readFloatFromBuffer(s,f);s[f+=31];this.m_boxSize.x=this.m_xDim*I,this.m_boxSize.y=this.m_yDim*A,this.m_boxSize.z=this.m_zDim*M;var C=1e-5;if(this.m_boxSize.x<C){var F=312;this.m_boxSize.x=F,this.m_boxSize.y=F,this.m_boxSize.z=F}var V=110,U=43,P=49,N=s[(f=l-d)+0]===V&&s[f+1]===U&&s[f+2]===P;if(!N)return console.error("Nifti hdr bad magic: ".concat(s[f+0],", ").concat(s[f+1],", ").concat(s[f+2])),r&&r(at.WRONG_HEADER_MAGIC,null,0,null),!1;f+=d;var k,L,B=this.m_xDim*this.m_yDim*this.m_zDim,z=B*this.phases,G=h,W=(n-G)/this.phases,H=new Array(this.phases),q=9,Y=Array(this.phases).fill(0);if(L=0,S===b||S===D)for(var Z=0;Z<this.phases;Z++)for(L=Z*W,k=0;k<z;k++){var K=this.readShortFromBuffer(s,G+L);if(L+=2,K>Y[Z]&&(Y[Z]=K),i&&z%(4*L)===0){var Q=L/z/4;_t,i(Q)}}if(S===T)for(var J=0;J<this.phases;J++)for(L=J*W,k=0;k<z;k++){var $=this.readFloatFromBuffer(s,G+L),ee=Math.floor($)+1;if(L+=4,ee>Y[J]&&(Y[J]=ee),i&&z%(4*L)===0){var te=L/z/4;_t,i(te)}}for(var ie=[],re=0;re<this.phases;re++)for(ie[re]=new Float32Array(Y[re]+1),k=0;k<Y[re]+1;k++)ie[re][k]=0;if(L=0,S===b||S===D)for(var ae=0;ae<this.phases;ae++)for(L=ae*W,k=0;k<B;k++){var se=this.readShortFromBuffer(s,G+L);L+=2,ie[ae][se]++}if(S===T)for(var ne=0;ne<this.phases;ne++)for(L=ne*W,k=0;k<B;k++){var oe=Math.floor(this.readFloatFromBuffer(s,G+L));L+=4,ie[ne][oe]++}var le=4,me=new Array(this.phases);if(S===b||S===D)for(var ue=0;ue<this.phases;ue++){me[ue]=new dt,me[ue].assignArray(Y[ue],ie[ue]);var he=.8,ce=!1;me[ue].smoothHistogram(he,ce);var de=4,_e=me[ue].getLastMaxIndex(de);if(_e<4&&(_e=Y[ue]),H[ue]=(ft<<q)/_e,H[ue]<=le)return console.error("Bad scaling: image will be 0"),r&&r(at.ERROR_PROCESS_HISTOGRAM,null,0,null),!1}for(var fe=8,ve=z*(x/fe),pe=[],ge=0;ge<this.phases;ge++)pe[ge]=new Uint8Array(B);if(k=0,L=0,S===b||S===D)for(var Se=0;Se<this.phases;Se++)for(L=Se*W,k=0;k<z;k++){var xe=this.readShortFromBuffer(s,G+L);if(L+=2,xe=(xe=xe*H[Se]>>q)<=ft?xe:ft,pe[Se][k]=xe,i&&z%(4*L)===0){var ye=.5+L/z/2;_t,i(ye)}}else{if(S!==O&&S!==y)throw new Error("BAD input dataType");for(var be=0;be<this.phases;be++)for(L=be*W,k=0;k<B;k++,L++){var Te=s[G+L];if(Te*=85,pe[be][k]=Te,i&&z%(4*L)===0){var Oe=.5+L/z/2;_t,i(Oe)}}}for(var De,Re,we,je=this.m_xDim*this.m_yDim,Xe=0*je,Ee=(this.m_zDim-1)*je,Ie=0,Ae=this.m_xDim-1,Me=0,Ce=(this.m_yDim-1)*this.m_xDim,Fe=0;Fe<this.phases;Fe++){for(Re=0;Re<this.m_yDim;Re++){var Ve=Re*this.m_xDim;for(De=0;De<this.m_xDim;De++){var Ue=void 0;Ue=Xe+Ve+De,pe[Fe][Ue]=0,Ue=Ee+Ve+De,pe[Fe][Ue]=0}}for(we=0;we<this.m_zDim;we++){var Pe=we*je;for(Re=0;Re<this.m_yDim;Re++){var Ne=void 0;Ne=Pe+Re*this.m_xDim+Ie,pe[Fe][Ne]=0,Ne=Pe+Re*this.m_xDim+Ae,pe[Fe][Ne]=0}}for(we=0;we<this.m_zDim;we++){var ke=we*je;for(De=0;De<this.m_xDim;De++){var Le=void 0;Le=ke+Me+De,pe[Fe][Le]=0,Le=ke+Ce+De,pe[Fe][Le]=0}}}for(var Be=0;Be<this.phases;Be++){e[Be].m_xDim=this.m_xDim,e[Be].m_yDim=this.m_yDim,e[Be].m_zDim=this.m_zDim;var ze=1;e[Be].m_bytesPerVoxel=ze,e[Be].m_dataArray=pe[Be],e[Be].m_dataSize=B,e[Be].m_boxSize=this.m_boxSize,e[Be].m_phase=Be}var Ge=6403,We=5121,He={m_pixelWidth:this.m_xDim,m_pixelHeight:this.m_yDim,m_pixelDepth:this.m_zDim,m_glType:We,m_glTypeSize:1,m_glFormat:Ge,m_glInternalFormat:Ge,m_glBaseInternalFormat:Ge};return i&&i(1),r&&r(at.SUCCESS,He,ve,pe),!0}},{key:"readFromUrl",value:function(e,t,i,r){var a=this;return this.m_fileLoader=new ot(t),this.m_fileLoader.readFile((function(t){return a.readFromBuffer(e,t,i,r)}),(function(e){r(at.ERROR_CANT_OPEN_URL,null,0,null)})),!0}}]),e}(),pt=function(){function e(){Object(u.a)(this,e),this.TAGS=[[2,0,"OB","FileMetaInfoGroupLength"],[2,1,"OB","FileMetaInformationVersion"],[2,2,"UI","MediaStoredSOPClassUID"],[2,3,"UI","MediaStoredSOPInstanceUID"],[2,16,"UI","TransferSyntaxUID"],[2,18,"UI","ImplementationClassUID"],[2,19,"UI","ImplementationVersionName"],[2,22,"UI","SourceApplicationEntityTitle"],[2,256,"UI","PrivateInformationCreatorUID"],[2,258,"UI","PrivateInformation"],[8,0,"UL","IdentifyingGroupLength"],[8,1,"UI","LengthToEnd"],[8,5,"CS","SpecificCharacterSet"],[8,6,"SQ","LanguageCodeSequence"],[8,8,"CS","ImageType"],[8,16,"SH","RecognitionCode"],[8,18,"DA","InstanceCreationDate"],[8,19,"TM","InstanceCreationTime"],[8,20,"UI","InstanceCreatorUID"],[8,22,"UI","SOPClassUID"],[8,24,"UI","SOPInstanceUID"],[8,26,"UI","RelatedGeneralSOPClassUID"],[8,27,"UI","OriginalSpecializedSOPClassUID"],[8,32,"DA","StudyDate"],[8,33,"DA","SeriesDate"],[8,34,"DA","AcquisitionDate"],[8,35,"DA","ContentDate"],[8,36,"DA","OverlayDate"],[8,37,"DA","CurveDate"],[8,42,"DT","AcquisitionDateTime"],[8,48,"TM","StudyTime"],[8,49,"TM","SeriesTime"],[8,50,"TM","AcquisitionTime"],[8,51,"TM","ContentTime"],[8,52,"TM","OverlayTime"],[8,53,"TM","CurveTime"],[8,64,"US","DataSetType"],[8,65,"LO","DataSetSubtype"],[8,66,"CS","NuclearMedicineSeriesType"],[8,80,"SH","AccessionNumber"],[8,81,"SQ","IssuerOfAccessionNumberSequence"],[8,82,"CS","QueryRetrieveLevel"],[8,84,"AE","RetrieveAETitle"],[8,86,"CS","InstanceAvailability"],[8,88,"UI","FailedSOPInstanceUIDList"],[8,96,"CS","Modality"],[8,112,"XX","Manufacturer"],[8,128,"XX","InstitutionName"],[8,129,"XX","InstitutionAddress"],[8,144,"XX","ReferringPhysicansName"],[8,4112,"XX","StationName"],[8,4144,"XX","StudyDescription"],[8,4158,"LO","SeriesDescription"],[8,4160,"XX","InstitutionDepartmentName"],[8,4176,"XX","PerformingPhysicansName"],[8,4192,'"XX','"Unkown'],[8,4224,"XX","AdmittingDiagnosesDescription"],[8,4240,"XX","ManufacturterModelName"],[8,4369,"XX","ReferencedPerformedProcStepSeq"],[8,4416,"XX","ReferencedImageSequence"],[8,4432,"UI","ReferencedSOP\u200bClassUID"],[8,4437,"UI","ReferencedSOP\u200bInstanceUID"],[8,8465,'"XX','"DerivationDescription'],[8,8466,'"XX','"SourceImageSequence'],[9,16,"LO","PrivateCreator"],[9,17,"??",'"Unknown'],[9,18,"??",'"Unknown'],[9,4097,"XX","PrivateTag"],[9,4098,"XX","PrivateTag"],[9,4100,"XX","PrivateTag"],[9,4135,"XX","PrivateTag"],[9,4144,"XX","PrivateTag"],[9,4145,"XX","PrivateTag"],[9,4323,"XX","PrivateTag"],[9,4329,"XX","PrivateTag"],[16,0,"UL","PatientGroupLength"],[16,16,"PN","PatientName"],[16,32,"LO","PatientID"],[16,33,"LO","IssuerOfPatientID"],[16,34,"CS","TypeOfPatientID"],[16,36,"SQ","IssuerOfPatientIDQualifiersSequence"],[16,48,"DA","PatientBirthDate"],[16,50,"TM","PatientBirthTime"],[16,64,"CS","PatientGender"],[16,80,"SQ","PatientInsurancePlanCodeSequence"],[16,257,"SQ","PatientPrimaryLanguageCodeSequence"],[16,258,"SQ","PatientPrimaryLanguageModifierCodeSequence"],[16,4096,"LO","OtherPatientIDs"],[16,4097,"PN","OtherPatientNames"],[16,4098,"SQ","OtherPatientIDsSequence"],[16,4101,"PN","PatientBirthName"],[16,4112,"AS","PatientAge"],[16,4128,"DS","PatientSize"],[16,4129,"SQ","PatientSizeCodeSequence"],[16,4144,"DS","PatientWeight"],[16,4160,"LO","PatientAddress"],[16,4176,"LO","InsurancePlanIdentification"],[16,4192,"PN","PatientMotherBirthName"],[16,4224,"LO","MilitaryRank"],[16,4225,"LO","BranchOfService"],[16,4240,"LO","MedicalRecordLocator"],[16,8192,"LO","MedicalAlerts"],[16,8464,"LO","Allergies"],[16,8528,"LO","CountryOfResidence"],[16,8530,"LO","RegionOfResidence"],[16,8532,"SH","PatientTelephoneNumbers"],[16,8544,"SH","EthnicGroup"],[16,8576,"SH","Occupation"],[16,8608,"CS","SmokingStatus"],[16,8624,"LT","AdditionalPatientHistory"],[16,8640,"US","PregnancyStatus"],[16,8656,"DA","LastMenstrualDate"],[16,8688,"LO","PatientReligiousPreference"],[16,8705,"LO","PatientSpeciesDescription"],[16,8706,"SQ","PatientSpeciesCodeSequence"],[16,8707,"CS","PatientSexNeutered"],[16,8720,"CS","AnatomicalOrientationType"],[16,8850,"LO","PatientBreedDescription"],[16,8851,"SQ","PatientBreedCodeSequence"],[16,8852,"SQ","BreedRegistrationSequence"],[16,8853,"LO","BreedRegistrationNumber"],[16,8854,"SQ","BreedRegistryCodeSequence"],[16,8855,"PN","ResponsiblePerson"],[16,8856,"CS","ResponsiblePersonRole"],[16,8857,"LO","ResponsibleOrganization"],[16,16384,"LT","PatientComments"],[16,37937,"FL","ExaminedBodyThickness"],[24,0,"UL","AcquisitionGroupLength"],[24,32,"XX","ScanningSequence"],[24,33,"XX","SequenceVariant"],[24,34,"XX","ScanOptions"],[24,35,"XX","MrAcquisionType"],[24,36,"??",'"SequenceName'],[24,37,"XX","AngioFlag"],[24,80,"XX","SliceThickness"],[24,96,"DS","KVP"],[24,128,"XX","RepetitionTime"],[24,129,"XX","EchoTime"],[24,130,"XX","InversionTime"],[24,131,"XX","NumberOfAverages"],[24,132,"XX","ImagingFrequency"],[24,133,"XX","ImagedNucleus"],[24,134,"XX","EchoNumber"],[24,135,"XX","MagneticFieldStrength"],[24,136,"XX","SpacingBetweenSlices"],[24,137,"XX","NumberOfPhaseEncodingSteps"],[24,144,"XX","DataCollectionDiameter"],[24,145,"XX","EchoTrainLength"],[24,147,"XX","ProcentSampling"],[24,148,"XX","ProcentPhaseFieldOfView"],[24,149,"XX","PixelBandwidth"],[24,4096,"XX","DeviceSerialNumber"],[24,4098,"??","DeviceUID"],[24,4099,"??","DeviceID"],[24,4100,"??","PlateID"],[24,4101,"??","GeneratorID"],[24,4102,"??","GridID"],[24,4103,"??",'"CassetteID'],[24,4104,"??","GantryID"],[24,4112,"??","SecondaryCaptureDeviceID"],[24,4113,"??","HardcopyCreationDeviceID"],[24,4114,"??","DateOfSecondaryCapture"],[24,4116,"??","TimeOfSecondaryCapture"],[24,4118,"??","SecondaryCaptureDeviceManufacturer"],[24,4119,"??","HardcopyDeviceManufacturer"],[24,4120,"??","SecondaryCaptureDeviceModelName"],[24,4121,"??","SecondaryCaptureDeviceSoftwareVers"],[24,4122,"??","HardcopyDeviceSoftwareVersion"],[24,4123,"??","HardcopyDeviceModelName"],[24,4128,"XX","SoftwareVersions"],[24,4144,"XX","ProtocolName"],[24,4225,"XX",'"LowR-RValue'],[24,4226,"XX",'"HiR-RValue'],[24,4227,"XX",'"IntervalsAcquired'],[24,4228,"XX",'"IntervalsRejected'],[24,4232,"XX","HeartRate"],[24,4240,"XX","CardiacNumberOfImages"],[24,4244,"XX","TriggerWindow"],[24,4352,"XX","ReconstructionDiameter"],[24,4368,"XX","DistanceSourceToDetector"],[24,4369,"XX","DistanceSourceToPatient"],[24,4373,"XX","Unknown"],[24,4384,"XX","GantryDetectorTilt"],[24,4400,"XX","TableHeight"],[24,4416,"XX","RotationDirection"],[24,4432,"XX","ExposureTime"],[24,4433,"XX","XRayTubeCurrent"],[24,4434,"XX","Exposure"],[24,4446,"XX",'"Unknown'],[24,4448,"XX","FilterType"],[24,4452,"XX",'"unknown'],[24,4454,"XX",'"unknown'],[24,4456,"XX",'"unknown'],[24,4464,"XX","GeneratorPower"],[24,4480,"XX",'"Unknown'],[24,4496,"XX","FocalSpot"],[24,4624,"XX","ConvolutionKernel"],[24,4688,"XX","ReceiveCoilName"],[24,4880,"XX","AcquisionMatrix"],[24,4882,"XX","InPlanePhaseEncodingDirection"],[24,4884,"XX","FlipAngle"],[24,4885,"XX","VariableFlipAngleFlag"],[24,4886,"XX","SAR"],[24,5120,"XX","unknown"],[24,5632,"XX",'"ShutterShape'],[24,5634,"XX","ShutterLeftVerticalEdge"],[24,5636,"XX",'"ShutterRightVerticalEdge'],[24,5638,"XX",'"ShutterUpperHorizontalEdge'],[24,5640,"XX",'"ShutterLowerHorizontalEdge'],[24,5648,"XX",'"CenterOfCircularShutter'],[24,5650,"XX",'"RadiusOfCircularShutter'],[24,5664,"XX",'"VerticesOfPolygonalShutter'],[24,5666,"XX",'"ShutterPresentationValue'],[24,5667,"XX",'"ShutterOverlayGroup'],[24,5668,"XX",'"ShutterPresentationColorCIELabVal'],[24,5888,"XX","Unknown"],[24,5890,"XX","Unknown"],[24,5892,"XX","Unknown"],[24,5894,"XX","Unknown"],[24,5896,"XX","Unknown"],[24,16384,"XX",'"AcquisitionComments'],[24,20480,"XX","OutputPower"],[24,20512,"XX","Unknown"],[24,20513,"XX",'"Unknown'],[24,20736,"XX","PatientPosition"],[24,20737,"XX","ViewPosition"],[24,24576,"XX","Unknown"],[24,37633,"XX","CTAcquisitionTypeSequence"],[24,37634,"XX","AcquisitionType"],[24,37635,"XX","TubeAngle"],[24,37636,"XX","CTAcquisitionDetailsSequence"],[24,37637,"XX","RevolutionTime"],[24,37638,"XX","SingleCollimationWidth"],[24,37639,"XX","TotalCollimationWidth"],[24,37640,"XX","CTTableDynamicsSequence"],[24,37641,"XX","TableSpeed"],[24,37648,"XX","TableFeedPerRotation"],[24,37649,"XX","SpiralPitchFactor"],[24,37650,"XX","CTGeometrySequence"],[24,37651,"XX","DataCollectionCenterPatient"],[24,37652,"XX","CTReconstructionSequence"],[24,37653,"XX","ReconstructionAlgorithm"],[24,37654,"XX","ConvolutionKernelGroup"],[24,37655,"XX","ReconstructionFieldOfView"],[24,37656,"XX","ReconstructionTargetCenterPatient"],[24,37657,"XX","ReconstructionAngle"],[24,37664,"XX","ImageFilter"],[24,37665,"XX","CTExposureSequenc"],[24,37666,"XX","ReconstructionPixelSpacing"],[24,37667,"XX","ExposureModulationType"],[24,37668,"XX","EstimatedDoseSaving"],[24,37669,"XX","CTXRayDetailsSequence"],[24,37670,"XX","CTPositionSequence"],[24,37671,"XX","TablePosition"],[24,37672,"XX","ExposureTimeInMilliSec"],[24,37673,"XX","CTImageFrameTypeSequence"],[24,37680,"XX","XRayTubeCurrentInMilliAmps"],[25,16,"LO","PrivateCreator"],[25,4098,"XX","NumberOfCellsInDetector"],[25,4099,"XX","CellsNumberAtTheta"],[25,4100,"XX","CellsSpacing"],[25,4111,"XX","HorizFrameOfRef"],[25,4113,"XX","SeriesContrast"],[25,4114,"XX","LastPSeq"],[25,4115,"XX","StartNumberOfBaseLine"],[25,4116,"XX","EndNumberOfBaseLine"],[25,4117,"XX","StartNumberForEnchancedScans"],[25,4118,"XX","EndNumberForEnchancedScans"],[25,4119,"XX","SeriesPlane"],[25,4120,"XX","FirstScanRas"],[25,4121,"XX","FirstScanLocation"],[25,4122,"XX","LastScanRas"],[25,4123,"XX","LastScanLoc"],[25,4126,"XX","DisplayFieldOfView"],[25,4131,"XX","TableSpeed"],[25,4132,"XX","MidScanTime"],[25,4133,"XX","MidScanFlag"],[25,4134,"XX","DegreesOfAzimuth"],[25,4135,"XX","GantryPeriod"],[25,4138,"XX","XRayOnPosition"],[25,4139,"XX","XRayOffPosition"],[25,4140,"XX","NumberOfTriggers"],[25,4142,"XX","AngleOfFirstView"],[25,4143,"XX","TriggerFrequency"],[25,4153,"XX","ScanFovType"],[25,4160,"XX","StatReconFlag"],[25,4161,"XX","ComputeType"],[25,4162,"XX","SegmentNumber"],[25,4163,"XX","TotalSegmentsRequested"],[25,4164,"XX","InterscanDelay"],[25,4167,"XX","ViewCompressionFactor"],[25,4170,"XX","TotalNoOfRefChannels"],[25,4171,"XX","DataSizeForScanData"],[25,4178,"XX","ReconPostProcflag"],[25,4183,"XX","CTWaterNumber"],[25,4184,"XX","CTBoneNumber"],[25,4186,"XX","AcquisitionDuration"],[25,4190,"XX","NumberOfChannels"],[25,4191,"XX","IncrementBetweenChannels"],[25,4192,"XX","StartingView"],[25,4193,"XX","NumberOfViews"],[25,4194,"XX","IncrementBetweenViews"],[25,4202,"XX","DependantOnNoViewsProcessed"],[25,4221,"DS","SecondEcho"],[25,4222,"SS","NumberOfEchoes"],[25,4223,"DS","TableDelta"],[25,4225,"SS","Contiguous"],[25,4228,"DS","PeakSAR"],[25,4231,"DS","CardiacRepetitionTime"],[25,4232,"SS","ImagesPerCardiacCycle"],[25,4234,"SS","ActualReceiveGainAnalog"],[25,4235,"SS","ActualReceiveGainDigital"],[25,4237,"DS","DelayAfterTrigger"],[25,4239,"SS","Swappf"],[25,4240,"SS","PauseInterval"],[25,4241,"DS","PulseTime"],[25,4242,"SL","SliceOffsetOnFreqAxis"],[25,4243,"DS","CenterFrequency"],[25,4244,"SS","TransmitGain"],[25,4245,"SS","AnalogReceiverGain"],[25,4246,"SS","DigitalReceiverGain"],[25,4247,"SL","BitmapDefiningCVs"],[25,4251,"SS","PulseSeqMode"],[25,4252,"LO","PulseSeqName"],[25,4253,"DT","PulseSeqDate"],[25,4254,"LO","InternalPulseSeqName"],[25,4255,"SS","TransmittingCoil"],[25,4256,"SS","SurfaceCoilType"],[25,4257,"SS","ExtremityCoilFlag"],[25,4258,"SL","RawDataRunNumber"],[25,4259,"UL","CalibratedFieldStrength"],[25,4260,"SS","SATFatWaterBone"],[25,4263,"DS","UserData01"],[25,4264,"DS","UserData02"],[25,4265,"DS","UserData03"],[25,4266,"DS","UserData04"],[25,4267,"DS","UserData05"],[25,4268,"DS","UserData06"],[25,4269,"DS","UserData07"],[25,4270,"DS","UserData08"],[25,4271,"DS","UserData09"],[25,4272,"DS","UserData10"],[25,4273,"DS","UserData11"],[25,4274,"DS","UserData12"],[25,4275,"DS","UserData13"],[25,4276,"DS","UserData14"],[25,4277,"DS","UserData15"],[25,4278,"DS","UserData16"],[25,4279,"DS","UserData17"],[25,4280,"DS","UserData18"],[25,4281,"DS","UserData19"],[25,4282,"DS","UserData20"],[25,4283,"DS","UserData21"],[25,4284,"DS","UserData22"],[25,4285,"DS","UserData23"],[25,4286,"DS","ProjectionAngle"],[25,4288,"SS","SaturationPlanes"],[25,4290,"SS","SATLocationR"],[25,4291,"SS","SATLocationL"],[25,4292,"SS","SATLocationA"],[25,4293,"SS","SATLocationP"],[25,4294,"SS","SATLocationH"],[25,4295,"SS","SATLocationF"],[25,4296,"SS","SATThicknessR-L"],[25,4297,"SS","SATThicknessA-P"],[25,4298,"SS","SATThicknessH-F"],[25,4299,"SS","PrescribedFlowAxis"],[25,4300,"SS","VelocityEncoding"],[25,4301,"SS","ThicknessDisclaimer"],[25,4302,"SS","PrescanType"],[25,4303,"SS","PrescanStatus"],[25,4306,"SS","ProjectionAlgorithm"],[25,4307,"SH","ProjectionAlgorithm"],[25,4309,"SS","FractionalEcho"],[25,4311,"SS","CardiacPhases"],[25,4312,"SS","VariableEchoflag"],[25,4313,"DS","ConcatenatedSAT"],[25,4319,"DS","UserData"],[25,4320,"DS","UserData"],[25,4322,"DS","VelocityEncodeScale"],[25,4338,"SS","FastPhases"],[25,4345,"DS","TransmissionGain"],[32,0,"UL","RelationshipGroupLength"],[32,13,"UI","StudyInstanceID"],[32,14,"UI","SeriesInstanceID"],[32,16,"IS","StudyID"],[32,17,"IS","SeriesNumber"],[32,18,"IS","AcquisionNumber"],[32,19,"IS","ImageNumber"],[32,32,"IS","PatientOrientation"],[32,50,"DS","ImagePosition"],[32,55,"DS","ImageOrientation"],[32,64,"XX","PositionReferenceIndicator"],[32,65,"XX","SliceLocation"],[32,82,"UI","FrameOfRefefernceID"],[32,96,"XX","Laterality"],[32,4098,"XX","ImagesInAcquision"],[32,4160,"LO","PositionReferenceIndicator"],[32,4161,"DS","SliceLocation"],[32,36950,"XX","StackId"],[32,36951,"XX","InStackPositionNumber"],[33,16,"LO","PrivateCreator"],[33,4099,"XX","SeriesFromWhichPrescribed"],[33,4101,"XX","GenesisVersionNow"],[33,4103,"XX","SeriesRecordChecksum"],[33,4120,"XX","GenesisVersionNow"],[33,4121,"XX","AcqreconRecordChecksum"],[33,4128,"XX","TableStartLocation"],[33,4149,"XX","SeriesFromWhichPrescribed"],[33,4150,"XX","ImageFromWhichPrescribed"],[33,4151,"XX","ScreenFormat"],[33,4170,"XX","AnatomicalReferenceForScout"],[33,4175,"XX","LocationsInAcquisition"],[33,4176,"XX","GraphicallyPrescribed"],[33,4177,"XX","RotationFromSourceXRot"],[33,4178,"XX","RotationFromSourceYRot"],[33,4179,"XX","RotationFromSourceZRot"],[33,4180,"XX","ImagePosition"],[33,4181,"XX","ImageOrientation"],[33,4182,"XX","IntegerSlop"],[33,4183,"XX","IntegerSlop"],[33,4184,"XX","IntegerSlop"],[33,4185,"XX","IntegerSlop"],[33,4186,"XX","IntegerSlop"],[33,4187,"XX","FloatSlop"],[33,4188,"XX","FloatSlop"],[33,4189,"XX","FloatSlop"],[33,4190,"XX","FloatSlop"],[33,4191,"XX","FloatSlop"],[33,4225,"XX","AutoWindowLevelAlpha"],[33,4226,"XX","AutoWindowLevelBeta"],[33,4227,"XX","AutoWindowLevelWindow"],[33,4228,"XX","ToWindowLevelLevel"],[33,4240,"XX","TubeFocalSpotPosition"],[33,4241,"XX","BiopsyPosition"],[33,4242,"XX","BiopsyTLocation"],[33,4243,"XX","BiopsyRefLocation"],[35,16,"LO","PrivateCreator"],[35,4097,"XX","NumberOfSeriesInStudy"],[35,4098,"XX","NumberOfUnarchivedSeries"],[35,4112,"XX","ReferenceImageField"],[35,4176,"XX","SummaryImage"],[35,4208,"XX","StartTimeSecsInFirstAxial"],[35,4212,"SL","NoofUpdatesToHeader"],[35,4221,"SS","IndicatesIfTheStudyHasCompleteInfo"],[35,4224,"LO","CRFilmFormat"],[37,16,"LO","PrivateCreator"],[37,4102,"SS","LastPulseSequenceUsed"],[37,4103,"SL","ImagesInSeries"],[37,4112,"SL","LandmarkCounter"],[37,4113,"SS","NumberOfAcquisitions"],[37,4116,"SL","IndicatesNoofUpdatesToHeader"],[37,4119,"SL","SeriesCompleteFlag"],[37,4120,"SL","NumberOfImagesArchived"],[37,4121,"SL","LastImageNumberUsed"],[37,4122,"SH","PrimaryReceiverSuiteAndHost"],[37,4123,"OB","ProtocolDataBlock"],[39,16,"LO","PrivateCreator"],[39,4102,"XX","ImageArchiveFlag"],[39,4112,"XX","ScoutType"],[39,4124,"XX","VmaMamp"],[39,4125,"XX","VmaPhase"],[39,4126,"XX","VmaMod"],[39,4127,"XX","VmaClip"],[39,4128,"XX","SmartScanOnOffFlag"],[39,4144,"XX","ForeignImageRevision"],[39,4145,"XX","ImagingMode"],[39,4146,"XX","PulseSequence"],[39,4147,"XX","ImagingOptions"],[39,4149,"XX","PlaneType"],[39,4150,"XX","ObliquePlane"],[39,4160,"XX","RASLetterOfImageLocation"],[39,4161,"XX","ImageLocation"],[39,4162,"XX","CenterRCoordOfPlaneImage"],[39,4163,"XX","CenterACoordOfPlaneImage"],[39,4164,"XX","CenterSCoordOfPlaneImage"],[39,4165,"XX","NormalRCoord"],[39,4166,"XX","NormalACoord"],[39,4167,"XX","NormalSCoord"],[39,4168,"XX","RCoordOfTopRightCorner"],[39,4169,"XX","ACoordOfTopRightCorner"],[39,4170,"XX","SCoordOfTopRightCorner"],[39,4171,"XX","RCoordOfBottomRightCorner"],[39,4172,"XX","ACoordOfBottomRightCorner"],[39,4173,"XX","SCoordOfBottomRightCorner"],[39,4176,"XX","TableStartLocation"],[39,4177,"XX","TableEndLocation"],[39,4192,"FL","ImageDimensionX"],[39,4193,"FL","ImageDimensionY"],[39,4194,"FL","NumberOfExcitations"],[40,0,"UL","ImagePresentationGroupLength"],[40,2,"US","SamplesPerPixel"],[40,4,"CS","PhotometricInterpretation"],[40,6,"US","Planar\u200bConfiguration"],[40,8,"XX","NumberOfFrames"],[40,16,"US","Rows"],[40,17,"US","Columns"],[40,48,"DS","PixelSpacing"],[40,256,"US","BitsAllocated"],[40,257,"US","BitsStored"],[40,258,"US","HighBit"],[40,259,"US","PixelRepresentation"],[40,262,"XX","SmallestImagePixelValue"],[40,263,"XX","LargestImagePixelValue"],[40,288,"US","PixelAddingValue"],[40,769,"CS","BurnderInAnnotation"],[40,771,"CS","Longitudinal\u200bTemporal\u200bInformation\u200bModified"],[40,4176,"DS","WindowCenter"],[40,4177,"DS","WindowWidth"],[40,4178,"DS","RescaleIntercept"],[40,4179,"DS","RescaleSlope"],[40,4180,"LO","RescaleType"],[40,4181,"LO","Window\u200bCenter\u200bWidth\u200bExplanation"],[41,16,"LO","PrivateCreator"],[41,4117,"SL","LowerRangeOfPixels1h"],[41,4118,"SL","LowerRangeOfPixels1i"],[41,4119,"SL","LowerRangeOfPixels2"],[41,4120,"SL","UpperRangeOfPixels2"],[41,4134,"SS","VersionOfTheHdrStruct"],[41,4145,"LO","PrivateTag"],[41,4146,"UL","PrivateTag"],[41,4147,"UL","PrivateTag"],[41,4148,"SL","AdvantageCompOverflow"],[41,4149,"SL","AdvantageCompUnderflow"],[50,0,"UL","StudyGroupLength"],[50,12,"XX","StrudyPriorityId"],[50,4128,"XX","ScheduledStudyLocation"],[50,4144,"XX","ReasonForStudy"],[50,4192,"XX","RequestedProcedureDescription"],[56,16,"XX","AdmissionId"],[56,80,"XX","SpecialNeeds"],[56,1280,"XX","PatientState"],[64,0,"UL","TextGroupLength"],[64,578,"XX","PerformedStationName"],[64,579,"XX","PerformedLocation"],[64,580,"XX","PerformedProcedureStepStartDate"],[64,581,"XX","PerformedProcedureStepStartTime"],[64,595,"XX","PerformedProcedureStepId"],[64,596,"XX","PerformedProcedureStepDescription"],[64,597,"LO","PerformedProcedureTypeDescription"],[64,640,"XX",'"CommentsOnPerformedProcedureStep'],[64,801,"XX","FilmConsumptionSequence"],[64,4097,"XX","RequestedProcedureId"],[64,4098,"XX","Unknown"],[64,4099,"XX","Unknown"],[64,4100,"XX","PatientTransportArrangments"],[64,4101,"XX","RequestedProcedureLocation"],[64,4112,"XX","NamesOfIntendentRecipientsOfResults"],[64,5120,"XX","RequestedProcedureComments"],[64,9216,"XX","ImagingServiceRequestComments"],[64,12289,"XX","Unknown"],[67,16,"LO","PrivateCreator"],[67,4097,"XX","BitmapOfPrescanOptions"],[67,4098,"XX","GradientOffsetInX"],[67,4099,"XX","GradientOffsetInY"],[67,4100,"XX","GradientOffsetInZ"],[67,4101,"XX","ImgIsOriginalOrUnoriginal"],[67,4102,"XX","NumberOfEPIShots"],[67,4103,"XX","ViewsPerSegment"],[67,4104,"XX","RespiratoryRateBpm"],[67,4105,"XX","RespiratoryTriggerPoint"],[67,4106,"XX","TypeOfReceiverUsed"],[67,4107,"XX","PeakRateOfChangeOfGradientField"],[67,4108,"XX","LimitsInUnitsOfPercent"],[67,4109,"XX","PSDEstimatedLimit"],[67,4110,"XX","PSDEstimatedLimitInTeslaPerSecond"],[67,4111,"XX","Saravghead"],[67,4112,"XX","WindowValue"],[67,4113,"XX","TotalInputViews"],[67,4114,"XX","XRayChain"],[67,4115,"XX","DeconKernelParameters"],[67,4116,"XX","CalibrationParameters"],[67,4117,"XX","TotalOutputViews"],[67,4118,"XX","NumberOfOverranges"],[67,4119,"XX","IBHImageScaleFactors"],[67,4120,"XX","BBHCoefficients"],[67,4121,"XX","NumberOfBBHChainsToBlend"],[67,4122,"XX","StartingChannelNumber"],[67,4123,"XX","PpscanParameters"],[67,4124,"XX","GEImageIntegrity"],[67,4125,"XX","LevelValue"],[67,4126,"XX","DeltaStartTime"],[67,4127,"XX","MaxOverrangesInAView"],[67,4128,"XX","AvgOverrangesAllViews"],[67,4129,"XX","CorrectedAfterGlowTerms"],[67,4133,"XX","ReferenceChannels"],[67,4134,"XX","NoViewsRefChansBlocked"],[67,4135,"XX","ScanPitchRatio"],[67,4136,"XX","UniqueImageIden"],[67,4137,"XX","HistogramTables"],[67,4138,"XX","UserDefinedData"],[67,4139,"XX","PrivateScanOptions"],[67,4140,"XX","EffectiveEchoSpacing"],[67,4141,"XX","StringSlopField1"],[67,4142,"XX","StringSlopField2"],[67,4143,"XX","RawDataType"],[67,4144,"XX","RawDataType"],[67,4145,"XX","RACordOfTargetReconCenter"],[67,4146,"XX","RawDataType"],[67,4147,"XX","NegScanspacing"],[67,4148,"XX","OffsetFrequency"],[67,4149,"XX","UserUsageTag"],[67,4150,"XX","UserFillMapMSW"],[67,4151,"XX","UserFillMapLSW"],[67,4152,"XX","User25_48"],[67,4153,"XX","SlopInt6_9"],[67,4160,"XX","TriggerOnPosition"],[67,4161,"XX","DegreeOfRotation"],[67,4162,"XX","DASTriggerSource"],[67,4163,"XX","DASFpaGain"],[67,4164,"XX","DASOutputSource"],[67,4165,"XX","DASAdInput"],[67,4166,"XX","DASCalMode"],[67,4167,"XX","DASCalFrequency"],[67,4168,"XX","DASRegXm"],[67,4169,"XX","DASAutoZero"],[67,4170,"XX","StartingChannelOfView"],[67,4171,"XX","DASXmPattern"],[67,4172,"XX","TGGCTriggerMode"],[67,4173,"XX","StartScanToXrayOnDelay"],[67,4174,"XX","DurationOfXrayOn"],[67,4192,"XX","SlopInt10_17"],[67,4193,"XX","ScannerStudyEntityUID"],[67,4194,"XX","ScannerStudyID"],[67,4207,"XX","ScannerTableEntry"],[67,4221,"US","ReconModeFlagWord "],[67,4224,"LO","CoilIDData"],[67,4225,"LO","GECoilName"],[67,4226,"LO","SystemConfigurationInformation"],[67,4227,"DS","AssetRFactors"],[67,4228,"LO","AdditionalAssetData"],[67,4233,"LO","GoverningBodyAndSARDefinition"],[67,4234,"CS","PrivateInPlanePhaseEncodingDirection"],[67,4240,"LO","SARDefinition"],[67,4241,"DS","SARValue"],[67,4245,"LO","PrescanReuseString"],[67,4246,"CS","ContentQualification"],[67,4247,"LO","ImageFilteringParameters"],[67,4250,"IS","RxStackIdentification"],[67,4266,"LO","AdditionalFilteringParameters"],[67,4273,"SS","ExcitationMode"],[69,16,"LO","PrivateCreator"],[69,4097,"XX","NumberOfMacroRowsInDetector"],[69,4098,"XX","MacroWidthAtISOCenter"],[69,4099,"XX","DASType"],[69,4100,"XX","DASGain"],[69,4102,"XX","TableDirectionInOrOut"],[69,4103,"XX","ZSmoothingFactor"],[69,4104,"XX","ViewWeightingMode"],[69,4105,"XX","SigmaRowNumberWhichRowsWereUsed"],[69,4106,"XX","MinimumDasValueFoundInTheScanData"],[69,4107,"XX","MaximumOffsetShiftValueUsed"],[69,4108,"XX","NumberOfViewsShifted"],[69,4109,"XX","ZTrackingFlag"],[69,4110,"XX","MeanZError"],[69,4111,"XX","ZTrackingMaximumError"],[69,4112,"XX","StartingViewForRow2a"],[69,4113,"XX","NumberOfViewsInRow2a"],[69,4114,"XX","StartingViewForRow1a"],[69,4115,"XX","SigmaMode"],[69,4116,"XX","NumberOfViewsInRow1a"],[69,4117,"XX","StartingViewForRow2b"],[69,4118,"XX","NumberOfViewsInRow2b"],[69,4119,"XX","StartingViewForRow1b"],[69,4120,"XX","NumberOfViewsInRow1b"],[69,4129,"XX","PrivateTag"],[69,4130,"XX","PrivateTag"],[69,4146,"XX","PrivateTag"],[83,16,"LO","PrivateCreator"],[83,4128,"XX","PrivateTag"],[83,4160,"XX","PrivateTag"],[83,4161,"XX","PrivateTag"],[83,4162,"XX","PrivateTag"],[83,4163,"XX","PrivateTag"],[83,4194,"XX","PrivateTag"],[136,320,"XX","StorageMediaFileSetUid"],[136,512,"XX","IconImageSequence"],[8193,4099,"XX","Unknown"],[8193,4106,"XX","Unknown"],[8193,4206,"XX","Unknown"],[8197,18,"XX","Unknown"],[8197,19,"XX","Unknown"],[8197,20,"XX","Unknown"],[8197,4627,"XX","Unknown"],[8197,5126,"XX","Unknown"],[21811,4611,"XX",'"Unknown'],[21811,21777,"XX",'"Unknown'],[32736,0,"IM","PixelDataGroupLength"],[32736,16,"IM","PixelData"]]}return Object(h.a)(e,[{key:"getVr",value:function(e,t){for(var i="",r=this.TAGS.length,a=0;a<r;a++)this.TAGS[a][0]===e&&this.TAGS[a][1]===t&&(i=this.TAGS[a][2]);return 0===t&&(i="UL"),i}},{key:"getTextDesc",value:function(e,t){for(var i="?",r=this.TAGS.length,a=0;a<r;a++)this.TAGS[a][0]===e&&this.TAGS[a][1]===t&&(i=this.TAGS[a][3]);return i}}]),e}(),gt=function e(){Object(u.a)(this,e),this.m_patientName="",this.m_patientDateOfBirth="",this.m_studyDescr="",this.m_studyDate="",this.m_seriesTime="",this.m_seriesDescr="",this.m_bodyPartExamined="",this.m_institutionName="",this.m_operatorsName="",this.m_physicansName="",this.m_patientId="",this.m_patientGender="",this.m_acquisionTime="",this.m_manufacturerName="",this.m_sliceInfo=[]},St=[2,16],xt=[2,0],yt=[32736,16],bt=function(){function e(t,i,r,a,s,n,o,l){Object(u.a)(this,e),this.m_group=t,this.m_element=i,this.m_vr=r,this.m_value=a,this.m_offsetStart=s,this.m_offsetValue=n,this.m_offsetEnd=o,this.m_littleEndian=l}return Object(h.a)(e,[{key:"value",value:function(){return this.m_value}},{key:"isTransformSyntax",value:function(){return this.m_group===St[0]&&this.m_element===St[1]}},{key:"isMetaLength",value:function(){return this.m_group===xt[0]&&this.m_element===xt[1]}},{key:"isPixelData",value:function(){return this.m_group===yt[0]&&this.m_element===yt[1]}}]),e}(),Tt=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,null,[{key:"getHash",value:function(e){for(var t=e.length,i=53*t,r=0;r<t;r++){i=(i*=137211941^e.charCodeAt(r))<<27|i>>5,i&=1073741823}return i}}]),e}(),Ot=function(){function e(){Object(u.a)(this,e),this.m_image=null,this.m_sliceNumber=0,this.m_sliceLocation=0,this.m_patientName="",this.m_studyDescr="",this.m_studyDate="",this.m_seriesTime="",this.m_seriesDescr="",this.m_bodyPartExamined="",this.m_hash=0,this.m_xDim=0,this.m_yDim=0}return Object(h.a)(e,[{key:"buildHash",value:function(){var e=this.m_patientName+this.m_studyDescr+this.m_studyDate+this.m_seriesTime+this.m_seriesDescr+this.m_bodyPartExamined;this.m_hash=Tt.getHash(e)}}]),e}(),Dt=function(){function e(t){Object(u.a)(this,e),console.assert(void 0!==t),console.assert("number"===typeof t,"hash shold be number"),this.m_hash=t,this.m_slices=[],this.m_minSlice=555555555555.5,this.m_maxSlice=-555555555555.5}return Object(h.a)(e,[{key:"addSlice",value:function(e){console.assert(void 0!==e),console.assert(e instanceof Ot,"added slice should be DicomSlice object"),this.m_slices.push(e),this.m_minSlice=e.m_sliceNumber<this.m_minSlice?e.m_sliceNumber:this.m_minSlice,this.m_maxSlice=e.m_sliceNumber>this.m_maxSlice?e.m_sliceNumber:this.m_maxSlice}}]),e}(),Rt=function(){function e(){Object(u.a)(this,e),this.m_series=[]}return Object(h.a)(e,[{key:"destroy",value:function(){this.m_series=[]}},{key:"getSeries",value:function(){return this.m_series}},{key:"addSlice",value:function(e){console.assert(void 0!==e),console.assert(e instanceof Ot,"should be DicomSlice object"),console.assert(void 0!==e.m_hash),console.assert(0!==e.m_hash);var t=this.getSerieIndex(e);if(t<0){var i=new Dt(e.m_hash);this.m_series.push(i),t=this.m_series.length-1}this.m_series[t].addSlice(e)}},{key:"getSerieIndex",value:function(e){for(var t=this.m_series.length,i=0;i<t;i++){if(this.m_series[i].m_hash===e.m_hash)return i}return-1}}]),e}(),wt=function e(){Object(u.a)(this,e),this.m_sliceName="",this.m_fileName="",this.m_tags=[]},jt=function e(){Object(u.a)(this,e),this.m_tag="",this.m_attrName="",this.m_attrValue=""},Xt=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,[{key:"isValidUrl",value:function(e){var t=e.match(/^((ftp|http|https):\/\/)?(([\S]+)\.)?([\S]+)\.([A-z]{2,})(:\d{1,6})?\/[\S]+/),i=e.match(/(ftp|http|https):\/\/([\d]+)\.([\d]+)\.([\d]+)\.([\d]+)(:([\d]+))?\/([\S]+)/);return null!==t||null!==i}},{key:"getFileNameFromUrl",value:function(e){var t=e.lastIndexOf("/");if(t<0&&(t=e.lastIndexOf("\\")),t<0)return console.log("getFileNameFromUrl: wrong URL!"),"";var i=e.substring(t+1);return i=i.length<=40?i:i.substring(0,40)}},{key:"getFolderNameFromUrl",value:function(e){var t=e.lastIndexOf("/");return t<0&&(t=e.lastIndexOf("\\")),t<0?(console.log("getFolderNameFromUrl: wrong URL!"),""):e.substring(0,t)}},{key:"isUrlExists",value:function(e){var t=null;window.XMLHttpRequest&&(t=new XMLHttpRequest);t.open("GET",e,!0),t.send();return 404!==t.status}},{key:"encodeUrl",value:function(e){for(var t="",i=!1,r=e.length,a=0;a<r;a++){var s=e[a];if(i&&!("/"===s||"."===s||"-"===s||"_"===s)){var n=e.charCodeAt(a);t+=String.fromCharCode(n+1)}else t+=s;i="."===s||i}return t}},{key:"decodeUrl",value:function(e){for(var t="",i=!1,r=e.length,a=0;a<r;a++){var s=e[a];if(i&&!("/"===s||"."===s||"-"===s||"_"===s)){var n=e.charCodeAt(a);t+=String.fromCharCode(n-1)}else t+=s;i="."===s||i}return console.log("".concat(t)),t}}]),e}(),Et=!1,It=[68,73,67,77],At=4294967295,Mt=1073741823,Ct=[32,19],Ft=[32736,16],Vt=[40,256],Ut=[40,16],Pt=[40,17],Nt=[40,258],kt=[40,262],Lt=[40,263],Bt=[40,288],zt=[40,48],Gt=[40,4176],Wt=[40,4177],Ht=[40,4178],qt=[40,4179],Yt=[40,4180],Zt=[40,259],Kt=[32,50],Qt=[32,4161],Jt=[40,2],$t=[8,4158],ei=[8,49],ti=[65534,57357],ii=[65534,57565],ri=[32,17],ai=[24,80],si=[24,21],ni="1.2.840.10008.1.2.4",oi="1.2.840.10008.1.2.4.57",li="1.2.840.10008.1.2.4.70",mi="1.2.840.10008.1.2.4.50",ui='"1.2.840.10008.1.2.4.51',hi="1.2.840.10008.1.2.4.90",ci="1.2.840.10008.1.2.4.91",di="1.2.840.10008.1.2.5",_i=[16,16],fi=[16,32],vi=[16,48],pi=[16,64],gi=[8,32],Si=[8,4144],xi=[8,50],yi=[8,128],bi=[8,144],Ti=[8,112],Oi=[8,4208],Di=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(u.a)(this,e),this.m_xDim=-1,this.m_yDim=-1,this.m_zDim=t,this.m_needScaleDownTexture=i,this.m_folder=null,this.m_isLoadedSuccessfull=!1,this.m_dataSize=0,this.m_dataArray=null,this.m_dictionary=new pt,this.m_imageNumber=-1,this.m_errors=[],this.m_transformSyntax="",this.m_loaders=[],this.m_xDim=-1,this.m_yDim=-1,this.m_bitsPerPixel=-1,this.m_padValue=-1073741823,this.m_windowCenter=Mt,this.m_windowWidth=Mt,this.m_rescaleIntercept=0,this.m_rescaleSlope=1,this.m_rescaleHounsfield=!1,this.m_pixelRepresentaionSigned=!1,this.m_littleEndian=!0,this.m_samplesPerPixel=1,this.m_seriesNumber=-1,this.m_seriesDescr="",this.m_boxSize={x:1,y:1,z:1},this.m_nonEmptyBoxMin={x:0,y:0,z:0},this.m_nonEmptyBoxMax={x:1,y:1,z:1},this.m_slicesVolume=new Rt,this.m_newTagEvent=new CustomEvent("newTag",{detail:{group:null,element:null,desc:null,value:null,imageNumber:null,fileName:null}}),this.m_dicomInfo=new gt,this.m_pixelSpacing={x:0,y:0,z:0},this.m_filesLoadedCounter=0,this.m_numLoadedFiles=t,this.m_imagePosMin={x:1e12,y:1e12,z:1e12},this.m_imagePosMax={x:-1e12,y:-1e12,z:-1e12},this.m_sliceLocMin=1e12,this.m_sliceLocMax=-1e12,this.runLoader=this.runLoader.bind(this)}return Object(h.a)(e,[{key:"getBoxSize",value:function(){return this.m_boxSize}},{key:"getNonEmptyBoxMin",value:function(){return this.m_nonEmptyBoxMin}},{key:"getNonEmptyBoxMax",value:function(){return this.m_nonEmptyBoxMax}},{key:"getDicomInfo",value:function(){return this.m_dicomInfo}},{key:"createVolumeFromSlices",value:function(e,t,i){console.assert(null!=e,"Null volume"),console.assert(e instanceof ji,"Should be volume set"),console.assert("number"===typeof t,"index should be number"),console.assert("number"===typeof i,"index should be number");var r=null;t<e.getNumVolumes()?r=e.getVolume(t):(r=new rt,e.addVolume(r),r=e.getVolume(t),console.assert(null!==r));for(var a=this.m_slicesVolume.m_series.length,s=-1,n=0;n<a;n++)if(this.m_slicesVolume.m_series[n].m_hash===i){s=n;break}console.assert(s>=0);var o=this.m_slicesVolume.m_series[s],l=o.m_slices[0],m=o.m_slices.length;this.m_xDim=l.m_xDim,this.m_yDim=l.m_yDim,this.m_zDim=o.m_slices.length;var u,h,c=this.m_xDim*this.m_yDim,d={x:this.m_imagePosMax.x-this.m_imagePosMin.x,y:this.m_imagePosMax.y-this.m_imagePosMin.y,z:this.m_imagePosMax.z-this.m_imagePosMin.z},_=1e-5;Math.abs(this.m_pixelSpacing.z)>_?u=this.m_pixelSpacing.z*this.m_zDim:(u=d.z,Math.abs(u)<_&&(u=d.x,Math.abs(u)<_&&(u=d.y))),u<_&&(u=1),this.m_pixelSpacing.x*this.m_pixelSpacing.y<_&&(this.m_pixelSpacing.x=1,this.m_pixelSpacing.y=1),this.m_pixelSpacing.z=u/this.m_zDim,this.m_boxSize.z=this.m_zDim*this.m_pixelSpacing.z,this.m_boxSize.x=this.m_xDim*this.m_pixelSpacing.x,this.m_boxSize.y=this.m_yDim*this.m_pixelSpacing.y,console.log("createVolumeFromSlices. Volume local phys dim: ".concat(this.m_boxSize.x," * ").concat(this.m_boxSize.y," * ").concat(this.m_boxSize.z));var f,v=null;if(!this.m_littleEndian)for(var p=0;p<a;p++){var g=this.m_slicesVolume.m_series[p];if(g.m_hash===i)for(var S=0;S<m;S++){var x=g.m_slices[S],y=x.m_image;for(c=x.m_xDim*x.m_yDim,h=0;h<c;h++){var b=y[h];y[h]=b>>8|b<<8&65535}}}for(var T=0;T<a;T++){var O=this.m_slicesVolume.m_series[T];if(O.m_hash===i)for(var D=0;D<m;D++){var R=O.m_slices[D];for(c=R.m_xDim*R.m_yDim,h=0;h<c;h++){var w=R.m_image[h];w===this.m_padValue&&(w=0),R.m_image[h]=w}}}for(var j=-1073741823,X=1073741823,E=0;E<a;E++){var I=this.m_slicesVolume.m_series[E];if(I.m_hash===i)for(var A=0;A<m;A++){var M=I.m_slices[A],C=M.m_image;for(c=M.m_xDim*M.m_yDim,h=0;h<c;h++){var F=C[h]*this.m_rescaleSlope+this.m_rescaleIntercept;X=F<X?F:X,j=F>j?F:j}}}console.log("Build Volume. min/max value=".concat(X,"/").concat(j,". Volume dim = ").concat(this.m_xDim,"*").concat(this.m_yDim,"*").concat(this.m_zDim)),console.log("Min slice number = ".concat(o.m_minSlice)),console.log("Max slice number = ".concat(o.m_maxSlice)),j=j-X>0?j:j+1;var V=Math.floor((1<<19)/(j-X));if(V<=4)return console.log("Bad scaling: image will be 0"),at.ERROR_SCALING;var U=o.m_slices,P=o.m_maxSlice-o.m_minSlice+1;P!==m&&console.log("Sort by location! N slices by tags = ".concat(P,", but N readed slices = ").concat(m));for(var N=U[0].m_sliceNumber,k=U[0].m_sliceNumber,L=0;L<m;L++){var B=U[L].m_sliceNumber;N=B<N?B:N,k=B>k?B:k}k-N>0?U.sort((function(e,t){return e.m_sliceNumber-t.m_sliceNumber})):U.sort((function(e,t){return e.m_sliceLocation-t.m_sliceLocation}));for(var z=0,G=0;G<m;G++)U[G].m_sliceNumber=z,z++;if(this.m_zDim=m,f=this.m_xDim*this.m_yDim*this.m_zDim,null===(v=new Uint8Array(f)))return console.log("no memory"),at.ERROR_NO_MEMORY;for(h=0;h<f;h++)v[h]=0;for(var W=0;W<m;W++){var H=U[W];c=H.m_xDim*H.m_yDim;var q=H.m_image,Y=H.m_sliceNumber;if(Y>=o.m_slices.length&&((Y=H.m_sliceNumber-o.m_minSlice)<0||Y>=this.m_zDim))return console.log("Invalid z slice reference"),at.ERROR_INVALID_SLICE_INDEX;if(null!==q){var Z=Y*c;if(this.m_windowCenter!==Mt&&this.m_windowWidth!==Mt){var K=this.m_windowCenter-.5*this.m_windowWidth;for(h=0;h<c;h++){var Q=q[h]*this.m_rescaleSlope+this.m_rescaleIntercept,J=0;J=(J=(J=this.m_rescaleHounsfield?Math.floor(255*(Q-K)/this.m_windowWidth):Math.floor(127+128*(Q-this.m_windowCenter)/(this.m_windowWidth/2)))>=0?J:0)<255?J:255,v[Z+h]=J}}else for(h=0;h<c;h++){var $=(q[h]*this.m_rescaleSlope+this.m_rescaleIntercept-X)*V>>11;$=$<=255?$:255,v[Z+h]=$}}}var ee=this.m_xDim*this.m_yDim*this.m_zDim;if(this.m_needScaleDownTexture&&ee>67108864){var te=512,ie=this.m_xDim<=te?this.m_xDim:te,re=this.m_yDim<=te?this.m_yDim:te;v=VolumeTools.scaleTextureDown(this,v,ie,re,120),c=this.m_xDim*this.m_yDim,console.log("Volume scaled down to: ".concat(ie," * ").concat(re," * ").concat(120,"."))}if(this.m_zDim>4){var ae,se,ne,oe,le,me=(ne=0)*this.m_xDim*this.m_yDim,ue=(ne=this.m_zDim-1)*this.m_xDim*this.m_yDim;for(se=0;se<this.m_yDim;se++)for(oe=se*this.m_xDim,ae=0;ae<this.m_xDim;ae++)v[me+oe+ae]=0,v[ue+oe+ae]=0;var he=ae=0,ce=ae=this.m_xDim-1;for(ne=0;ne<this.m_zDim;ne++)for(le=ne*this.m_xDim*this.m_yDim,se=0;se<this.m_yDim;se++)v[le+(oe=se*this.m_xDim)+he]=0,v[le+oe+ce]=0;var de=(se=0)*this.m_xDim,_e=(se=this.m_yDim-1)*this.m_xDim;for(ne=0;ne<this.m_zDim;ne++)for(le=ne*this.m_xDim*this.m_yDim,ae=0;ae<this.m_xDim;ae++)v[le+ae+de]=0,v[le+ae+_e]=0}var fe=6403,ve={m_pixelWidth:this.m_xDim,m_pixelHeight:this.m_yDim,m_pixelDepth:this.m_zDim,m_glType:5121,m_glTypeSize:1,m_glFormat:fe,m_glInternalFormat:fe,m_glBaseInternalFormat:fe},pe=this.m_callbackComplete;pe&&pe(at.SUCCESS,ve,f,v);return r.m_xDim=this.m_xDim,r.m_yDim=this.m_yDim,r.m_zDim=this.m_zDim,r.m_dataArray=v,r.m_dataSize=f,r.m_bytesPerVoxel=1,r.m_boxSize.x=this.m_boxSize.x,r.m_boxSize.y=this.m_boxSize.y,r.m_boxSize.z=this.m_boxSize.z,r.m_patientName=this.m_dicomInfo.m_patientName,r.m_patientBirth=this.m_dicomInfo.m_patientDateOfBirth,r.m_seriesDescr=this.m_dicomInfo.m_seriesDescr,r.m_studyDescr=this.m_dicomInfo.m_studyDescr,r.m_studyDate=this.m_dicomInfo.m_studyDate,r.m_seriesTime=this.m_dicomInfo.m_seriesTime,r.m_bodyPartExamined=this.m_dicomInfo.m_bodyPartExamined,r.m_institutionName=this.m_dicomInfo.m_institutionName,r.m_operatorsName=this.m_dicomInfo.m_operatorsName,r.m_physicansName=this.m_dicomInfo.m_physicansName,r.createIcon(),at.SUCCESS}},{key:"getNextTag",value:function(t,i){if(i>=t.byteLengh)return null;var r=!0,a=0,s=0,n=0,o=i,l="";this.m_metaFinished?(r=this.m_littleEndian,a=t.getUint16(i,r)):(a=t.getUint16(i,1),-1!==this.m_metaFinishedOffset&&i>=this.m_metaFinishedOffset||2!==a?(this.m_metaFinished=1,r=this.m_littleEndian,a=t.getUint16(i,r)):r=!0),this.m_metaFound||2!==a||(this.m_metaFound=!0),i+=2,s=t.getUint16(i,r),i+=2,this.m_explicit||!this.m_metaFinished?(l=e.getStringAt(t,i,2),!this.m_metaFound&&this.m_metaFinished&&-1===e.getVrsStringIndex(l)?(l=pt.getVr(a,s),n=t.getUint32(i,r),i+=4,this.m_explicit=!1):(i+=2,-1!==e.getDataVrsStringIndex(l)?(i+=2,n=t.getUint32(i,r),i+=4):(n=t.getUint16(i,r),i+=2))):(l=this.m_dictionary.getVr(a,s),(n=t.getUint32(i,r))===At&&(l="SQ"),i+=4);var m=i,u=null;if("SQ"===l){if(n===At){for(var h=0,c=0;h!==ii[0]||c!==ii[1];){h=t.getUint16(i,r),i+=2,c=t.getUint16(i,r),i+=2;var d=t.getUint32(i,r);if(i+=4,d===At){for(;!(h===ti[0]&&c===ti[1]||h===ii[0]&&c===ii[1]);){i=this.getNextTag(t,i).m_offsetEnd,h=t.getUint16(i,r),c=t.getUint16(i+2,r)}i+=8}else i+=d}n=0}}else n>0&&(n===At&&a===Ft[0]&&s===Ft[1]&&(n=t.byteLength-i),u=t.buffer.slice(i,i+n));if(4294967295===n)return null;var _=new bt(a,s,l,u,o,m,i+=n,this.m_littleEndian);if(_&&(this.m_newTagEvent.detail.group=a.toString(16),this.m_newTagEvent.detail.element=s.toString(16),this.m_newTagEvent.detail.desc=this.m_dictionary.getTextDesc(a,s),this.m_newTagEvent.detail.value=e.getAttrValueAsString(_),this.m_newTagEvent.detail.imageNumber=a===Ct[0]&&s===Ct[1]?parseInt(this.m_newTagEvent.detail.value,10):-1,dispatchEvent(this.m_newTagEvent)),_.isTransformSyntax()){var f=_.m_value.byteLength,v=new DataView(_.m_value),p=e.getStringAt(v,0,f);"1.2.840.10008.1.2"===p?(this.m_explicit=!1,this.m_littleEndian=!0):"1.2.840.10008.1.2.2"===p?(this.m_explicit=!0,this.m_littleEndian=!1):"1.2.840.10008.1.2.1.99"===p?(this.m_needsDeflate=!0,this.m_explicit=!0,this.m_littleEndian=!0):p==ni?this.m_transformSyntax=ni:p==li?this.m_transformSyntax=li:p==oi?this.m_transformSyntax=oi:p==mi?this.m_transformSyntax=mi:p==ui?this.m_transformSyntax=ui:p==hi?this.m_transformSyntax=hi:p==ci?this.m_transformSyntax=ci:p==di?this.m_transformSyntax=di:(this.m_explicit=!0,this.m_littleEndian=!0)}else _.isMetaLength()&&(this.m_metaFinishedOffset=_.m_value[0]+i);return _}},{key:"readFromGoogleBuffer",value:function(t,i,r,a,s,n){var o=new DataView(a),l=(o.byteLength,e.getStringAt(o,64,32));if("Content-Type: application/dicom;"===l){var m=a.slice(136);new DataView(m);return this.readFromBuffer(t,i,r,m,s,n)}return console.log("readFromGoogleBuffer. bad content type = ".concat(l)),at.BAD_HEADER}},{key:"readFromBuffer",value:function(t,i,r,a,s,n){"number"!==typeof t&&console.log("LoaderDicom.readFromBuffer: bad indexFile argument"),"string"!==typeof i&&console.log("LoaderDicom.readFromBuffer: bad fileName argument"),"object"!==typeof a&&console.log("LoaderDicom.readFromBuffer: bad arrBuf argument");var o=this.m_dicomInfo,l=new wt,m="Slice "+t.toString();l.m_sliceName=m,l.m_fileName=i,l.m_tags=[],o.m_sliceInfo.push(l);var u=new DataView(a);if(null===u)return console.log("No memory"),at.ERROR_NO_MEMORY;if(u.byteLength<144)return this.m_error=at.ERROR_TOO_SMALL_DATA_SIZE,void 0!==n&&n(at.ERROR_TOO_SMALL_DATA_SIZE),at.ERROR_TOO_SMALL_DATA_SIZE;for(var h=0;h<4;h++){if(u.getUint8(128+h)!==It[h])return this.m_errors[t]=-1,console.log("Dicom readFromBuffer. Wrong header in file: ".concat(i)),void 0!==n&&n(at.WRONG_HEADER_MAGIC),at.WRONG_HEADER_MAGIC}var c=128;c+=4,this.m_littleEndian=!0,this.m_explicit=!0,this.m_metaFound=!1,this.m_metaFinished=!1,this.m_metaFinishedOffset=-1,this.m_needsDeflate=!1,this.m_imageNumber=-1,this.m_xDim=-1,this.m_yDim=-1,this.m_bitsPerPixel=-1,this.m_windowCenter=-1,this.m_windowWidth=-1;var d,_=0,f=0,v=!1;for(d=this.getNextTag(u,c);null!==d;){if(d.isPixelData()){v=!0;break}if(c=d.m_offsetEnd,null===(d=this.getNextTag(u,c)))break;var p=this.m_dicomInfo,g=p.m_sliceInfo.length,S=p.m_sliceInfo[g-1],x=new jt;x.m_tag="("+e.numberToHexString(d.m_group)+","+e.numberToHexString(d.m_element)+")";var y=this.m_dictionary.getTextDesc(d.m_group,d.m_element);x.m_attrName=y.length>1?y:"";var b=e.getAttrValueAsString(d);if(b=null!==b?b:"",x.m_attrValue=b,S.m_tags.push(x),d.m_group===Ct[0]&&d.m_element===Ct[1]){var T=d.m_value.byteLength,O=new DataView(d.m_value),D=e.getStringAt(O,0,T);this.m_imageNumber=parseInt(D,10)-1}if(d.m_group===Ut[0]&&d.m_element===Ut[1]){var R=d.m_value.byteLength,w=new DataView(d.m_value),j=2===R?w.getUint16(0,this.m_littleEndian):w.getUint32(0,this.m_littleEndian);if(this.m_yDim<0)this.m_yDim=j;else if(this.m_yDim!==j)return console.log("Bad image size y"),void 0!==n&&n(at.WRONG_IMAGE_DIM_Y),at.WRONG_IMAGE_DIM_Y}if(d.m_group===Pt[0]&&d.m_element===Pt[1]){var X=d.m_value.byteLength,E=new DataView(d.m_value),I=2===X?E.getUint16(0,this.m_littleEndian):E.getUint32(0,this.m_littleEndian);if(this.m_xDim<0)this.m_xDim=I;else if(this.m_xDim!==I)return console.log("Bad image size x"),void 0!==n&&n(at.WRONG_IMAGE_DIM_X),at.WRONG_IMAGE_DIM_X}if(d.m_group===Vt[0]&&d.m_element===Vt[1]){var A=d.m_value.byteLength,M=new DataView(d.m_value);this.m_bitsPerPixel=2===A?M.getUint16(0,this.m_littleEndian):M.getUint32(0,this.m_littleEndian)}if(d.m_group===Gt[0]&&d.m_element===Gt[1]&&null!=d.m_value&&d.m_value.byteLength>0){var C=d.m_value.byteLength,F=new DataView(d.m_value),V=e.getStringAt(F,0,C);this.m_windowCenter=parseInt(V,10)}if(d.m_group===Wt[0]&&d.m_element===Wt[1]&&null!=d.m_value&&d.m_value.byteLength>0){var U=d.m_value.byteLength,P=new DataView(d.m_value),N=e.getStringAt(P,0,U);this.m_windowWidth=parseInt(N,10)}if(d.m_group===Ht[0]&&d.m_element===Ht[1]&&null!=d.m_value&&d.m_value.byteLength>0){var k=d.m_value.byteLength,L=new DataView(d.m_value),B=e.getStringAt(L,0,k);this.m_rescaleIntercept=parseInt(B,10)}if(d.m_group===qt[0]&&d.m_element===qt[1]&&null!=d.m_value&&d.m_value.byteLength>0){var z=d.m_value.byteLength,G=new DataView(d.m_value),W=e.getStringAt(G,0,z);this.m_rescaleSlope=parseInt(W,10)}if(d.m_group===Yt[0]&&d.m_element===Yt[1]&&null!=d.m_value&&d.m_value.byteLength>0){var H=d.m_value.byteLength,q=new DataView(d.m_value);"HU"===e.getStringAt(q,0,H)&&(this.m_rescaleHounsfield=!0)}if(d.m_group===Zt[0]&&d.m_element===Zt[1]&&null!=d.m_value&&d.m_value.byteLength>0){var Y=d.m_value.byteLength,Z=new DataView(d.m_value);1===(2===Y?Z.getUint16(0,this.m_littleEndian):Z.getUint32(0,this.m_littleEndian))&&(this.m_pixelRepresentaionSigned=!0)}if(d.m_group===ri[0]&&d.m_element===ri[1]&&null!=d.m_value&&d.m_value.byteLength>0){var K=d.m_value.byteLength,Q=new DataView(d.m_value),J=e.getStringAt(Q,0,K);this.m_seriesNumber=parseInt(J,10)}if(d.m_group===$t[0]&&d.m_element===$t[1]&&null!==d.m_value){var $=d.m_value.byteLength,ee=new DataView(d.m_value);this.m_seriesDescr=e.getStringAt(ee,0,$)}if(d.m_group===Nt[0]&&d.m_element===Nt[1]){var te=d.m_value.byteLength,ie=new DataView(d.m_value),re=2===te?ie.getUint16(0,this.m_littleEndian):ie.getUint32(0,this.m_littleEndian);_=(1<<re+1)-1}if(d.m_group===kt[0]&&d.m_element===kt[1]){var ae=d.m_value.byteLength,se=new DataView(d.m_value);2===ae?se.getInt16(0,this.m_littleEndian):se.getInt32(0,this.m_littleEndian)}if(d.m_group===Lt[0]&&d.m_element===Lt[1]){var ne=d.m_value.byteLength,oe=new DataView(d.m_value);2===ne?oe.getInt16(0,this.m_littleEndian):oe.getInt32(0,this.m_littleEndian)}if(d.m_group===Bt[0]&&d.m_element===Bt[1]){var le=d.m_value.byteLength,me=new DataView(d.m_value);f=2===le?me.getUint16(0,this.m_littleEndian):me.getUint32(0,this.m_littleEndian),this.m_padValue=f}if(d.m_group===zt[0]&&d.m_element===zt[1]){var ue=d.m_value.byteLength,he=new DataView(d.m_value),ce=e.getStringAt(he,0,ue).split("\\");2===ce.length&&(this.m_pixelSpacing.x=parseFloat(ce[0]),this.m_pixelSpacing.y=parseFloat(ce[1]))}if(d.m_group===Kt[0]&&d.m_element===Kt[1]){var de=d.m_value.byteLength,_e=new DataView(d.m_value),fe=e.getStringAt(_e,0,de).split("\\");if(3===fe.length){var ve=parseFloat(fe[0]),pe=parseFloat(fe[1]),ge=parseFloat(fe[2]);this.m_imagePosMin.x=ve<this.m_imagePosMin.x?ve:this.m_imagePosMin.x,this.m_imagePosMin.y=pe<this.m_imagePosMin.y?pe:this.m_imagePosMin.y,this.m_imagePosMin.z=ge<this.m_imagePosMin.z?ge:this.m_imagePosMin.z,this.m_imagePosMax.x=ve>this.m_imagePosMax.x?ve:this.m_imagePosMax.x,this.m_imagePosMax.y=pe>this.m_imagePosMax.y?pe:this.m_imagePosMax.y,this.m_imagePosMax.z=ge>this.m_imagePosMax.z?ge:this.m_imagePosMax.z}}if(d.m_group===ai[0]&&d.m_element===ai[1]){var Se=d.m_value.byteLength,xe=new DataView(d.m_value),ye=e.getStringAt(xe,0,Se);this.m_pixelSpacing.z=parseFloat(ye)}if(d.m_group===Qt[0]&&d.m_element===Qt[1]){var be=d.m_value.byteLength,Te=new DataView(d.m_value),Oe=e.getStringAt(Te,0,be),De=parseFloat(Oe);this.m_sliceLocation=De,this.m_sliceLocMin=De<this.m_sliceLocMin?De:this.m_sliceLocMin,this.m_sliceLocMax=De>this.m_sliceLocMax?De:this.m_sliceLocMax}if(d.m_group===Jt[0]&&d.m_element===Jt[1]){var Re=d.m_value.byteLength,we=new DataView(d.m_value);this.m_samplesPerPixel=2===Re?we.getUint16(0,this.m_littleEndian):we.getUint32(0,this.m_littleEndian)}if(d.m_group===$t[0]&&d.m_element===$t[1]&&null!==d.m_value){var je=d.m_value.byteLength,Xe=new DataView(d.m_value),Ee=e.getStringAt(Xe,0,je);this.m_dicomInfo.m_seriesDescr=Ee}if(d.m_group===ei[0]&&d.m_element===ei[1]&&null!==d.m_value){var Ie=d.m_value.byteLength,Ae=new DataView(d.m_value),Me=e.getStringAt(Ae,0,Ie),Ce=Me.substring(0,2),Fe=Me.substring(2,4),Ve=Me.substring(4,Me.length),Ue="".concat(Ce,":").concat(Fe,":").concat(Ve);this.m_dicomInfo.m_seriesTime=Ue}if(d.m_group===_i[0]&&d.m_element===_i[1]&&null!==d.m_value){var Pe=d.m_value.byteLength,Ne=new DataView(d.m_value);this.m_dicomInfo.m_patientName=e.getUtf8StringAt(Ne,0,Pe),this.m_dicomInfo.m_patientName=this.m_dicomInfo.m_patientName.trim()}if(d.m_group===fi[0]&&d.m_element===fi[1]&&null!==d.m_value){var ke=d.m_value.byteLength,Le=new DataView(d.m_value);this.m_dicomInfo.m_patientId=e.getStringAt(Le,0,ke)}if(d.m_group===pi[0]&&d.m_element===pi[1]&&null!==d.m_value){var Be=d.m_value.byteLength,ze=new DataView(d.m_value);this.m_dicomInfo.m_patientGender=e.getStringAt(ze,0,Be)}if(d.m_group===vi[0]&&d.m_element===vi[1]&&null!==d.m_value){var Ge=d.m_value.byteLength,We=new DataView(d.m_value),He=e.getStringAt(We,0,Ge),qe=He.substring(0,4),Ye=He.substring(4,6),Ze=He.substring(6);this.m_dicomInfo.m_patientDateOfBirth="".concat(Ze,"/").concat(Ye,"/").concat(qe)}if(d.m_group===gi[0]&&d.m_element===gi[1]&&null!==d.m_value){var Ke=d.m_value.byteLength,Qe=new DataView(d.m_value),Je=e.getStringAt(Qe,0,Ke),$e=Je.substring(0,4),et=Je.substring(4,6),tt=Je.substring(6);this.m_dicomInfo.m_studyDate="".concat(tt,"/").concat(et,"/").concat($e)}if(d.m_group===Si[0]&&d.m_element===Si[1]&&null!==d.m_value){var it=d.m_value.byteLength,rt=new DataView(d.m_value),st=e.getStringAt(rt,0,it);this.m_dicomInfo.m_studyDescr=st,this.m_dicomInfo.m_studyDescr=this.m_dicomInfo.m_studyDescr.trim()}if(d.m_group===si[0]&&d.m_element===si[1]&&null!==d.m_value){var nt=d.m_value.byteLength,ot=new DataView(d.m_value);this.m_dicomInfo.m_bodyPartExamined=e.getStringAt(ot,0,nt)}if(d.m_group===xi[0]&&d.m_element===xi[1]&&null!==d.m_value){var lt=d.m_value.byteLength,mt=new DataView(d.m_value);this.m_dicomInfo.m_acquisionTime=e.getStringAt(mt,0,lt)}if(d.m_group===yi[0]&&d.m_element===yi[1]&&null!==d.m_value){var ut=d.m_value.byteLength,ht=new DataView(d.m_value);this.m_dicomInfo.m_institutionName=e.getUtf8StringAt(ht,0,ut),this.m_dicomInfo.m_institutionName=this.m_dicomInfo.m_institutionName.trim()}if(d.m_group===Oi[0]&&d.m_element===Oi[1]&&null!==d.m_value){var ct=d.m_value.byteLength,dt=new DataView(d.m_value);this.m_dicomInfo.m_operatorsName=e.getUtf8StringAt(dt,0,ct),this.m_dicomInfo.m_operatorsName=this.m_dicomInfo.m_operatorsName.trim()}if(d.m_group===bi[0]&&d.m_element===bi[1]&&null!==d.m_value){var _t=d.m_value.byteLength,ft=new DataView(d.m_value);this.m_dicomInfo.m_physicansName=e.getUtf8StringAt(ft,0,_t),this.m_dicomInfo.m_physicansName=this.m_dicomInfo.m_physicansName.trim()}if(d.m_group===Ti[0]&&d.m_element===Ti[1]&&null!==d.m_value){var vt=d.m_value.byteLength,pt=new DataView(d.m_value);this.m_dicomInfo.m_manufacturerName=e.getStringAt(pt,0,vt),this.m_dicomInfo.m_manufacturerName=this.m_dicomInfo.m_manufacturerName.trim()}}if(!v)return void 0!==n&&n(at.ERROR_PIXELS_TAG_NOT_FOUND),at.ERROR_PIXELS_TAG_NOT_FOUND;if(this.m_transformSyntax.length>1)return void 0!==n&&n(at.ERROR_COMPRESSED_IMAGE_NOT_SUPPORTED),at.ERROR_COMPRESSED_IMAGE_NOT_SUPPORTED;var gt=Math.floor(this.m_xDim*this.m_yDim*(this.m_bitsPerPixel/8)*this.m_samplesPerPixel);if(gt!==d.m_value.byteLength||0===_)return console.log("Wrong image pixels size. Readed ".concat(d.m_value.byteLength,", but expected ").concat(gt)),void 0!==n&&n(at.ERROR_COMPRESSED_IMAGE_NOT_SUPPORTED),at.WRONG_HEADER_DATA_SIZE;var St=this.m_xDim*this.m_yDim,xt=new Ot;if(null===xt)return console.log("No memory"),at.ERROR_NO_MEMORY;if(this.m_pixelRepresentaionSigned?xt.m_image=new Int16Array(St):xt.m_image=new Uint16Array(St),null===xt.m_image)return console.log("No memory"),at.ERROR_NO_MEMORY;xt.m_sliceNumber=this.m_imageNumber,xt.m_sliceLocation=this.m_sliceLocation,xt.m_patientName=this.m_dicomInfo.m_patientName,xt.m_studyDescr=this.m_dicomInfo.m_studyDescr,xt.m_studyDate=this.m_dicomInfo.m_studyDate,xt.m_seriesTime=this.m_dicomInfo.m_seriesTime,xt.m_seriesDescr=this.m_dicomInfo.m_seriesDescr,xt.m_bodyPartExamined=this.m_dicomInfo.m_bodyPartExamined,xt.m_institutionName=this.m_dicomInfo.m_institutionName,xt.m_operatorsName=this.m_dicomInfo.m_operatorsName,xt.m_physicansName=this.m_dicomInfo.m_physicansName,xt.buildHash(),xt.m_xDim=this.m_xDim,xt.m_yDim=this.m_yDim;var yt=xt.m_image,bt=new DataView(d.m_value);if(null===bt)return console.log("No memory"),at.ERROR_NO_MEMORY;var Tt;if(8===this.m_bitsPerPixel){if(1===this.m_samplesPerPixel)for(Tt=0;Tt<St;Tt++){var Dt=bt.getUint8(Tt);yt[Tt]=Dt}else if(3===this.m_samplesPerPixel){var Rt=0;for(Tt=0;Tt<St;Tt++,Rt+=3){var Xt=bt.getUint8(Rt+0),Et=bt.getUint8(Rt+1),At=bt.getUint8(Rt+2);yt[Tt]=Math.floor((Xt+Et+At)/3)}}}else if(16===this.m_bitsPerPixel){var Mt=0;for(Tt=0;Tt<St;Tt++){var Ft=bt.getUint16(Mt,this.m_littleEndian);Mt+=2,yt[Tt]=Ft}}else console.log("TODO: need to implement reading non-8 and non-16 bit dicom images");return this.m_error=0,this.m_slicesVolume.addSlice(xt),void 0!==n&&n(at.SUCCESS),at.SUCCESS}},{key:"readFromUrl",value:function(e,t,i,r){var a=this;console.assert(null!=e,"Null volume"),console.assert(e instanceof ji,"Should be volume set"),console.assert(null!=t,"Null string url"),console.assert("string"===typeof t,"Should be string in url");var s=new Xt;if(!s.isValidUrl(t))return console.log("readFromUrl: not vaild URL = = ".concat(t," ")),!1;this.m_folder=s.getFolderNameFromUrl(t);var n=this.m_folder+"/file_list.txt";console.log("readFromUrl: load file = ".concat(n," "));var o=new ot(n);return this.m_callbackComplete=r,this.m_callbackProgress=i,this.m_fileListCounter=0,o.readFile((function(t){return a.m_fileListCounter+=1,1!==a.m_fileListCounter||a.readReadyFileList(e,t,i,r)}),(function(e){return console.log("Error read file: ".concat(e)),r(at.ERROR_CANT_OPEN_URL,null,0,null),!1})),!0}},{key:"readReadyFileList",value:function(e,t,i,r){console.assert(null!=e,"Null volume"),console.assert(e instanceof ji,"Should be volume set"),console.assert(null!=t,"Null array"),console.assert("ArrayBuffer"===t.constructor.name,"Should be ArrayBuf in arrBuf");var a=new Uint8Array(t),s=String.fromCharCode.apply(null,a),n=s.substr(0,64);console.log("Loaded file list. Started with:  ".concat(n," ..."));for(var o=s.split("\n"),l=o.length,m=l-1;m>=0;m--)o[m].endsWith("\r")&&(o[m]=o[m].substring(0,o[m].length-1)),o[m].length<4&&o.pop();l=o.length,this.m_zDim=l,console.log("Loaded file list. ".concat(l," files will be loaded. 1st file in list is = ").concat(o[0])),console.log("Loaded file list. Last file in list is = ".concat(o[l-1]));for(var u=0;u<l;u++)this.m_errors[u]=-1,this.m_loaders[u]=null;this.m_pixelSpacing={x:0,y:0,z:0},this.m_filesLoadedCounter=0,this.m_numFailsLoad=0,this.m_numLoadedFiles=l,this.m_imagePosMin={x:1e12,y:1e12,z:1e12},this.m_imagePosMax={x:-1e12,y:-1e12,z:-1e12},this.m_sliceLocMin=1e12,this.m_sliceLocMax=-1e12;for(var h=0;h<this.m_numLoadedFiles&&this.m_numFailsLoad<1;h++){var c="".concat(this.m_folder,"/").concat(o[h]);this.m_loaders[h]=new ot(c);var d=this.m_loaders[h];if(!this.runLoader(e,o[h],d,h,i,r,!1))return!1}return!0}},{key:"runLoader",value:function(e,t,i,r,a,s,n){var o=this;return this.m_fromGoogle=n,i.readFile((function(i){var n,l=o.m_filesLoadedCounter/o.m_numLoadedFiles;if(void 0!==a&&0===(7&o.m_filesLoadedCounter)&&a(l),void 0!==a&&o.m_filesLoadedCounter+1===o.m_numLoadedFiles&&a(1),o.m_newTagEvent.detail.fileName=t,(n=o.m_fromGoogle?o.readFromGoogleBuffer(r,t,l,i,a,s):o.readFromBuffer(r,t,l,i,a,s))!==at.SUCCESS&&0===o.m_numFailsLoad&&(o.m_numFailsLoad+=1,null!==s))return s(n,null,0,null,t),!1;if(o.m_filesLoadedCounter+=1,o.m_filesLoadedCounter===o.m_numLoadedFiles){Et;var m,u={x:o.m_imagePosMax.x-o.m_imagePosMin.x,y:o.m_imagePosMax.y-o.m_imagePosMin.y,z:o.m_imagePosMax.z-o.m_imagePosMin.z},h=1e-5;Math.abs(o.m_pixelSpacing.z)>h?m=o.m_pixelSpacing.z*o.m_zDim:(m=u.z,Math.abs(m)<h&&(m=u.x,Math.abs(m)<h&&(m=u.y))),m<h&&(m=1),o.m_pixelSpacing.z=m/o.m_zDim,o.m_boxSize.z=o.m_zDim*o.m_pixelSpacing.z,o.m_boxSize.x=o.m_xDim*o.m_pixelSpacing.x,o.m_boxSize.y=o.m_yDim*o.m_pixelSpacing.y,console.log("Volume local phys dim: ".concat(o.m_boxSize.x," * ").concat(o.m_boxSize.y," * ").concat(o.m_boxSize.z));var c=o.m_slicesVolume.getSeries();0===c.length&&(o.m_slicesVolume.buildSeriesInfo(),c=o.m_slicesVolume.getSeries());var d=c[0].m_hash,_=o.createVolumeFromSlices(e,0,d);if(null!==s)return s(_),!0}return!0}),(function(e){return console.log("Error read file: ".concat(e)),!1})),!0}}],[{key:"getVrsStringIndex",value:function(e){for(var t=["AE","AS","AT","CS","DA","DS","DT","FL","FD","IS","LO","LT","OB","OD","OF","OW","PN","SH","SL","SS","ST","TM","UI","UL","UN","US","UT"],i=t.length,r=0;r<i;r++)if(t[r]===e)return r;return-1}},{key:"getDataVrsStringIndex",value:function(e){for(var t=["OB","OW","OF","SQ","UT","UN"],i=t.length,r=0;r<i;r++)if(t[r]===e)return r;return-1}},{key:"getStringAt",value:function(e,t,i){for(var r="",a=0;a<i;a++){var s=e.getUint8(t+a);0!==s&&(r+=String.fromCharCode(s))}return r}},{key:"getUtf8StringAt",value:function(e,t,i){for(var r="",a=0;a<i;){var s=e.getUint8(t+a);switch(a++,94==s&&(s=32),s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:r+=String.fromCharCode(s);break;case 12:case 13:var n=e.getUint8(t+a);a++,r+=String.fromCharCode((31&s)<<6|63&n);break;case 14:var o=e.getUint8(t+a);a++;var l=e.getUint8(t+a);a++,r+=String.fromCharCode((15&s)<<12|(63&o)<<6|(63&l)<<0)}}return r}},{key:"getAttrValueAsString",value:function(t){if(null===t.m_value)return"SQ"===t.m_vr?"(Sequence Data)":null;var i=new DataView(t.m_value),r=null,a=null,s=0;switch(t.m_vr){case"AE":return e.getStringAt(i,0,t.m_value.byteLength);case"AS":switch(r=e.getStringAt(i,0,t.m_value.byteLength),a=Number(r.slice(0,3)).toString(),r[3]){case"D":return"".concat(a," days");case"W":return"".concat(a," weeks");case"M":return"".concat(a," months");case"Y":return"".concat(a," years");default:return null}case"CS":return e.getStringAt(i,0,t.m_value.byteLength);case"DA":return r=e.getStringAt(i,0,t.m_value.byteLength),new Date("".concat(r.slice(0,4),"-").concat(r.slice(4,6),"-").concat(r.slice(6,8))).toLocaleDateString();case"DS":case"DT":return e.getStringAt(i,0,t.m_value.byteLength);case"FL":for(a=i.getFloat32(0,t.m_littleEndian).toString(),s=4;s+4<=i.byteLength;)a="".concat(a," \\ ").concat(i.getFloat32(s,t.m_littleEndian).toString()),s+=4;return a;case"FD":for(a=i.getFloat64(0,t.m_littleEndian).toString(),s=8;s+4+4<=i.byteLength;)a="".concat(a," \\ ").concat(i.getFloat64(s,t.m_littleEndian).toString()),s+=8;return a;case"IS":case"LO":case"LT":case"PN":case"SH":return e.getStringAt(i,0,t.m_value.byteLength);case"SL":for(a=i.getInt32(0,t.m_littleEndian).toString(),s=4;s+2<=i.byteLength;)a="".concat(a," \\ ").concat(i.getInt16(s,t.m_littleEndian).toString()),s+=4;return a;case"SS":for(a=i.getInt16(0,t.m_littleEndian).toString(),s=2;s+2<=i.byteLength;)a="".concat(a," \\ ").concat(i.getInt16(s,t.m_littleEndian).toString()),s+=2;return a;case"ST":return e.getStringAt(i,0,t.m_value.byteLength);case"TM":return r=e.getStringAt(i,0,t.m_value.byteLength),t.m_value.byteLength>=2&&(a="".concat(Number(r.slice(0,2)),"h")),t.m_value.byteLength>=4&&(a="".concat(a," ").concat(Number(r.slice(2,4)),"m")),t.m_value.byteLength>4&&(a="".concat(a," ").concat(parseFloat(r.slice(4,t.m_value.byteLength)),"s")),a;case"UI":return e.getStringAt(i,0,t.m_value.byteLength);case"UL":for(a=i.getUint32(0,t.m_littleEndian).toString(),s=4;s+4<=i.byteLength;)a="".concat(a," \\ ").concat(i.getUint32(s,t.m_littleEndian).toString()),s+=4;return a;case"US":for(a=i.getUint16(0,t.m_littleEndian).toString(),s=2;s+2<=i.byteLength;)a="".concat(a," \\ ").concat(i.getUint16(s,t.m_littleEndian).toString()),s+=2;return a;case"UT":return e.getStringAt(i,0,t.m_value.byteLength);default:return null}}},{key:"numberToHexString",value:function(e){for(var t=e.toString(16),i=4-t.length,r="",a=0;a<i;a++)r+="0";return"0x"+r+t}}]),e}(),Ri=function(){function e(){Object(u.a)(this,e),this.m_file=null,this.m_reader=null,this.m_request=null}return Object(h.a)(e,[{key:"readLocal",value:function(e){var t=this;return new Promise((function(i){t.m_file=e,t.m_reader=new FileReader,t.m_reader.addEventListener("load",(function(e){var t=e.target.result;i&&i(t)})),t.m_reader.readAsArrayBuffer(t.m_file)}))}},{key:"readFromUrl",value:function(e){var t=this;return new Promise((function(i,r){t.m_url=e,t.m_request=null;if(t.m_request=new XMLHttpRequest,!("withCredentials"in t.m_request))return t.m_request=null,void console.log("This browser cant support CORS requests");t.m_request.open("GET",t.m_url,!0),t.m_request.responseType="arraybuffer",t.m_request.addEventListener("load",(function(e){var t=e.target.response;null===t?console.log("Bad response type. Expect object type in response."):i(t)}),!1),t.m_request.addEventListener("error",(function(e){var t="Error event happend for XMLHttpRequest: loaded = ".concat(e.loaded,", total = ").concat(e.total);console.log(t),r(t)}),!1),t.m_request.send()}))}}]),e}(),wi=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,[{key:"readFromBufferHeader",value:function(t,i,r,a){console.assert(null!=t,"Null volume"),console.assert(t instanceof rt,"Should be volume"),console.assert(null!=i,"Null array"),console.assert("ArrayBuffer"===i.constructor.name,"Should be ArrayBuf in arrBuf");var s=new Uint8Array(i);if(348!==s.length)return a&&a(at.WRONG_HEADER_DATA_SIZE,null,0,null),!1;var n=0,o=e.readIntFromBuffer(s,n);if(n+=4,348!==o)return console.log("Hdr first int wrong: ".concat(o,", but should be ").concat(348)),a&&a(at.BAD_HEADER,null,0,null),!1;var l=e.getStringAt(s,n,10);if(n+=10,t.m_dataType=0,"CHAR"===l&&(t.m_dataType=2,t.m_bytesPerVoxel=1),"SHORT"===l&&(t.m_dataType=4,t.m_bytesPerVoxel=2),0===t.m_dataType)return console.log("Hdr wrong data type. Should be CHAR or SHORT, but found: ".concat(l)),a&&a(at.BAD_HEADER,null,0,null),!1;console.log("Hdr read data type = ".concat(l));n+=18;var m=e.readIntFromBuffer(s,n);n+=4;if(16384!==m)return console.log("Hdr wrong extents in header. Should be ".concat(16384,", but found: ").concat(m)),a&&a(at.BAD_HEADER,null,0,null),!1;n+=2;var u=e.readByteFromBuffer(s,n);n+=1;if(114!==u)return console.log("Hdr wrong regular in header. Should be ".concat(114,", but found: ").concat(u)),a&&a(at.BAD_HEADER,null,0,null),!1;n+=1,n+=2;var h=e.readShortFromBuffer(s,n);n+=2;var c=e.readShortFromBuffer(s,n);n+=2;var d=e.readShortFromBuffer(s,n);n+=2,t.m_xDim=h,t.m_yDim=c,t.m_zDim=d,console.log("HDR: volume dim = ".concat(t.m_xDim," * ").concat(t.m_yDim," * ").concat(t.m_zDim," "));n+=8;n+=4;n+=8,n+=2;var _=e.readShortFromBuffer(s,n);if(n+=2,2===t.m_dataType&&2!==_)return console.log("Wrong data tye for char typed header"),!1;if(4===t.m_dataType&&4!==_)return console.log("Wrong data tye for signed short typed header"),!1;var f=e.readShortFromBuffer(s,n);if(n+=2,2===t.m_dataType&&8!==f)return console.log("Wrong bits pix for char typed header"),!1;if(4===t.m_dataType&&16!==f)return console.log("Wrong bits pix for word typed header"),!1;n+=2,n+=4;var v=e.readFloatFromBuffer(s,n);n+=4;var p=e.readFloatFromBuffer(s,n);n+=4;var g=e.readFloatFromBuffer(s,n);n+=4;return n+=16,t.m_boxSize.x=t.m_xDim*v,t.m_boxSize.y=t.m_yDim*p,t.m_boxSize.z=t.m_zDim*g,console.log("HDR: physic size = ".concat(t.m_boxSize.x," * ").concat(t.m_boxSize.y," * ").concat(t.m_boxSize.z," ")),!0}},{key:"readFromBufferImage",value:function(e,t,i,r){console.assert(null!=e,"Null volume"),console.assert(e instanceof rt,"Should be volume"),console.assert(null!=t,"Null array"),console.assert("ArrayBuffer"===t.constructor.name,"Should be ArrayBuf in arrBuf");var a=new Uint8Array(t).length;return a<8?(r&&r(at.ERROR_TOO_SMALL_DATA_SIZE,null,0,null),!1):a>=241172480?(r&&r(at.ERROR_TOO_LARGE_DATA_SIZE,null,0,null),!1):(e.m_imageBufferSize=a,e.m_arrBuf=t,console.log("readFromBufferImage complete with ".concat(a," bytes in image ")),!0)}},{key:"createVolumeFromHeaderAndImage",value:function(e){console.assert(null!=e,"Null volume"),console.assert(e instanceof rt,"Should be volume");var t=0;2===e.m_dataType&&(t=1),4===e.m_dataType&&(t=2);var i=e.m_xDim*e.m_yDim*e.m_zDim,r=i*t;if(r!==e.m_imageBufferSize)return console.log("HDR: wrong IMG data size. Read: ".concat(e.m_imageBufferSize,", but expected ").concat(r," ")),!1;var a=e.m_arrBuf;if(4===e.m_dataType){var s,n=new Uint16Array(a);e.m_dataArray=new Uint8Array(i);var o=0;for(s=0;s<i;s++)o=n[s]>o?n[s]:o;o++;for(s=0;s<i;s++)e.m_dataArray[s]=Math.floor(255*n[s]/o)}else if(2===e.m_dataType){var l=new Uint8Array(a);e.m_dataArray=l}return e.m_bytesPerVoxel=1,e.m_dataSize=e.m_imageBufferSize,!0}},{key:"createRoiVolumeFromHeaderAndImage",value:function(e,t){console.assert(null!=e,"Null volume"),console.assert(e instanceof rt,"Should be volume"),console.assert(null!=t,"Null volume"),console.assert(t instanceof rt,"Should be volume");if(1!==e.m_bytesPerVoxel)return console.log("createRoiVolumeFromHeaderAndImage: bad volDst. m_bytesPerVoxel should be 1"),!1;if(1!==t.m_bytesPerVoxel)return console.log("createRoiVolumeFromHeaderAndImage: bad volRoi"),!1;if(e.m_xDim!==t.m_xDim||e.m_yDim!==t.m_yDim||e.m_zDim!==t.m_zDim)return console.log("createRoiVolumeFromHeaderAndImage: different volumes sizes"),!1;for(var i=e.m_xDim*e.m_yDim*e.m_zDim,r=new Uint8Array(4*i),a=t.m_arrBuf,s=new Uint8Array(a),n=0,o=0;o<i;o++,n+=4)r[n+0]=e.m_dataArray[o],r[n+1]=0,r[n+2]=0,r[n+3]=s[o];e.m_dataArray=r;return e.m_bytesPerVoxel=4,console.log("createRoiVolumeFromHeaderAndImage: success"),!0}},{key:"readFromUrl",value:function(e,t,i,r){console.log("readFromUrl. going to read from ".concat(t," ..."));var a=new Xt;if(!a.isValidUrl(t))return console.log("readFromUrl: not vaild URL = = ".concat(t," ")),!1;this.m_folder=a.getFolderNameFromUrl(t);var s=a.getFileNameFromUrl(t),n=/(\w+)_intn.(h|hdr)/.exec(s);if(3!==n.length)return console.log("LoaderHdr.readFromUrl: bad URL name = ".concat(t,". Should be in template NNN_intn.h ")),!1;var o=n[1],l=this.m_folder+"/"+o+"_intn.h",m=this.m_folder+"/"+o+"_intn.img",u=this.m_folder+"/"+o+"_mask.h",h=this.m_folder+"/"+o+"_mask.img",c=[];return c.push(l),c.push(m),c.push(u),c.push(h),this.readFromUrls(c,e,i,r)}},{key:"readFromUrls",value:function(e,t,i,r){var a=this;console.assert(null!=t,"Null volume set"),console.assert(t instanceof ji,"Should be volume set");var s=e.length;if(2===s){var n=e[0],o=e[1],l=new Ri,m=new Ri,u=n.indexOf(".h");if(-1===u&&(u=n.indexOf(".hdr")),-1===u){var h=n;n=o,o=h}var c=t.getVolume(0);l.readFromUrl(n).then((function(e){a.readFromBufferHeader(c,e,r,i),console.log("Load success HDR file: ".concat(n)),m.readFromUrl(o).then((function(e){a.readFromBufferImage(c,e,r,i),console.log("Load success IMG file: ".concat(o)),a.createVolumeFromHeaderAndImage(c),r(at.SUCCESS)}))}),(function(e){return console.log("HDR File read error",e),r(at.ERROR_CANT_OPEN_URL,null,0,null),!1}))}else{if(4!==s)return console.log("Error read hdr files. Should be ".concat(2," files")),!1;var d=e[0],_=e[1],f=e[2],v=e[3],p=new Ri,g=new Ri,S=new Ri,x=new Ri,y=new rt,b=t.getVolume(0);p.readFromUrl(d).then((function(e){a.readFromBufferHeader(b,e,r,i),console.log("Load success HDR file: ".concat(d)),g.readFromUrl(_).then((function(e){a.readFromBufferImage(b,e,r,i),console.log("Load success IMG file: ".concat(_)),S.readFromUrl(f).then((function(e){a.readFromBufferHeader(y,e,r,i),x.readFromUrl(v).then((function(e){a.readFromBufferImage(y,e,r,i),a.createVolumeFromHeaderAndImage(b),a.createRoiVolumeFromHeaderAndImage(b,y),r(at.SUCCESS)}))}))}))}),(function(e){return console.log("HDR File read error",e),!1}))}return!0}}],[{key:"readByteFromBuffer",value:function(e,t){return e[t]}},{key:"readIntFromBuffer",value:function(e,t){return e[t+0]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24}},{key:"readShortFromBuffer",value:function(e,t){return e[t+0]|e[t+1]<<8}},{key:"readFloatFromBuffer",value:function(e,t){var i=new ArrayBuffer(4),r=new DataView(i);r.setUint8(0,e[t+0]),r.setUint8(1,e[t+1]),r.setUint8(2,e[t+2]),r.setUint8(3,e[t+3]);return r.getFloat32(0,!0)}},{key:"getStringAt",value:function(e,t,i){for(var r="",a=0;a<i;a++){var s=e[t+a];if(0===s)break;r+=String.fromCharCode(s)}return r}}]),e}(),ji=function(e){Object(S.a)(i,e);var t=Object(x.a)(i);function i(e){var r;return Object(u.a)(this,i),(r=t.call(this,e)).m_numVolumes=0,r.m_volumes=[],r.m_patientName="",r.m_patientBirth="",r.m_seriesDescr="",r.m_studyDescr="",r.m_studyDate="",r.m_seriesTime="",r.m_bodyPartExamined="",r.m_institutionName="",r.m_operatorsName="",r.m_physicansName="",r}return Object(h.a)(i,[{key:"addVolume",value:function(e){console.assert(e instanceof rt,"VolumeSet.addVolume: arg must be Volume"),this.m_volumes.push(e),this.m_numVolumes++}},{key:"getNumVolumes",value:function(){return this.m_numVolumes}},{key:"getVolume",value:function(e){return console.assert(Number.isInteger(e),"VolumeSet.getVolume: arg must be number"),console.assert(e<this.m_numVolumes,"index of volume should be in range"),console.assert(e>=0,"index of volume should be non negative"),e<0||e>=this.m_numVolumes?null:this.m_volumes[e]}},{key:"checkVolume",value:function(){var e=this.m_numVolumes;if(e<=1)return console.log("volumes is less than or equal to one: ",e),!0;for(var t=new Array(e),i=0;i<e;i++){var r=this.getVolume(i);if(null===r)return!1;t[i]=r.m_dataArray.length}for(var a=1;a<e;a++)if(console.assert(t[a-1]===t[a],"volume size mismatch. Phase ",a-1," size is ",t[a-1]," and phase ",a," size is ",t[a]),t[a-1]!==t[a])return!1;for(var s=1;s<e;s++){var n=this.getVolume(s-1),o=this.getVolume(s);console.log(n,o);for(var l=0;l<t[s];l++)if(n.m_dataArray[l]!==o.m_dataArray[l])return console.log("volumes for phases ",s-1," and ",s," are different at pixel: ",l," with values: ",n.m_dataArray[l]," and ",o.m_dataArray[l]),!1}return console.log("volumes are the same"),!0}},{key:"render",value:function(){return null}},{key:"readFromKtx",value:function(e,t,i){console.assert(null!=e),console.assert("ArrayBuffer"===e.constructor.name,"Should be ArrayBuf in arrBuf");var r=new ht,a=this.getVolume(0);return r.readFromBuffer(a,e,t,i)}},{key:"readFromKtxUrl",value:function(e,t,i){var r=new ht,a=this.getVolume(0);r.readFromUrl(a,e,t,i)}},{key:"readFromNiiUrl",value:function(e,t,i){var r=new vt,a=this.getVolume(0);return r.readFromUrl(a,e,t,i)}},{key:"readFromDicomUrl",value:function(e,t,i){return new Di(0).readFromUrl(this,e,t,i)}},{key:"readFromHdrUrl",value:function(e,t,i){return(new wi).readFromUrl(this,e,t,i)}},{key:"readFromNifti",value:function(e,t,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=new vt,s=a.readShortFromBuffer(e,40);if(console.log(this.getNumVolumes(),s),4===s){var n=a.readShortFromBuffer(e,48);for(console.log(n);this.getNumVolumes()<n;)this.addVolume(new rt)}return null!==r?a.readFromBuffer(this.m_volumes,e,t,i,r):a.readFromBuffer(this.m_volumes,e,t,i)}},{key:"readFromDicom",value:function(e,t,i,r){return e.readFromBuffer(0,"file???",0,t,i,r)}},{key:"readSingleSliceFromDicom",value:function(e,t,i,r,a,s,n){return e.readFromBuffer(t,i,r,a,s,n)}}]),i}(s.a.Component),Xi={socket:it.socket,showLoader:!1,fileName:"brain.ktx",notification:{body:"",header:"",isVisible:!1,status:null,icon:null,spin:!1,timer:null},doctorView:{isLoaded:!1,loadedScan:"",patients:[],status:"Bleeding",rateOfLeakage:.31,volumeOfLeakage:-1,timeOfStroke:7320,title:"CT Head or Brain W/O&W",date:new Date(2006,9,6),phaseTimes:[4,6,8,10,12,14,16,18,20,22,24,26,28,33,38,43,48,53],zoom:.9},nurseView:{isLoaded:!1,patients:[],status:"Not Bleeding",rateOfLeakage:-1,volumeOfLeakage:-1,timeOfStroke:0,title:"CT Head or Brain W/O&W",date:new Date(2006,9,6)},visState:{volumeSet:new ji({}),spotColor:new j.U(1,1,1),showVenousStructure:!0,loadingBarRatio:50,volumeIndex:0,texture3d:null,modeView:b.VIEW_3D_LIGHT,mode2d:T.TRANSVERSE,slider2d:.5,slider3d_r:.09,slider3d_g:.3,slider3d_b:.46,mode3d:O.RAYCAST,mode3droi:D.RAYCAST,sliderOpacity:.53,sliderIsosurface:.46,sliderBrightness:.56,sliderCut:1,sliderQuality:.35,sliderErRadius:50,sliderErDepth:50,volumeRenderer:null,indexTools2d:0,render2dZoom:1,render2dxPos:0,render2dyPos:0,graphics2d:null,uiApp:null,dicomInfo:null,isTool3D:!1,volumeOpacity:1,sliderContrast3D:0,arrErrors:[],dicomSeries:[],loaderDicom:null},options:{moduleOne:{processTimingData:!0,build4d:!0,build3d:!0,compute4dSummary:!0,saveAvailableData:!0,reloadTimingIndices:!0,stopIfOptionsChange:!1,autoSelectLargest:!0,autoSelectFirstLargest:!1,autoSelectLastLargest:!0,setTimeSeparationMin:"0",setTimeSeparationMax:"60",imageSetIndex:"0"},moduleTwo:{dataOutput:"C:\\Workspaces\\carl",modality:"CT",vendor:"Toshiba",scanner:"320",process:"DCE",region:"Brain",study:"ICH",restartEnabled:!0,minimum3d:"0.125",includeMinThreshold:!0,includeMaxThreshold:!1,useMorphologicalOperations:!0,strfiDisk:"5",strfi3d:"2",imageRegion:"Minimum",minimumConnected:"0.2",coarseRadius:"20",strfiRadius:"1.5",imageIndexRange:"All"},moduleThree:{minimumNumber:"50",numberOfBins:"400",distributionTail:"0.01",feature:"Median Value",medianMin:"0.3",medianMax:"0.4",peakRangeMin:"0.3",peakRangeMax:"0.4",probabilityMin:"0",probabilityMax:"0.97",nonNegativeValues:!0,nonZeroValues:!0},moduleFour:{enableRestart:!0,vascularMaskDirectory:"",outputDataDirectory:""}}},Ei=function(e){return e.map((function(t){return{scanId:t[0],startTime:t[1]?new Date(t[1]):new Date,endTime:t[2]?new Date(t[2]):new Date,currentModule:t[3],progress:t[4],mlStatus:t[5],failed:t[6],initiator:e[7],outputLocation:t[8],phases:t[9],patientName:t[10],patientAge:t[11],patientSex:t[12],scanTime:t[13]?new Date(t[13]):new Date}}))},Ii=function(e){return e.map((function(e){return{scanId:e[0],marker:e[1],value:e[2],postTime:e[3]?new Date(e[3]):new Date}}))},Ai=function(e){var t=e.toLocaleDateString(),i="".concat(e.getHours().toString().padStart(2,"0"),":").concat(e.getMinutes().toString().padStart(2,"0"));return"".concat(t," ").concat(i)},Mi=function(e,t){var i=t[0],r=e.nurseView.patients.findIndex((function(e){return e.scanId===i.scanId})),a=e.doctorView.patients.findIndex((function(e){return e.scanId===i.scanId})),s=Object(p.a)(e.nurseView.patients),n=Object(p.a)(e.doctorView.patients);return 5===i.currentModule?r>=0?(s.splice(r,1),n.push(i)):a>=0?n[a]=i:n.push(i):r>=0?s[r]=i:a>=0?(n.splice(a,1),s.push(i)):s.push(i),[s,n]},Ci=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Xi,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case y.SET_IS_LOADED:return Object(w.a)(Object(w.a)({},e),{},{doctorView:Object(w.a)(Object(w.a)({},e.doctorView),{},{isLoaded:t.isLoaded})});case y.SET_LOADER:return Object(w.a)(Object(w.a)({},e),{},{showLoader:t.showLoader});case y.SET_SPOT_COLOR:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{spotColor:[t.r,t.g,t.b]})});case y.SET_VOLUME_OPACITY:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{volumeOpacity:t.volumeOpacity})});case y.SET_SHOW_VENOUS_STRUCTURE:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{showVenousStructure:t.showVenousStructure})});case y.SET_SCANID:return Object(w.a)(Object(w.a)({},e),{},{doctorView:Object(w.a)(Object(w.a)({},e.doctorView),{},{loadedScan:t.loadedScan})});case y.SET_VOLUME_SET:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{volumeSet:t.volumeSet})});case y.SET_TEXTURE3D:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{texture3d:t.texture3d})});case y.SET_VOLUME_INDEX:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{volumeIndex:t.volumeIndex})});case y.SET_MODE_VIEW:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{modeView:t.modeView})});case y.SET_MODE_2D:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{mode2d:t.mode2d})});case y.SET_SLIDER_2D:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{slider2d:t.slider2d})});case y.SET_MODE_3D:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{mode3d:t.mode3d})});case y.SET_MODE_3Droi:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{mode3droi:t.mode3droi})});case y.SET_SLIDER_3DR:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{slider3d_r:t.slider3d_r})});case y.SET_SLIDER_3DB:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{slider3d_b:t.slider3d_b})});case y.SET_SLIDER_3DG:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{slider3d_g:t.slider3d_g})});case y.SET_SLIDER_Opacity:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{sliderOpacity:t.sliderOpacity})});case y.SET_SLIDER_Isosurface:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{sliderIsosurface:t.sliderIsosurface})});case y.SET_SLIDER_ErRadius:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{sliderErRadius:t.sliderErRadius})});case y.SET_SLIDER_ErDepth:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{sliderErDepth:t.sliderErDepth})});case y.SET_VOLUME_Renderer:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{volumeRenderer:t.volumeRenderer})});case y.SET_SLIDER_Brightness:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{sliderBrightness:t.sliderBrightness})});case y.SET_SLIDER_Cut:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{sliderCut:t.sliderCut})});case y.SET_SLIDER_Quality:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{sliderQuality:t.sliderQuality})});case y.SET_2D_TOOLS_INDEX:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{indexTools2d:t.indexTools2d})});case y.SET_2D_X_POS:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{render2dxPos:t.render2dxPos})});case y.SET_2D_ZOOM:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{render2dZoom:t.render2dZoom})});case y.SET_2D_Y_POS:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{render2dyPos:t.render2dyPos})});case y.SET_UI_APP:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{uiApp:t.uiApp})});case y.SET_DICOM_INFO:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{dicomInfo:t.dicomInfo})});case y.SET_IS_TOOL3D:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{isTool3D:t.isTool3D})});case y.SET_GRAPHICS_2D:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{graphics2d:t.graphics2d})});case y.SET_SLIDER_Contrast3D:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{sliderContrast3D:t.sliderContrast3D})});case y.SET_ERR_ARRAY:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{arrErrors:t.arrErrors})});case y.SET_DICOM_SERIES:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{dicomSeries:t.dicomSeries})});case y.SET_LOADER_DICOM:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{loaderDicom:t.loaderDicom})});case y.SET_3D_ZOOM:return Object(w.a)(Object(w.a)({},e),{},{doctorView:Object(w.a)(Object(w.a)({},e.doctorView),{},{zoom:t.zoom})});case y.SET_PATIENT_DATA:var i=Ei(t.payload);return Object(w.a)(Object(w.a)({},e),{},{doctorView:Object(w.a)(Object(w.a)({},e.doctorView),{},{patients:i.filter((function(e){return 5===e.currentModule}))}),nurseView:Object(w.a)(Object(w.a)({},e.nurseView),{},{patients:i.filter((function(e){return 5!==e.currentModule}))})});case y.UPDATE_PATIENT_DATA:var r=Ei([t.payload]),a=Mi(e,r),s=Object(l.a)(a,2),n=s[0],o=s[1];return Object(w.a)(Object(w.a)({},e),{},{doctorView:Object(w.a)(Object(w.a)({},e.doctorView),{},{patients:o}),nurseView:Object(w.a)(Object(w.a)({},e.nurseView),{},{patients:n})});case y.UPDATE_BIOMARKER_DATA:var m=Ii([t.payload])[0];return console.log(m),"V0"===m.marker?e.doctorView.volumeOfLeakage=m.value:"K1"===m.marker&&(e.doctorView.rateOfLeakage=m.value),-1!==e.doctorView.rateOfLeakage&&-1!==e.doctorView.volumeOfLeakage&&(e.doctorView.timeOfStroke=Math.round(e.doctorView.volumeOfLeakage/e.doctorView.rateOfLeakage*100)/100,e.doctorView.status="Bleeding"),Object(w.a)({},e);case y.SET_NOTIFICATION:return Object(w.a)(Object(w.a)({},e),{},{notification:t.payload});case y.SET_PHASETIMES:return Object(w.a)(Object(w.a)({},e),{},{doctorView:Object(w.a)(Object(w.a)({},e.doctorView),{},{phaseTimes:t.payload})});case y.SET_INPUT:var u=t.payload,h=u.module,c=u.name,d=u.value,_=Object(w.a)(Object(w.a)({},e),{},{options:Object(w.a)({},e.options)});return _.options.moduleOne=Object(w.a)({},e.options.moduleOne),_.options.moduleTwo=Object(w.a)({},e.options.moduleTwo),_.options.moduleThree=Object(w.a)({},e.options.moduleThree),_.options.moduleFour=Object(w.a)({},e.options.moduleFour),_.options[h][c]=d,_;default:return Object(w.a)({},e)}},Fi=Object(a.createContext)({}),Vi=function(e){var t=Object(a.useReducer)(Ci,Xi),i=Object(l.a)(t,2),s=i[0],n=i[1];return Object(r.jsx)(Fi.Provider,{value:[s,n],children:e.children})},Ui=i(19),Pi=i.n(Ui),Ni=i(28),ki=i(30),Li=function(){function e(){Object(u.a)(this,e),this.m_texture=-1}return Object(h.a)(e,[{key:"createFromRawVolume",value:function(e){this.m_texture=new j.l(e.m_dataArray,e.m_xDim,e.m_yDim,e.m_zDim)}}]),e}();!function(e){e.SUCCESS="success",e.FAILURE="failure"}(st||(st={}));var Bi=i(68),zi=i.n(Bi),Gi=i.p+"static/media/module4demoSubset_fake.nii.ce5cdb22.gz",Wi=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,[{key:"getFileName",value:function(){var e=Object(Ni.a)(Pi.a.mark((function e(t){return Pi.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,zi.a.get(Gi,{responseType:"blob",params:{scan_id:t,tc:(new Date).getTime()}});case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getTiming",value:function(){var e=Object(Ni.a)(Pi.a.mark((function e(t){return Pi.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",JSON.parse("[\n      5e-05,\n      2.1e-05,\n      2e-05,\n      3e-05,\n      2e-05,\n      2e-05,\n      2e-05,\n      3e-05,\n      2e-05,\n      2.1e-05,\n      3e-05,\n      2e-05,\n      2e-05,\n      6e-05,\n      6.1e-05,\n      5e-05,\n      6e-05,\n      6.1e-05\n    ]"));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function Hi(){return new Worker(i.p+"static/js/file-worker.6e70ceef.worker.js")}var qi=function(){var e=Object(Ni.a)(Pi.a.mark((function e(t,i){var r,a,s,n,o,l;return Pi.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=new Wi,t({type:y.SET_NOTIFICATION,payload:{body:"",header:"Loading 4D Image",isVisible:!0,icon:ki.d,spin:!0,timer:null}}),e.next=4,r.getFileName(i);case 4:if(!((a=e.sent)instanceof Error)){e.next=8;break}return t({type:y.SET_NOTIFICATION,payload:{body:"Couldn't find an image",header:"Loading failed",isVisible:!1,status:st.FAILURE,icon:ki.e,timer:4e3}}),e.abrupt("return");case 8:console.log(a),(s=new Hi).postMessage({data:a.data,scanId:i}),s.onerror=function(e){s.terminate(),t({type:y.SET_NOTIFICATION,payload:{body:"An error occurred while loading the image.",header:"Loading failed",isVisible:!1,status:st.FAILURE,icon:ki.e,timer:4e3}}),console.log(e)},l=[],s.onmessage=function(e){var r=e.data,a=r.status,m=r.volume,u=r.volumeSet,h=r.tex3d,c=r.data;switch(a){case"start":n=Object.assign(new Li,JSON.parse(h)),console.log("Volume loaded, transferring from worker...");break;case"vol":var d=Object.assign(new Li,JSON.parse(m));d.m_dataArray=c,l.push(d),console.log("   Got volume ".concat(l.length));break;case"end":(o=Object.assign(new ji({}),JSON.parse(u))).m_volumes=l;var _=Object.assign(new ji({}),o);t({type:y.SET_LOADER,showLoader:!0}),t({type:y.SET_VOLUME_SET,volumeSet:_}),t({type:y.SET_VOLUME_INDEX,volumeIndex:l.length-1}),t({type:y.SET_IS_LOADED,isLoaded:!0}),t({type:y.SET_SCANID,loadedScan:i}),t({type:y.SET_ERR_ARRAY,arrErrors:[]}),t({type:y.SET_TEXTURE3D,texture3d:n}),t({type:y.SET_MODE_VIEW,modeView:b.VIEW_2D}),t({type:y.SET_MODE_3D,mode3d:O.RAYCAST}),t({type:y.SET_NOTIFICATION,payload:{body:"",header:"Success",isVisible:!1,status:st.SUCCESS,icon:ki.a,timer:4}}),console.log("Volume transferring finished."),s.terminate();break;case"fail":default:s.terminate()}};case 14:case"end":return e.stop()}}),e)})));return function(t,i){return e.apply(this,arguments)}}();function Yi(e){var t=e.progress,i=e.radius,a=e.stroke,s=i-2*a,n=2*s*Math.PI,o=n-t/100*n;return Object(r.jsx)("svg",{height:2*i,width:2*i,children:Object(r.jsx)("circle",{stroke:"lightgreen",fill:"transparent",strokeWidth:a,strokeDasharray:n+" "+n,style:{strokeDashoffset:o},r:s,cx:i,cy:i})})}i(102);function Zi(e){var t=e.isNurse,i=Object(a.useContext)(Fi),s=Object(l.a)(i,2),n=s[0],o=s[1],m=t?n.nurseView.patients:n.doctorView.patients,u=function(e){switch(e){case 0:return"Initializing";case 1:return"Preprocessing";case 2:return"Extract Brain Region";case 3:return"Vascular Segmentation";case 4:return"Dynamic Spot Selection";case 5:return"Completed"}},h=function(){var e=Object(Ni.a)(Pi.a.mark((function e(t){return Pi.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n.doctorView.loadedScan===t){e.next=6;break}return e.next=3,qi(o,t);case 3:return e.abrupt("return",e.sent);case 6:return e.abrupt("return",o({type:y.SET_IS_LOADED,isLoaded:!0}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(r.jsx)("div",{className:"file-list fill",children:Object(r.jsx)("div",{className:"col-12 px-0 py-4 flex center top",children:Object(r.jsxs)("div",{className:"col-8 p-0 flex center top ",children:[Object(r.jsx)("h3",{className:"header",children:"Patient Files"}),!m.length&&Object(r.jsx)("div",{className:"col-12 flex space-around",children:Object(r.jsxs)("div",{className:"col-12",style:{color:"grey"},children:["No ",t?"in-progress":"completed"," scans."]})}),!!m.length&&m.map((function(e){return Object(r.jsxs)("div",{className:"col-12 flex space-between file-item",onClick:Object(Ni.a)(Pi.a.mark((function t(){return Pi.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h(e.scanId);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))),children:[Object(r.jsx)("div",{className:"col-5 flex left",children:e.patientName||e.scanId}),Object(r.jsx)("div",{className:"col-3 flex left",children:Ai(e.startTime)}),Object(r.jsxs)("div",{className:"col-4 p-0 flex right",children:[Object(r.jsxs)("div",{className:"pr-1",children:["(",u(e.currentModule),")"]}),e.progress,"%",Object(r.jsx)(Yi,{radius:10,stroke:2,progress:e.progress})]})]},e.scanId)}))]})})})}var Ki=i(54),Qi=i.n(Ki),Ji=i(46),$i=i.n(Ji);i(121),i(66);var er=function(){var e=Object(a.useContext)(Fi),t=Object(l.a)(e,2),i=t[0],n=t[1],o=Object(a.useState)(!1),m=Object(l.a)(o,2),f=m[0],p=m[1],g=Object(a.useState)("Loading..."),S=Object(l.a)(g,2),x=S[0],b=S[1],T=Object(a.useState)(0),D=Object(l.a)(T,2),R=D[0],w=D[1],j=Object(a.useState)(!1),X=Object(l.a)(j,2),E=X[0],I=X[1],A=["Anterior Axial","Coronal"],M=Object(a.useState)(0),C=Object(l.a)(M,2),F=C[0],V=C[1],U=s.a.useRef(null),P=s.a.useRef(null),N=s.a.useRef(null),k=s.a.useRef(null),L=i.visState.volumeSet,B=[i.visState.volumeIndex],z=(i.visState.volumeOpacity,i.visState.mode3d===O.RAYCAST),G=i.visState.showVenousStructure,W=0;null!==L&&void 0!==L&&(W=L.getNumVolumes()),Object(a.useEffect)((function(){var e=new(function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,[{key:"doHideProgressBar",value:function(){p(!1)}},{key:"doShowProgressBar",value:function(e){b(e),p(!0)}},{key:"doSetProgressBarRatio",value:function(e){e>=0&&e<=99&&(f||p(!0),w(e))}}]),e}());n({type:y.SET_UI_APP,uiApp:e}),n({type:y.SET_VOLUME_INDEX,volumeIndex:W-1})}),[]);var H,q=Object(r.jsx)("div",{className:"col-12 flex center",style:{marginTop:"auto"},children:Object(r.jsxs)(c.a,{xs:!0,xl:!0,sm:!0,md:!0,lg:"12",style:{width:"100%",color:"whitesmoke"},children:[x,Object(r.jsx)(d.a,{animated:!0,variant:"success",now:R,label:"".concat(R,"%")})]})}),Y=function(e,t){e/=10,e=Number.parseFloat(e.toFixed(1)),void 0!==t&&(e=1===t?(e+=.1)>2?2:e:(e-=.1)<.5?.5:e),n({type:y.SET_3D_ZOOM,zoom:e}),i.visState.volumeRenderer.orbitControl.setZoom(e)};return Object(r.jsxs)("div",{className:"col-12 p-0 flex fill",children:[!i.doctorView.isLoaded&&Object(r.jsx)(Zi,{isNurse:!1}),i.doctorView.isLoaded&&Object(r.jsxs)("div",{className:"overlay flex",children:[Object(r.jsxs)("div",{className:"col-3 p-3 flex left",children:[Object(r.jsx)("div",{className:"col-12 p-0 flex left data-header",children:"Status"}),Object(r.jsx)("h3",{className:"data-large",children:i.doctorView.status}),Object(r.jsx)("div",{className:"col-12 p-0 flex left data-header",children:"Est. Rate of Leakage"}),Object(r.jsxs)("h3",{className:"data-large",children:[i.doctorView.rateOfLeakage," ml/min"]}),Object(r.jsx)("div",{className:"col-12 p-0 flex left data-header",children:"Est. Time of Stroke"}),Object(r.jsxs)("h3",{className:"data-large",children:[i.doctorView.timeOfStroke/60," min"]}),Object(r.jsx)("div",{className:"col-12 p-0 flex left",children:Object(r.jsx)("button",{className:"button-main",style:{background:z?"":"dimgrey"},onClick:function(){n(z?{type:y.SET_MODE_3D,mode3d:O.RAYFAST}:{type:y.SET_MODE_3D,mode3d:O.RAYCAST})},children:"Reveal SPOT"})}),i.visState.volumeRenderer&&Object(r.jsx)("div",{className:"col-12 p-0 flex left",children:Object(r.jsx)("button",{className:"button-main",style:{background:E?"dimgrey":""},onClick:function(){return I(i.visState.volumeRenderer.setAutoSpin(!E))},children:"Auto rotate"})}),Object(r.jsx)("div",{className:"col-12 p-0 flex left",children:Object(r.jsx)("button",{className:"button-main",style:{background:G?"dimgrey":""},onClick:function(){n({type:y.SET_SHOW_VENOUS_STRUCTURE,showVenousStructure:!G})},children:"Show Venous Structure"})}),Object(r.jsxs)("div",{className:"col-12 p-0 flex left",children:[Object(r.jsx)("div",{className:"data-header",children:"Orientation"}),Object(r.jsxs)(_.a,{className:"dropdown",id:"dropdown-basic-button",onSelect:function(e,t){var r=Number.parseInt(t.target.id);i.visState.volumeRenderer&&(i.visState.volumeRenderer.setPresetView(r),V(r))},children:[Object(r.jsx)(_.a.Toggle,{id:JSON.stringify(Math.random()),children:A[F]}),Object(r.jsx)(_.a.Menu,{children:A.map((function(e,t){return Object(r.jsx)(_.a.Item,{id:t,children:e})}))})]})]}),Object(r.jsxs)("div",{className:"col-auto p-0 flex column small-slider vertical",children:[Object(r.jsx)("i",{className:"fas fa-search-plus mb-3",style:{color:"white",cursor:"pointer"},onClick:function(){return Y(k.current.slider.get(),0)}}),Object(r.jsx)(v.a,{onSlide:function(e){return Y(e)},range:{min:5,max:20},animate:!1,ref:k,orientation:"vertical",width:10,start:10*i.doctorView.zoom,connect:[!1,!0],step:1,tooltips:!1,format:Qi()({decimals:1})}),Object(r.jsx)("i",{className:"fas fa-search-minus  mt-3",style:{color:"white",cursor:"pointer"},onClick:function(){return Y(k.current.slider.get(),1)}})]})]}),Object(r.jsx)("div",{className:"col-6 p-0"}),Object(r.jsxs)("div",{className:"col-3 p-4 flex right top",children:[Object(r.jsx)("div",{className:"col-12 p-0 data-header flex right",children:"John Doe"}),Object(r.jsx)("div",{className:"col-12 p-0 data-header flex right",children:i.doctorView.title}),Object(r.jsx)("div",{className:"col-12 p-0 data-header flex right",children:(H=i.doctorView.date,H.toDateString())}),Object(r.jsx)("div",{className:"col-12 p-0 data-header flex right",children:"Age: 72"}),Object(r.jsx)("div",{className:"col-12 p-0 data-header flex right",children:"Sex: M"}),Object(r.jsx)("div",{className:"col-12 p-0",children:Object(r.jsx)("button",{className:"button-main",onClick:function(){return n({type:y.SET_LOADER,showLoader:!1}),void n({type:y.SET_IS_LOADED,isLoaded:!1})},children:"Close"})}),Object(r.jsx)("div",{className:"col-12 pt-2 px-0 flex data-header right",children:Object(r.jsxs)("b",{children:["Volume Opacity: ",(100*i.visState.volumeOpacity).toFixed(0),"%"]})}),Object(r.jsx)("div",{className:"col-auto p-0 flex small-slider vertical",children:Object(r.jsx)(v.a,{onSlide:function(e){n({type:y.SET_VOLUME_OPACITY,volumeOpacity:e/100})},range:{min:0,max:100},ref:N,direction:"rtl",start:100*i.visState.volumeOpacity,connect:[!0,!1],orientation:"vertical",step:1})})]}),Object(r.jsx)("div",{className:"col-12 p-0 flex center slider-container",children:Object(r.jsxs)("div",{className:"col-8 p-4 slider",children:[W>1&&Object(r.jsx)(v.a,{onSet:function(e){return t=e,void(U.current&&U.current.isLoaded?n({type:y.SET_VOLUME_INDEX,volumeIndex:Number.parseInt(t[0])}):P.current&&P.current.set(i.visState.volumeIndex));var t},range:{min:0,max:W-1},ref:P,style:{height:100,cursor:"pointer"},start:B,connect:[!0,!1],step:1,tooltips:!0,format:Qi()({decimals:0})}),i.doctorView.phaseTimes.length>0&&W>1&&Object(r.jsxs)("div",{className:"col-12 p-0 flex space-between",children:[Object(r.jsxs)("div",{className:"data-header flex center column tick",children:[Object(r.jsx)("div",{className:"tick-line"}),Object(r.jsx)("h5",{children:"0s"})]}),i.doctorView.phaseTimes.map((function(e){return Object(r.jsxs)("div",{className:"data-header flex center column tick",children:[Object(r.jsx)("div",{className:"tick-line"}),Object(r.jsxs)("h5",{children:[e,"s"]})]})}))]})]})})]}),Object(r.jsx)("div",{className:"loader-container",children:Object(r.jsx)($i.a,{type:"ThreeDots",color:"#95afcd",height:250,width:250,visible:i.showLoader})}),i.doctorView.isLoaded&&Object(r.jsx)("div",{className:"flex col-12",children:Object(r.jsx)("div",{className:"col-12 flex graphics-center",children:Object(r.jsx)(tt,{ref:U,store:i,dispatch:n})})}),f?q:null]})},tr=i(72),ir=i(16);function rr(){return Object(r.jsxs)("div",{className:"col-12 p-0 flex fill center",children:[Object(r.jsx)("h2",{className:"header",children:"I am a"}),Object(r.jsxs)("div",{className:"col-12 p-0 flex center",children:[Object(r.jsxs)(tr.a,{className:"m-2 button-main button-large",children:[" ",Object(r.jsx)(ir.b,{to:"/doctor",children:"Doctor"})]}),Object(r.jsxs)(tr.a,{className:"m-2 button-main button-large",children:[" ",Object(r.jsx)(ir.b,{to:"/nurse",children:"Nurse"})," "]}),Object(r.jsxs)(tr.a,{className:"m-2 button-main button-large",children:[" ",Object(r.jsx)(ir.b,{to:"/radiologist",children:"Radiologist"})," "]})]})]})}function ar(){var e=Object(a.useContext)(Fi),t=Object(l.a)(e,2),i=t[0],n=t[1],o=(Object(m.f)(),s.a.useRef(null)),u=i.visState.volumeSet;null!==u&&void 0!==u&&u.getNumVolumes();var h;return Object(r.jsxs)("div",{className:"col-12 p-0 flex fill",children:[!i.doctorView.isLoaded&&Object(r.jsx)(Zi,{isNurse:!0}),i.doctorView.isLoaded&&Object(r.jsxs)("div",{className:"overlay flex",children:[Object(r.jsxs)("div",{className:"col-3 p-3 flex left",children:[Object(r.jsx)("div",{className:"col-12 p-0 flex left data-header",children:"Status"}),Object(r.jsx)("h3",{className:"data-large",children:i.doctorView.status}),Object(r.jsx)("div",{className:"col-12 p-0 flex left data-header",children:"Est. Rate of Leakage"}),Object(r.jsxs)("h3",{className:"data-large",children:[i.doctorView.rateOfLeakage," ml/s"]}),Object(r.jsx)("div",{className:"col-12 p-0 flex left data-header",children:"Est. Time of Stroke"}),Object(r.jsxs)("h3",{className:"data-large",children:[i.doctorView.timeOfStroke," s"]})]}),Object(r.jsx)("div",{className:"col-6 p-0"}),Object(r.jsxs)("div",{className:"col-3 p-4 flex right top",children:[Object(r.jsx)("div",{className:"col-12 p-0 data-header flex right",children:i.doctorView.title}),Object(r.jsx)("div",{className:"col-12 p-0 data-header flex right",children:(h=i.doctorView.date,h.toDateString())}),Object(r.jsx)("button",{className:"button-main",onClick:function(){return n({type:y.SET_LOADER,showLoader:!1}),void n({type:y.SET_IS_LOADED,isLoaded:!1})},children:"Close"})]})]}),Object(r.jsx)("div",{className:"loader-container",children:Object(r.jsx)($i.a,{type:"ThreeDots",color:"#95afcd",height:250,width:250,visible:i.showLoader})}),i.doctorView.isLoaded&&Object(r.jsx)("div",{className:"col-12 flex graphics-center",children:Object(r.jsx)(tt,{ref:o,store:i,dispatch:n})})]})}var sr=i(139);function nr(e){var t=e.label,i=e.reset,s=e.defaultValue,n=e.module,o=e.name,m=Object(a.useContext)(Fi),u=Object(l.a)(m,2),h=u[0],c=u[1],d=h.options[n][o];Object(a.useEffect)((function(){console.log(i),i&&_(s)}),[i]);var _=function(e){c({type:y.SET_INPUT,payload:{module:n,name:o,value:e}})};return Object(r.jsx)(sr.a.Group,{controlId:"formBasicPassword",className:"flex left",children:Object(r.jsx)(sr.a.Check,{type:"checkbox",checked:d,label:t,onChange:function(e){_(!d)}})})}function or(e){var t=e.label,i=e.reset,s=e.defaultValue,n=e.placeholder,o=e.module,m=e.name,u=Object(a.useContext)(Fi),h=Object(l.a)(u,2),c=h[0],d=h[1],_=c.options[o][m];Object(a.useEffect)((function(){i&&f(s)}),[i]);var f=function(e){d({type:y.SET_INPUT,payload:{module:o,name:m,value:e}})};return Object(r.jsx)("div",{className:"flex",children:Object(r.jsxs)(sr.a.Group,{controlId:_,className:"flex left",children:[Object(r.jsx)(sr.a.Label,{children:t}),Object(r.jsx)(sr.a.Control,{value:_,type:"email",placeholder:n,onChange:function(e){return function(e){console.log(e),f(e.target.value)}(e)}})]})})}var lr=i(49),mr=function(e){var t=Object(a.useState)(!0),i=Object(l.a)(t,2),s=i[0],n=i[1];return Object(r.jsxs)("div",{className:"module-container col-12 p-1",children:[Object(r.jsxs)("h5",{className:"space-between header pointer col-12 p-0 flex",onClick:function(){return n(!s)},children:[e.title,Object(r.jsx)("i",{children:Object(r.jsx)(lr.a,{icon:s?ki.b:ki.c})})]}),!s&&Object(r.jsx)("div",{className:"flex text",children:e.children})]})};function ur(e){var t=e.reset,i=Object(a.useContext)(Fi);Object(l.a)(i,2)[1];return Object(r.jsx)(mr,{title:"Dynamic Spot Extraction Options (Module 4)",children:Object(r.jsxs)("div",{className:"flex column fill col-12",children:[Object(r.jsx)("b",{className:"fit p-0 flex",children:"General Options"}),Object(r.jsx)(nr,{label:"Restart Enabled",defaultValue:!0,reset:t,name:"enableRestart",module:"moduleFour"}),Object(r.jsx)(or,{label:"Vascular Mask Data Directory",defaultValue:"C:\\Workspaces\\carl",reset:t,placeholder:"Your path goes here",name:"vascularMaskDirectory",module:"moduleTwo"}),Object(r.jsx)(or,{label:"Output Data Directory",defaultValue:"C:\\Workspaces\\carl",reset:t,placeholder:"Your path goes here",name:"outputDataDirectory",module:"moduleTwo"})]})})}function hr(e){var t=e.reset,i=Object(a.useContext)(Fi);Object(l.a)(i,2)[1];return Object(r.jsx)(mr,{title:"Preprocessing Options (Module 1)",children:Object(r.jsxs)("div",{className:"flex fill",children:[Object(r.jsxs)("div",{className:"col-6",children:[Object(r.jsx)(nr,{label:"Process Timing Data",defaultValue:!0,reset:t,name:"processTimingData",module:"moduleOne"}),Object(r.jsx)(nr,{label:"Build 4D Image Data Set",defaultValue:!0,reset:t,name:"build4d",module:"moduleOne"}),Object(r.jsx)(nr,{label:"Build 3D Image Data Set",defaultValue:!0,reset:t,name:"build3d",module:"moduleOne"}),Object(r.jsx)(nr,{label:"Compute 4D Summary",defaultValue:!0,reset:t,name:"compute4dSummary",module:"moduleOne"}),Object(r.jsx)(nr,{label:"Save available data",defaultValue:!0,reset:t,name:"saveAvailableData",module:"moduleOne"})]}),Object(r.jsxs)("div",{className:"col-6",children:[Object(r.jsx)(nr,{label:"Reload timing indices",defaultValue:!0,reset:t,name:"reloadTimingIndices",module:"moduleOne"}),Object(r.jsx)(nr,{label:"Stop if options change",defaultValue:!1,reset:t,name:"stopIfOptionsChange",module:"moduleOne"}),Object(r.jsx)(nr,{label:"Auto select largest",defaultValue:!0,reset:t,name:"autoSelectLargest",module:"moduleOne"}),Object(r.jsx)(nr,{label:"Auto select first largest",defaultValue:!1,reset:t,name:"autoSelectFirstLargest",module:"moduleOne"}),Object(r.jsx)(nr,{label:"Auto select last largest",defaultValue:!0,reset:t,name:"autoSelectLastLargest",module:"moduleOne"})]}),Object(r.jsxs)("div",{className:"col-12 flex left",children:[Object(r.jsx)("b",{className:"col-12 p-0 flex left",children:"Set time Separation"}),Object(r.jsxs)("div",{className:"col-12 p-0 flex",children:[Object(r.jsx)(or,{label:"Min",defaultValue:"0",reset:t,placeholder:"",name:"setTimeSeparationMin",module:"moduleOne"}),Object(r.jsx)(or,{label:"Max",defaultValue:"60",reset:t,placeholder:"",name:"setTimeSeparationMax",module:"moduleOne"})]}),Object(r.jsx)(or,{label:"Specify image set index",defaultValue:"0",reset:t,placeholder:"",name:"imageSetIndex",module:"moduleOne"})]})]})})}function cr(e){var t=e.label,i=e.reset,s=e.defaultValue,n=e.options,o=e.module,m=e.name,u=Object(a.useContext)(Fi),h=Object(l.a)(u,2),c=h[0],d=h[1],f=c.options[o][m];Object(a.useEffect)((function(){i&&v(n[s])}),[i]);var v=function(e){d({type:y.SET_INPUT,payload:{module:o,name:m,value:e}})};return Object(r.jsxs)("div",{className:"flex left column mr-2",children:[t,Object(r.jsxs)(_.a,{id:"dropdown-basic-button",onSelect:function(e,t){var i;console.log(t),(null===t||void 0===t||null===(i=t.target)||void 0===i?void 0:i.text)&&v(t.target.text)},children:[Object(r.jsx)(_.a.Toggle,{id:JSON.stringify(Math.random()),children:f}),Object(r.jsx)(_.a.Menu,{children:n.map((function(e,t){return Object(r.jsx)(_.a.Item,{href:"#/action-".concat(t),children:e})}))})]})]})}function dr(e){var t=e.reset,i=Object(a.useContext)(Fi);Object(l.a)(i,2)[1];return Object(r.jsx)(mr,{title:"Adaptive Vascular Model Options (Module 3)",children:Object(r.jsxs)("div",{className:"flex fill col-12",children:[Object(r.jsxs)("div",{className:"col-12 flex column py-2 px-0",children:[Object(r.jsx)("b",{className:"fit p-0 flex",children:"Binning Options"}),Object(r.jsx)(or,{label:"Minimum number of bins",defaultValue:"50",reset:t,placeholder:"Your path goes here",name:"minimumNumber",module:"moduleThree"}),Object(r.jsx)(or,{label:"Number of bins",defaultValue:"400",reset:t,placeholder:"Your path goes here",name:"numberOfBins",module:"moduleThree"}),Object(r.jsx)(or,{label:"Distribution Tail",defaultValue:"0.01",reset:t,placeholder:"Your path goes here",name:"minimumNumber",module:"moduleThree"}),Object(r.jsx)(cr,{label:"Feature",defaultValue:0,reset:t,options:["Median Value","Mode Value","Cumulative Probability"],name:"feature",module:"moduleThree"})]}),Object(r.jsxs)("div",{className:"col-12 flex column py-2 px-0",children:[Object(r.jsx)("b",{className:"fit p-0 flex",children:"Distribution Feature Range"}),Object(r.jsx)(or,{label:"Median Min",defaultValue:"0.3",reset:t,name:"medianMin",module:"moduleThree"}),Object(r.jsx)(or,{label:"Median Max",defaultValue:"0.4",reset:t,name:"medianMax",module:"moduleThree"}),Object(r.jsx)(nr,{label:"Non-negative values",defaultValue:!0,reset:t,name:"nonNegativeValues",module:"moduleThree"}),Object(r.jsx)(nr,{label:"Non-zero values",defaultValue:!0,reset:t,name:"nonZeroValues",module:"moduleThree"})]})]})})}function _r(e){var t=e.reset,i=Object(a.useContext)(Fi);Object(l.a)(i,2)[1];return Object(r.jsx)(mr,{title:"Brain Segmentation Options (Module 2)",children:Object(r.jsxs)("div",{className:"flex fill col-12 ",children:[Object(r.jsxs)("div",{className:"col-12 flex column py-2 px-0",children:[Object(r.jsx)("b",{className:"fit p-0 flex",children:"General Options"}),Object(r.jsx)(or,{label:"Data Output Path",defaultValue:"C:\\Workspaces\\carl",reset:t,placeholder:"Your path goes here",name:"dataOutput",module:"moduleTwo"}),Object(r.jsx)(nr,{label:"Restart Enabled",defaultValue:!0,reset:t,name:"restartEnabled",module:"moduleTwo"}),Object(r.jsx)(or,{label:"Minimum 3D",defaultValue:"0.125",reset:t,placeholder:"",name:"minimum3d",module:"moduleTwo"})]}),Object(r.jsxs)("div",{className:"col-12 flex py-2 px-0",children:[Object(r.jsx)("b",{className:"col-12 p-0 flex",children:"Data Source"}),Object(r.jsx)(cr,{label:"Modality",defaultValue:0,reset:t,options:["CT","MR"],name:"modality",module:"moduleTwo"}),Object(r.jsx)(cr,{label:"Vendor",defaultValue:0,reset:t,options:["Toshiba","GE"],name:"vendor",module:"moduleTwo"}),Object(r.jsx)(cr,{label:"Scanner",defaultValue:0,reset:t,options:["320","LS"],name:"scanner",module:"moduleTwo"}),Object(r.jsx)(cr,{label:"Process",defaultValue:0,reset:t,options:["DCE","Single"],name:"process",module:"moduleTwo"}),Object(r.jsx)(cr,{label:"Region",defaultValue:0,reset:t,options:["Brain"],name:"region",module:"moduleTwo"}),Object(r.jsx)(cr,{label:"Study",defaultValue:0,reset:t,options:["ICH","dCTA","CTP"],name:"study",module:"moduleTwo"})]}),Object(r.jsxs)("div",{className:"col-12 flex column py-2 px-0",children:[Object(r.jsx)("b",{className:"fit p-0 flex",children:"Image Set Time Series Thresholding"}),Object(r.jsx)(nr,{label:"Include Maximum Threshold",defaultValue:!0,reset:t,name:"includeMinThreshold",module:"moduleTwo"}),Object(r.jsx)(nr,{label:"Include Minimum Threshold",defaultValue:!0,reset:t,name:"includeMaxThreshold",module:"moduleTwo"})]}),Object(r.jsxs)("div",{className:"col-12 flex column py-2 px-0",children:[Object(r.jsx)("b",{className:"fit p-0 flex",children:"Tissue Mask Generation"}),Object(r.jsx)(nr,{label:"Use morphological operations",defaultValue:!0,reset:t,name:"useMorphologicalOperations",module:"moduleTwo"}),Object(r.jsx)(or,{label:"STRFI disk",defaultValue:"5",reset:t,name:"strfiDisk",module:"moduleTwo"}),Object(r.jsx)(or,{label:"STRFI 3D",defaultValue:"2",reset:t,name:"strfi3d",module:"moduleTwo"})]}),Object(r.jsxs)("div",{className:"col-12 flex column py-2 px-0",children:[Object(r.jsx)("b",{className:"fit p-0 flex",children:"Brain Selection Algorithm Parameters"}),Object(r.jsx)(or,{label:"Image index range",defaultValue:"All",reset:t,placeholder:"",name:"imageIndexRange",module:"moduleTwo"}),Object(r.jsx)(or,{label:"Image index region",defaultValue:"Minimum",reset:t,placeholder:"",name:"imageRegion",module:"moduleTwo"}),Object(r.jsx)(or,{label:"minimumConnected",defaultValue:"0.2",reset:t,placeholder:"",name:"minimumConnected",module:"moduleTwo"}),Object(r.jsx)(or,{label:"Coarse radius",defaultValue:"20",reset:t,placeholder:"",name:"coarseRadius",module:"moduleTwo"}),Object(r.jsx)(or,{label:"STRFI radius",defaultValue:"1.5",reset:t,placeholder:"",name:"strfiRadius",module:"moduleTwo"})]})]})})}i(131);function fr(){var e=Object(a.useState)(!1),t=Object(l.a)(e,2),i=t[0],s=t[1];return Object(a.useEffect)((function(){i&&s(!1)}),[i]),Object(r.jsxs)("div",{className:"flex center page",children:[Object(r.jsx)("div",{className:"col-2"}),Object(r.jsxs)("div",{className:"col-8 py-3 px-0 flex options-container",children:[Object(r.jsxs)("h4",{className:"header col-12 flex space-between",children:["Options",Object(r.jsx)(tr.a,{variant:"light",onClick:function(){s(!0)},children:"Reset to Default"})]}),Object(r.jsx)(hr,{reset:i}),Object(r.jsx)(_r,{reset:i}),Object(r.jsx)(dr,{reset:i}),Object(r.jsx)(ur,{reset:i})]}),Object(r.jsx)("div",{className:"col-2"})]})}var vr=i(138),pr=i(140);function gr(){var e=Object(a.useContext)(Fi),t=Object(l.a)(e,2);t[0],t[1],Object(m.g)();Object(a.useEffect)((function(){var e="",t=window.location.search;if(t.length>0){var i=t.match(/\\?url=(\S+)/);if(null===i)return void console.log("arguments should be in form: ?url=www.xxx.yy/zz/ww");var r=(e=i[1]).match(/^((ftp|http|https):\/\/)?(([\S]+)\.)?([\S]+)\.([A-z]{2,})(:\d{1,6})?\/[\S]+/),a=e.match(/(ftp|http|https):\/\/([\d]+)\.([\d]+)\.([\d]+)\.([\d]+)(:([\d]+))?\/([\S]+)/);if(null===r&&null===a)return void console.log("Not valid URL = ".concat(e));n(e)}}),[]);var i=Object(a.useState)(""),s=Object(l.a)(i,2),n=(s[0],s[1]);return Object(r.jsxs)(vr.a,{expand:"lg",className:"fit",children:[Object(r.jsx)(vr.a.Toggle,{"aria-controls":"basic-navbar-nav"}),Object(r.jsxs)(vr.a.Collapse,{id:"basic-navbar-nav",children:[Object(r.jsx)(pr.a,{className:"mr-auto"}),Object(r.jsx)(ir.c,{className:"p-1",activeStyle:{fontWeight:"bold"},exact:!0,to:"/",children:"Home"}),Object(r.jsx)(ir.c,{className:"p-1",activeStyle:{fontWeight:"bold"},exact:!0,to:"/doctor",children:"Doctor"}),Object(r.jsx)(ir.c,{className:"p-1",activeStyle:{fontWeight:"bold"},exact:!0,to:"/nurse",children:"Nurse"}),Object(r.jsx)(ir.c,{className:"p-1",activeStyle:{fontWeight:"bold"},exact:!0,to:"/radiologist",children:"Options"})]})]})}function Sr(e){var t=e.notification,i=Object(a.useContext)(Fi),s=Object(l.a)(i,2),n=(s[0],s[1]),o=t.header,m=t.body,u=t.isVisible,h=t.timer,c=t.icon,d=t.spin,_=t.status;return h&&setTimeout((function(){n({type:y.SET_NOTIFICATION,payload:{body:"",header:"",isVisible:!1}})}),h),u||h?Object(r.jsxs)("div",{className:"notification flex center column ".concat(_),children:[Object(r.jsxs)("div",{className:"notification-header",children:[c&&Object(r.jsx)(lr.a,{icon:c,spin:d,className:"mr-2"}),o]}),Object(r.jsx)("div",{className:"notification-body",children:m})]}):null}var xr=function(){var e=Object(a.useContext)(Fi),t=Object(l.a)(e,2),i=t[0],s=t[1];return Object(a.useEffect)((function(){s({type:y.SET_PATIENT_DATA,payload:[["355056963916367154422305871670634494196","2021-03-23T18:44:08-07:00",null,5,100,"0",!1,"C:\\Users\\Keenan\\Git\\carl-server\\data\\Study2",null,null,null,null,null,"2020-01-01T09:00:00-08:00"]]}),s({type:y.UPDATE_BIOMARKER_DATA,payload:[["355056963916367154422305871670634494196","V0",5]]}),s({type:y.UPDATE_BIOMARKER_DATA,payload:[["355056963916367154422305871670634494196","K1",.00148]]})}),[s]),Object(r.jsxs)("div",{className:"App flex column",children:[Object(r.jsx)(gr,{}),Object(r.jsxs)(m.c,{children:[Object(r.jsx)(m.a,{path:"/doctor",children:Object(r.jsx)(er,{})}),Object(r.jsx)(m.a,{path:"/radiologist",children:Object(r.jsx)(fr,{})}),Object(r.jsx)(m.a,{path:"/nurse",children:Object(r.jsx)(ar,{})}),Object(r.jsx)(m.a,{exact:!0,path:"/",children:Object(r.jsx)(rr,{})})]}),Object(r.jsx)(Sr,{notification:i.notification})]})};o.a.render(Object(r.jsx)(s.a.StrictMode,{children:Object(r.jsx)(Vi,{children:Object(r.jsx)(ir.a,{children:Object(r.jsx)(xr,{})})})}),document.getElementById("root"))},67:function(e,t){},79:function(e,t,i){},80:function(e,t,i){}},[[132,1,2]]]);
//# sourceMappingURL=main.664ea209.chunk.js.map