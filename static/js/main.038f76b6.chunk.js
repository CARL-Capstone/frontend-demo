(this["webpackJsonpmy-app"]=this["webpackJsonpmy-app"]||[]).push([[0],{129:function(e,t){},140:function(e,t,i){},141:function(e,t,i){},163:function(e,t,i){},182:function(e,t,i){},191:function(e,t,i){},205:function(e,t,i){"use strict";i.r(t);var a=i(2),r=i(0),s=i.n(r),o=i(29),n=i.n(o),l=(i(140),i(14)),m=i(16),u=(i(141),i(6)),h=i(7),c=i(131),d=i(220),_=i(46),f=i(58),v=i.n(f),p=i(50),g=i(13),S=i(19),x=i(18),b={SET_IS_LOADED:0,SET_FILENAME:1,SET_VOLUME_SET:2,SET_VOLUME_INDEX:3,SET_TEXTURE3D:4,SET_MODE_VIEW:5,SET_MODE_2D:6,SET_SLIDER_2D:7,SET_MODE_3D:8,SET_SLIDER_3DR:9,SET_SLIDER_3DG:10,SET_SLIDER_3DB:11,SET_SLIDER_Opacity:12,SET_SLIDER_Isosurface:13,SET_SLIDER_Brightness:14,SET_SLIDER_Cut:15,SET_SLIDER_Quality:16,SET_SLIDER_ErRadius:17,SET_SLIDER_ErDepth:18,SET_VOLUME_Renderer:19,SET_2D_TOOLS_INDEX:20,SET_2D_ZOOM:21,SET_2D_X_POS:22,SET_2D_Y_POS:23,SET_GRAPHICS_2D:24,SET_UI_APP:25,SET_DICOM_INFO:26,SET_IS_TOOL3D:27,SET_SLIDER_Contrast3D:28,SET_ERR_ARRAY:29,SET_MODE_3Droi:30,SET_DICOM_SERIES:31,SET_LOADER_DICOM:32,SET_FILENAMES:33,SET_PATIENT_DATA:34,UPDATE_PATIENT_DATA:35,SET_NOTIFICATION:36,SET_PHASETIMES:37,UPDATE_BIOMARKER_DATA:38,SET_SCANID:39,SET_3D_ZOOM:40,SET_SPOT_COLOR:69,SET_VOLUME_OPACITY:420,SET_SHOW_VENOUS_STRUCTURE:"360 no-scope",SET_INPUT:41,SET_LOADER:42},y={VIEW_NA:-1,VIEW_MPR:0,VIEW_2D:1,VIEW_3D_LIGHT:2,VIEW_3D:3,VIEW_COUNT:4},T={NA:-1,SAGGITAL:0,CORONAL:1,TRANSVERSE:2},D={NA:-1,ISO:0,RAYCAST:1,RAYFAST:2,EREASER:3},O={NA:-1,ISO:0,RAYCAST:1},R=i(71),w=i(3),E=i(1),j=function(){function e(){Object(u.a)(this,e),this.m_useWebGL2=void 0}return Object(h.a)(e,[{key:"createWebGLContext",value:function(){this.canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");var e=this.canvas.getContext("webgl2");return this.m_useWebGL2=1,null==e?(console.log("WebGL 2 not supported, moving to webgl 1"),e=this.canvas.getContext("webgl"),this.m_useWebGL2=0):console.log("WebGL 2 context created"),e}},{key:"getCanvas",value:function(){return this.canvas}},{key:"useWebGL2",value:function(){return this.m_useWebGL2}}]),e}(),M=Math.PI/720,A=function(){function e(t,i,a,r,s){Object(u.a)(this,e),this.rotateAmount=M,this.m_callback=s,this.m_mesh=r,this.m_wireMesh=null,this.m_camera=i,this.m_target=new E.U(0,0,0),this.m_scene=a,this.m_button=e.EVENT_BUTTON_NA,this.domElem=t,this.m_pressedLeft=!1,this.m_pressedRight=!1,this.m_prevMouse={x:-1,y:-1},this.m_prevTime=-1,this.m_deltaTime=0,this.m_spherical=new E.O,this.m_sphericalDelta=new E.O,this.m_spherical.set(0,0,0),this.m_sphericalDelta.set(0,0,0),this.m_autoRotate=!1,this.m_minDistance=.3,this.m_maxDistance=2.5,this.m_minAzimuthAngle=-1/0,this.m_maxAzimuthAngle=1/0,this.m_minPolarAngle=0,this.m_maxPolarAngle=2*Math.PI,this.m_enableDamping=!1,this.m_dampingFactor=.25,this.isEraserMode=!1}return Object(h.a)(e,[{key:"setEraserMode",value:function(e){this.isEraserMode=e}},{key:"setMesh",value:function(e){this.m_mesh=e}},{key:"setWireMesh",value:function(e){this.m_wireMesh=e}},{key:"setScene",value:function(e){this.m_scene=e}},{key:"getX",value:function(e){return e-this.domElem.offsetLeft}},{key:"getY",value:function(e){return e-this.domElem.offsetTop}},{key:"autoSpin",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.autoRotateInterval&&(clearInterval(this.autoRotateInterval),this.autoRotateInterval=void 0),t&&(this.autoRotateInterval=setInterval((function(){return e._autoSpin()}),1e3/30))}},{key:"_autoSpin",value:function(){var e=new E.y;e.identity();var t=new E.y;t.makeRotationAxis(new E.U(0,1,0),M),e.multiply(t).multiply(this.m_mesh.matrix),this.m_mesh.rotation.setFromRotationMatrix(e),this.m_wireMesh&&(e.identity(),e.multiply(t).multiply(this.m_wireMesh.matrix),this.m_wireMesh.rotation.setFromRotationMatrix(e)),this.m_callback()}},{key:"updateTime",value:function(e,t){if(0!==e||0!==t){var i=(new Date).getTime();if(this.m_prevTime=this.m_prevTime>0?this.m_prevTime:i,this.m_deltaTime=i-this.m_prevTime,this.m_prevTime=i,this.m_mesh){var a=new E.y,r=new E.y,s=new E.y,o=new E.U;o.copy(this.m_target).sub(this.m_camera.position).normalize(),r.makeRotationAxis(this.m_camera.up,.018*e),a.makeRotationAxis(o.cross(this.m_camera.up),.018*t),s.identity(),s.multiply(r).multiply(a).multiply(this.m_mesh.matrix),this.m_mesh.rotation.setFromRotationMatrix(s),this.m_wireMesh&&(s.identity(),s.multiply(r).multiply(a).multiply(this.m_wireMesh.matrix),this.m_wireMesh.rotation.setFromRotationMatrix(s)),this.m_callback()}}}},{key:"onMouseDown",value:function(e,t,i){this.m_pressedLeft=!0,this.m_prevMouse={x:e,y:t},this.m_spherical.set(0,0,0),this.m_sphericalDelta.set(0,0,0),this.m_prevTime=(new Date).getTime(),this.ctrlKey=i}},{key:"onMouseUp",value:function(){this.m_pressedLeft=!1,this.m_prevMouse.x=-1,this.m_prevMouse.y=-1}},{key:"onMouseMove",value:function(e,t){this.m_prevMouse.x<0&&(this.m_prevMouse.x=e,this.m_prevMouse.y=t);var i=e-this.m_prevMouse.x,a=t-this.m_prevMouse.y;this.m_prevMouse.x=e,this.m_prevMouse.y=t,this.m_pressedLeft&&this.updateTime(i,a)}},{key:"onZoom",value:function(e){var t=.2*e,i=this.m_camera.position.length(),a=this.m_camera.position.sub(this.m_target);a.normalize(),i+=t,i=Math.max(i,.3),i=Math.min(i,2.5),a.multiplyScalar(i),this.m_camera.position.set(a.x,a.y,a.z),this.m_camera.lookAt(this.m_target),this.m_camera.updateMatrixWorld()}},{key:"setZoom",value:function(e){var t=e,i=this.m_camera.position.sub(this.m_target);i.normalize(),t=Math.max(t,.3),t=Math.min(t,2.5),i.multiplyScalar(t),this.m_camera.position.set(i.x,i.y,i.z),this.m_camera.lookAt(this.m_target),this.m_camera.updateMatrixWorld()}}]),e}();A.EVENT_BUTTON_NA=-1,A.EVENT_BUTTON_LEFT=0,A.EVENT_BUTTON_CENTER=1,A.EVENT_BUTTON_RIGHT=2;var I=i.p+"static/media/backface.3dc9d515.vert",C=i.p+"static/media/backface.84a75448.frag",X=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment=""}return Object(h.a)(e,[{key:"create",value:function(e){var t=this,i=new E.p(E.m);i.setResponseType("text");var a=new E.p(E.m);a.setResponseType("text"),i.load(I,(function(i){t.m_strShaderVertex=i,a.load(C,(function(i){t.m_strShaderFragment=i;var a=new E.M({vertexShader:t.m_strShaderVertex,fragmentShader:t.m_strShaderFragment,side:E.c,depthTest:!0,depthFunc:E.t,blending:E.C});e&&e(a)}))}))}}]),e}(),F=i.p+"static/media/frontface.6197e7b1.vert",k=i.p+"static/media/frontface.7ecf0644.frag",U=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment="",this.m_uniforms={texBF:{type:"t",value:null},PlaneX:{type:"v4",value:new E.V(-1,0,0,.5)},PlaneY:{type:"v4",value:new E.V(0,-1,0,.5)},PlaneZ:{type:"v4",value:new E.V(0,0,-1,.5)}}}return Object(h.a)(e,[{key:"create",value:function(e,t){var i=this;this.m_uniforms.texBF.value=e;var a=new E.p(E.m);a.setResponseType("text");var r=new E.p(E.m);r.setResponseType("text"),a.load(F,(function(e){i.m_strShaderVertex=e,r.load(k,(function(e){i.m_strShaderFragment=e;var a=new E.M({uniforms:i.m_uniforms,vertexShader:i.m_strShaderVertex,fragmentShader:i.m_strShaderFragment,side:E.r,depthTest:!0,depthFunc:E.u,blending:E.C});t&&t(a)}),(function(e){console.log("Shader load failed! because of error "+e.target.status+", "+e.target.statusText)}))}))}}]),e}(),N=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment="",this.m_defines={backCullMode:1},this.m_uniforms={texBF:{type:"t",value:null},texFF:{type:"t",value:null}}}return Object(h.a)(e,[{key:"create",value:function(e,t){return this.m_uniforms.texBF.value=e,this.m_uniforms.texFF.value=t,this.m_strShaderVertex="\n      varying vec3 pos;\n      attribute vec3 uvw;\n      varying vec4 screenpos;\n      void main() {\n        pos = uvw;\n        screenpos = (projectionMatrix  * modelViewMatrix * vec4(position, 1.0));\n        gl_Position =  screenpos;\n      }\n    ",this.m_strShaderFragment="\n      precision highp float;\n      precision highp int;\n      uniform sampler2D texFF;\n      uniform sampler2D texBF;\n\n      varying vec3 pos;\n      varying vec4 screenpos;\n      void main() {\n      vec2 tc = screenpos.xy / screenpos.w * 0.5 + 0.5;\n      vec3 back  = texture2D(texBF, tc, 0.0).xyz;\n      vec3 front = texture2D(texFF, tc, 0.0).xyz;\n      float cullvalue = length(pos - back) - length(front - back);\n\n\n      #if backCullMode == 1\n        if (cullvalue < -0.001)\n          discard;\n      #endif\n      #if backCullMode == 0\n        if (cullvalue > 0.001)\n          discard;\n      #endif\n\n        gl_FragColor = vec4(0.5, 0.0, 1.0, 1.0);\n        //gl_FragColor = vec4(cullvalue, cullvalue, cullvalue, 1.0);\n        //gl_FragColor = vec4(front, 1.0);\n      }\n    ",new E.M({uniforms:this.m_uniforms,defines:this.m_defines,vertexShader:this.m_strShaderVertex,fragmentShader:this.m_strShaderFragment,side:E.r,wireframe:!0,depthTest:!1,polygonOffset:!1,polygonOffsetFactor:-4,polygonOffsetUnits:-4})}}]),e}(),V=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment="",this.m_uniforms={texBuffer:{type:"t",value:null}}}return Object(h.a)(e,[{key:"create",value:function(e){return this.m_uniforms.texBuffer.value=e,this.m_strShaderVertex="\n      varying vec4 screenpos;\n      void main() {\n        screenpos = (projectionMatrix  * modelViewMatrix * vec4(position, 1.0));\n        gl_Position =  screenpos;\n      }\n    ",this.m_strShaderFragment="\n      precision highp float;\n      precision highp int;\n      uniform sampler2D texBuffer;\n\n      varying vec4 screenpos;\n      void main() {\n        vec2 tc = screenpos.xy / screenpos.w * 0.5 + 0.5;\n        gl_FragColor = texture2D(texBuffer, tc, 0.0);\n      }\n    ",new E.M({uniforms:this.m_uniforms,vertexShader:this.m_strShaderVertex,fragmentShader:this.m_strShaderFragment,side:E.r,depthTest:!0,depthFunc:E.u,blending:E.C})}}]),e}(),L=i.p+"static/media/clipplane.7ba65be0.vert",P=i.p+"static/media/clipplane.d594e568.frag",B=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment="",this.m_uniforms={MVP:{type:"m4"},texBF:{type:"t"}}}return Object(h.a)(e,[{key:"create",value:function(e,t){var i=this;this.m_uniforms.texBF.value=e;var a=new E.p(E.m);a.setResponseType("text");var r=new E.p(E.m);r.setResponseType("text"),a.load(L,(function(e){i.m_strShaderVertex=e,r.load(P,(function(e){i.m_strShaderFragment=e;var a=new E.M({uniforms:i.m_uniforms,vertexShader:i.m_strShaderVertex,fragmentShader:i.m_strShaderFragment,side:E.n,depthTest:!1,depthWrite:!1});t&&t(a)}))}))}}]),e}(),z=i.p+"static/media/rendertotexture.b51229d9.vert",G=i.p+"static/media/rendertotexture.1f755ade.frag",W=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment="",this.m_uniforms={texTF:{type:"t",value:null},texVolume:{type:"t",value:null},texRoiId:{type:"t",value:null},texRoiColor:{type:"t",value:null},RoiVolumeTex:{type:"t",value:null},texVolumeMask:{type:"t",value:null},texVolumeAO:{type:"t",value:null},lightDir:{type:"v3",value:new E.U(0,0,0)},texBF:{type:"t",value:null},texFF:{type:"t",value:null},t_function1min:{type:"v4",value:new E.V(0,0,0,0)},t_function1max:{type:"v4",value:new E.V(0,0,0,0)},t_function2min:{type:"v4",value:new E.V(0,0,0,0)},t_function2max:{type:"v4",value:new E.V(0,0,0,0)},stepSize:{type:"v4",value:new E.V(0,0,0,0)},texSize:{type:"f",value:0},isoThreshold:{type:"f",value:0},brightness3D:{type:"f",value:0},contrast3D:{type:"f",value:0},colorMap1D:{type:"t",value:null},heatMap1D:{type:"t",value:null},opacityBarrier:{type:"f",value:0},volumeOpacity:{type:"f",value:1},tileCountX:{type:"f",value:0},volumeSizeZ:{type:"f",value:0},xDim:{type:"f",value:0},yDim:{type:"f",value:0},zDim:{type:"f",value:0},ssaoOffsets:{type:"v3v"},SPOTcolor:{type:"v3",value:new E.U(1,1,1)},showSolids:{type:"b",value:!0}},this.m_defines={isoRenderFlag:0,MaskFlag:0,useAmbientTex:0,useWebGL2:1}}return Object(h.a)(e,[{key:"create",value:function(e,t,i,a,r,s,o,n){var l=this;this.m_uniforms.texTF.value=e,this.m_uniforms.texVolume.value=t,this.m_uniforms.texVolumeMask.value=i,this.m_uniforms.texVolumeAO.value=a,this.m_uniforms.texBF.value=r,this.m_uniforms.texFF.value=s,this.m_uniforms.ssaoOffsets.value=o;var m=new E.p(E.m);m.setResponseType("text");var u=new E.p(E.m);u.setResponseType("text"),m.load(z,(function(e){l.m_strShaderVertex=e,u.load(G,(function(e){l.m_strShaderFragment=e;var t=new E.M({uniforms:l.m_uniforms,defines:l.m_defines,vertexShader:l.m_strShaderVertex,fragmentShader:l.m_strShaderFragment,side:E.c,depthTest:!0,depthFunc:E.t,blending:E.C});n&&n(t)}))}))}}]),e}(),H=i.p+"static/media/interpolation.ae2f2bf4.vert",q=i.p+"static/media/interpolation.b65fb94f.frag",Y=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment="",this.m_uniforms={isoSurfTexel:{type:"v2",value:null},texIsoSurface:{type:"t",value:null}},this.m_defines={isoRenderFlag:0}}return Object(h.a)(e,[{key:"create",value:function(e,t){var i=this;this.m_uniforms.texIsoSurface.value=e;var a=new E.p(E.m);a.setResponseType("text");var r=new E.p(E.m);r.setResponseType("text"),a.load(H,(function(e){i.m_strShaderVertex=e,r.load(q,(function(e){i.m_strShaderFragment=e;var a=new E.M({uniforms:i.m_uniforms,defines:i.m_defines,vertexShader:i.m_strShaderVertex,fragmentShader:i.m_strShaderFragment,side:E.c});t&&t(a)}))}))}}]),e}(),Z=i.p+"static/media/volumerender.0fdf551f.vert",K=i.p+"static/media/volumerender.00647b63.frag",Q=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment="",this.m_uniforms={isoSurfTexel:{type:"v2",value:null},lightDir:{type:"v3",value:new E.U(0,0,0)},texTF:{type:"t",value:null},texVolume:{value:null},texRoiId:{type:"t",value:null},texRoiColor:{type:"t",value:null},RoiVolumeTex:{type:"t",value:null},texVolumeMask:{type:"t",value:null},texVolumeAO:{type:"t",value:null},texBF:{type:"t",value:null},texFF:{type:"t",value:null},texIsoSurface:{type:"t",value:null},colorMap1D:{type:"t",value:null},heatMap1D:{type:"t",value:null},t_function1min:{type:"v4",value:new E.V(0,0,0,0)},t_function1max:{type:"v4",value:new E.V(0,0,0,0)},t_function2min:{type:"v4",value:new E.V(0,0,0,0)},t_function2max:{type:"v4",value:new E.V(0,0,0,0)},stepSize:{type:"v4",value:new E.V(0,0,0,0)},texSize:{type:"f",value:0},isoThreshold:{type:"f",value:0},brightness3D:{type:"f",value:0},contrast3D:{type:"f",value:0},tileCountX:{type:"f",value:0},volumeSizeZ:{type:"f",value:0},opacityBarrier:{type:"f",value:0},volumeOpacity:{type:"f",value:1},xDim:{type:"f",value:0},yDim:{type:"f",value:0},zDim:{type:"f",value:0},ssaoOffsets:{type:"v3v"},SPOTcolor:{type:"v3",value:new E.U(1,1,1)},showSolids:{type:"b",value:!0}},this.m_defines={isoRenderFlag:0,MaskFlag:0,useAmbientTex:0,useWebGL2:1}}return Object(h.a)(e,[{key:"create",value:function(e,t,i,a,r,s,o,n,l){var m=this;this.m_uniforms.texTF.value=e,this.m_uniforms.texVolume.value=t,this.m_uniforms.texVolumeMask.value=i,this.m_uniforms.texVolumeAO.value=a,this.m_uniforms.texBF.value=r,this.m_uniforms.texFF.value=s,this.m_uniforms.texIsoSurface.value=o,this.m_uniforms.ssaoOffsets.value=n;var u=new E.p(E.m);u.setResponseType("text");var h=new E.p(E.m);h.setResponseType("text"),u.load(Z,(function(e){m.m_strShaderVertex=e,h.load(K,(function(e){m.m_strShaderFragment=e;var t=new E.M({uniforms:m.m_uniforms,defines:m.m_defines,vertexShader:m.m_strShaderVertex,fragmentShader:m.m_strShaderFragment,side:E.c,depthTest:!0,depthFunc:E.t,blending:E.C});l&&l(t)}))}))}}]),e}(),J=i.p+"static/media/blur.a62df0a0.vert",$=i.p+"static/media/blur.d95db93c.frag",ee=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment="";this.m_uniforms={texVolume:{type:"t",value:null},texVolumeRoi:{type:"t",value:null},texRoiColor:{type:"t",value:null},texSegInUse:{type:"t",value:null},texelSize:{type:"v3",value:null},tileCountX:{type:"f",value:16},volumeSizeZ:{type:"f",value:256},xDim:{type:"f",value:256},yDim:{type:"f",value:256},blurSigma:{type:"f",value:.8},contrast:{type:"f",value:1},brightness:{type:"f",value:0},curZ:{type:"f",value:0},save_flag:{type:"b",value:!0}},this.m_defines={renderRoiMap:0,useWebGL2:1}}return Object(h.a)(e,[{key:"create",value:function(e,t,i,a,r,s){var o=this;this.m_uniforms.texVolume.value=e,this.m_uniforms.texVolume.value=e,this.m_uniforms.texVolumeRoi.value=t,this.m_uniforms.texRoiColor.value=a,this.m_uniforms.texSegInUse.value=r,this.m_uniforms.texelSize.value=i;var n=new E.p(E.m);n.setResponseType("text");var l=new E.p(E.m);l.setResponseType("text"),n.load(J,(function(e){o.m_strShaderVertex=e,l.load($,(function(e){o.m_strShaderFragment=e;var t=new E.M({uniforms:o.m_uniforms,defines:o.m_defines,vertexShader:o.m_strShaderVertex,fragmentShader:o.m_strShaderFragment});s&&s(t)}))}))}}]),e}(),te=i.p+"static/media/createAO.a62df0a0.vert",ie=i.p+"static/media/createAO.bae764f9.frag",ae=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment="";var t=1/256,i=256;this.m_uniforms={texVolume:{type:"t",value:null},vectorsTex:{type:"t",value:null},texelSize:{type:"v3",value:new E.U(t,t,t)},tileCountX:{type:"f",value:16},volumeSizeZ:{type:"f",value:i},xDim:{type:"f",value:i},yDim:{type:"f",value:i},curZ:{type:"f",value:i},isoThreshold:{type:"f",value:i},vectorsSize:{type:"i",value:null}},this.m_defines={useWebGL2:1}}return Object(h.a)(e,[{key:"create",value:function(e,t,i,a,r,s){var o=this;this.m_uniforms.texVolume.value=e,this.m_uniforms.vectorsTex.value=i,this.m_uniforms.texelSize.value=t,this.m_uniforms.vectorsSize.value=a,this.m_uniforms.isoThreshold.value=r;var n=new E.p(E.m);n.setResponseType("text");var l=new E.p(E.m);l.setResponseType("text"),n.load(te,(function(e){o.m_strShaderVertex=e,l.load(ie,(function(e){o.m_strShaderFragment=e;var t=new E.M({uniforms:o.m_uniforms,defines:o.m_defines,vertexShader:o.m_strShaderVertex,fragmentShader:o.m_strShaderFragment});s&&s(t)}))}))}}]),e}(),re=function e(){Object(u.a)(this,e),this.m_point=new E.U,this.m_next=null},se=function(){function e(t){Object(u.a)(this,e),this.create(t)}return Object(h.a)(e,[{key:"create",value:function(e){this.m_numPoints=0,this.m_numAllocatedPoints=e,this.m_points=new Array(e),this.m_voxels=new Array(4096);for(var t=0;t<e;t++)this.m_points[t]=new re,this.m_points[t].m_point.set(0,0,0),this.m_points[t].m_next=null}},{key:"getNumPoints",value:function(){return this.m_numPoints}},{key:"findPointSlow",value:function(e,t,i){for(var a=0;a<this.m_numPoints;a++){var r=e-this.m_points[a].m_point.x,s=t-this.m_points[a].m_point.y,o=i-this.m_points[a].m_point.z;if(r*r+s*s+o*o<1e-8)return a}return-1}},{key:"addPoint",value:function(e,t,i){var a=this.findPointSlow(e,t,i);if(a>=0)return a;if(this.m_numPoints>=this.m_numAllocatedPoints)return-1;var r=this.m_numPoints;return this.m_points[r]=new re,this.m_points[r].m_point.set(e,t,i),this.m_points[r].m_next=null,this.m_numPoints++,r}}]),e}(),oe=function e(t,i,a){Object(u.a)(this,e);this.m_indices=new Int32Array(3),this.m_indices[0]=t,this.m_indices[1]=i,this.m_indices[2]=a},ne=function(){function e(t){Object(u.a)(this,e),this.create(t)}return Object(h.a)(e,[{key:"create",value:function(e){this.m_numTriangles=0,this.m_numAllocatedTriangles=e,this.m_triangles=new Array(e);for(var t=0;t<e;t++)this.m_triangles[t]=new oe(-1,-1,-1)}},{key:"getNumTriangles",value:function(){return this.m_numTriangles}},{key:"addTriangle",value:function(e,t,i){return this.m_numTriangles>=this.m_numAllocatedTriangles?-1:(this.m_triangles[this.m_numTriangles].m_indices[0]=e,this.m_triangles[this.m_numTriangles].m_indices[1]=t,this.m_triangles[this.m_numTriangles].m_indices[2]=i,this.m_numTriangles++,1)}}]),e}(),le=function e(){Object(u.a)(this,e),this.va=new E.U,this.vb=new E.U,this.vc=new E.U},me=function(){function e(){Object(u.a)(this,e),this.m_numAllocated=0,this.m_numStacked=0,this.m_stack=null}return Object(h.a)(e,[{key:"create",value:function(e){for(var t=20,i=0;i<e;i++)t*=4;this.m_numAllocated=t,this.m_stack=new Array(this.m_numAllocated);for(var a=0;a<this.m_numAllocated;a++)this.m_stack[a]=new le;this.m_numStacked=0}},{key:"getStackDepth",value:function(){return this.m_numStacked}},{key:"isEmpty",value:function(){return 0===this.m_numStacked}},{key:"push",value:function(e,t,i){return this.m_numStacked>=this.m_numAllocated?-1:(this.m_stack[this.m_numStacked].va=e,this.m_stack[this.m_numStacked].vb=t,this.m_stack[this.m_numStacked].vc=i,this.m_numStacked++,1)}},{key:"pop",value:function(){return this.m_numStacked<=0?null:(this.m_numStacked--,this.m_stack[this.m_numStacked])}}]),e}(),ue=function(){function e(){Object(u.a)(this,e),this.m_pointSet=null,this.m_triangleSet=null}return Object(h.a)(e,[{key:"create",value:function(e,t){var i=.5257311121,a=.8506508083,r=[-i,0,+a,+i,0,+a,-i,0,-a,+i,0,-a,0,+a,+i,0,+a,-i,0,-a,+i,0,-a,-i,+a,+i,0,-a,+i,0,+a,-i,0,-a,-i,0],s=[0,4,1,0,9,4,9,5,4,4,5,8,4,8,1,8,10,1,8,3,10,5,3,8,5,2,3,2,7,3,7,10,3,7,6,10,7,11,6,11,0,6,0,1,6,6,1,10,9,0,11,9,11,2,9,2,5,7,2,11];this.m_pointSet=new se(12);for(var o=0,n=0;n<12;n++,o+=3){var l=r[o+0],m=r[o+1],u=r[o+2];this.m_pointSet.addPoint(l,m,u)}this.m_triangleSet=new ne(20),o=0;for(var h=0;h<20;h++,o+=3){var c=s[o+0],d=s[o+1],_=s[o+2];this.m_triangleSet.addTriangle(c,_,d)}this.subDivideMesh(t);for(var f=this.m_pointSet.getNumPoints(),v=0;v<f;v++)this.m_pointSet.m_points[v].m_point.x*=e.x,this.m_pointSet.m_points[v].m_point.y*=e.y,this.m_pointSet.m_points[v].m_point.z*=e.z;return 1}},{key:"getNumTriangles",value:function(){return this.m_triangleSet.m_numTriangles}},{key:"getNumVertices",value:function(){return this.m_pointSet.m_numPoints}},{key:"getVertex",value:function(e){return this.m_pointSet.m_points[e].m_point}},{key:"getTriangle",value:function(e){return this.m_triangleSet.m_triangles[e].m_indices}},{key:"saveGeoToPlyFile",value:function(e){var t="ply\nformat ascii 1.0\ncomment tetrahedron mesh\n",i=this.m_pointSet.m_numPoints,a=i.toString();t=(t=(t=(t=(t=t.concat("element vertex ")).concat(a)).concat("\n")).concat("property float x\nproperty float y\nproperty float z\n")).concat("element face ");var r=this.m_triangleSet.m_numTriangles,s=r.toString();t=(t=(t=(t=t.concat(s)).concat("\n")).concat("property list uchar int vertex_indices\n")).concat("end_header\n");for(var o=0;o<i;o++){var n=this.m_pointSet.m_points[o].m_point,l=n.x.toString(),m=n.y.toString(),u=n.z.toString();t=(t=(t=(t=(t=(t=t.concat(l)).concat(" ")).concat(m)).concat(" ")).concat(u)).concat(" 1.0\n")}for(var h=0;h<r;h++){var c=this.m_triangleSet.m_triangles[h].m_indices,d="3 ".concat(c[0]," ").concat(c[1]," ").concat(c[2],"\n");t=t.concat(d)}var _=(new TextEncoder).encode(t),f=new Blob([_],{type:"application/octet-stream"}),v=URL.createObjectURL(f),p=document.createElement("a");p.setAttribute("href",v),p.setAttribute("download",e);var g=document.createEvent("MouseEvents");g.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),p.dispatchEvent(g)}},{key:"saveGeoToObjFile",value:function(e){for(var t="# Tetrahedron test geo\n",i=this.m_pointSet.m_numPoints,a=i.toString(),r=this.m_triangleSet.m_numTriangles,s=r.toString(),o=0;o<i;o++){var n=this.m_pointSet.m_points[o].m_point,l=n.x.toString(),m=n.y.toString(),u=n.z.toString();t=(t=(t=(t=(t=(t=(t=t.concat("v  ")).concat(l)).concat(" ")).concat(m)).concat(" ")).concat(u)).concat("\n")}var h="# ".concat(a," vertices\n");t=(t=t.concat(h)).concat("g TetraObj\n");for(var c=0;c<r;c++){var d=this.m_triangleSet.m_triangles[c].m_indices,_=1+d[0],f=1+d[1],v=1+d[2],p="f ".concat(_," ").concat(f," ").concat(v,"\n");t=t.concat(p)}var g="# ".concat(s," triangles\n");t=t.concat(g);var S=(new TextEncoder).encode(t),x=new Blob([S],{type:"application/octet-stream"}),b=URL.createObjectURL(x),y=document.createElement("a");y.setAttribute("href",b),y.setAttribute("download",e);var T=document.createEvent("MouseEvents");T.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),y.dispatchEvent(T)}},{key:"subDivideMesh",value:function(e){if(0===e)return 1;var t=new me;t.create(e);var i=new me;i.create(e);for(var a=this.m_triangleSet.getNumTriangles(),r=0;r<a;r++){var s=this.m_triangleSet.m_triangles[r].m_indices,o=s[0],n=s[1],l=s[2],m=this.m_pointSet.m_points[o].m_point,u=this.m_pointSet.m_points[n].m_point,h=this.m_pointSet.m_points[l].m_point,c=t.push(m,u,h);if(c<1)return c}for(var d=t,_=i,f=0;f<e;f++){for(var v=d.getStackDepth(),p=0;p<v;p++){var g=d.pop();if(null===g)return-1;var S=g.va,x=g.vb,b=g.vc,y=new E.U,T=new E.U,D=new E.U;y.addVectors(S,x),y.normalize(),T.addVectors(x,b),T.normalize(),D.addVectors(b,S),D.normalize(),_.push(S,y,D),_.push(x,T,y),_.push(b,D,T),_.push(y,T,D)}var O=d;d=_,_=O}var R=d.getStackDepth(),w=Math.floor(3*R*.6);for(this.m_triangleSet.create(R),this.m_pointSet.create(w);!d.isEmpty();){var j=d.pop(),M=j.va,A=j.vb,I=j.vc,C=this.m_pointSet.addPoint(M.x,M.y,M.z),X=this.m_pointSet.addPoint(A.x,A.y,A.z),F=this.m_pointSet.addPoint(I.x,I.y,I.z),k=this.m_triangleSet.addTriangle(C,X,F);if(1!==k)return k}var U=this.m_pointSet.getNumPoints(),N=this.m_triangleSet.getNumTriangles();return U>w||N>R?-10:1}}]),e}(),he=function(){function e(t){Object(u.a)(this,e),this.rendererBlur=t.renderer,this.sceneBlur=t.scene,this.cameraOrtho=t.camera,this.xDim=t.xDim,this.yDim=t.yDim,this.zDim=t.zDim,this.texVolumeAO=null,this.vectorsTex=null}return Object(h.a)(e,[{key:"_setAOVectorTex",value:function(){var e=255,t=new ue,i=new E.U(.5,.5,.5);if(!(t.create(i,2)<1)){this.numAOVectors=t.getNumVertices(),this.vectors=new Uint8Array(4*this.numAOVectors);for(var a=0;a<this.numAOVectors;a++){var r=t.getVertex(a);this.vectors[4*a+0]=(r.x+.5)*e,this.vectors[4*a+1]=(r.y+.5)*e,this.vectors[4*a+2]=(r.z+.5)*e,this.vectors[4*a+3]=e}this.vectorsTex=new E.k(this.vectors,this.numAOVectors,1,E.J),this.vectorsTex.wrapS=E.g,this.vectorsTex.wrapT=E.g,this.vectorsTex.magFilter=E.B,this.vectorsTex.minFilter=E.B,this.vectorsTex.needsUpdate=!0}}},{key:"set",value:function(e,t){var i=this;null===this.vectorsTex&&this._setAOVectorTex(),this.xDimAO=this.xDim,this.yDimAO=this.yDim,this.zDimAO=this.zDim,this.bufferTextureAO=new E.W(this.xDimAO,this.yDimAO,{minFilter:E.v,magFilter:E.v,format:E.J,type:E.S,depthBuffer:!1}),this.ambientVolumeTexCPU=new Uint8Array(this.xDimAO*this.yDimAO*this.zDimAO),0===this.isWebGL2?this.texVolumeAO=new E.k(this.ambientVolumeTexCPU,this.xTex,this.yTex,E.b):(this.texVolumeAO=new E.l(this.ambientVolumeTexCPU,this.xDimAO,this.yDimAO,this.zDimAO),this.texVolumeAO.format=E.K),this.texVolumeAO.wrapS=E.g,this.texVolumeAO.wrapT=E.g,this.texVolumeAO.wrapR=E.g,this.texVolumeAO.magFilter=E.v,this.texVolumeAO.minFilter=E.v,this.texVolumeAO.needsUpdate=!0;var a=new E.U(1/this.xDim,1/this.yDim,1/this.zDim);(new ae).create(e,a,this.vectorsTex,this.numAOVectors,t,(function(e){i.materialAO=e,e.uniforms.tileCountX.value=i.zTexDivSqrt,e.uniforms.volumeSizeZ.value=i.zDim,i.setAmbientTextureWebGL2(),i.texVolumeAO.needsUpdate=!0}))}},{key:"setAmbientTextureWebGL2",value:function(){var e=new Uint8Array(4*this.xDimAO*this.yDimAO),t=this.rendererBlur.getContext();console.log("AO WebGL2");for(var i=0;i<this.zDimAO;++i){this.materialAO.uniforms.curZ.value=i/(this.zDimAO-1),this.materialAO.uniforms.curZ.needsUpdate=!0,this.sceneBlur.overrideMaterial=this.materialAO,this.rendererBlur.render(this.sceneBlur,this.cameraOrtho,this.bufferTextureAO),this.sceneBlur.overrideMaterial=null,t.readPixels(0,0,this.xDimAO,this.yDimAO,t.RGBA,t.UNSIGNED_BYTE,e);for(var a=i*this.xDimAO*this.yDimAO,r=0;r<this.yDimAO;r++)for(var s=0;s<this.xDimAO;s++)this.ambientVolumeTexCPU[s+r*this.xDimAO+a]=e[4*(s+r*this.xDimAO)]}console.log("AO WebGL2 End")}},{key:"get",value:function(){return this.texVolumeAO}}]),e}(),ce=function(){function e(){Object(u.a)(this,e),this.selectedROIs=null,this.transferFuncRgba=null,this.transferFuncTexture=null,this.texRoiColor=null,this.texRoiId=null,this.numRois=256,this.m_handleColors=[{r:0,g:0,b:0},{r:255,g:128,b:64},{r:255,g:0,b:0},{r:128,g:64,b:64},{r:128,g:0,b:0},{r:64,g:64,b:64},{r:128,g:128,b:128},{r:192,g:192,b:192},{r:255,g:255,b:255},{r:255,g:255,b:255}]}return Object(h.a)(e,[{key:"init",value:function(e,t){this.selectedROIs=new Uint8Array(4*this.numRois),this.numTfPixels=256,this.transferFuncRgba=new Uint8Array(4*this.numTfPixels),this.texRoiColor=null,e&&(this.texRoiId=this.createSelectedRoiMap(),this.texRoiColor=this.createRoiColorMap(t))}},{key:"createTransferFuncTexture",value:function(){for(var e=null,t=0,i=255,a=22.95,r=76.5,s=.43*i,o=135.15,n=0;n<this.numTfPixels;n++)n>a&&n<51&&(t=(n-a)/28.05),n>51&&n<r&&(t=(r-n)/25.5),n>s&&n<o&&(t=(n-s)/(o-s)),n>o&&(t=1),this.transferFuncRgba[4*n+0]=i,this.transferFuncRgba[4*n+1]=0,this.transferFuncRgba[4*n+1+1]=0,this.transferFuncRgba[4*n+1+1+1]=i*t/12,n>s&&(this.transferFuncRgba[4*n+0]=255,this.transferFuncRgba[4*n+1]=210,this.transferFuncRgba[4*n+1+1]=180,this.transferFuncRgba[4*n+1+1+1]=i*t/3);return(e=new E.k(this.transferFuncRgba,this.numTfPixels,1,E.J)).wrapS=E.g,e.wrapT=E.g,e.magFilter=E.B,e.minFilter=E.B,e.needsUpdate=!0,this.transferFuncTexture=e,e}},{key:"setTransferFuncColors",value:function(e){this.transferFuncCtrlPtsRgb=[];for(var t=0;t<e.length;t++)this.transferFuncCtrlPtsRgb.push(new E.U(e[t].r,e[t].g,e[t].b))}},{key:"updateTransferFuncTexture",value:function(e,t){if(null===this.transferFuncRgba)return null;for(var i=0;i<e.length-1;i++)for(var a=Math.floor(e[i]),r=Math.floor(e[i+1]),s=a;s<r;s++){var o=(s-a)/(r-a),n=(1-o)*this.m_handleColors[i].r+o*this.m_handleColors[i+1].r,l=(1-o)*this.m_handleColors[i].g+o*this.m_handleColors[i+1].g,m=(1-o)*this.m_handleColors[i].b+o*this.m_handleColors[i+1].b;this.transferFuncRgba[4*s+0]=n,this.transferFuncRgba[4*s+1]=l,this.transferFuncRgba[4*s+2]=m;var u=t[i]>0?t[i]:0,h=t[i+1]>0?t[i+1]:0;this.transferFuncRgba[4*s+3]=255*(h*o+(1-o)*u)}return this.transferFuncTexture.needsUpdate=!0,this.transferFuncRgba}},{key:"createRoiColorMap",value:function(e){var t=null;if(null!==e)t=new E.k(e,256,1,E.J);else{for(var i=new Uint8Array(4*this.numRois),a=0;a<this.numRois;a++)i[4*a+0]=255,i[4*a+1]=0,i[4*a+2]=0,i[4*a+3]=255;t=new E.k(i,this.numRois,1,E.J)}return t.wrapS=E.g,t.wrapT=E.g,t.magFilter=E.B,t.minFilter=E.B,t.needsUpdate=!0,t}},{key:"createSelectedRoiMap",value:function(){for(var e=0;e<this.numRois;e++)this.selectedROIs[4*e]=e<50||e>240?0:255,this.selectedROIs[4*e+1]=0,this.selectedROIs[4*e+2]=0,this.selectedROIs[4*e+3]=0;var t=new E.k(this.selectedROIs,256,1,E.J);return t.wrapS=E.g,t.wrapT=E.g,t.magFilter=E.B,t.minFilter=E.B,t.needsUpdate=!0,t}},{key:"updateSelectedRoiMap",value:function(e){for(var t=0;t<this.numRois;t++)e[t]?this.selectedROIs[4*t]=255:this.selectedROIs[4*t]=0;this.texRoiId.needsUpdate=!0}},{key:"updateSelectedRoi",value:function(e,t){this.selectedROIs[4*e]=t?255:0,console.log("initMatBlure: ".concat(this.initMatBlure)),this.texRoiId.needsUpdate=!0}}]),e}(),de=function(){function e(){Object(u.a)(this,e),this.bufferBF=null,this.bufferFF=null,this.bufferRenderToTexture=null,this.isoThreshold=0,this.volTextureMask=null,this.geometry=null,this.lastSize=[],this.lastDepth=[],this.lastRotationVector=[],this.lastTarget=[],this.lastMode=[],this.lastBackDistance=[],this.resetflag=!1,this.bufferTextureCPU=null}return Object(h.a)(e,[{key:"createUpdatableVolumeMask",value:function(e,t){this.xDim=e.xDim,this.yDim=e.yDim,this.zDim=e.zDim,this.bufferBF=e.bufBF,this.bufferFF=e.bufFF,this.bufferRenderToTexture=e.bufTex,this.bufferMask=new Uint8Array(this.xDim*this.yDim*this.zDim),this.bufferTextureCPU=t;for(var i=0;i<this.zDim;i++)for(var a=0;a<this.yDim;a++)for(var r=0;r<this.xDim;r++)this.bufferMask[r+a*this.xDim+i*this.xDim*this.yDim]=255;return this.updatableTextureMask&&this.updatableTextureMask.dispose(),this.updatableTextureMask=new E.l(this.bufferMask,this.xDim,this.yDim,this.zDim),this.updatableTextureMask.format=E.K,this.updatableTextureMask.type=E.S,this.updatableTextureMask.wrapS=E.g,this.updatableTextureMask.wrapT=E.g,this.updatableTextureMask.magFilter=E.v,this.updatableTextureMask.minFilter=E.v,this.updatableTextureMask.needsUpdate=!0,this.updatableTextureMask}},{key:"eraseStart",value:function(e,t,i,a,r){this.isoThreshold=a;var s=Math.round(e),o=Math.round(t);this.eraserMouseDown=!0;var n=4*(o*i+s),l=4*(Math.floor(o/3)*Math.floor(i/3)+Math.floor(s/3)),m=this.bufferRenderToTexture[l+3];if(2!==m){var u=this.bufferBF[n+0]-this.bufferFF[n+0],h=this.bufferBF[n+1]-this.bufferFF[n+1],c=this.bufferBF[n+2]-this.bufferFF[n+2],d=new E.U(u,h,c),_=Math.sqrt(u*u+h*h+c*c);u=u/_*m+.5+this.bufferFF[n+0],h=h/_*m+.5+this.bufferFF[n+1],c=c/_*m+.5+this.bufferFF[n+2],this.erasePixels(u,h,c,d,r,m),this.updatableTextureMask.needsUpdate=!0}}},{key:"onMouseUp",value:function(){this.orbitControl.onMouseUp(),this.lockEraserBuffersUpdating=!1,this.eraserMouseDown=!1,this.renderState=this.RENDER_STATE.ONCE}},{key:"setEraserRadius",value:function(e){this.radius=e}},{key:"setEraserDepth",value:function(e){this.depth=e}},{key:"erasePixels",value:function(e,t,i,a,r,s){for(var o=Math.floor(e*this.xDim),n=Math.floor(t*this.yDim),l=Math.floor(i*this.zDim),m=new E.U,u=new E.U,h=1.4*1.4,c=0,d=0,_=0,f=0,v=0,p=-Math.min(2,l);p<=Math.min(2,this.zDim-1-l);p++)for(var g=-Math.min(2,n);g<=Math.min(2,this.yDim-1-n);g++)for(var S=-Math.min(2,o);S<=Math.min(2,this.xDim-1-o);S++){var x=l+p;v=o+S+(n+g)*this.xDim+x*this.xDim*this.yDim;var b=1-Math.exp(-(S*S+g*g+p*p)/(2*h));f+=b;var y=this.bufferTextureCPU[v];c+=y*b*(-S/h),d+=y*b*(-g/h),_+=y*b*(-p/h)}u.set(c/f,d/f,_/f),m.copy(u),m.normalize();var T=this.xDim/this.zDim,D=new E.j(this.radius,this.radius,this.depth,180,this.depth),O=new E.z(D,null),R=new E.U(0,0,1);O.quaternion.setFromUnitVectors(R,m.clone().normalize().multiplyScalar(-1)),O.position.copy(new E.U(o,n,l)),!0===r&&(this.prevDistance=s,this.resetflag=!1);if(!1===this.resetflag)if(Math.abs(this.prevDistance-s)<.05){this.prevDistance=s,this.point=new E.U(0,0,0),this.queue=[],this.queue.push(this.point);-5;for(var w=!1;this.queue.length>0;){this.point=this.queue.pop();var j=this.point.clone();if(j.z*=T,j.applyAxisAngle(new E.U(1,0,0),-O.rotation.x),j.applyAxisAngle(new E.U(0,1,0),-O.rotation.y),j.applyAxisAngle(new E.U(0,0,1),O.rotation.z),!(Math.sqrt(j.x*j.x+j.y*j.y)>this.radius||Math.abs(j.z)>this.depth||j.z<-5))for(var M=this.point.x-1;M<=this.point.x+1;M++)for(var A=this.point.y-1;A<=this.point.y+1;A++)for(var I=this.point.z-1;I<=this.point.z+1;I++){var C=o+Math.round(M),X=n+Math.round(A),F=l+Math.round(I);if(v=C+X*this.xDim+F*this.xDim*this.yDim,0!==this.bufferMask[v]){var k=255*this.isoThreshold-.01*255;this.bufferTextureCPU[v]>=k&&(w=!0,this.bufferMask[v]=0,this.queue.push(new E.U(M,A,I)))}}}!0===w&&(this.lastSize.push(this.radius),this.lastDepth.push(this.depth),this.lastRotationVector.push(new E.U(-O.rotation.x,-O.rotation.y,O.rotation.z)),this.lastTarget.push(new E.U(o,n,l)),this.lastBackDistance.push(-Math.round(Math.abs(Math.tan(a.normalize().angleTo(u.normalize())))*this.radius))),this.updatableTextureMask.needsUpdate=!0}else this.resetflag=!1}},{key:"undoLastErasing",value:function(){if(0!==this.lastSize.length){var e=this.lastTarget.pop(),t=this.lastRotationVector.pop(),i=Math.round(this.lastSize.pop()),a=this.lastDepth.pop(),r=this.lastBackDistance.pop(),s=this.xDim/this.zDim;for(this.point=new E.U(0,0,0),this.queue=[],this.queue.push(this.point);this.queue.length>0;){this.point=this.queue.pop();var o=this.point.clone();if(o.z*=s,o.applyAxisAngle(new E.U(1,0,0),t.x),o.applyAxisAngle(new E.U(0,1,0),t.y),o.applyAxisAngle(new E.U(0,0,1),t.z),!(Math.sqrt(o.x*o.x+o.y*o.y)>i||o.z>a||o.z<r))for(var n=0,l=this.point.x-1;l<=this.point.x+1;l++)for(var m=this.point.y-1;m<=this.point.y+1;m++)for(var u=this.point.z-1;u<=this.point.z+1;u++){var h=e.x+Math.round(l),c=e.y+Math.round(m),d=e.z+Math.round(u);n=h+c*this.xDim+d*this.xDim*this.xDim,0===this.bufferMask[n]&&(this.bufferMask[n]=255,this.queue.push(new E.U(l,m,u)))}}this.updatableTextureMask.needsUpdate=!0}}}]),e}(),_e=function(){function e(){Object(u.a)(this,e),this.transferFunc=null,this.xDim=0,this.yDim=0,this.zDim=0,this.bufferTextureCPU=null,this.eraser=null}return Object(h.a)(e,[{key:"initRenderer",value:function(e,t){var i=this;this.sceneBlur=new E.L;this.numRois=256,this.cameraOrtho=new E.F(this.xDim/-2,this.xDim/2,this.yDim/2,this.yDim/-2,.1,100);var a=new j;this.context=a.createWebGLContext(),this.canvas3d=a.getCanvas(),this.rendererBlur=new E.X({canvas:this.canvas3d,context:this.context}),this.ambientTexture=new he({xDim:this.xDim,yDim:this.yDim,zDim:this.zDim,renderer:this.rendererBlur,scene:this.sceneBlur,camera:this.cameraOrtho}),console.log("rendererBlur done");var r=new E.I(1,1);this.rendererBlur.setSize(this.xDim,this.yDim),this.transferFunc=new ce,this.transferFunc.init(e,t);var s=new E.U(1/this.xDim,1/this.yDim,1/this.zDim);(new ee).create(this.origVolumeTex,this.RoiVolumeTex,s,this.transferFunc.texRoiColor,this.transferFunc.texRoiId,(function(t){var a=new E.z(r,t);t.uniforms.volumeSizeZ.value=i.zDim,t.uniforms.xDim.value=i.xDim,t.uniforms.yDim.value=i.yDim,t.defines.useWebGL2=i.isWebGL2,i.material=t,i.sceneBlur.add(a),!1===e?i.switchToBlurRender():i.switchToRoiMapRender(),console.log("isRoiVolume: ".concat(e)),i.setVolumeTexture(.8)})),this.vectorsTex=null}},{key:"createTransferFuncTexture",value:function(){return null!==this.transferFunc?this.transferFunc.createTransferFuncTexture():null}},{key:"setTransferFuncColors",value:function(e){this.transferFunc.setTransferFuncColors(e)}},{key:"updateTransferFuncTexture",value:function(e,t){return this.transferFunc.updateTransferFuncTexture(e,t)}},{key:"switchToRoiMapRender",value:function(){this.material.defines.renderRoiMap=1,this.material.needsUpdate=!0}},{key:"switchToBlurRender",value:function(){this.material.defines.renderRoiMap=0,this.material.needsUpdate=!0}},{key:"setVolumeTexture",value:function(e){this.material&&"undefined"!==typeof this.material?(console.log("blur material NOT null"),this.setVolumeTextureWebGL2(e),this.updatableTexture.needsUpdate=!0):console.log("blur material null")}},{key:"updateVolumeTextureWithMask",value:function(){null===this.eraser.bufferMask&&console.log("volTextureMask null");for(var e=0;e<this.zDim;e++)for(var t=e*this.xDim*this.yDim,i=0;i<this.yDim;i++)for(var a=i*this.xDim,r=0;r<this.xDim;r++){var s=r+a+t,o=this.arrPixels[s],n=s;this.zDim>5&&(0===e||e===this.zDim-1||0===this.eraser.bufferMask[s])&&(o=0),this.bufferR[n]=o}this.origVolumeTex.needsUpdate=!0,this.setVolumeTexture(1)}},{key:"setVolumeTextureWebGL2",value:function(e){this.material.uniforms.blurSigma.value=e,this.material.uniforms.blurSigma.needsUpdate=!0;for(var t=new Uint8Array(4*this.xDim*this.yDim),i=this.rendererBlur.getContext(),a=1;a<this.zDim-1;++a){this.material.uniforms.curZ.value=a/this.zDim,this.material.uniforms.curZ.needsUpdate=!0,this.rendererBlur.render(this.sceneBlur,this.cameraOrtho,this.bufferTexture),i.readPixels(0,0,this.xDim,this.yDim,i.RGBA,i.UNSIGNED_BYTE,t);var r=a*this.xDim*this.yDim;if(this.isRoiVolume)for(var s=0;s<this.yDim;s++)for(var o=0;o<this.xDim;o++){var n=4*(o+s*this.xDim),l=n+4*r;this.bufferTextureCPU[l]=t[n],this.bufferTextureCPU[l+1]=t[n+1],this.bufferTextureCPU[l+2]=t[n+2],this.bufferTextureCPU[l+3]=t[n+3]}else for(var m=0;m<this.yDim;m++)for(var u=0;u<this.xDim;u++)this.bufferTextureCPU[u+m*this.xDim+r]=t[4*(u+m*this.xDim)]}}},{key:"set3DTextureFrom1Byte",value:function(){this.bufferTextureCPU=new Uint8Array(this.xDim*this.yDim*this.zDim),this.bufferR=new Uint8Array(this.xDim*this.yDim*this.zDim);for(var e=0;e<this.zDim;e++)for(var t=e*this.xDim*this.yDim,i=0;i<this.yDim;i++)for(var a=i*this.xDim,r=0;r<this.xDim;r++){var s=r+a+t,o=this.arrPixels[s+0],n=s;this.zDim>5&&(0===e||e===this.zDim-1)&&(o=0),this.bufferR[n+0]=o,this.bufferTextureCPU[n+0]=o}console.log("setBufferRgbaFrom1Bytes for 3d texture")}},{key:"set3DTextureFrom4Bytes",value:function(){this.isRoiVolume&&(this.bufferRoi=new Uint8Array(this.xDim*this.yDim*this.zDim),this.bufferTextureCPU=new Uint8Array(4*this.xDim*this.yDim*this.zDim),console.log("ROI")),this.bufferR=new Uint8Array(this.xDim*this.yDim*this.zDim);for(var e=0;e<this.zDim;e++)for(var t=e*this.xDim*this.yDim,i=0;i<this.yDim;i++)for(var a=i*this.xDim,r=0;r<this.xDim;r++){var s=r,o=4*(s+a+t),n=this.arrPixels[o+0],l=this.arrPixels[o+3],m=s+a+t;r<2||r>this.xDim-4||i<2||i>this.yDim-4||e<2||e>this.zDim-4?this.bufferR[m+0]=0:this.bufferR[m+0]=n,this.bufferTextureCPU[4*m+0]=n,this.bufferTextureCPU[4*m+1]=n,this.bufferTextureCPU[4*m+2]=n,this.bufferTextureCPU[4*m+3]=n,this.bufferRoi[m+0]=l}console.log("setBufferRgbaFrom4Bytes for 3D texture")}},{key:"createRoiColorMap",value:function(e){return this.transferFunc.createRoiColorMap(e)}},{key:"createSelectedRoiMap",value:function(){return this.createSelectedRoiMap()}},{key:"updateSelectedRoiMap",value:function(e){this.transferFunc.updateSelectedRoiMap(e),this.setVolumeTexture(1)}},{key:"updateSelectedRoi",value:function(e,t){this.transferFunc.updateSelectedRoi(e,t),this.setVolumeTexture(1)}},{key:"createUpdatableVolumeTex",value:function(e,t,i){this.isWebGL2=1,this.arrPixels=e.m_dataArray;var a=e.m_xDim,r=e.m_yDim,s=e.m_zDim;this.xDim=a,this.yDim=r,this.zDim=s,this.isRoiVolume=t,this.RoiVolumeTex=null,t?(this.set3DTextureFrom4Bytes(),this.RoiVolumeTex=new E.l(this.bufferRoi,this.xDim,this.yDim,this.zDim),this.RoiVolumeTex.format=E.K,this.RoiVolumeTex.type=E.S,this.RoiVolumeTex.wrapS=E.g,this.RoiVolumeTex.wrapT=E.g,this.RoiVolumeTex.magFilter=E.B,this.RoiVolumeTex.minFilter=E.B,this.RoiVolumeTex.needsUpdate=!0):this.set3DTextureFrom1Byte(),this.bufferTexture=new E.W(this.xDim,this.yDim,{minFilter:E.v,magFilter:E.v,format:E.J,type:E.S,depthBuffer:!1}),this.origVolumeTex&&this.origVolumeTex.dispose(),this.origVolumeTex=new E.l(this.bufferR,this.xDim,this.yDim,this.zDim),this.origVolumeTex.format=E.K,this.origVolumeTex.type=E.S,this.origVolumeTex.wrapR=E.g,this.origVolumeTex.wrapS=E.g,this.origVolumeTex.wrapT=E.g,this.origVolumeTex.magFilter=E.B,this.origVolumeTex.minFilter=E.B,this.origVolumeTex.needsUpdate=!0;var o=E.K;return t&&(o=E.J),this.updatableTexture=new E.l(this.bufferTextureCPU,this.xDim,this.yDim,this.zDim),this.updatableTexture.format=o,this.updatableTexture.type=E.S,this.updatableTexture.wrapR=E.g,this.updatableTexture.wrapS=E.g,this.updatableTexture.wrapT=E.g,this.updatableTexture.magFilter=E.v,this.updatableTexture.minFilter=E.v,this.zDim>1&&this.initRenderer(t,i),this.updatableTexture.needsUpdate=!0,this.eraser=new de,this.updatableTexture}},{key:"createUpdatableVolumeMask",value:function(e){return this.eraser.createUpdatableVolumeMask(e,this.bufferTextureCPU)}}]),e}(),fe=function(){function e(){Object(u.a)(this,e),this.m_palette=[{name:"amygdala",roiColor:"0.247059 0.584314 0.270588 1",roiId:139,position:"right",isBrain:!0},{name:"amygdala",roiColor:"0.309804 0.929412 0.054902 1",roiId:118,position:"left",isBrain:!0},{name:"angular gyrus",roiColor:"0.686275 0.231373 0.152941 1",roiId:19,position:"right",isBrain:!0},{name:"angular gyrus",roiColor:"0.811765 0.486275 0.117647 1",roiId:159,position:"left",isBrain:!0},{name:"anterior limb of internal capsule",roiColor:"0.309804 0.203922 0.462745 1",roiId:128,position:"right",isBrain:!0},{name:"anterior limb of internal capsule",roiColor:"0.435294 0.733333 0.027451 1",roiId:43,position:"left",isBrain:!0},{roiColor:"0.937255 0.94902 0.513725 1",roiId:20,name:"brain stem",isBrain:!0},{name:"caudate nucleus",roiColor:"0.74902 0.278431 0.141176 1",roiId:53,position:"right",isBrain:!0},{name:"caudate nucleus",roiColor:"0.184314 0.0745098 0.356863 1",roiId:39,position:"left",isBrain:!0},{name:"cerebellum",roiColor:"0.811765 0.458824 0.952941 1",roiId:76,position:"right",isBrain:!0},{name:"cerebellum",roiColor:"0.247059 0.113725 0.843137 1",roiId:67,position:"left",isBrain:!0},{name:"cingulate region",roiColor:"0.623529 0.45098 0.666667 1",roiId:7,position:"right",isBrain:!0},{name:"cingulate region",roiColor:"0.937255 0.631373 0.505882 1",roiId:27,position:"left",isBrain:!0},{roiColor:"0.937255 0.301961 0.470588 1",roiId:133,name:"corpus callosum",isBrain:!0},{name:"cuneus",roiColor:"0.435294 0.513725 0.768627 1",roiId:175,position:"right",isBrain:!0},{name:"cuneus",roiColor:"0.937255 0.729412 0.192157 1",roiId:54,position:"left",isBrain:!0},{name:"fornix",roiColor:"0.937255 0.415686 0.847059 1",roiId:254,position:"right",isBrain:!0},{name:"fornix",roiColor:"0.811765 0.67451 0.980392 1",roiId:29,position:"left",isBrain:!0},{roiColor:"0.247059 0.466667 0.105882 1",roiId:233,name:"fourth ventricle",isBrain:!0},{name:"frontal lobe WM",roiColor:"0.560784 0.290196 0.215686 1",roiId:17,position:"right",isBrain:!0},{name:"frontal lobe WM",roiColor:"0.498039 0.662745 0.101961 1",roiId:30,position:"left",isBrain:!0},{name:"globus palladus",roiColor:"0.0588235 0.843137 0.168627 1",roiId:11,position:"right",isBrain:!0},{name:"globus palladus",roiColor:"0.247059 0.74902 0.447059 1",roiId:12,position:"left",isBrain:!0},{name:"hippocampal formation",roiColor:"0.498039 0.709804 0.619608 1",roiId:36,position:"right",isBrain:!0},{name:"hippocampal formation",roiColor:"0.121569 0.4 0.972549 1",roiId:101,position:"left",isBrain:!0},{name:"inferior frontal gyrus",roiColor:"0.247059 0.85098 0.0666667 1",roiId:75,position:"right",isBrain:!0},{name:"inferior frontal gyrus",roiColor:"0.937255 0.662745 0.329412 1",roiId:15,position:"left",isBrain:!0},{name:"inferior occipital gyrus",roiColor:"0.0588235 0.643137 0.643137 1",roiId:97,position:"right",isBrain:!0},{name:"inferior occipital gyrus",roiColor:"0.247059 0.411765 0.568627 1",roiId:37,position:"left",isBrain:!0},{name:"inferior temporal gyrus",roiColor:"0.247059 0.00392157 0.796078 1",roiId:140,position:"right",isBrain:!0},{name:"inferior temporal gyrus",roiColor:"0.87451 0.819608 0.541176 1",roiId:164,position:"left",isBrain:!0},{name:"insula",roiColor:"0.623529 0.886275 0.356863 1",roiId:4,position:"right",isBrain:!0},{name:"insula",roiColor:"0.560784 0.698039 0.12549 1",roiId:108,position:"left",isBrain:!0},{name:"lateral front-orbital gyrus",roiColor:"0.435294 0.501961 0.203922 1",roiId:6,position:"right",isBrain:!0},{name:"lateral front-orbital gyrus",roiColor:"1 0.8 0.00784314 1",roiId:90,position:"left",isBrain:!0},{name:"lateral occipitotemporal gyrus",roiColor:"0.0588235 0.027451 0.470588 1",roiId:99,position:"right",isBrain:!0},{name:"lateral occipitotemporal gyrus",roiColor:"0.937255 0.101961 0.913725 1",roiId:196,position:"left",isBrain:!0},{name:"lateral ventricle",roiColor:"0.435294 0.176471 0.568627 1",roiId:8,position:"right",isBrain:!0},{name:"lateral ventricle",roiColor:"0.74902 0.764706 0.247059 1",roiId:3,position:"left",isBrain:!0},{name:"lingual gyrus",roiColor:"0.435294 0.458824 0.47451 1",roiId:112,position:"right",isBrain:!0},{name:"lingual gyrus",roiColor:"0.811765 0.0941176 0.301961 1",roiId:69,position:"left",isBrain:!0},{name:"medial front-orbital gyrus",roiColor:"0.87451 0.364706 0.384314 1",roiId:1,position:"right",isBrain:!0},{name:"medial front-orbital gyrus",roiColor:"0.811765 0.160784 0.247059 1",roiId:85,position:"left",isBrain:!0},{name:"medial frontal gyrus",roiColor:"0.435294 0.615686 0.0705882 1",roiId:114,position:"right",isBrain:!0},{name:"medial frontal gyrus",roiColor:"0.184314 0.372549 0.423529 1",roiId:9,position:"left",isBrain:!0},{name:"medial occipitotemporal gyrus",roiColor:"0.247059 0.368627 0.211765 1",roiId:165,position:"right",isBrain:!0},{name:"medial occipitotemporal gyrus",roiColor:"1 0.843137 0.254902 1",roiId:119,position:"left",isBrain:!0},{name:"middle frontal gyrus",roiColor:"0.623529 0.905882 0.113725 1",roiId:2,position:"right",isBrain:!0},{name:"middle frontal gyrus",roiColor:"0.686275 0.0901961 0.811765 1",roiId:50,position:"left",isBrain:!0},{name:"middle occipital gyrus",roiColor:"0.686275 0.933333 0.698039 1",roiId:63,position:"right",isBrain:!0},{name:"middle occipital gyrus",roiColor:"0.435294 0.0588235 0.964706 1",roiId:154,position:"left",isBrain:!0},{name:"middle temporal gyrus",roiColor:"0.937255 0.498039 0.67451 1",roiId:130,position:"right",isBrain:!0},{name:"middle temporal gyrus",roiColor:"0.498039 0.768627 0.439216 1",roiId:64,position:"left",isBrain:!0},{name:"nucleus accumbens",roiColor:"1 0.807843 0.529412 1",roiId:25,position:"right",isBrain:!0},{name:"nucleus accumbens",roiColor:"0.0588235 0.65098 0.0509804 1",roiId:72,position:"left",isBrain:!0},{name:"occipital lobe WM",roiColor:"0.0588235 0.368627 0.552941 1",roiId:45,position:"right",isBrain:!0},{name:"occipital lobe WM",roiColor:"0.0588235 0.639216 0.839216 1",roiId:73,position:"left",isBrain:!0},{name:"occipital pole",roiColor:"0.74902 0.494118 0.419608 1",roiId:132,position:"right",isBrain:!0},{name:"occipital pole",roiColor:"0.247059 0.807843 0.74902 1",roiId:251,position:"left",isBrain:!0},{name:"parahippocampal gyrus",roiColor:"0.121569 0.847059 0.00392157 1",roiId:125,position:"right",isBrain:!0},{name:"parahippocampal gyrus",roiColor:"0.247059 0.0705882 0.321569 1",roiId:18,position:"left",isBrain:!0},{name:"parietal lobe WM",roiColor:"1 0.4 0.223529 1",roiId:105,position:"right",isBrain:!0},{name:"parietal lobe WM",roiColor:"0.309804 0.678431 0.639216 1",roiId:57,position:"left",isBrain:!0},{name:"postcentral gyrus",roiColor:"0.560784 0.478431 0.2 1",roiId:110,position:"right",isBrain:!0},{name:"postcentral gyrus",roiColor:"0.498039 0.576471 0.027451 1",roiId:74,position:"left",isBrain:!0},{name:"posterior limb of internal capsule inc. cerebral peduncle",roiColor:"1 0.917647 0.576471 1",roiId:35,position:"right",isBrain:!0},{name:"posterior limb of internal capsule inc. cerebral peduncle",roiColor:"0.435294 0.490196 0.0784314 1",roiId:34,position:"left",isBrain:!0},{name:"precentral gyrus",roiColor:"0.184314 0.709804 0.615686 1",roiId:5,position:"right",isBrain:!0},{name:"precentral gyrus",roiColor:"0.87451 0.560784 1 1",roiId:80,position:"left",isBrain:!0},{name:"precuneus",roiColor:"1 0.654902 0.223529 1",roiId:32,position:"right",isBrain:!0},{name:"precuneus",roiColor:"1 0 0.211765 1",roiId:56,position:"left",isBrain:!0},{name:"putamen",roiColor:"1 0.831373 0.227451 1",roiId:16,position:"right",isBrain:!0},{name:"putamen",roiColor:"0.372549 0.678431 0.32549 1",roiId:14,position:"left",isBrain:!0},{name:"subthalamic nucleus",roiColor:"0.184314 0.545098 0.619608 1",roiId:23,position:"right",isBrain:!0},{name:"subthalamic nucleus",roiColor:"0.309804 0.686275 0.243137 1",roiId:33,position:"left",isBrain:!0},{name:"superior frontal gyrus",roiColor:"0.87451 0.380392 0.768627 1",roiId:10,position:"right",isBrain:!0},{name:"superior frontal gyrus",roiColor:"1 0.113725 0.396078 1",roiId:70,position:"left",isBrain:!0},{name:"superior occipital gyrus",roiColor:"0.372549 0.0431373 0.537255 1",roiId:38,position:"right",isBrain:!0},{name:"superior occipital gyrus",roiColor:"0.623529 0.301961 0.2 1",roiId:98,position:"left",isBrain:!0},{name:"superior parietal lobule",roiColor:"0.247059 0.843137 0.407843 1",roiId:88,position:"right",isBrain:!0},{name:"superior parietal lobule",roiColor:"0.87451 0.533333 0.254902 1",roiId:52,position:"left",isBrain:!0},{name:"superior temporal gyrus",roiColor:"0.498039 0.721569 0.996078 1",roiId:145,position:"right",isBrain:!0},{name:"superior temporal gyrus",roiColor:"1 0.67451 0.45098 1",roiId:61,position:"left",isBrain:!0},{name:"supramarginal gyrus",roiColor:"0.87451 0.45098 0.270588 1",roiId:60,position:"right",isBrain:!0},{name:"supramarginal gyrus",roiColor:"0.623529 0.0235294 0.654902 1",roiId:41,position:"left",isBrain:!0},{name:"temporal lobe WM",roiColor:"0.498039 0.603922 0.768627 1",roiId:59,position:"right",isBrain:!0},{name:"temporal lobe WM",roiColor:"0.87451 0.411765 0.368627 1",roiId:83,position:"left",isBrain:!0},{name:"thalamus",roiColor:"0.0588235 0.796078 0.866667 1",roiId:203,position:"right",isBrain:!0},{name:"thalamus",roiColor:"0.74902 0.984314 0.341176 1",roiId:102,position:"left",isBrain:!0},{roiColor:"0.811765 0.258824 0.823529 1",roiId:232,name:"third ventricle",isBrain:!0},{name:"uncus",roiColor:"0.121569 0.352941 0.196078 1",roiId:26,position:"right",isBrain:!0},{name:"uncus",roiColor:"0.623529 0.117647 0.14902 1",roiId:62,position:"left",isBrain:!0},{name:"xxx_brain_internal",roiColor:"0.8 0.8 0.1 1",roiId:150,position:"left",isBrain:!0},{name:"xxx_brain_core",roiColor:"0.2 0.8 0.2 1",roiId:250,position:"left",isBrain:!0}],this.createBytePalette256()}return Object(h.a)(e,[{key:"createBytePalette256",value:function(){var e;for(this.m_palette256=new Uint8Array(1024),e=0;e<1024;e++)this.m_palette256[e]=0;var t=this.m_palette.length;for(e=0;e<t;e++){var i=this.m_palette[e].roiId,a=this.m_palette[e].roiColor.split(" "),r=Math.floor(255*parseFloat(a[0])),s=Math.floor(255*parseFloat(a[1])),o=Math.floor(255*parseFloat(a[2])),n=4*parseInt(i,10);this.m_palette256[n+0]=r,this.m_palette256[n+1]=s,this.m_palette256[n+2]=o,this.m_palette256[n+3]=255}}},{key:"getPalette",value:function(){return this.m_palette}},{key:"getPalette256",value:function(){return this.m_palette256}}]),e}(),ve="72px Arial",pe=function(){function e(){Object(u.a)(this,e),this.m_textWidth=0,this.m_textHeight=0,this.m_canvas=document.createElement("canvas"),this.m_ctx=this.m_canvas.getContext("2d")}return Object(h.a)(e,[{key:"drawText",value:function(t,i){this.m_canvas.width=1024,this.m_canvas.height=512,this.m_ctx.fillStyle="rgba(255, 255, 255, 0)";this.m_ctx.fillRect(0,0,512,128),this.m_ctx.font=ve,this.m_ctx.fillStyle=i,this.m_ctx.strokeStyle=i,this.m_ctx.textAlign="left",this.m_ctx.textBaseline="top",this.m_ctx.lineWidth=2;var a=0===t.length?"?":t;this.m_textWidth=Math.floor(this.m_ctx.measureText(a).width),this.m_textHeight=e.getFontHeight(ve),this.m_canvas.width=e.ceilPowerOfTwo(this.m_textWidth),this.m_canvas.height=e.ceilPowerOfTwo(this.m_textHeight),this.m_ctx.fillStyle="rgba(255, 255, 255, 0)",this.m_ctx.fillRect(0,0,this.m_canvas.width,this.m_canvas.height),this.m_ctx.font=ve,this.m_ctx.fillStyle=i,this.m_ctx.strokeStyle=i,this.m_ctx.textAlign="left",this.m_ctx.textBaseline="top",this.m_ctx.fillText(a,0,0)}},{key:"width",get:function(){return this.m_canvas.width}},{key:"height",get:function(){return this.m_canvas.height}},{key:"textWidth",get:function(){return this.m_textWidth}},{key:"textHeight",get:function(){return this.m_textHeight}}],[{key:"getFontHeight",value:function(e){var t=document.getElementsByTagName("body")[0],i=document.createElement("div"),a=document.createTextNode("GyW~ig^");i.appendChild(a),i.setAttribute("style","font:".concat(e,";position:absolute;top:0;left:0")),t.appendChild(i);var r=i.offsetHeight;return t.removeChild(i),r}},{key:"ceilPowerOfTwo",value:function(e){for(var t=1;t<30;t++){var i=1<<t;if(i>=e)return i}return-1}}]),e}(),ge=function(e){Object(S.a)(i,e);var t=Object(x.a)(i);function i(e){var a;return Object(u.a)(this,i),(a=t.call(this)).m_canvas=new pe,a.m_align=new E.T(0,0),a.m_side=E.n,a.m_antialias=!0,a.m_text=e,a}return Object(h.a)(i,[{key:"getText",value:function(){return this.m_text}},{key:"setText",value:function(e){this.m_text!==e&&(this.m_text=e,this.updateText())}},{key:"getFont",value:function(){return this.m_font}},{key:"updateText",value:function(){console.log("Use virtual method for ".concat(this.m_text))}},{key:"cleanUp",value:function(){this.texture&&this.texture.dispose()}},{key:"applyAntiAlias",value:function(){!1===this.antialias&&(this.texture.magFilter=E.B,this.texture.minFilter=E.w)}}]),i}(E.D),Se=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment="",this.m_uniforms={texture1:{type:"t",value:null}},this.m_strShaderVertex="\n      varying vec3 vecNormal;\n      varying vec3 vecPos;\n      varying vec2 vecUV;\n      void main() {\n        vecPos = position;\n        vecNormal = normal;\n        vecUV = uv;\n        gl_Position = vec4(position, 1.0);\n      }\n    ",this.m_strShaderFragment="\n      varying vec3 vecNormal;\n      varying vec3 vecPos;\n      varying vec2 vecUV;\n\n      uniform sampler2D texture1;\n\n      void main() {\n        vec2 texCoord = vecUV;\n        vec4 vColTex = texture2D(texture1, texCoord, 0.0);\n        float sum = (vColTex.x + vColTex.y + vColTex.z) / 3.0;\n        if (sum < 20.0 / 256.0)\n          discard;\n        gl_FragColor = vec4(vColTex.x, vColTex.y, vColTex.z, sum);\n      }\n    "}return Object(h.a)(e,[{key:"create",value:function(e){this.m_uniforms.texture1.value=e,this.m_material=new E.M({blending:E.i,blendEquation:E.a,blendSrc:E.P,blendDst:E.E,uniforms:this.m_uniforms,vertexShader:this.m_strShaderVertex,fragmentShader:this.m_strShaderFragment}),this.m_material.needsUpdate=!0}}]),e}(),xe=function(e){Object(S.a)(i,e);var t=Object(x.a)(i);function i(e){var a;return Object(u.a)(this,i),(a=t.call(this,e)).m_mesh=null,a.m_material=null,a.m_renderedTextHeight=0,a.m_xMin=3,a.m_xMax=-3,a.m_yMin=3,a.m_yMax=-3,a}return Object(h.a)(i,[{key:"getRenderedTextHeight",value:function(){return this.m_renderedTextHeight}},{key:"updateText",value:function(e,t,a,r,s,o,n){var l=this;this.cleanUp(),null!==this.m_mesh&&(this.remove(this.m_mesh),this.m_mesh=null,this.m_material=null),this.m_canvas.drawText(this.m_text,n),this.m_renderedTextHeight=a;var m=a,u=m*(this.m_canvas.m_textWidth/this.m_canvas.m_textHeight);if(this.m_texture=new E.Q(this.m_canvas.m_canvas),this.m_texture.needsUpdate=!0,null===this.m_material){this.m_matTexturePlain=new Se,this.m_matTexturePlain.create(this.m_texture),this.m_material=this.m_matTexturePlain.m_material,this.m_material.blending=E.i,this.m_material.blendEquation=E.a,this.m_material.blendSrc=E.P,this.m_material.blendDst=E.E,this.m_geometry=new E.s;var h=this.m_canvas.m_textWidth/this.m_canvas.m_canvas.width,c=this.m_canvas.m_textHeight/this.m_canvas.m_canvas.height;this.m_xMin=i.getXMin(e,r,u),this.m_xMax=i.getXMax(e,r,u),this.m_yMin=i.getYMin(t,s,m),this.m_yMax=i.getYMax(t,s,m);var d=.05,_=new E.U(this.m_xMin,this.m_yMin,d),f=new E.U(this.m_xMax,this.m_yMin,d),v=new E.U(this.m_xMin,this.m_yMax,d),p=new E.U(this.m_xMax,this.m_yMax,d);this.m_geometry.vertices.push(_),this.m_geometry.vertices.push(f),this.m_geometry.vertices.push(v),this.m_geometry.vertices.push(p),this.m_geometry.faceVertexUvs[0].push([new E.T(0,1-c),new E.T(h,1-c),new E.T(0,1)]),this.m_geometry.faceVertexUvs[0].push([new E.T(h,1),new E.T(0,1),new E.T(h,1-c)]);var g=new E.U;E.R.getNormal(_,f,v,g),this.m_geometry.faces.push(new E.o(0,1,2,g)),this.m_geometry.faces.push(new E.o(3,2,1,g)),this.m_mesh=new E.z(this.m_geometry,this.m_material),this.add(this.m_mesh);var S=document.createElement("canvas"),x=S.getContext("2d");S.width=32,S.height=32,x.fillStyle=o,x.fillRect(0,0,S.width,S.height);var b=new E.Q(S);b.needsUpdate=!0,this.m_matTextureBox=new Se,this.m_matTextureBox.create(b,(function(e){l.m_boxMaterial=e;var t=.06;l.m_boxGeometry=new E.s;var i,a=new E.U(l.m_xMin,l.m_yMin,t),r=new E.U(l.m_xMax,l.m_yMin,t),s=new E.U(l.m_xMin,l.m_yMax,t),o=new E.U(l.m_xMax,l.m_yMax,t);l.m_boxGeometry.vertices.push(a),l.m_boxGeometry.vertices.push(r),l.m_boxGeometry.vertices.push(s),l.m_boxGeometry.vertices.push(o),E.R.getNormal(a,r,s,i),l.m_boxGeometry.faces.push(new E.o(0,1,2,i)),l.m_boxGeometry.faces.push(new E.o(3,2,1,i)),l.m_boxMesh=new E.z(l.m_boxGeometry,l.m_boxMaterial),l.add(l.m_boxMesh)}))}else this.m_material.map=this.m_texture}}],[{key:"getXMin",value:function(e,t,a){return t===i.ALIGN_LEFT?e:t===i.ALIGN_RIGHT?e-a:t===i.ALIGN_CENTER?e-.5*a:0}},{key:"getXMax",value:function(e,t,a){return t===i.ALIGN_LEFT?e+a:t===i.ALIGN_RIGHT?e:t===i.ALIGN_CENTER?e+.5*a:0}},{key:"getYMin",value:function(e,t,a){return t===i.ALIGN_TOP?e-a:t===i.ALIGN_BOTTOM?e:t===i.ALIGN_CENTER?e-.5*a:0}},{key:"getYMax",value:function(e,t,a){return t===i.ALIGN_TOP?e:t===i.ALIGN_BOTTOM?e+a:t===i.ALIGN_CENTER?e+.5*a:0}}]),i}(ge);xe.ALIGN_LEFT=0,xe.ALIGN_RIGHT=1,xe.ALIGN_TOP=2,xe.ALIGN_BOTTOM=3,xe.ALIGN_CENTER=4;var be=function(){function e(){Object(u.a)(this,e),this.m_strShaderVertex="",this.m_strShaderFragment=""}return Object(h.a)(e,[{key:"create",value:function(){return this.m_strShaderVertex="\n      void main() {\n        gl_Position = vec4(position, 1.0);\n      }\n    ",this.m_strShaderFragment="\n      void main() {\n        gl_FragColor = vec4(1.0, 1.0, 0.0, 1.0);\n      }\n    ",new E.M({vertexShader:this.m_strShaderVertex,fragmentShader:this.m_strShaderFragment,wireframe:!0})}}]),e}(),ye=.11,Te=function(){function e(t,i,a,r,s,o,n){Object(u.a)(this,e),this.createWithMaterial(t,i,a,r,s,o,n),this.m_xS=a,this.m_yS=r,this.m_xE=s,this.m_yE=o}return Object(h.a)(e,[{key:"createWithMaterial",value:function(e,t,i,a,r,s,o){this.m_scene=e,this.m_lineWidth=t;var n=new E.T(r-i,s-a),l=new E.T(+n.y,-n.x);l.normalize(),l.multiplyScalar(t);var m=new E.U(i-l.x,a-l.y,ye),u=new E.U(i+l.x,a+l.y,ye),h=new E.U(r-l.x,s-l.y,ye),c=new E.U(r+l.x,s+l.y,ye);this.m_geo=new E.s,this.m_geo.vertices.push(m),this.m_geo.vertices.push(u),this.m_geo.vertices.push(h),this.m_geo.vertices.push(c);var d=new E.U(0,0,1);this.m_geo.faces.push(new E.o(0,1,3,d)),this.m_geo.faces.push(new E.o(3,2,0,d)),this.m_mesh=new E.z(this.m_geo,o),this.m_scene.add(this.m_mesh),console.log("Line added to scene: ".concat(i,",").concat(a," -> ").concat(r,",").concat(s," "))}},{key:"getRenderObject",value:function(){return this.m_mesh}},{key:"getxS",value:function(){return this.m_xS}},{key:"getyS",value:function(){return this.m_yS}},{key:"getxE",value:function(){return this.m_xE}},{key:"getyE",value:function(){return this.m_yE}}]),e}(),De=function(){function e(t,i){Object(u.a)(this,e),this.m_scene=t,this.m_lineWidth=i,this.m_runningState=!1,this.m_xPixelSize=-1,this.m_yPixelSize=-1;var a=new be;this.m_linesMaterial=a.create(),this.m_distances=[],this.m_vertexes=[],this.m_xStart=-1,this.m_yStart=-1,this.m_textWidthScr=.03,this.m_textColor="rgba(255, 255, 255, 255)",this.m_textBgColor="rgb(65, 65, 65)",this.m_zoom=1}return Object(h.a)(e,[{key:"clearLines",value:function(){for(var e=this.m_distances.length,t=0;t<e;++t){var i=this.m_distances.pop();this.m_scene.remove(i.line.getRenderObject()),this.m_scene.remove(i.text)}this.m_runningState=!1,this.m_vertexes=[]}},{key:"updateLines",value:function(e,t,i){for(var a=this.m_distances.length,r=0;r<a;++r){this.m_scene.remove(this.m_distances[r].line.getRenderObject()),this.m_scene.remove(this.m_distances[r].text);var s=(this.m_vertexes[2*r].xZ-t)/e-(1-1/e),o=(this.m_vertexes[2*r].yZ-i)/e+(1-1/e);if(null==this.m_vertexes[2*r+1])break;var n=(this.m_vertexes[2*r+1].xZ-t)/e-(1-1/e),l=(this.m_vertexes[2*r+1].yZ-i)/e+(1-1/e),m=new Te(this.m_scene,this.m_lineWidth,s,o,n,l,this.m_linesMaterial);this.m_distances[r].line=m,this.m_distances[r].text.updateText(.5*(s+n)-0,.5*(o+l)-0,this.m_textWidthScr,xe.ALIGN_CENTER,xe.ALIGN_CENTER,this.m_textBgColor,this.m_textColor),this.m_scene.add(this.m_distances[r].text)}}},{key:"updateZoom",value:function(e){this.m_zoom=e}},{key:"setPixelSize",value:function(e,t){this.m_xPixelSize=e,this.m_yPixelSize=t}},{key:"isRunning",value:function(){return this.m_runningState}},{key:"onMouseDown",value:function(e,t,i,a,r){this.m_runningState=!this.m_runningState;var s=(e+(1-1/i))*i+a,o=(t-(1-1/i))*i+r;if(this.m_runningState){this.m_xStart=e,this.m_yStart=t;var n=new Te(this.m_scene,this.m_lineWidth,e,t,e,t,this.m_linesMaterial),l=new xe("0 mm");l.updateText(e,t,this.m_textWidthScr,xe.ALIGN_CENTER,xe.ALIGN_CENTER,this.m_textBgColor,this.m_textColor),this.m_scene.add(l),this.m_distances.push({line:n,text:l}),this.m_vertexes.push({xZ:s,yZ:o})}else this.m_vertexes.push({xZ:s,yZ:o}),this.m_xStart=-1,this.m_yStart=-1}},{key:"test",value:function(){new Te(this.m_scene,this.m_lineWidth,-1,1,-.5,.5,this.m_linesMaterial)}},{key:"onMouseMove",value:function(e,t,i){if(this.m_runningState){var a=this.m_distances.pop();this.m_scene.remove(a.line.getRenderObject());var r=new Te(this.m_scene,this.m_lineWidth,this.m_xStart,this.m_yStart,e,t,this.m_linesMaterial);this.m_scene.remove(a.text);var s="".concat((i*Math.sqrt((e-this.m_xStart)*(e-this.m_xStart)*this.m_xPixelSize*this.m_xPixelSize+(t-this.m_yStart)*(t-this.m_yStart)*this.m_yPixelSize*this.m_yPixelSize)).toFixed(2)," mm"),o=new xe(s);o.updateText(.5*(e+this.m_xStart)-0,.5*(t+this.m_yStart)-0,this.m_textWidthScr,xe.ALIGN_CENTER,xe.ALIGN_CENTER,this.m_textBgColor,this.m_textColor),this.m_scene.add(o),this.m_distances.push({line:r,text:o})}}},{key:"updateVertexes",value:function(e,t,i){this.m_vertexes=[];for(var a=0;a<this.m_distances.length;++a){var r=(this.m_distances[a].line.getxS()+(1-1/e))*e+t,s=(this.m_distances[a].line.getyS()-(1-1/e))*e+i;this.m_vertexes.push({xZ:r,yZ:s}),r=(this.m_distances[a].line.getxE()+(1-1/e))*e+t,s=(this.m_distances[a].line.getyE()-(1-1/e))*e+i,this.m_vertexes.push({xZ:r,yZ:s})}}}]),e}(),Oe="distance",Re="angle",we="area",Ee="rect",je="text",Me="grad",Ae="cobr",Ie="bifi",Ce="zoom",Xe="delete",Fe="edit",ke=function(){function e(t,i,a){Object(u.a)(this,e),this.m_width=i,this.m_height=a,this.m_material=null,this.m_mesh=null,console.log("Graphics2d create size = ".concat(i," * ").concat(a)),this.m_scene=t,this.m_materialsTex2d=null,this.m_material=null,this.m_zoom=1,this.m_savePosX=0,this.m_savePosY=0,this.m_posX=0,this.m_posY=0,this.m_move=!1,this.m_wProjScreen=i,this.m_hProjScreen=a,this.m_showTileTexture=!1;var r=1/i,s=1/a;this.m_lineWidth=2*(r>s?r:s),this.m_lineWidth=.002,this.m_textTime=-1e3,this.m_text=null,this.m_toolType=Oe,this.m_distanceTool=new De(this.m_scene,this.m_lineWidth)}return Object(h.a)(e,[{key:"set2dToolType",value:function(e){this.m_toolType=e}},{key:"onFileLoaded",value:function(){this.m_distanceTool.clearLines(),this.m_angleTool.clearLines(),this.m_areaTool.clearLines(),this.m_rectTool.clearLines(),this.m_textTool.clear(),this.m_deleteTool.clearLines(),this.m_editTool.clearLines()}},{key:"clear2DTools",value:function(){this.m_distanceTool.clearLines(),this.m_angleTool.clearLines(),this.m_areaTool.clearLines(),this.m_rectTool.clearLines(),this.m_textTool.clear(),this.m_deleteTool.clearLines(),this.m_editTool.clearLines()}},{key:"default2DTools",value:function(){this.m_zoom=1,this.m_posX=0,this.m_posY=0,this.m_savePosX=0,this.m_savePosY=0,this.m_materialsTex2d.m_uniforms.posX.value=this.m_posX,this.m_materialsTex2d.m_uniforms.posY.value=this.m_posY,this.m_materialsTex2d.m_uniforms.zoom.value=this.m_zoom,this.updateLines()}},{key:"fov2Tan",value:function(e){return Math.tan(E.x.degToRad(.5*e))}},{key:"tan2Fov",value:function(e){return 2*E.x.radToDeg(Math.atan(e))}},{key:"onKeyDown",value:function(e,t){}},{key:"onMouseDown",value:function(e,t){if(null!==this.m_volumeData&&null!==this.m_volumeHeader&&!(e>this.m_wProjScreen||t>this.m_hProjScreen)&&!this.m_levelSetMode){var i=2*e-1,a=2*t-1;switch(this.m_toolType){case Oe:this.m_distanceTool.onMouseDown(i,a,this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen);break;case Re:this.m_angleTool.onMouseDown(i,a,this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen);break;case je:this.m_textTool.onMouseDown(i,a,this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen);break;case we:this.m_areaTool.onMouseDown(i,a,this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen);break;case Ee:this.m_rectTool.onMouseDown(i,a,this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen);break;case Me:case Ae:case Ie:break;case Ce:this.m_move=!0,this.m_moveTool.onMouseDown(i,a);break;case Xe:this.m_deleteTool.onMouseDown(i,a,this.m_distanceTool.m_distances,this.m_angleTool.m_angles,this.m_rectTool.m_areas,this.m_areaTool.m_distances,this.m_textTool.m_textArr,this.m_distanceTool.m_vertexes,this.m_angleTool.m_vertexes,this.m_rectTool.m_vertexes,this.m_areaTool.m_vertexes2,this.m_areaTool.m_last_lengths,this.m_areaTool.m_vertexes,this.m_areaTool,this.m_textTool.m_vertexes),console.log("".concat(this.m_areaTool.last_length));break;case Fe:this.m_editTool.onMouseDown();break;default:console.log("Unexpected 2d tool")}}}},{key:"onMouseUp",value:function(e,t){if(null!==this.m_volumeData&&null!==this.m_volumeHeader&&!(e>this.m_wProjScreen||t>this.m_hProjScreen)){var i=2*e-1,a=2*t-1;if(this.m_levelSetMode)return null!==this.m_levelSetCircle&&this.clearLevelSetCenter(),void this.drawLevelSetCenter(i,a);switch(this.m_toolType){case Oe:case Re:case we:case Ee:case je:case Ae:case Ie:break;case Ce:this.m_move=!1,this.m_moveTool.onMouseUp(),this.m_savePosX=this.m_posX,this.m_savePosY=this.m_posY;break;case Xe:break;case Fe:this.m_editTool.onMouseUp();break;default:console.log("Unexpected 2d tool")}}}},{key:"onMouseMove",value:function(e,t){if(null!==this.m_volumeData&&null!==this.m_volumeHeader&&!(e>this.m_wProjScreen||t>this.m_hProjScreen)){var i=2*e-1,a=2*t-1;switch(this.m_toolType){case Oe:this.m_distanceTool.onMouseMove(i,a,this.m_zoom);break;case Re:this.m_angleTool.onMouseMove(i,a);break;case we:this.m_areaTool.onMouseMove(i,a);break;case Ee:this.m_rectTool.onMouseMove(i,a,this.m_zoom);break;case je:case Me:case Ae:case Ie:break;case Ce:this.m_move&&this.updateMove(i,a);break;case Xe:this.m_deleteTool.onMouseMove(i,a,this.m_zoom,this.m_distanceTool.m_distances,this.m_angleTool.m_angles,this.m_rectTool.m_areas,this.m_areaTool.m_distances,this.m_textTool.m_textArr);break;case Fe:this.m_editTool.onMouseMove(i,a,this.m_zoom,this.m_distanceTool.m_distances,this.m_angleTool.m_angles,this.m_rectTool.m_areas,this.m_areaTool.m_distances,this.m_areaTool,this.m_textTool,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen),this.m_distanceTool.updateVertexes(this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen),this.m_angleTool.updateVertexes(this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen);break;default:console.log("Unexpected 2d tool")}}}},{key:"onMouseWheel",value:function(e){switch(this.m_toolType){case Oe:case Re:case we:case Ee:case je:case Ae:case Ie:break;case Ce:this.m_zoomTool.onMouseWheel(e),this.updateZoom(),this.createMarkLinesAndText();break;case Xe:case Fe:break;default:console.log("Unexpected 2d tool")}}},{key:"updateLines",value:function(){this.m_distanceTool.updateLines(this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen),this.m_angleTool.updateLines(this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen),this.m_rectTool.updateLines(this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen),this.m_textTool.updateAll(this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen),this.m_areaTool.updateLines(this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen),this.m_deleteTool.updateLines(this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen),this.m_editTool.updateLines(this.m_zoom,this.m_posX*this.m_wProjScreen,this.m_posY*this.m_hProjScreen)}},{key:"updateMove",value:function(e,t){var i=2-2*this.m_zoom,a=this.m_moveTool.onMouseMove(e,t);this.m_savePosX+a.x<=Math.abs(i)&&this.m_savePosX+a.x>0?(this.m_posX=this.m_savePosX+a.x,this.m_materialsTex2d.m_uniforms.posX.value=this.m_posX):this.m_savePosX+a.x>Math.abs(i)?(this.m_posX=Math.abs(i),this.m_materialsTex2d.m_uniforms.posX.value=this.m_posX):(this.m_posX=0,this.m_materialsTex2d.m_uniforms.posX.value=this.m_posX),this.m_savePosY+a.y>=-1*Math.abs(i)&&this.m_savePosY+a.y<0?(this.m_posY=this.m_savePosY+a.y,this.m_materialsTex2d.m_uniforms.posY.value=this.m_posY):this.m_savePosY+a.y<-1*Math.abs(i)?(this.m_posY=-1*Math.abs(i),this.m_materialsTex2d.m_uniforms.posY.value=this.m_posY):(this.m_posY=0,this.m_materialsTex2d.m_uniforms.posY.value=this.m_posY),this.updateLines()}},{key:"updateZoom",value:function(){this.m_materialsTex2d.m_uniforms.zoom.value=this.m_zoomTool.m_zoom,this.m_zoom=this.m_zoomTool.m_zoom;var e=2-2*this.m_zoom;this.m_posX>e&&(this.m_posX=e,this.m_materialsTex2d.m_uniforms.posX.value=this.m_posX),this.m_posY<-1*e&&this.m_posY<0&&(this.m_posY=-1*e,this.m_materialsTex2d.m_uniforms.posY.value=this.m_posY),this.updateLines()}},{key:"updateText",value:function(){}}],[{key:"shortenString",value:function(e){var t=e,i=e.length;if(i>20){var a=e.substring(0,6),r=e.substring(i-5,i);t="".concat(a,"...").concat(r)}return t}}]),e}(),Ue=.1,Ne=149/255,Ve=175/255,Le=205/255,Pe=205/255,Be=149/255,ze=149/255,Ge=108/255,We=78/255,He=78/255,qe=.0025,Ye=.0033,Ze=.0025,Ke=.0029,Qe=175,Je=[-1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],$e=[-1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1],et=function(){function e(t){var i=this;Object(u.a)(this,e),this.curFileDataType=t.curFileDataType,this.sceneReadyCounter=0,this.renderCounter=0,this.scene=new E.L,this.sceneClipPlane=new E.L,this.scene23D=new E.L,this.graphics23d=null,this.sceneSphere=new E.L,this.meshSphere=null,this.newScene=new E.L,this.renderScene=0,this.planeGeometry=null,this.props=t,this.mesh=null,this.renderer=null,this.texTF=null,this.volTexture=null,this.origVolumeTex=null,this.texRoiId=null,this.texRoiColor=null,this.RoiVolumeTex=null,this.volTextureMask=null,this.texVolumeAO=null,this.bfTexture=null,this.ffTexture=null,this.renderToTexture=null,this.geometry=null,this.geometrySphere=null,this.geometryWireFrameSphere=null,this.matBF=null,this.matFF=null,this.matScreenTex=null,this.matWireFrame=null,this.matRenderToTexture=null,this.matVolumeRender=null,this.volumeUpdater=null,this.checkFrameBufferMode=0,this.eraserStarted=!1,this.lockEraserBuffersUpdating=!1,this.SPOTcolor=new E.U(1,0,0),this.volumeOpacity=1,this.showSolids=!0,this.dispatch=t.dispatch,this.volumeReady=!1,this.planeCenterPt=new E.U(-.5,-.5,.7);var a=new j;this.context=a.createWebGLContext(),this.isWebGL2=a.useWebGL2(),this.canvas3d=a.getCanvas(),this.renderer=new E.X({antialias:!1,canvas:this.canvas3d,preserveDrawingBuffer:!0,context:this.context}),this.renderer.autoClearStencil=!1,this.renderer.autoClearColor=!1,this.renderer||console.log("cant create 3d renderer"),this.windowWidth=Math.floor(t.width),this.windowHeight=Math.floor(t.height),console.log("Window: ".concat(this.windowWidth," x ").concat(this.windowHeight));var r=this.windowWidth/this.windowHeight;this.camera=new E.G(60,r,.01,3),this.camera.position.z=10,this.renderer.setSize(this.windowWidth,this.windowHeight),this.renderer.setClearColor(0),t.mount.appendChild(this.renderer.domElement),this.orbitControl=new A(this.renderer.domElement,this.camera,this.scene,this.mesh,(function(){i.updateCutPlanes(),i.updateLightDir()})),this.renderer.gammaInput=!0,this.renderer.gammaOutput=!0,this.RENDER_STATE={ENABLED:0,ONCE:1,DISABLED:2},this.renderState=this.RENDER_STATE.ENABLED,this.fps=0,this.isoThreshold=0,this.isEraseMode=!1,this.eraserRadius=10,this.eraserDepth=20,this.eraserSrart=!1,this.lockEraserBuffersUpdating=!1,this.eraserMouseDown=!1,this.m_eraser=null,this.isSculptingMode=!1,this.sculptingCapturedVertex=null,this.sculptingSphereCenter=new E.U(0,0,0),this.sculptingSphereSize=1,this.vBoxVirt={x:1,y:1,z:1}}return Object(h.a)(e,[{key:"setFileDataType",value:function(e){this.curFileDataType=e}},{key:"removeSphereFromSphereScene",value:function(){null!==this.meshSphere&&this.sceneSphere.remove(this.meshSphere),this.meshSphere=null,this.geometrySphere=null}},{key:"addSphereToSphereScene",value:function(){var e=new ue,t=new E.U(.5,.5,.5),i=e.create(t,2);if(i<1)return i;for(var a=e.getNumVertices(),r=e.getNumTriangles(),s=[],o=[],n=[],l=0;l<a;l++){var m=e.getVertex(l),u=new E.U(m.x,m.y,m.z);s.push(m.x,m.y,m.z),u.normalize(),n.push(u.x,u.y,u.z)}for(var h=0,c=0;h<r;h++,c+=3){var d=e.getTriangle(h);o.push(d[0],d[1],d[2])}this.geometrySphere=new E.f;var _=new Float32Array(s),f=new Float32Array(n),v=new Uint8Array(o);return this.geometrySphere.addAttribute("position",new E.e(_,3)),this.geometrySphere.addAttribute("normal",new E.e(f,3)),this.geometrySphere.setIndex(new E.e(v,1)),this.computeGeometrySphereUVs(),this.meshSphere=new E.z(this.geometrySphere),this.sceneSphere.add(this.meshSphere),this.meshSphere}},{key:"updateMeshSphere",value:function(){}},{key:"isVolumeLoaded",value:function(){return null!==this.matVolumeRender}},{key:"fov2Tan",value:function(e){return Math.tan(E.x.degToRad(.5*e))}},{key:"tan2Fov",value:function(e){return 2*E.x.radToDeg(Math.atan(e))}},{key:"screenshot",value:function(e,t){if(null===this.renderer)return null;var i=null;if("undefined"===typeof e)i=this.renderer.domElement.toDataURL("image/png");else{var a=this.camera.aspect,r=this.camera.fov,s=this.fov2Tan(this.camera.fov)*Math.min(this.windowWidth,this.windowHeight)/this.windowHeight,o=e/t;this.camera.aspect=o,this.camera.fov=this.tan2Fov(s/Math.min(o,1)),this.camera.updateProjectionMatrix(),this.renderer.setSize(e,t),this.render(),i=this.renderer.domElement.toDataURL("image/png"),this.camera.aspect=a,this.camera.fov=r,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.windowWidth,this.windowHeight),this.render()}return i}},{key:"setMaskFlag",value:function(e){this.matVolumeRender.defines.MaskFlag=e,this.matVolumeRender.needsUpdate=!0,this.matRenderToTexture.defines.MaskFlag=e,this.matRenderToTexture.needsUpdate=!0}},{key:"switchToTool23D",value:function(e){this.Tool23D=e,this.Tool23D?this.graphics23d=new ke(this.scene23D,this.windowWidth,this.windowHeight):this.graphics23d=null}},{key:"switchToVolumeRender",value:function(){null!==this.matVolumeRender&&null!==this.matRenderToTexture&&(this.isRoiVolume>0?(this.matVolumeRender.defines.isoRenderFlag=4,this.matVolumeRender.needsUpdate=!0,this.matRenderToTexture.defines.isoRenderFlag=4,this.matRenderToTexture.needsUpdate=!0,this.renderState=this.RENDER_STATE.ONCE):(this.matVolumeRender.defines.isoRenderFlag=0,this.matVolumeRender.needsUpdate=!0,this.matRenderToTexture.defines.isoRenderFlag=0,this.matRenderToTexture.needsUpdate=!0,this.renderState=this.RENDER_STATE.ONCE))}},{key:"switchToFullVolumeRender",value:function(){null!==this.matVolumeRender&&null!==this.matRenderToTexture&&(this.isRoiVolume>0?(this.matVolumeRender.defines.isoRenderFlag=4,this.matVolumeRender.needsUpdate=!0,this.matRenderToTexture.defines.isoRenderFlag=4,this.matRenderToTexture.needsUpdate=!0,this.renderState=this.RENDER_STATE.ONCE):(this.matVolumeRender.defines.isoRenderFlag=3,this.matVolumeRender.needsUpdate=!0,this.matRenderToTexture.defines.isoRenderFlag=3,this.matRenderToTexture.needsUpdate=!0,this.renderState=this.RENDER_STATE.ONCE))}},{key:"switchToIsosurfRender",value:function(){null!==this.matVolumeRender&&null!==this.matRenderToTexture&&(this.isRoiVolume>0?(this.matVolumeRender.defines.isoRenderFlag=5,this.matVolumeRender.needsUpdate=!0,this.matRenderToTexture.defines.isoRenderFlag=5,this.matRenderToTexture.needsUpdate=!0,this.renderState=this.RENDER_STATE.ONCE,this.volumeUpdater.switchToRoiMapRender()):(this.matVolumeRender.defines.isoRenderFlag=1,this.matVolumeRender.needsUpdate=!0,this.matRenderToTexture.defines.isoRenderFlag=1,this.matRenderToTexture.needsUpdate=!0,this.renderState=this.RENDER_STATE.ONCE))}},{key:"switchToFLATRender",value:function(){null!==this.matVolumeRender&&null!==this.matRenderToTexture&&(this.matVolumeRender.defines.isoRenderFlag=2,this.matVolumeRender.needsUpdate=!0,this.matRenderToTexture.defines.isoRenderFlag=2,this.matRenderToTexture.needsUpdate=!0,this.renderState=this.RENDER_STATE.ONCE)}},{key:"setIsoThresholdValue",value:function(e){null!==this.matVolumeRender&&null!==this.matRenderToTexture&&(this.matRenderToTexture.uniforms.isoThreshold.value=e,this.matRenderToTexture.uniforms.isoThreshold.needsUpdate=!0,this.matVolumeRender.uniforms.isoThreshold.value=e,this.matVolumeRender.uniforms.isoThreshold.needsUpdate=!0,this.isoThreshold=e,this.renderState=this.RENDER_STATE.ONCE)}},{key:"setVolumeOpacity",value:function(e){null!==this.matVolumeRender&&null!==this.matRenderToTexture&&(this.matRenderToTexture.uniforms.volumeOpacity.value=e,this.matRenderToTexture.uniforms.volumeOpacity.needsUpdate=!0,this.matVolumeRender.uniforms.volumeOpacity.value=e,this.matVolumeRender.uniforms.volumeOpacity.needsUpdate=!0,this.volumeOpacity=e,this.renderState=this.RENDER_STATE.ONCE)}},{key:"setSpotColor",value:function(e,t,i){null!==this.matVolumeRender&&null!==this.matRenderToTexture&&(this.matRenderToTexture.uniforms.SPOTcolor.value=new E.U(e,t,i),this.matRenderToTexture.uniforms.SPOTcolor.needsUpdate=!0,this.matVolumeRender.uniforms.SPOTcolor.value=new E.U(e,t,i),this.matVolumeRender.uniforms.SPOTcolor.needsUpdate=!0,this.SPOTcolor=new E.U(e,t,i),this.renderState=this.RENDER_STATE.ONCE)}},{key:"showVenousStructure",value:function(e){null!==this.matVolumeRender&&null!==this.matRenderToTexture&&(this.matRenderToTexture.uniforms.showSolids.value=e,this.matRenderToTexture.uniforms.showSolids.needsUpdate=!0,this.matVolumeRender.uniforms.showSolids.value=e,this.matVolumeRender.uniforms.showSolids.needsUpdate=!0,this.showSolids=e,this.renderState=this.RENDER_STATE.ONCE)}},{key:"setOpacityBarrier",value:function(e){null!==this.matVolumeRender&&null!==this.matRenderToTexture&&(this.matVolumeRender.uniforms.opacityBarrier.value=Qe*e,this.matVolumeRender.uniforms.opacityBarrier.needsUpdate=!0,this.matRenderToTexture.uniforms.opacityBarrier.value=Qe*e,this.matRenderToTexture.uniforms.opacityBarrier.needsUpdate=!0)}},{key:"updateBrightness",value:function(e){null!==this.matRenderToTexture&&(this.matRenderToTexture.uniforms.brightness3D.value=e,this.matRenderToTexture.uniforms.brightness3D.needsUpdate=!0),null!==this.matVolumeRender&&(this.matVolumeRender.uniforms.brightness3D.value=e,this.matVolumeRender.uniforms.brightness3D.needsUpdate=!0)}},{key:"updateContrast",value:function(e){null!==this.matVolumeRender&&null!==this.matRenderToTexture&&(this.matRenderToTexture.uniforms.contrast3D.value=e,this.matVolumeRender.uniforms.contrast3D.value=e,this.matRenderToTexture.uniforms.contrast3D.needsUpdate=!0,this.matVolumeRender.uniforms.contrast3D.needsUpdate=!0)}},{key:"setAmbientTextureMode",value:function(e){this.texVolumeAO&&this.texVolumeAO.dispose(),this.volumeUpdater.ambientTexture.set(this.volTexture,e),this.texVolumeAO=this.volumeUpdater.ambientTexture.get(),this.matRenderToTexture.defines.useAmbientTex=1,this.matVolumeRender.defines.useAmbientTex=1,this.matRenderToTexture.needsUpdate=!0,this.matVolumeRender.needsUpdate=!0,this.matRenderToTexture.uniforms.texVolumeAO.value=this.texVolumeAO,this.matRenderToTexture.uniforms.texVolumeAO.needsUpdate=!0,this.matVolumeRender.uniforms.texVolumeAO.value=this.texVolumeAO,this.matVolumeRender.uniforms.texVolumeAO.needsUpdate=!0}},{key:"offAmbientTextureMode",value:function(){this.texVolumeAO&&this.texVolumeAO.dispose(),this.matRenderToTexture.defines.useAmbientTex=0,this.matVolumeRender.defines.useAmbientTex=0,this.matRenderToTexture.needsUpdate=!0,this.matVolumeRender.needsUpdate=!0}},{key:"updateZCutPlane",value:function(e){this.planeCenterPt.z=1.4*e,this.updateCutPlanes()}},{key:"setTransferFuncVec3",value:function(e,t){null!==this.matRenderToTexture&&(this.matRenderToTexture.uniforms.t_function1min.value=0===t?new E.V(Ue,0,0,e[0]):new E.V(0,.8,0,e[0]),this.matRenderToTexture.uniforms.t_function1min.needsUpdate=!0,this.matRenderToTexture.uniforms.t_function1max.value=new E.V(Ne,Ve,Le,e[1]),this.matRenderToTexture.uniforms.t_function1max.needsUpdate=!0,this.matRenderToTexture.uniforms.t_function2min.value=new E.V(Pe,Be,ze,e[2]),this.matRenderToTexture.uniforms.t_function2min.needsUpdate=!0,this.matRenderToTexture.uniforms.t_function2max.value=new E.V(Ge,We,He,e[2]),this.matRenderToTexture.uniforms.t_function2max.needsUpdate=!0,this.matRenderToTexture.uniforms.stepSize.value=new E.V(qe,Ye,Ze,Ke),this.matRenderToTexture.uniforms.stepSize.needsUpdate=!0,this.matVolumeRender.uniforms.t_function1min.value=0===t?new E.V(Ue,0,0,e[0]):new E.V(0,.8,0,e[0]),this.matVolumeRender.uniforms.t_function1min.needsUpdate=!0,this.matVolumeRender.uniforms.t_function1max.value=new E.V(Ne,Ve,Le,e[1]),this.matVolumeRender.uniforms.t_function1max.needsUpdate=!0,this.matVolumeRender.uniforms.t_function2min.value=new E.V(Pe,Be,ze,e[2]),this.matVolumeRender.uniforms.t_function2min.needsUpdate=!0,this.matVolumeRender.uniforms.t_function2max.value=new E.V(Ge,We,He,e[2]),this.matVolumeRender.uniforms.t_function2max.needsUpdate=!0,this.matVolumeRender.uniforms.stepSize.value=new E.V(qe,Ye,Ze,Ke),this.matVolumeRender.uniforms.stepSize.needsUpdate=!0)}},{key:"computeGeometryUVs",value:function(e,t){this.geometry.computeBoundingBox();var i=this.geometry.boundingBox.max,a=this.geometry.boundingBox.min,r=new E.U(0-a.x,0-a.y,0-a.z),s=new E.U(i.x-a.x,i.y-a.y,i.z-a.z);this.geo_offset1=new E.U(0,0,0),this.geo_offset1=r,this.geo_offset2=new E.U(0,0,0),this.geo_offset2.x=e.x+.5,this.geo_offset2.y=e.y-.5,this.geo_offset2.z=e.z-.5,this.geo_scale=new E.U(0,0,0),this.geo_scale.x=(t.x-e.x)/s.x,this.geo_scale.y=(t.y-e.y)/s.y,this.geo_scale.z=(t.z-e.z)/s.z;for(var o=new Float32Array(3*this.geometry.getAttribute("position").count),n=0;n<this.geometry.getAttribute("position").count;n++){var l=this.geometry.getAttribute("position").getX(n),m=this.geometry.getAttribute("position").getY(n),u=this.geometry.getAttribute("position").getZ(n);o[3*n+0]=-l,o[3*n+1]=m,o[3*n+2]=u}this.geometry.addAttribute("uvw",new E.e(o,3)),this.geometry.getAttribute("uvw").needsUpdate=!0}},{key:"computeGeometrySphereUVs",value:function(){for(var e=new Float32Array(3*this.geometrySphere.getAttribute("position").count),t=0;t<this.geometrySphere.getAttribute("position").count;t++){var i=this.geometrySphere.getAttribute("position").getX(t),a=this.geometrySphere.getAttribute("position").getY(t),r=this.geometrySphere.getAttribute("position").getZ(t);e[3*t+0]=-i/this.vBoxVirt.x,e[3*t+1]=+a/this.vBoxVirt.y,e[3*t+2]=+r/this.vBoxVirt.z}this.geometrySphere.addAttribute("uvw",new E.e(e,3)),this.geometrySphere.getAttribute("uvw").needsUpdate=!0}},{key:"createClipPlaneGeometry",value:function(){var e=this;(new B).create(this.bfTexture,(function(t){e.planeGeometry=new E.H(2,2);var i=new E.z(e.planeGeometry,t);e.sceneClipPlane.add(i)}))}},{key:"updateClipPlaneGeometry",value:function(){var e=new Float32Array(3*this.planeGeometry.getAttribute("position").count),t=new E.y;t.getInverse(this.mesh.matrix);var i=new E.y;i.getInverse(this.camera.projectionMatrix);var a=new E.y;a.copy(this.camera.matrixWorld);for(var r=0;r<this.planeGeometry.getAttribute("position").count;r++){var s=new E.U;s.x=this.planeGeometry.getAttribute("position").getX(r),s.y=this.planeGeometry.getAttribute("position").getY(r),s.z=this.planeGeometry.getAttribute("position").getZ(r)+.001,s.applyMatrix4(i),s.applyMatrix4(a),s.applyMatrix4(t),e[3*r+0]=-s.x,e[3*r+1]=s.y,e[3*r+2]=s.z}this.planeGeometry.addAttribute("uvw",new E.e(e,3)),this.planeGeometry.getAttribute("uvw").needsUpdate=!0}},{key:"getScreen2WorldTransform",value:function(){var e=new E.y;e.getInverse(this.mesh.matrix);var t=new E.y;t.getInverse(this.camera.projectionMatrix);var i=new E.y;return i.copy(this.camera.matrixWorld),t.multiply(i),t.multiply(e),t}},{key:"initWithVolume",value:function(e,t,i,a,r,s){var o,n=this,l=arguments.length>6&&void 0!==arguments[6]&&arguments[6],m=arguments.length>7&&void 0!==arguments[7]?arguments[7]:.9,u=null===(o=this.mesh)||void 0===o?void 0:o.matrix,h=this.camera.clone(),c=t.x>t.y?t.x:t.y;c=t.z>c?t.z:c,this.vBoxVirt.x=t.x/c,this.vBoxVirt.y=t.y/c,this.vBoxVirt.z=t.z/c,this.isoThreshold=this.curFileDataType.thresholdIsosurf,this.volume=e,this.nonEmptyBoxMin=i,this.nonEmptyBoxMax=a,this.matWireFrame=null,this.removeSphereFromSphereScene();var d=new N;this.matWireFrame=d.create(this.bfTexture,this.ffTexture),this.addSphereToSphereScene(),this.renderScene=0,this.sceneReadyCounter=0,this.renderCounter=0;var _=null,f=null,v=null;if(this.sceneClipPlane&&(this.sceneClipPlane=new E.L),this.scene){null!==this.mesh&&this.scene.remove(this.mesh),null!==this.geometry&&this.geometry.dispose(),this.mesh=null,this.geometry=new E.f,this.geometry.fromGeometry(new E.d(1,1,1)),this.computeGeometryUVs(i,a),this.geometry.scale(this.vBoxVirt.x,this.vBoxVirt.y,this.vBoxVirt.z),this.camera.position.set(0,0,m),this.camera.lookAt(new E.U(0,0,0));var p=this.volume.m_xDim,g=this.volume.m_yDim,S=this.volume.m_zDim;console.log("3D tex size = ".concat(p," ").concat(g," ").concat(S)),this.volTexture&&this.volTexture.dispose(),this.eraserStarted=!1,this.isRoiVolume=r,this.roiPalette=null;var x=new fe;this.roiPalette=x.getPalette256();var b=4,y=250,T=0,D=1,O=2,j=this.roiPalette[y*b+T],M=this.roiPalette[y*b+D],A=this.roiPalette[y*b+O];if(console.log("RoiPalette: pal[250] = ".concat(A,", ").concat(M,", ").concat(j)),this.volumeUpdater=new _e,this.volTexture=this.volumeUpdater.createUpdatableVolumeTex(this.volume,r,this.roiPalette),this.origVolumeTex=this.volumeUpdater.origVolumeTex,this.texTF=this.volumeUpdater.createTransferFuncTexture(),this.volTextureMask&&this.volTextureMask.dispose(),this.texVolumeAO&&this.texVolumeAO.dispose(),this.renderer.getContext().getExtension("EXT_color_buffer_float")){this.bfTexture&&this.bfTexture.dispose(),this.bfTexture=new E.W(this.windowWidth,this.windowHeight,{minFilter:E.v,magFilter:E.v,format:E.J,type:E.q,depthBuffer:!0});var I=4;this.bufferBFTextureCPU=new Float32Array(I*this.windowWidth*this.windowHeight),this.ffTexture&&this.ffTexture.dispose(),this.ffTexture=new E.W(this.windowWidth,this.windowHeight,{minFilter:E.v,magFilter:E.v,format:E.J,type:E.q,depthBuffer:!0}),this.bufferFFTextureCPU=new Float32Array(I*this.windowWidth*this.windowHeight),this.renderfTexture&&this.renderToTexture.dispose();var C=3;this.xSmallTexSize=Math.floor(this.windowWidth/C),this.ySmallTexSize=Math.floor(this.windowHeight/C),this.renderToTexture=new E.W(this.xSmallTexSize,this.ySmallTexSize,{minFilter:E.B,magFilter:E.B,format:E.J,type:E.q,depthBuffer:!0}),this.bufferRenderToTextureCPU=new Float32Array(I*this.xSmallTexSize*this.ySmallTexSize)}else console.log("cant create float texture");if(this.createClipPlaneGeometry(),this.matWireFrame&&(this.matWireFrame.uniforms.texBF.value=this.bfTexture,this.matWireFrame.uniforms.texBF.needsUpdate=!0,this.matWireFrame.uniforms.texFF.value=this.ffTexture,this.matWireFrame.uniforms.texFF.needsUpdate=!0),v=new V,this.matScreenTex=v.create(this.ffTexture),(new X).create((function(e){n.matBF=e,n.sceneReadyCounter++})),(_=new U).m_uniforms.PlaneX.value=new E.V(-1,0,0,.5),_.m_uniforms.PlaneY.value=new E.V(0,-1,0,.5),_.m_uniforms.PlaneZ.value=new E.V(0,0,-1,.5),_.create(this.bfTexture.texture,(function(e){n.matFF=e,n.sceneReadyCounter++})),this.mesh=new E.z(this.geometry),l&&u)this.mesh.rotation.setFromRotationMatrix(u),this.camera.copy(h,!0),this.camera.updateMatrixWorld();else{var F=new E.y;F.identity(),F.set.apply(F,Je),this.mesh.rotation.setFromRotationMatrix(F),this.meshSphere&&this.meshSphere.rotation.setFromRotationMatrix(F)}this.orbitControl.setMesh(this.mesh),this.orbitControl.setWireMesh(this.meshSphere);for(var k=[],L=64,P=0;P<L;++P){var B=2*Math.random()-1,z=2*Math.random()-1,G=-Math.random();k.push(new E.U(B,z,G))}var H=["volumeOpacity","SPOTcolor","showSolids"],q=function(e){return e&&H.reduce((function(t,i){return Object(w.a)(Object(w.a)({},t),{},Object(R.a)({},i,e.m_uniforms[i]))}),{})},Z=function(e,t){return t&&Object.keys(t).forEach((function(i){return e.m_uniforms[i]=t[i]}))},K=q(this.matRenderToTextureThreeGS);this.matRenderToTextureThreeGS=new W,Z(this.matRenderToTextureThreeGS,K),this.matRenderToTextureThreeGS.m_uniforms.colorMap1D.value=this.colorMapTexture,this.matRenderToTextureThreeGS.create(this.texTF,this.volTexture,null,this.texVolumeAO,this.bfTexture.texture,this.ffTexture.texture,k,(function(e){e.uniforms.t_function1min.value=new E.V(Ue,0,0,n.curFileDataType.thresholdTissue1),e.uniforms.t_function1max.value=new E.V(Ne,Ve,Le,n.curFileDataType.thresholdTissue2),e.uniforms.t_function2min.value=new E.V(Pe,Be,ze,n.curFileDataType.thresholdIsosurf),e.uniforms.t_function2max.value=new E.V(Ge,We,He,n.curFileDataType.thresholdIsosurf),e.uniforms.stepSize.value=new E.V(qe,Ye,Ze,Ke),e.uniforms.texSize.value=p,e.uniforms.isoThreshold.value=n.curFileDataType.thresholdIsosurf,e.uniforms.brightness3D.value=n.curFileDataType.brightness,e.uniforms.opacityBarrier.value=Qe*n.curFileDataType.opacityTissue,e.uniforms.volumeSizeZ.value=S,e.uniforms.xDim.value=p,e.uniforms.yDim.value=g,e.uniforms.lightDir.value=new E.U(n.curFileDataType.lightDirComp,n.curFileDataType.lightDirComp,n.curFileDataType.lightDirComp),e.uniforms.needsUpdate=!0,n.matRenderToTexture=e,n.sceneReadyCounter++}));var J=3;(f=new Y).m_uniforms.isoSurfTexel.value=new E.T(J/this.windowWidth,J/this.windowHeight),f.create(this.renderToTexture.texture,(function(e){e.uniforms.needsUpdate=!0,n.sceneReadyCounter++})),K=q(this.matSkullThreeGS),this.matSkullThreeGS=new Q,Z(this.matSkullThreeGS,K),this.matSkullThreeGS.m_uniforms.isoSurfTexel.value=new E.T(J/this.windowWidth,J/this.windowHeight),this.matSkullThreeGS.m_uniforms.colorMap1D.value=this.colorMapTexture,this.matSkullThreeGS.create(this.texTF,this.volTexture,null,this.texVolumeAO,this.bfTexture.texture,this.ffTexture.texture,this.renderToTexture.texture,k,(function(e){e.uniforms.t_function1min.value=new E.V(Ue,0,0,n.curFileDataType.thresholdTissue1),e.uniforms.t_function1max.value=new E.V(Ne,Ve,Le,n.curFileDataType.thresholdTissue2),e.uniforms.t_function2min.value=new E.V(Pe,Be,ze,n.curFileDataType.thresholdIsosurf),e.uniforms.t_function2max.value=new E.V(Ge,We,He,n.curFileDataType.thresholdIsosurf),e.uniforms.stepSize.value=new E.V(qe,Ye,Ze,Ke),e.uniforms.texSize.value=p,e.uniforms.isoThreshold.value=n.curFileDataType.thresholdIsosurf,e.uniforms.brightness3D.value=n.curFileDataType.brightness,e.uniforms.volumeSizeZ.value=S,e.uniforms.xDim.value=p,e.uniforms.yDim.value=g,e.uniforms.opacityBarrier.value=Qe*n.curFileDataType.opacityTissue,e.uniforms.lightDir.value=new E.U(n.curFileDataType.lightDirComp,n.curFileDataType.lightDirComp,n.curFileDataType.lightDirComp),e.uniforms.needsUpdate=!0;var t=new E.A({color:16711680,shading:E.N});new E.z(new E.h(300,300,300),t).position.set(0,0,0),n.scene.add(n.mesh),n.matVolumeRender=e,s?n.switchToFLATRender():n.switchToVolumeRender(),n.mesh.material=n.matVolumeRender,n.meshSphere.material=n.matVolumeRender,n.sceneReadyCounter++}))}}},{key:"isSpinning",value:function(){return!this.orbitControl.autoRotateInterval}},{key:"setAutoSpin",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return this.setAnimate(e),e}},{key:"setAnimate",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.animateInterval&&(clearInterval(this.animateInterval),this.animateInterval=void 0),e&&(this.animateInterval=setInterval(this._animate.bind(this),1e3/30))}},{key:"_animate",value:function(){this.orbitControl._autoSpin()}},{key:"setTransferFuncColors",value:function(e){this.volumeUpdater.setTransferFuncColors(e)}},{key:"updateTransferFuncTexture",value:function(e,t){return this.volumeUpdater.updateTransferFuncTexture(e,t)}},{key:"updateSelectedRoiMap",value:function(e){this.volumeUpdater.updateSelectedRoiMap(e)}},{key:"updateCutPlanes",value:function(){if(this.mesh){var e=new E.y;1===this.renderScene?e.getInverse(e.extractRotation(this.meshSphere.matrix)):e.getInverse(e.extractRotation(this.mesh.matrix));var t=new E.U(-1,0,0),i=new E.U(0,-1,0),a=new E.U(0,0,-1),r=(new E.U).copy(this.planeCenterPt);r.applyMatrix4(e),t.applyMatrix4(e),i.applyMatrix4(e),a.applyMatrix4(e),null!==this.matFF&&(this.matFF.uniforms.PlaneX.value.x=t.x,this.matFF.uniforms.PlaneX.value.y=t.y,this.matFF.uniforms.PlaneX.value.z=t.z,this.matFF.uniforms.PlaneX.value.w=-r.dot(t),this.matFF.uniforms.PlaneY.value.x=i.x,this.matFF.uniforms.PlaneY.value.y=i.y,this.matFF.uniforms.PlaneY.value.z=i.z,this.matFF.uniforms.PlaneY.value.w=-r.dot(i),this.matFF.uniforms.PlaneZ.value.x=-a.x,this.matFF.uniforms.PlaneZ.value.y=a.y,this.matFF.uniforms.PlaneZ.value.z=a.z,this.matFF.uniforms.PlaneZ.value.w=-r.dot(a))}}},{key:"updateLightDir",value:function(){if(this.mesh){var e=new E.y;0===this.renderScene?e.getInverse(e.extractRotation(this.mesh.matrix)):e.getInverse(e.extractRotation(this.meshSphere.matrix));var t=new E.U(1,1,1);t.normalize(),t.applyMatrix4(e),t.x=-t.x,this.matRenderToTexture.uniforms.lightDir.value=t,this.matRenderToTexture.uniforms.lightDir.needsUpdate=!0,this.matVolumeRender.uniforms.lightDir.value=t,this.matVolumeRender.uniforms.lightDir.needsUpdate=!0}else console.log("UpdateLightDir call mesh is not created")}},{key:"setPresetView",value:function(e){var t=Je,i=new E.y;i.identity(),1===e&&(t=$e),i.set.apply(i,Object(p.a)(t)),this.mesh.rotation.setFromRotationMatrix(i),this.meshSphere&&this.meshSphere.rotation.setFromRotationMatrix(i)}},{key:"isReadyToRender",value:function(){return 5===this.sceneReadyCounter&&!(null===this.matVolumeRender||null===this.matBF||null===this.matFF||null===this.matRenderToTexture)}},{key:"render",value:function(){if(this.isReadyToRender())if(this.volumeReady||(this.dispatch({type:b.SET_LOADER,showLoader:!1}),this.volumeReady=!0),null!==this.matVolumeRender&&null!==this.matBF&&null!==this.matFF&&null!==this.matRenderToTexture){if(0===this.checkFrameBufferMode&&(this.checkFrameBufferMode=1),0===this.renderScene){this.updateLightDir(),this.updateClipPlaneGeometry(),this.updateCutPlanes(),this.renderer.setRenderTarget(this.bfTexture),this.renderer.clear(),this.renderer.state.buffers.depth.setClear(0),this.scene.overrideMaterial=this.matBF,this.renderer.render(this.scene,this.camera,this.bfTexture);var e=this.renderer.getContext();this.isEraseMode&&!this.lockEraserBuffersUpdating&&e.readPixels(0,0,this.windowWidth,this.windowHeight,e.RGBA,e.FLOAT,this.bufferBFTextureCPU),this.renderer.setRenderTarget(this.ffTexture),this.renderer.clear(),this.renderer.state.buffers.depth.setClear(1),this.renderer.render(this.sceneClipPlane,this.camera,this.ffTexture),this.scene.overrideMaterial=this.matFF,this.renderer.render(this.scene,this.camera,this.ffTexture),this.isEraseMode&&!this.lockEraserBuffersUpdating&&e.readPixels(0,0,this.windowWidth,this.windowHeight,e.RGBA,e.FLOAT,this.bufferFFTextureCPU),this.renderer.setRenderTarget(),this.renderer.clear(),this.renderer.state.buffers.depth.setClear(0),this.scene.overrideMaterial=this.matRenderToTexture,this.renderer.render(this.scene,this.camera,this.renderToTexture),this.isEraseMode&&!this.lockEraserBuffersUpdating&&e.readPixels(0,0,this.xSmallTexSize,this.ySmallTexSize,e.RGBA,e.FLOAT,this.bufferRenderToTextureCPU),this.scene.overrideMaterial=null,this.renderer.render(this.scene,this.camera),this.renderer.autoClearDepth=!1,this.Tool23D&&this.renderer.render(this.scene23D,this.camera),this.renderer.autoClearDepth=!0}this.renderCounter++}else;}},{key:"setStepsize",value:function(e){var t=1/(100+700*e);null!==this.matRenderToTexture&&(this.matRenderToTexture.uniforms.stepSize.value=new E.V(t,t,t,t),this.matRenderToTexture.uniforms.needsUpdate=!0),null!==this.matVolumeRender&&(this.matVolumeRender.uniforms.stepSize.value=new E.V(t,t,t,t),this.matVolumeRender.uniforms.needsUpdate=!0)}},{key:"getVertexProjectionToScreen",value:function(e,t){var i=e.clone();i.applyMatrix4(this.meshSphere.matrixWorld),i.project(this.camera);var a=.5*this.windowWidth,r=.5*this.windowHeight,s=a+a*i.x,o=r+r*i.y;t.x=s,t.y=o;var n=e.clone();return n.applyMatrix4(this.meshSphere.matrixWorld),n.applyMatrix3(this.camera.normalMatrix),n.z}},{key:"setEraserMode",value:function(e){if(this.isEraseMode=e,this.orbitControl.setEraserMode(e),!this.eraserStarted&&e){this.eraserStarted=!0;var t={xDim:this.volume.m_xDim,yDim:this.volume.m_yDim,zDim:this.volume.m_zDim,bufBF:this.bufferBFTextureCPU,bufFF:this.bufferFFTextureCPU,bufTex:this.bufferRenderToTextureCPU};this.volTextureMask=this.volumeUpdater.createUpdatableVolumeMask(t),this.matSkullThreeGS.m_uniforms.texVolumeMask.value=this.volTextureMask,this.matRenderToTextureThreeGS.m_uniforms.texVolumeMask.value=this.volTextureMask}e?this.setMaskFlag(1):this.setMaskFlag(0)}},{key:"undoEraser",value:function(){this.volumeUpdater.eraser.undoLastErasing()}},{key:"setEraserStart",value:function(e){this.eraserStart=e}},{key:"onMouseDown",value:function(e,t){this.Tool23D?this.graphics23d.onMouseDown(e/this.windowWidth,t/this.windowHeight):(this.orbitControl.onMouseDown(e,t),1===this.checkFrameBufferMode&&(this.renderState=this.RENDER_STATE.ENABLED,this.eraserMouseDown=!0,this.isEraseMode&&this.eraserStart&&(this.lockEraserBuffersUpdating=!0,this.volumeUpdater.eraser.eraseStart(e,t,this.windowWidth,this.matVolumeRender.uniforms.isoThreshold.value,!0))))}},{key:"onMouseMove",value:function(e,t){this.Tool23D?this.graphics23d.onMouseMove(e/this.windowWidth,t/this.windowHeight):1===this.checkFrameBufferMode&&(this.renderState=this.RENDER_STATE.ENABLED,this.isEraseMode&&this.eraserMouseDown&&this.eraserStart?this.volumeUpdater.eraser.eraseStart(e,t,this.windowWidth,this.matVolumeRender.uniforms.isoThreshold.value,!1):this.orbitControl.onMouseMove(e,t))}},{key:"onMouseUp",value:function(e,t){this.Tool23D?this.graphics23d.onMouseUp(e/this.windowWidth,t/this.windowHeight):(this.orbitControl.onMouseUp(),1===this.checkFrameBufferMode&&(this.lockEraserBuffersUpdating=!1,this.eraserMouseDown=!1,this.renderState=this.RENDER_STATE.ONCE))}},{key:"onMouseWheel",value:function(e){var t=Math.max(-1,Math.min(1,e.deltaY||-e.detail));this.orbitControl.onZoom(-t),1===this.checkFrameBufferMode&&(this.renderState=this.RENDER_STATE.ONCE)}}]),e}(),tt=function(e){Object(S.a)(i,e);var t=Object(x.a)(i);function i(e){var a;return Object(u.a)(this,i),(a=t.call(this,e)).onMode=a.onMode.bind(Object(g.a)(a)),a.isLoaded=!1,a.volume=null,a.start=a.start.bind(Object(g.a)(a)),a.stop=a.stop.bind(Object(g.a)(a)),a.animate=a.animate.bind(Object(g.a)(a)),a.renderScene=a.renderScene.bind(Object(g.a)(a)),a.setVolRenderToStore=a.setVolRenderToStore.bind(Object(g.a)(a)),a.m_mount=null,a.m_volumeRenderer3D=null,a.m_distanceTool=null,a.m_renderer=null,a.m_frameId=null,a.m_prevMode=D.RAYCAST,a.m_fileDataType={thresholdIsosurf:.46,thresholdTissue1:.09,thresholdTissue2:.3,opacityTissue:.53,startRotX:.5*-Math.PI,startRotY:Math.PI,lightDirComp:-.5773,brightness:.56},a.state={wRender:0,hRender:0},a}return Object(h.a)(i,[{key:"setVolRenderToStore",value:function(e){var t=this.props.dispatch;t({type:b.SET_VOLUME_Renderer,volumeRenderer:e}),t({type:b.SET_SLIDER_3DR,slider3d_r:Number.parseFloat(.09)}),t({type:b.SET_SLIDER_3DG,slider3d_g:Number.parseFloat(.3)}),t({type:b.SET_SLIDER_3DB,slider3d_b:Number.parseFloat(.46)}),t({type:b.SET_SLIDER_Opacity,sliderOpacity:Number.parseFloat(.53)}),t({type:b.SET_SLIDER_Isosurface,sliderIsosurface:Number.parseFloat(.46)}),t({type:b.SET_SLIDER_Brightness,sliderBrightness:Number.parseFloat(.56)}),t({type:b.SET_SLIDER_Cut,sliderCut:Number.parseFloat(1)}),t({type:b.SET_SLIDER_Quality,sliderQuality:Number.parseFloat(.35)})}},{key:"start",value:function(){null===this.m_frameId&&(this.m_frameId=requestAnimationFrame(this.animate))}},{key:"stop",value:function(){cancelAnimationFrame(this.m_frameId),this.m_frameId=null}},{key:"animate",value:function(){this.renderScene(),this.m_frameId=window.requestAnimationFrame(this.animate)}},{key:"renderScene",value:function(){null!==this.m_volumeRenderer3D&&this.m_volumeRenderer3D.render()}},{key:"onMode",value:function(e){this.props.dispatch({type:b.SET_MODE_3D,mode3d:e})}},{key:"componentDidMount",value:function(){this.props.dispatch({type:b.SET_LOADER,showLoader:!0});var e=this.m_mount.clientWidth>0?this.m_mount.clientWidth:200,t=this.m_mount.clientHeight>0?this.m_mount.clientHeight:200;0===this.state.wRender&&(this.setState({wRender:e}),this.setState({hRender:t}));var i=this.props,a=i.store,r=i.dispatch;if(null===this.m_volumeRenderer3D&&(this.m_volumeRenderer3D=new et({curFileDataType:this.m_fileDataType,width:e,height:t,mount:this.m_mount,dispatch:r})),this.setVolRenderToStore(this.m_volumeRenderer3D),null!==this.volume&&!1===this.isLoaded&&null!==this.m_volumeRenderer3D){var s=a.visState.volumeSet,o=a.visState.volumeIndex,n=4===s.getVolume(o).m_bytesPerVoxel,l=a.visState.mode3d===D.RAYFAST;this.m_volumeRenderer3D.initWithVolume(this.volume,this.volume.m_boxSize,{x:0,y:0,z:0},{x:1,y:1,z:1},n,l,a.doctorView.zoom,a.visState.volumeOpacity),this.isLoaded=!0}this.start(),this.m_mount.focus()}},{key:"componentDidUpdate",value:function(e){var t=e.store,i=this.props,a=i.store,r=i.dispatch;if(t.visState.volumeIndex!==a.visState.volumeIndex){this.isLoaded=!1,this.m_volumeRenderer3D.volumeReady&&(r({type:b.SET_LOADER,showLoader:!0}),this.m_volumeRenderer3D.volumeReady=!1),this.stop();var s=a.visState.volumeSet.getVolume(a.visState.volumeIndex);null!==s&&(this.volume=s);var o=a.visState.mode3d===D.RAYFAST,n=4===s.m_bytesPerVoxel;this.m_volumeRenderer3D.initWithVolume(this.volume,this.volume.m_boxSize,{x:0,y:0,z:0},{x:1,y:1,z:1},n,o,!0,a.doctorView.zoom,a.visState.volumeOpacity),this.m_volumeRenderer3D.setVolumeOpacity(a.visState.volumeOpacity),this.isLoaded=!0,this.start()}else if(t.visState.spotColor!==a.visState.spotColor){var l;(l=this.m_volumeRenderer3D).setSpotColor.apply(l,Object(p.a)(a.visState.spotColor))}else t.visState.volumeOpacity!==a.visState.volumeOpacity?this.m_volumeRenderer3D.setVolumeOpacity(a.visState.volumeOpacity):t.visState.showVenousStructure!==a.visState.showVenousStructure&&this.m_volumeRenderer3D.showVenousStructure(a.visState.showVenousStructure)}},{key:"componentWillUnmount",value:function(){this.stop(),null!==this.m_renderer&&this.m_mount.removeChild(this.m_renderer.domElement),this.m_volumeRenderer3D=null}},{key:"_onMouseMove",value:function(e){if(null!==this.m_volumeRenderer3D){var t=this.m_mount.getBoundingClientRect(),i=e.clientX-t.left,a=e.clientY-t.top;this.m_volumeRenderer3D.onMouseMove(i,-(this.state.hRender-a),this.props.ereaseStart)}}},{key:"_onMouseDown",value:function(e){if(null!==this.m_volumeRenderer3D){var t=this.m_mount.getBoundingClientRect(),i=e.clientX-t.left,a=e.clientY-t.top;this.m_volumeRenderer3D.onMouseDown(i,-(this.state.hRender-a),this.props.ereaseStart)}}},{key:"_onMouseUp",value:function(){null!==this.m_volumeRenderer3D&&this.m_volumeRenderer3D.onMouseUp()}},{key:"_onWheel",value:function(e){null!==this.m_volumeRenderer3D&&this.m_volumeRenderer3D.onMouseWheel(e)}},{key:"onClick",value:function(e){e.stopPropagation()}},{key:"onTouchStart",value:function(e){if(void 0!==this.m_mount&&null!==this.m_mount){var t=e.changedTouches,i=t.length;if(i>=2&&console.log("onTouchStart. numTouches == 2"),i>=1){var a=this.m_mount.getBoundingClientRect(),r=t[i-1].pageX-a.left,s=t[i-1].pageY-a.top;null!==this.m_volumeRenderer3D&&this.m_volumeRenderer3D.onMouseDown(r,this.state.hRender-s,this.props.ereaseStart)}}}},{key:"onTouchMove",value:function(e){if(void 0!==this.m_mount&&null!==this.m_mount){var t=e.changedTouches,i=t.length;if(i>=2&&console.log("onTouchStart. numTouches == 2"),i>=1){var a=this.m_mount.getBoundingClientRect(),r=t[i-1].pageX-a.left,s=t[i-1].pageY-a.top;null!==this.m_volumeRenderer3D&&this.m_volumeRenderer3D.onMouseMove(r,this.state.hRender-s,this.props.ereaseStart)}}}},{key:"onTouchEnd",value:function(){null!==this.m_volumeRenderer3D&&this.m_volumeRenderer3D.onMouseUp()}},{key:"render",value:function(){var e=this,t=this.props.store,i=null,r=t.visState.volumeSet;if(r&&r.getNumVolumes()>0){var s=t.visState.volumeIndex;i=r.getVolume(s)}null!==i&&(this.volume=i);var o=t.visState.mode3d,n=t.visState.modeView;null!==this.m_volumeRenderer3D&&(this.m_volumeRenderer3D.switchToTool23D(t.visState.isTool3D),n!==y.VIEW_3D?(o===D.RAYCAST&&(this.m_prevMode=D.RAYCAST,console.log("colors: ",t.visState.slider3d_r,t.visState.slider3d_g,t.visState.slider3d_b),this.m_volumeRenderer3D.switchToVolumeRender()),o===D.ISO&&(this.m_prevMode=D.ISO,this.m_volumeRenderer3D.switchToIsosurfRender(),this.m_volumeRenderer3D.setIsoThresholdValue(t.visState.sliderIsosurface)),o===D.RAYFAST&&(this.m_prevMode=D.RAYFAST,this.m_volumeRenderer3D.switchToFLATRender()),o===D.EREASER&&(this.m_prevMode=D.RAYFAST,this.m_volumeRenderer3D.switchToIsosurfRender(),this.m_volumeRenderer3D.setIsoThresholdValue(t.visState.sliderIsosurface),this.m_volumeRenderer3D.volumeUpdater.eraser.setEraserRadius(t.visState.sliderErRadius),this.m_volumeRenderer3D.volumeUpdater.eraser.setEraserDepth(t.visState.sliderErDepth))):this.m_volumeRenderer3D.switchToFullVolumeRender(),this.m_volumeRenderer3D.setVolumeOpacity(t.visState.volumeOpacity),this.m_volumeRenderer3D.setOpacityBarrier(t.visState.sliderOpacity),this.m_volumeRenderer3D.updateBrightness(t.visState.sliderBrightness),this.m_volumeRenderer3D.updateZCutPlane(t.visState.sliderCut-.5),this.m_volumeRenderer3D.setStepsize(t.visState.sliderQuality),this.m_volumeRenderer3D.updateContrast(t.visState.sliderContrast3D)),null!==this.m_volumeRenderer3D&&this.m_volumeRenderer3D.render();var l={width:"100%",height:"100%",opacity:this.isLoaded?"1":"0"},m=Object(a.jsx)("div",{style:l,ref:function(t){e.m_mount=t},onMouseMove:this._onMouseMove.bind(this),onMouseDown:this._onMouseDown.bind(this),onMouseUp:this._onMouseUp.bind(this),onTouchStart:this.onTouchStart.bind(this),onTouchEnd:this.onTouchEnd.bind(this),onTouchMove:this.onTouchMove.bind(this),className:"graphics-display",onClick:this.onClick.bind(this),onWheel:this._onWheel.bind(this)}),u=Object(a.jsx)("div",{width:"100%",height:"100%",ref:function(t){e.m_mount=t},onMouseMove:this._onMouseMove.bind(this),onMouseDown:this._onMouseDown.bind(this),onMouseUp:this._onMouseUp.bind(this),onTouchStart:this.onTouchStart.bind(this),onTouchEnd:this.onTouchEnd.bind(this),onTouchMove:this.onTouchMove.bind(this),onClick:this.onClick.bind(this),tabIndex:"1",className:"graphics-display",onWheel:this._onWheel.bind(this)});return this.state.wRender>0?u:m}}]),i}(s.a.Component),it=i(129),at=function(e){Object(S.a)(i,e);var t=Object(x.a)(i);function i(e){var a;return Object(u.a)(this,i),(a=t.call(this,e)).m_xDim=0,a.m_yDim=0,a.m_zDim=0,a.m_bytesPerVoxel=0,a.m_dataArray=null,a.m_dataSize=0,a.m_boxSize={x:0,y:0,z:0},a.m_phase=0,a.m_xIcon=0,a.m_yIcon=0,a.m_dataIcon=null,a}return Object(h.a)(i,[{key:"createEmptyBytesVolume",value:function(e,t,i){this.m_xDim=e,this.m_yDim=t,this.m_zDim=i;var a=e*t*i;this.m_bytesPerVoxel=1,this.m_dataArray=new Uint8Array(a),this.m_dataSize=a,this.m_boxSize={x:e,y:t,z:i};for(var r=0;r<a;r++)this.m_dataArray[r]=0}},{key:"createIcon",value:function(){console.assert(this.m_xDim>0),console.assert(this.m_yDim>0),console.assert(this.m_zDim>0),console.assert(null!==this.m_dataArray);var e=this.m_xDim>this.m_yDim?this.m_xDim:this.m_yDim,t=e/64,i=Math.floor(this.m_zDim/2)*this.m_xDim*this.m_yDim;this.m_xIcon=64,this.m_yIcon=this.m_xIcon;var a=this.m_xIcon*this.m_yIcon;this.m_dataIcon=new Uint8Array(a);for(var r=0;r<a;r++)this.m_dataIcon[r]=0;for(var s=Math.floor(64*this.m_xDim/e),o=Math.floor(64*this.m_yDim/e),n=Math.floor(this.m_xIcon/2-s/2),l=Math.floor(this.m_yIcon/2-o/2),m=0;m<o;m++)for(var u=Math.floor(m*t),h=0;h<s;h++){var c=Math.floor(h*t),d=this.m_dataArray[c+u*this.m_xDim+i],_=h+n,f=m+l;this.m_dataIcon[_+f*this.m_xIcon]=d}}},{key:"makeDimensions4x",value:function(){if(!(this.m_zDim<4)){var e=this.m_xDim+3&-4,t=this.m_yDim+3&-4,i=this.m_zDim+3&-4;if(this.m_xDim!==e||this.m_yDim!==t||this.m_zDim!==i){console.log("Volume. makeDimensions4x. Convert into ".concat(e,"*").concat(t,"*").concat(i));var a,r=e*t*i,s=this.m_bytesPerVoxel,o=r*s,n=new Uint8Array(r*s);for(a=0;a<o;a++)n[a]=0;console.log("Volume info: xyzDim = ".concat(this.m_xDim,"*").concat(this.m_yDim,"*").concat(this.m_zDim)),console.log("Volume info: bpp = ".concat(this.m_bytesPerVoxel)),console.log("Volume info: dataSize = ".concat(this.m_dataSize));var l=this.m_xDim*this.m_yDim;if(1===this.m_bytesPerVoxel)for(var m=0;m<this.m_zDim;m++)for(var u=m*l,h=m*e*t,c=0;c<this.m_yDim;c++)for(var d=c*this.m_xDim,_=c*e,f=0;f<this.m_xDim;f++){var v=f+d+u,p=this.m_dataArray[v];n[f+_+h]=p}else if(4===this.m_bytesPerVoxel)for(var g=0;g<this.m_zDim;g++)for(var S=g*l,x=g*e*t,b=0;b<this.m_yDim;b++)for(var y=b*this.m_xDim,T=b*e,D=0;D<this.m_xDim;D++){var O=4*(D+y+S),R=this.m_dataArray[O+0],w=this.m_dataArray[O+1],E=this.m_dataArray[O+2],j=this.m_dataArray[O+3],M=4*(D+T+x);n[M+0]=R,n[M+1]=w,n[M+2]=E,n[M+3]=j}this.m_xDim=e,this.m_yDim=t,this.m_zDim=i,this.m_dataArray=n,this.m_dataSize=r}}}},{key:"render",value:function(){return Object(a.jsx)("p",{children:">"})}}]),i}(s.a.Component),rt=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,null,[{key:"getResultString",value:function(t){switch(t){case e.SUCCESS:return"Success";case e.UNKNOWN:return"Unknown";case e.BAD_DICOM:return"Bad Dicom";case e.BAD_HEADER:return"Bad header";case e.UNSUPPORTED_ENDIANNESS:return"Unsupported endianness";case e.UNSUPPORTED_COLOR_FORMAT:return"Unsupported color format";case e.WRONG_HEADER_DATA_SIZE:return"Wrong header data size";case e.WRONG_HEADER_DIMENSIONS:return"Wrong header dimensions";case e.WRONG_HEADER_DATA_TYPE:return"Wrong header data type";case e.WRONG_HEADER_BITS_PER_PIXEL:return"Wrong header bits per pixel";case e.WRONG_HEADER_MAGIC:return"Wrong header magic";case e.ERROR_PROCESS_HISTOGRAM:return"Wrong histogram";case e.WRONG_IMAGE_DIM_X:return"Wrong image dim x";case e.WRONG_IMAGE_DIM_Y:return"Wrong image dim y";case e.WRONG_IMAGE_DIM_Z:return"Wrong image dim z";case e.ERROR_PIXELS_TAG_NOT_FOUND:return"Pixels tag is not found";case e.ERROR_NO_MEMORY:return"No memory during loading";case e.ERROR_CANT_OPEN_URL:return"Cant open file via url";case e.ERROR_WRONG_NUM_SLICES:return"Wrong number of slices";case e.ERROR_HISTOGRAM_DETECT_RIDGES:return"Error detect histogram ridges";case e.ERROR_SCALING:return"Error scaling 16 bit data into 8 bit";case e.ERROR_INVALID_SLICE_INDEX:return"Invalid slice index. Possible reason: incomplete dicom folder";case e.ERROR_TOO_SMALL_DATA_SIZE:return"Too small input data size";case e.ERROR_TOO_LARGE_DATA_SIZE:return"Too large input data size";case e.ERROR_COMPRESSED_IMAGE_NOT_SUPPORTED:return"Compressed image formats read is not supported";default:return"Unknown error code"}}}]),e}();rt.SUCCESS=0,rt.UNKNOWN=1,rt.BAD_DICOM=2,rt.BAD_HEADER=3,rt.UNSUPPORTED_ENDIANNESS=4,rt.UNSUPPORTED_COLOR_FORMAT=5,rt.WRONG_HEADER_DATA_SIZE=6,rt.WRONG_HEADER_DIMENSIONS=7,rt.WRONG_HEADER_DATA_TYPE=8,rt.WRONG_HEADER_BITS_PER_PIXEL=9,rt.WRONG_HEADER_MAGIC=10,rt.ERROR_PROCESS_HISTOGRAM=11,rt.WRONG_IMAGE_DIM_X=12,rt.WRONG_IMAGE_DIM_Y=13,rt.ERROR_PIXELS_TAG_NOT_FOUND=14,rt.ERROR_NO_MEMORY=15,rt.ERROR_CANT_OPEN_URL=16,rt.ERROR_WRONG_NUM_SLICES=17,rt.ERROR_HISTOGRAM_DETECT_RIDGES=18,rt.ERROR_SCALING=19,rt.ERROR_INVALID_SLICE_INDEX=20,rt.ERROR_TOO_SMALL_DATA_SIZE=21,rt.ERROR_TOO_LARGE_DATA_SIZE=22,rt.ERROR_COMPRESSED_IMAGE_NOT_SUPPORTED=23;var st,ot=null,nt=function(){function e(t){Object(u.a)(this,e),ot||(ot=this),this.m_url=t,this.m_request=null,this.readFile=this.readFile.bind(this)}return Object(h.a)(e,[{key:"readFile",value:function(e,t){var i=this;if(this.m_request=new XMLHttpRequest,this.m_request||console.log("Cant create object request"),!("withCredentials"in this.m_request))return this.m_request=null,void console.log("This browser cant support CORS requests");this.m_request.open("GET",this.m_url,!0),this.m_request.responseType="arraybuffer",this.m_request.addEventListener("load",(function(t){var i=t.target.response;if(null===i)console.log("Bad response type. Expect object type in response.");else if(e){var a=new TextDecoder("utf-8"),r=i.byteLength;r>4e3&&(r=4e3);var s=i.slice(0,r),o=a.decode(s);"<!DOCTYPE"===o.substr(0,9)&&console.log("Error load data from URL. Read result is "+o),e(i)}}),!1),this.m_request.addEventListener("error",(function(){var e="Error accessing file ".concat(i.m_url);t(e)}),!1),this.m_request.send();if(404===this.m_request.status){var a="Cant access url =  ".concat(this.m_url);t(a)}}}]),e}(),lt=6403,mt=6407,ut=6408,ht=function(){function e(){Object(u.a)(this,e),this.m_header={m_id:"",m_endianness:0,m_glType:0,m_glTypeSize:0,m_glFormat:0,m_glInternalFormat:0,m_glBaseInternalFormat:0,m_pixelWidth:0,m_pixelHeight:0,m_pixelDepth:0,m_numberOfArrayElements:0,m_numberOfFaces:0,m_numberOfMipmapLevels:0,m_bytesOfKeyValueData:0},this.m_boxSize={x:0,y:0,z:0}}return Object(h.a)(e,[{key:"readFromBuffer",value:function(t,i,a,r){var s=new Uint8Array(i),o=0;if(void 0!==a&&a(0),0===s.length)return void 0!==r&&r(rt.BAD_HEADER),rt.BAD_HEADER;var n,l=[171,75,84,88,32,49,49,187,13,10,26,10],m=l.length,u=!0;for(n=0;n<m;n++){if(s[o]!==l[n]){u=!1;break}this.m_header.m_id+=String.fromCharCode(s[o]),o+=1}if(!u)return console.log("KTX HEADER IS WRONG"),void 0!==r&&r(rt.BAD_HEADER),rt.BAD_HEADER;var h=67305985;if(this.m_header.m_endianness=e.readInt(s,o),o+=4,this.m_header.m_endianness!==h){var c=this.m_header.m_endianness.toString(16);return console.log("ENDIANNESS IS WRONG. Found = ".concat(c," , but should be = ").concat(h.toString(16))),void 0!==r&&r(rt.UNSUPPORTED_ENDIANNESS),rt.UNSUPPORTED_ENDIANNESS}if(this.m_header.m_glType=e.readInt(s,o),o+=4,this.m_header.m_glTypeSize=e.readInt(s,o),o+=4,this.m_header.m_glFormat=e.readInt(s,o),o+=4,this.m_header.m_glFormat!==lt&&this.m_header.m_glFormat!==mt&&this.m_header.m_glFormat!==ut)return console.log("KTX header.m_glFormat is WRONG"),void 0!==r&&r(rt.UNSUPPORTED_COLOR_FORMAT),rt.UNSUPPORTED_COLOR_FORMAT;this.m_header.m_glInternalFormat=e.readInt(s,o),o+=4,this.m_header.m_glBaseInternalFormat=e.readInt(s,o),o+=4,this.m_header.m_pixelWidth=e.readInt(s,o),o+=4,this.m_header.m_pixelHeight=e.readInt(s,o),o+=4,this.m_header.m_pixelDepth=e.readInt(s,o),o+=4,t.m_xDim=this.m_header.m_pixelWidth,t.m_yDim=this.m_header.m_pixelHeight,t.m_zDim=this.m_header.m_pixelDepth;var d=this.m_header,_=8192;if(d.m_pixelWidth<4||d.m_pixelHeight<4||d.m_pixelDepth<4)return console.log("KTX dims too small: ".concat(d.m_pixelWidth," * ").concat(d.m_pixelHeight," * ").concat(d.m_pixelDepth)),void 0!==r&&r(rt.WRONG_IMAGE_DIM_X),rt.WRONG_IMAGE_DIM_X;if(d.m_pixelWidth>_||d.m_pixelHeight>_||d.m_pixelDepth>_)return console.log("KTX dims too large: ".concat(d.m_pixelWidth," * ").concat(d.m_pixelHeight," * ").concat(d.m_pixelDepth)),void 0!==r&&r(rt.WRONG_IMAGE_DIM_X),rt.WRONG_IMAGE_DIM_X;this.m_header.m_numberOfArrayElements=e.readInt(s,o),o+=4,this.m_header.m_numberOfFaces=e.readInt(s,o),o+=4,this.m_header.m_numberOfMipmapLevels=e.readInt(s,o),o+=4,this.m_header.m_bytesOfKeyValueData=e.readInt(s,o),o+=4;var f=0;if(this.m_header.m_glFormat===lt?f=1:this.m_header.m_glFormat===mt?f=3:this.m_header.m_glFormat===ut&&(f=4),this.m_header.m_bytesOfKeyValueData>0){var v,p,g,S,x,b,y=o;for(o+=this.m_header.m_bytesOfKeyValueData;y<o;){var T="",D=void 0;for(D=s[y+=4];0!==D;y++)0!==(D=s[y])&&(T=T.concat(String.fromCharCode(D)));if(console.log("UDataString = ".concat(T)),"fBoxMin"===T)v=e.readFloat(s,y),y+=4,p=e.readFloat(s,y),y+=4,g=e.readFloat(s,y),y+=4,console.log("vBoxMix = ".concat(v," * ").concat(p," * ").concat(g));else if("fBoxMax"===T){S=e.readFloat(s,y),y+=4,x=e.readFloat(s,y),y+=4,b=e.readFloat(s,y),y+=4,this.m_boxSize.x=S-v,this.m_boxSize.y=x-p,this.m_boxSize.z=b-g,console.log("vBox = ".concat(this.m_boxSize.x," * ").concat(this.m_boxSize.y," * ").concat(this.m_boxSize.z));break}}}this.m_dataSize=e.readInt(s,o),o+=4;var O,R=this.m_header.m_pixelWidth*this.m_header.m_pixelHeight*this.m_header.m_pixelDepth*f;if(this.m_dataSize!==R)return console.log("!!! not implemented yet"),void 0!==r&&r(rt.WRONG_HEADER_DATA_SIZE),rt.WRONG_HEADER_DATA_SIZE;this.m_dataArray=new Uint8Array(this.m_dataSize);var w=!1;for(O=29;O>=0&&!w;O--){1<<O<this.m_dataSize&&(w=!0)}O++;(O-=3)<=0&&(O=1);for(var E=(1<<O)-1,j=0;j<this.m_dataSize;j++){if(this.m_dataArray[j]=s[o],o+=1,void 0!==a&&0===(j&E)&&j>0)a(j/this.m_dataSize)}if(0===this.m_boxSize.x){var M=.3;this.m_boxSize.x=M*this.m_header.m_pixelWidth,this.m_boxSize.x=M*this.m_header.m_pixelWidth,this.m_boxSize.y=M*this.m_header.m_pixelHeight,this.m_boxSize.z=M*this.m_header.m_pixelDepth,console.log("vBox = ".concat(this.m_boxSize.x," * ").concat(this.m_boxSize.y," * ").concat(this.m_boxSize.z))}return t.m_bytesPerVoxel=f,t.m_dataArray=this.m_dataArray,t.m_dataSize=this.m_dataSize,t.m_boxSize=this.m_boxSize,console.log("KTX Loaded successfully with dim = ".concat(t.m_xDim,"*").concat(t.m_yDim,"*").concat(t.m_zDim,". bpp=").concat(t.m_bytesPerVoxel)),this.m_isLoadedSuccessfull=!0,void 0!==a&&a(1),void 0!==r&&r(rt.SUCCESS),rt.SUCCESS}},{key:"readFromUrl",value:function(e,t,i,a){var r=this;console.log("LoadedKtx. staring read ".concat(t)),this.m_fileLoader=new nt(t),this.m_fileLoader.readFile((function(t){r.readFromBuffer(e,t,i,a)}),(function(e){console.log("LoaderKtx. Error read file: ".concat(e)),a(rt.ERROR_CANT_OPEN_URL,null,0,null)}))}}],[{key:"readInt",value:function(e,t){for(var i=0,a=0;a<4;a++){i=(i<<8)+e[t+3-a]}return i}},{key:"readFloat",value:function(e,t){var i=new ArrayBuffer(4),a=new DataView(i);a.setUint8(0,e[t+0]),a.setUint8(1,e[t+1]),a.setUint8(2,e[t+2]),a.setUint8(3,e[t+3]);return a.getFloat32(0,!0)}}]),e}(),ct=function(){function e(){Object(u.a)(this,e),this.m_mouseDown=!1,this.m_indexMoved=-1,this.m_numHandles=10,this.m_handleColors=[{r:0,g:0,b:0},{r:255,g:128,b:64},{r:255,g:0,b:0},{r:128,g:64,b:64},{r:128,g:0,b:0},{r:64,g:64,b:64},{r:128,g:128,b:128},{r:192,g:192,b:192},{r:255,g:255,b:255},{r:255,g:255,b:255}],this.m_handleX=[0,22,40,55,61,115,118,125,160,255],this.m_handleY=[0,0,.3,.12,0,0,.4,.8,.95,1],this.m_proj=[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}],this.m_handleColors.length!==this.m_numHandles&&console.log("Wrong array this.m_handleColors: ".concat(this.m_handleColors.length," !== ").concat(this.m_numHandles))}return Object(h.a)(e,[{key:"render",value:function(e,t,i,a,r){this.m_xMin=t,this.m_yMin=i,this.m_wScreen=a,this.m_hScreen=r;var s,o,n=Math.floor(a/50);this.m_radCircle=n,e.lineWidth=1,e.strokeStyle="#000000",s=-1,o=-1;for(var l=0;l<this.m_numHandles;l++){var m=this.m_handleX[l],u=this.m_handleY[l],h=t+Math.floor(a*m/255),c=i+Math.floor(r-1-r*u/1);this.m_proj[l].x=h,this.m_proj[l].y=c,l>0&&(e.beginPath(),e.moveTo(s,o),e.lineTo(h,c),e.stroke()),s=h,o=c}for(var d=0;d<this.m_numHandles;d++){var _=this.m_handleX[d],f=this.m_handleY[d],v=t+Math.floor(a*_/255),p=i+Math.floor(r-1-r*f/1),g=this.m_handleColors[d].r.toString(16),S=this.m_handleColors[d].g.toString(16),x=this.m_handleColors[d].b.toString(16);g=1===g.length?"0"+g:g,S=1===S.length?"0"+S:S,x=1===x.length?"0"+x:x;var b="#".concat(g).concat(S).concat(x);e.fillStyle=b,e.beginPath(),e.ellipse(v,p,n,n,0,0,2*Math.PI),e.fill(),e.stroke()}}},{key:"onMouseDown",value:function(e,t){for(var i=0;i<this.m_numHandles;i++){var a=e-this.m_proj[i].x,r=t-this.m_proj[i].y;a*a+r*r<=this.m_radCircle*this.m_radCircle&&(console.log("Picked point ".concat(i)),this.m_mouseDown=!0,this.m_indexMoved=i)}return!1}},{key:"onMouseUp",value:function(){return this.m_mouseDown=!1,!1}},{key:"onMouseMove",value:function(e,t){if(this.m_mouseDown){var i,a;i=0===this.m_indexMoved||this.m_indexMoved===this.m_numHandles-1?this.m_proj[this.m_indexMoved].x:(i=(i=e)<this.m_proj[this.m_indexMoved-1].x?this.m_proj[this.m_indexMoved-1].x:i)>this.m_proj[this.m_indexMoved+1].x?this.m_proj[this.m_indexMoved+1].x:i,(a=t)<this.m_yMin&&(a=this.m_yMin),a>this.m_yMin+this.m_hScreen&&(a=this.m_yMin+this.m_hScreen),this.m_proj[this.m_indexMoved].x=i,this.m_proj[this.m_indexMoved].y=a;var r=255*(i-this.m_xMin)/this.m_wScreen,s=1*(this.m_yMin+this.m_hScreen-1-a)/this.m_hScreen;return this.m_handleX[this.m_indexMoved]=r,this.m_handleY[this.m_indexMoved]=s,!0}return!1}}]),e}(),dt=function(e){Object(S.a)(i,e);var t=Object(x.a)(i);function i(e){var a;return Object(u.a)(this,i),(a=t.call(this,e)).m_histogram=[],a.m_numColors=0,a.m_transfFunc=new ct,a.m_transfFuncCallback=void 0,a.m_transfFuncUpdateCallback=void 0,a.setSize=a.setSize.bind(Object(g.a)(a)),a.onMouseDown=a.onMouseDown.bind(Object(g.a)(a)),a.onMouseUp=a.onMouseUp.bind(Object(g.a)(a)),a.onMouseMove=a.onMouseMove.bind(Object(g.a)(a)),a.state={width:0,height:220},a}return Object(h.a)(i,[{key:"componentDidMount",value:function(){this.updateCanvas(),window.addEventListener("resize",this.handleResize,!1),this.setSize()}},{key:"componentDidUpdate",value:function(){this.updateCanvas(),window.removeEventListener("resize",this.handleResize,!1)}},{key:"handleResize",value:function(){this.setSize()}},{key:"setSize",value:function(){var e=this.m_canvasOwner;if(e){var t=e.clientWidth-2,i=e.clientHeight-2;this.setState({width:t}),this.setState({height:i})}}},{key:"getVolumeHistogram",value:function(e){var t,i=e.m_xDim,a=e.m_yDim,r=e.m_zDim,s=e.m_dataArray,o=i*a*r;for(this.m_numColors=256,this.m_histogram=new Array(this.m_numColors),t=0;t<this.m_numColors;t++)this.m_histogram[t]=0;for(t=0;t<o;t++){var n=s[t];this.m_histogram[n]++}var l=0;for(t=0;t<this.m_numColors;t++)l=this.m_histogram[t]>l?this.m_histogram[t]:l;var m=1/(l+=.001);for(t=0;t<this.m_numColors;t++)this.m_histogram[t]*=m;this.smoothHistogram(),this.getMaxPeak()}},{key:"assignArray",value:function(e,t){this.m_numColors=e,this.m_histogram=t}},{key:"getLastMaxIndex",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,i=4,a=!1;for(e=this.m_numColors-i;e>i;e--)if(this.m_histogram[e]>t&&this.m_histogram[e]>this.m_histogram[e-2]&&this.m_histogram[e]>this.m_histogram[e+2]){a=!0;break}return a?e:(console.log("getLastMaxIndex. Not found!"),-1)}},{key:"getMaxPeak",value:function(){var e;this.m_peakIndex=-1;var t=this.m_histogram,i=0;for(e=this.m_numColors-4;e>12;e--)if(t[e]>t[e-1]&&t[e]>t[e+1]&&t[e]>t[e-2]&&t[e]>t[e+2]){var a=t[e];a>i&&(i=a,this.m_peakIndex=e)}}},{key:"smoothHistogram",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1.2,t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=60,a=Math.floor(this.m_numColors/i),r=32;a>r&&(a=r);var s,o=1/(2*e*e),n=new Array(this.m_numColors),l=0;for(s=0;s<this.m_numColors;s++){for(var m=0,u=0,h=-a;h<=a;h++){var c=s+h,d=h/a,_=Math.exp(-d*d*o);c>=0&&c<this.m_numColors&&(m+=this.m_histogram[c]*_,u+=_)}l=(m/=u)>l?m:l,n[s]=m}if(t)for(s=0;s<this.m_numColors;s++)this.m_histogram[s]=n[s]/l;else for(s=0;s<this.m_numColors;s++)this.m_histogram[s]=n[s]}},{key:"onMouseDown",value:function(e){if(void 0!==this.m_transfFuncCallback&&void 0!==this.m_transfFuncUpdateCallback){var t=this.refs.canvasHistogram.getBoundingClientRect(),i=e.clientX-t.left,a=e.clientY-t.top;this.m_transfFunc.onMouseDown(i,a)&&this.forceRender()}}},{key:"onMouseUp",value:function(e){if(void 0!==this.m_transfFuncCallback&&void 0!==this.m_transfFuncUpdateCallback){var t=this.refs.canvasHistogram.getBoundingClientRect(),i=e.clientX-t.left,a=e.clientY-t.top;this.m_transfFunc.onMouseUp(i,a)&&this.forceRender()}}},{key:"onMouseMove",value:function(e){if(void 0!==this.m_transfFuncCallback&&void 0!==this.m_transfFuncUpdateCallback){var t=this.refs.canvasHistogram.getBoundingClientRect(),i=e.clientX-t.left,a=e.clientY-t.top;this.m_transfFunc.onMouseMove(i,a)&&this.forceRender()}}},{key:"updateCanvas",value:function(){if(void 0!==this.refs.canvasHistogram){var e=this.refs.canvasHistogram.getContext("2d"),t=this.refs.canvasHistogram.clientWidth,i=this.refs.canvasHistogram.clientHeight;e.fillStyle="rgb(220, 220, 220)",e.fillRect(0,0,t,i);var a=this.props.volume;null!==a&&this.getVolumeHistogram(a);var r=Math.floor(.01*t),s=Math.floor(.99*t),o=Math.floor(.05*i),n=Math.floor(.95*i),l=s-r,m=n-o;e.lineWidth=1,e.strokeStyle="#0a0a0a",e.moveTo(r,n),e.lineTo(r,o),e.stroke(),e.moveTo(r,n),e.lineTo(s,n),e.stroke(),e.font="10px Arial",e.fillStyle="rgb(120, 20, 20)",e.textBaseline="top",e.textAlign="center";var u,h=1;this.m_peakIndex>0&&(h=(h=2*this.m_histogram[this.m_peakIndex])>1?1:h);var c,d,_;for(u=0;u<=4;u++){var f=r+Math.floor(l*u/4);e.moveTo(f,n),e.lineTo(f,n+6),e.stroke();var v=Math.floor(0+this.m_numColors*u/4);e.textAlign=0===u?"left":4===u?"right":"center",e.fillText(v.toString(),f,n+4)}for(e.lineWidth=2,e.strokeStyle="#080808",e.fillStyle="#707070",e.beginPath(),e.moveTo(r,n),c=0;c<this.m_numColors;c++){d=r+Math.floor(l*c/this.m_numColors);var p=this.m_histogram[c]/h;p=p>=1?1:p,_=n-Math.floor(m*p),e.lineTo(d,_)}if(_=n,e.lineTo(d,_),e.closePath(),e.fill(),this.m_peakIndex>0){e.lineWidth=1,e.strokeStyle="#eeeeee";var g=r+Math.floor(l*this.m_peakIndex/this.m_numColors),S=this.m_histogram[this.m_peakIndex]/h;S=S>=1?1:S;var x=n-Math.floor(m*S);e.beginPath(),e.setLineDash([5,15]),e.moveTo(g,x),x=n,e.lineTo(g,x),e.stroke(),e.setLineDash([])}void 0!==this.m_transfFuncCallback&&void 0!==this.m_transfFuncUpdateCallback&&this.m_transfFunc.render(e,r,o,l,m)}}},{key:"forceRender",value:function(){this.setState({state:this.state}),void 0!==this.m_transfFuncCallback&&this.m_transfFuncCallback(this.m_transfFunc)}},{key:"render",value:function(){var e=this,t=this.props.volume;if(void 0===t)return Object(a.jsx)("p",{children:"UiHistogram.props volume is not defined !!!"});if(null===t)return Object(a.jsx)("p",{children:"vol is null"});this.m_transfFuncCallback=this.props.transfFunc,this.m_transfFuncUpdateCallback=this.props.transfFuncUpdate;var i=this.state.width||200,r=this.state.height||200;return console.log(i,r),Object(a.jsx)("div",{ref:function(t){e.m_canvasOwner=t},children:Object(a.jsx)("canvas",{ref:"canvasHistogram",width:i,height:r,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onMouseMove:this.onMouseMove})})}}]),i}(s.a.Component),_t=!1,ft=255,vt=function(){function e(){Object(u.a)(this,e),this.m_littleEndian=!0,this.m_header={m_id:"",m_endianness:0,m_glType:0,m_glTypeSize:0,m_glFormat:0,m_glInternalFormat:0,m_glBaseInternalFormat:0,m_pixelWidth:0,m_pixelHeight:0,m_pixelDepth:0,m_numberOfArrayElements:0,m_numberOfFaces:0,m_numberOfMipmapLevels:0,m_bytesOfKeyValueData:0},this.m_xDim=0,this.m_yDim=0,this.m_zDim=0,this.phases=1,this.m_boxSize={x:0,y:0,z:0}}return Object(h.a)(e,[{key:"readIntFromBuffer",value:function(e,t){return this.m_littleEndian?e[t+0]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24:e[t+3]|e[t+2]<<8|e[t+1]<<16|e[t+0]<<24}},{key:"readShortFromBuffer",value:function(e,t){return this.m_littleEndian?e[t+0]|e[t+1]<<8:e[t+1]|e[t+0]<<8}},{key:"readFloatFromBuffer",value:function(e,t){var i=new ArrayBuffer(4),a=new DataView(i);return a.setUint8(0,e[t+0]),a.setUint8(1,e[t+1]),a.setUint8(2,e[t+2]),a.setUint8(3,e[t+3]),a.getFloat32(0,this.m_littleEndian)}},{key:"readFromBuffer",value:function(e,t,i,a){var r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=new Uint8Array(t),o=s.length;if(null!==r&&r.length!==o)throw new Error("check your input arrays");var n=8,l=348,m=19,u=108,h=this.readFloatFromBuffer(s,u);console.log(h);var c=83886080*m+h;if(o<n)return a&&a(rt.ERROR_TOO_SMALL_DATA_SIZE,null,0,null),!1;if(o>c)return a&&a(rt.ERROR_TOO_LARGE_DATA_SIZE,null,0,null),!1;if(o<l)return console.error("Nifti header too small"),a&&a(rt.BAD_HEADER,null,0,null),!1;var d=4,_=2,f=0,v=this.readIntFromBuffer(s,f);if(v>2<<24&&(this.m_littleEndian=!1,v=this.readIntFromBuffer(s,f)),f+=d,v!==l)return console.error("Nifti first int wrong: ".concat(v,", but should be ").concat(l)),a&&a(rt.BAD_HEADER,null,0,null),!1;f+=10,f+=18,f+=d,f+=_,f+=1,f+=1;var p=this.readShortFromBuffer(s,f);f+=_;var g=3;if(p<g)return console.error("Nifti header wrong num dimensions: ".concat(p,", but should be at least 3")),a&&a(rt.WRONG_HEADER_DIMENSIONS,null,0,null),!1;if(this.m_xDim=this.readShortFromBuffer(s,f),f+=_,this.m_yDim=this.readShortFromBuffer(s,f),f+=_,this.m_zDim=this.readShortFromBuffer(s,f),f+=_,4===p){this.phases=this.readShortFromBuffer(s,f),f+=_;this.readShortFromBuffer(s,f);f+=6}else f+=8;f+=d,f+=d,f+=d,f+=_;var S=this.readShortFromBuffer(s,f);f+=_;var x=this.readShortFromBuffer(s,f);f+=_;this.readShortFromBuffer(s,f);var b=2,y=4,T=16,D=256,O=512,R=0;if(R|=S===b,R|=S===y,R|=S===T,R|=S===D,!(R|=S===O))return console.error("Nifti header read. This data type (".concat(S,") is not supported")),a&&a(rt.WRONG_HEADER_DATA_TYPE,null,0,null),!1;var w=8,E=16,j=32,M=x===w|x===E|x===j;if(!M)return console.error("Nifti wrong bitPix: ".concat(x,", but should be 8,16 or 32")),a&&a(rt.WRONG_HEADER_BITS_PER_PIXEL,null,0,null),!1;f+=_;var A=this.readFloatFromBuffer(s,f);f+=d;var I=this.readFloatFromBuffer(s,f);f+=d;var C=this.readFloatFromBuffer(s,f);f+=d;this.readFloatFromBuffer(s,f);f+=d;this.readFloatFromBuffer(s,f);s[f+=31];this.m_boxSize.x=this.m_xDim*A,this.m_boxSize.y=this.m_yDim*I,this.m_boxSize.z=this.m_zDim*C;var X=1e-5;if(this.m_boxSize.x<X){var F=312;this.m_boxSize.x=F,this.m_boxSize.y=F,this.m_boxSize.z=F}var k=110,U=43,N=49,V=s[(f=l-d)+0]===k&&s[f+1]===U&&s[f+2]===N;if(!V)return console.error("Nifti hdr bad magic: ".concat(s[f+0],", ").concat(s[f+1],", ").concat(s[f+2])),a&&a(rt.WRONG_HEADER_MAGIC,null,0,null),!1;f+=d;var L,P,B=this.m_xDim*this.m_yDim*this.m_zDim,z=B*this.phases,G=h,W=(o-G)/this.phases,H=new Array(this.phases),q=9,Y=Array(this.phases).fill(0);if(P=0,S===y||S===O)for(var Z=0;Z<this.phases;Z++)for(P=Z*W,L=0;L<z;L++){var K=this.readShortFromBuffer(s,G+P);if(P+=2,K>Y[Z]&&(Y[Z]=K),i&&z%(4*P)===0){var Q=P/z/4;_t,i(Q)}}if(S===T)for(var J=0;J<this.phases;J++)for(P=J*W,L=0;L<z;L++){var $=this.readFloatFromBuffer(s,G+P),ee=Math.floor($)+1;if(P+=4,ee>Y[J]&&(Y[J]=ee),i&&z%(4*P)===0){var te=P/z/4;_t,i(te)}}for(var ie=[],ae=0;ae<this.phases;ae++)for(ie[ae]=new Float32Array(Y[ae]+1),L=0;L<Y[ae]+1;L++)ie[ae][L]=0;if(P=0,S===y||S===O)for(var re=0;re<this.phases;re++)for(P=re*W,L=0;L<B;L++){var se=this.readShortFromBuffer(s,G+P);P+=2,ie[re][se]++}if(S===T)for(var oe=0;oe<this.phases;oe++)for(P=oe*W,L=0;L<B;L++){var ne=Math.floor(this.readFloatFromBuffer(s,G+P));P+=4,ie[oe][ne]++}var le=4,me=new Array(this.phases);if(S===y||S===O)for(var ue=0;ue<this.phases;ue++){me[ue]=new dt,me[ue].assignArray(Y[ue],ie[ue]);var he=.8,ce=!1;me[ue].smoothHistogram(he,ce);var de=4,_e=me[ue].getLastMaxIndex(de);if(_e<4&&(_e=Y[ue]),H[ue]=(ft<<q)/_e,H[ue]<=le)return console.error("Bad scaling: image will be 0"),a&&a(rt.ERROR_PROCESS_HISTOGRAM,null,0,null),!1}for(var fe=8,ve=z*(x/fe),pe=[],ge=0;ge<this.phases;ge++)pe[ge]=new Uint8Array(B);if(L=0,P=0,S===y||S===O)for(var Se=0;Se<this.phases;Se++)for(P=Se*W,L=0;L<z;L++){var xe=this.readShortFromBuffer(s,G+P);if(P+=2,xe=(xe=xe*H[Se]>>q)<=ft?xe:ft,pe[Se][L]=xe,i&&z%(4*P)===0){var be=.5+P/z/2;_t,i(be)}}else{if(S!==D&&S!==b)throw new Error("BAD input dataType");for(var ye=0;ye<this.phases;ye++)for(P=ye*W,L=0;L<B;L++,P++){var Te=s[G+P];if(Te*=85,pe[ye][L]=Te,i&&z%(4*P)===0){var De=.5+P/z/2;_t,i(De)}}}for(var Oe,Re,we,Ee=this.m_xDim*this.m_yDim,je=0*Ee,Me=(this.m_zDim-1)*Ee,Ae=0,Ie=this.m_xDim-1,Ce=0,Xe=(this.m_yDim-1)*this.m_xDim,Fe=0;Fe<this.phases;Fe++){for(Re=0;Re<this.m_yDim;Re++){var ke=Re*this.m_xDim;for(Oe=0;Oe<this.m_xDim;Oe++){var Ue=void 0;Ue=je+ke+Oe,pe[Fe][Ue]=0,Ue=Me+ke+Oe,pe[Fe][Ue]=0}}for(we=0;we<this.m_zDim;we++){var Ne=we*Ee;for(Re=0;Re<this.m_yDim;Re++){var Ve=void 0;Ve=Ne+Re*this.m_xDim+Ae,pe[Fe][Ve]=0,Ve=Ne+Re*this.m_xDim+Ie,pe[Fe][Ve]=0}}for(we=0;we<this.m_zDim;we++){var Le=we*Ee;for(Oe=0;Oe<this.m_xDim;Oe++){var Pe=void 0;Pe=Le+Ce+Oe,pe[Fe][Pe]=0,Pe=Le+Xe+Oe,pe[Fe][Pe]=0}}}for(var Be=0;Be<this.phases;Be++){e[Be].m_xDim=this.m_xDim,e[Be].m_yDim=this.m_yDim,e[Be].m_zDim=this.m_zDim;var ze=1;e[Be].m_bytesPerVoxel=ze,e[Be].m_dataArray=pe[Be],e[Be].m_dataSize=B,e[Be].m_boxSize=this.m_boxSize,e[Be].m_phase=Be}var Ge=6403,We=5121,He={m_pixelWidth:this.m_xDim,m_pixelHeight:this.m_yDim,m_pixelDepth:this.m_zDim,m_glType:We,m_glTypeSize:1,m_glFormat:Ge,m_glInternalFormat:Ge,m_glBaseInternalFormat:Ge};return i&&i(1),a&&a(rt.SUCCESS,He,ve,pe),!0}},{key:"readFromUrl",value:function(e,t,i,a){var r=this;return this.m_fileLoader=new nt(t),this.m_fileLoader.readFile((function(t){return r.readFromBuffer(e,t,i,a)}),(function(e){a(rt.ERROR_CANT_OPEN_URL,null,0,null)})),!0}}]),e}(),pt=function(){function e(){Object(u.a)(this,e),this.TAGS=[[2,0,"OB","FileMetaInfoGroupLength"],[2,1,"OB","FileMetaInformationVersion"],[2,2,"UI","MediaStoredSOPClassUID"],[2,3,"UI","MediaStoredSOPInstanceUID"],[2,16,"UI","TransferSyntaxUID"],[2,18,"UI","ImplementationClassUID"],[2,19,"UI","ImplementationVersionName"],[2,22,"UI","SourceApplicationEntityTitle"],[2,256,"UI","PrivateInformationCreatorUID"],[2,258,"UI","PrivateInformation"],[8,0,"UL","IdentifyingGroupLength"],[8,1,"UI","LengthToEnd"],[8,5,"CS","SpecificCharacterSet"],[8,6,"SQ","LanguageCodeSequence"],[8,8,"CS","ImageType"],[8,16,"SH","RecognitionCode"],[8,18,"DA","InstanceCreationDate"],[8,19,"TM","InstanceCreationTime"],[8,20,"UI","InstanceCreatorUID"],[8,22,"UI","SOPClassUID"],[8,24,"UI","SOPInstanceUID"],[8,26,"UI","RelatedGeneralSOPClassUID"],[8,27,"UI","OriginalSpecializedSOPClassUID"],[8,32,"DA","StudyDate"],[8,33,"DA","SeriesDate"],[8,34,"DA","AcquisitionDate"],[8,35,"DA","ContentDate"],[8,36,"DA","OverlayDate"],[8,37,"DA","CurveDate"],[8,42,"DT","AcquisitionDateTime"],[8,48,"TM","StudyTime"],[8,49,"TM","SeriesTime"],[8,50,"TM","AcquisitionTime"],[8,51,"TM","ContentTime"],[8,52,"TM","OverlayTime"],[8,53,"TM","CurveTime"],[8,64,"US","DataSetType"],[8,65,"LO","DataSetSubtype"],[8,66,"CS","NuclearMedicineSeriesType"],[8,80,"SH","AccessionNumber"],[8,81,"SQ","IssuerOfAccessionNumberSequence"],[8,82,"CS","QueryRetrieveLevel"],[8,84,"AE","RetrieveAETitle"],[8,86,"CS","InstanceAvailability"],[8,88,"UI","FailedSOPInstanceUIDList"],[8,96,"CS","Modality"],[8,112,"XX","Manufacturer"],[8,128,"XX","InstitutionName"],[8,129,"XX","InstitutionAddress"],[8,144,"XX","ReferringPhysicansName"],[8,4112,"XX","StationName"],[8,4144,"XX","StudyDescription"],[8,4158,"LO","SeriesDescription"],[8,4160,"XX","InstitutionDepartmentName"],[8,4176,"XX","PerformingPhysicansName"],[8,4192,'"XX','"Unkown'],[8,4224,"XX","AdmittingDiagnosesDescription"],[8,4240,"XX","ManufacturterModelName"],[8,4369,"XX","ReferencedPerformedProcStepSeq"],[8,4416,"XX","ReferencedImageSequence"],[8,4432,"UI","ReferencedSOP\u200bClassUID"],[8,4437,"UI","ReferencedSOP\u200bInstanceUID"],[8,8465,'"XX','"DerivationDescription'],[8,8466,'"XX','"SourceImageSequence'],[9,16,"LO","PrivateCreator"],[9,17,"??",'"Unknown'],[9,18,"??",'"Unknown'],[9,4097,"XX","PrivateTag"],[9,4098,"XX","PrivateTag"],[9,4100,"XX","PrivateTag"],[9,4135,"XX","PrivateTag"],[9,4144,"XX","PrivateTag"],[9,4145,"XX","PrivateTag"],[9,4323,"XX","PrivateTag"],[9,4329,"XX","PrivateTag"],[16,0,"UL","PatientGroupLength"],[16,16,"PN","PatientName"],[16,32,"LO","PatientID"],[16,33,"LO","IssuerOfPatientID"],[16,34,"CS","TypeOfPatientID"],[16,36,"SQ","IssuerOfPatientIDQualifiersSequence"],[16,48,"DA","PatientBirthDate"],[16,50,"TM","PatientBirthTime"],[16,64,"CS","PatientGender"],[16,80,"SQ","PatientInsurancePlanCodeSequence"],[16,257,"SQ","PatientPrimaryLanguageCodeSequence"],[16,258,"SQ","PatientPrimaryLanguageModifierCodeSequence"],[16,4096,"LO","OtherPatientIDs"],[16,4097,"PN","OtherPatientNames"],[16,4098,"SQ","OtherPatientIDsSequence"],[16,4101,"PN","PatientBirthName"],[16,4112,"AS","PatientAge"],[16,4128,"DS","PatientSize"],[16,4129,"SQ","PatientSizeCodeSequence"],[16,4144,"DS","PatientWeight"],[16,4160,"LO","PatientAddress"],[16,4176,"LO","InsurancePlanIdentification"],[16,4192,"PN","PatientMotherBirthName"],[16,4224,"LO","MilitaryRank"],[16,4225,"LO","BranchOfService"],[16,4240,"LO","MedicalRecordLocator"],[16,8192,"LO","MedicalAlerts"],[16,8464,"LO","Allergies"],[16,8528,"LO","CountryOfResidence"],[16,8530,"LO","RegionOfResidence"],[16,8532,"SH","PatientTelephoneNumbers"],[16,8544,"SH","EthnicGroup"],[16,8576,"SH","Occupation"],[16,8608,"CS","SmokingStatus"],[16,8624,"LT","AdditionalPatientHistory"],[16,8640,"US","PregnancyStatus"],[16,8656,"DA","LastMenstrualDate"],[16,8688,"LO","PatientReligiousPreference"],[16,8705,"LO","PatientSpeciesDescription"],[16,8706,"SQ","PatientSpeciesCodeSequence"],[16,8707,"CS","PatientSexNeutered"],[16,8720,"CS","AnatomicalOrientationType"],[16,8850,"LO","PatientBreedDescription"],[16,8851,"SQ","PatientBreedCodeSequence"],[16,8852,"SQ","BreedRegistrationSequence"],[16,8853,"LO","BreedRegistrationNumber"],[16,8854,"SQ","BreedRegistryCodeSequence"],[16,8855,"PN","ResponsiblePerson"],[16,8856,"CS","ResponsiblePersonRole"],[16,8857,"LO","ResponsibleOrganization"],[16,16384,"LT","PatientComments"],[16,37937,"FL","ExaminedBodyThickness"],[24,0,"UL","AcquisitionGroupLength"],[24,32,"XX","ScanningSequence"],[24,33,"XX","SequenceVariant"],[24,34,"XX","ScanOptions"],[24,35,"XX","MrAcquisionType"],[24,36,"??",'"SequenceName'],[24,37,"XX","AngioFlag"],[24,80,"XX","SliceThickness"],[24,96,"DS","KVP"],[24,128,"XX","RepetitionTime"],[24,129,"XX","EchoTime"],[24,130,"XX","InversionTime"],[24,131,"XX","NumberOfAverages"],[24,132,"XX","ImagingFrequency"],[24,133,"XX","ImagedNucleus"],[24,134,"XX","EchoNumber"],[24,135,"XX","MagneticFieldStrength"],[24,136,"XX","SpacingBetweenSlices"],[24,137,"XX","NumberOfPhaseEncodingSteps"],[24,144,"XX","DataCollectionDiameter"],[24,145,"XX","EchoTrainLength"],[24,147,"XX","ProcentSampling"],[24,148,"XX","ProcentPhaseFieldOfView"],[24,149,"XX","PixelBandwidth"],[24,4096,"XX","DeviceSerialNumber"],[24,4098,"??","DeviceUID"],[24,4099,"??","DeviceID"],[24,4100,"??","PlateID"],[24,4101,"??","GeneratorID"],[24,4102,"??","GridID"],[24,4103,"??",'"CassetteID'],[24,4104,"??","GantryID"],[24,4112,"??","SecondaryCaptureDeviceID"],[24,4113,"??","HardcopyCreationDeviceID"],[24,4114,"??","DateOfSecondaryCapture"],[24,4116,"??","TimeOfSecondaryCapture"],[24,4118,"??","SecondaryCaptureDeviceManufacturer"],[24,4119,"??","HardcopyDeviceManufacturer"],[24,4120,"??","SecondaryCaptureDeviceModelName"],[24,4121,"??","SecondaryCaptureDeviceSoftwareVers"],[24,4122,"??","HardcopyDeviceSoftwareVersion"],[24,4123,"??","HardcopyDeviceModelName"],[24,4128,"XX","SoftwareVersions"],[24,4144,"XX","ProtocolName"],[24,4225,"XX",'"LowR-RValue'],[24,4226,"XX",'"HiR-RValue'],[24,4227,"XX",'"IntervalsAcquired'],[24,4228,"XX",'"IntervalsRejected'],[24,4232,"XX","HeartRate"],[24,4240,"XX","CardiacNumberOfImages"],[24,4244,"XX","TriggerWindow"],[24,4352,"XX","ReconstructionDiameter"],[24,4368,"XX","DistanceSourceToDetector"],[24,4369,"XX","DistanceSourceToPatient"],[24,4373,"XX","Unknown"],[24,4384,"XX","GantryDetectorTilt"],[24,4400,"XX","TableHeight"],[24,4416,"XX","RotationDirection"],[24,4432,"XX","ExposureTime"],[24,4433,"XX","XRayTubeCurrent"],[24,4434,"XX","Exposure"],[24,4446,"XX",'"Unknown'],[24,4448,"XX","FilterType"],[24,4452,"XX",'"unknown'],[24,4454,"XX",'"unknown'],[24,4456,"XX",'"unknown'],[24,4464,"XX","GeneratorPower"],[24,4480,"XX",'"Unknown'],[24,4496,"XX","FocalSpot"],[24,4624,"XX","ConvolutionKernel"],[24,4688,"XX","ReceiveCoilName"],[24,4880,"XX","AcquisionMatrix"],[24,4882,"XX","InPlanePhaseEncodingDirection"],[24,4884,"XX","FlipAngle"],[24,4885,"XX","VariableFlipAngleFlag"],[24,4886,"XX","SAR"],[24,5120,"XX","unknown"],[24,5632,"XX",'"ShutterShape'],[24,5634,"XX","ShutterLeftVerticalEdge"],[24,5636,"XX",'"ShutterRightVerticalEdge'],[24,5638,"XX",'"ShutterUpperHorizontalEdge'],[24,5640,"XX",'"ShutterLowerHorizontalEdge'],[24,5648,"XX",'"CenterOfCircularShutter'],[24,5650,"XX",'"RadiusOfCircularShutter'],[24,5664,"XX",'"VerticesOfPolygonalShutter'],[24,5666,"XX",'"ShutterPresentationValue'],[24,5667,"XX",'"ShutterOverlayGroup'],[24,5668,"XX",'"ShutterPresentationColorCIELabVal'],[24,5888,"XX","Unknown"],[24,5890,"XX","Unknown"],[24,5892,"XX","Unknown"],[24,5894,"XX","Unknown"],[24,5896,"XX","Unknown"],[24,16384,"XX",'"AcquisitionComments'],[24,20480,"XX","OutputPower"],[24,20512,"XX","Unknown"],[24,20513,"XX",'"Unknown'],[24,20736,"XX","PatientPosition"],[24,20737,"XX","ViewPosition"],[24,24576,"XX","Unknown"],[24,37633,"XX","CTAcquisitionTypeSequence"],[24,37634,"XX","AcquisitionType"],[24,37635,"XX","TubeAngle"],[24,37636,"XX","CTAcquisitionDetailsSequence"],[24,37637,"XX","RevolutionTime"],[24,37638,"XX","SingleCollimationWidth"],[24,37639,"XX","TotalCollimationWidth"],[24,37640,"XX","CTTableDynamicsSequence"],[24,37641,"XX","TableSpeed"],[24,37648,"XX","TableFeedPerRotation"],[24,37649,"XX","SpiralPitchFactor"],[24,37650,"XX","CTGeometrySequence"],[24,37651,"XX","DataCollectionCenterPatient"],[24,37652,"XX","CTReconstructionSequence"],[24,37653,"XX","ReconstructionAlgorithm"],[24,37654,"XX","ConvolutionKernelGroup"],[24,37655,"XX","ReconstructionFieldOfView"],[24,37656,"XX","ReconstructionTargetCenterPatient"],[24,37657,"XX","ReconstructionAngle"],[24,37664,"XX","ImageFilter"],[24,37665,"XX","CTExposureSequenc"],[24,37666,"XX","ReconstructionPixelSpacing"],[24,37667,"XX","ExposureModulationType"],[24,37668,"XX","EstimatedDoseSaving"],[24,37669,"XX","CTXRayDetailsSequence"],[24,37670,"XX","CTPositionSequence"],[24,37671,"XX","TablePosition"],[24,37672,"XX","ExposureTimeInMilliSec"],[24,37673,"XX","CTImageFrameTypeSequence"],[24,37680,"XX","XRayTubeCurrentInMilliAmps"],[25,16,"LO","PrivateCreator"],[25,4098,"XX","NumberOfCellsInDetector"],[25,4099,"XX","CellsNumberAtTheta"],[25,4100,"XX","CellsSpacing"],[25,4111,"XX","HorizFrameOfRef"],[25,4113,"XX","SeriesContrast"],[25,4114,"XX","LastPSeq"],[25,4115,"XX","StartNumberOfBaseLine"],[25,4116,"XX","EndNumberOfBaseLine"],[25,4117,"XX","StartNumberForEnchancedScans"],[25,4118,"XX","EndNumberForEnchancedScans"],[25,4119,"XX","SeriesPlane"],[25,4120,"XX","FirstScanRas"],[25,4121,"XX","FirstScanLocation"],[25,4122,"XX","LastScanRas"],[25,4123,"XX","LastScanLoc"],[25,4126,"XX","DisplayFieldOfView"],[25,4131,"XX","TableSpeed"],[25,4132,"XX","MidScanTime"],[25,4133,"XX","MidScanFlag"],[25,4134,"XX","DegreesOfAzimuth"],[25,4135,"XX","GantryPeriod"],[25,4138,"XX","XRayOnPosition"],[25,4139,"XX","XRayOffPosition"],[25,4140,"XX","NumberOfTriggers"],[25,4142,"XX","AngleOfFirstView"],[25,4143,"XX","TriggerFrequency"],[25,4153,"XX","ScanFovType"],[25,4160,"XX","StatReconFlag"],[25,4161,"XX","ComputeType"],[25,4162,"XX","SegmentNumber"],[25,4163,"XX","TotalSegmentsRequested"],[25,4164,"XX","InterscanDelay"],[25,4167,"XX","ViewCompressionFactor"],[25,4170,"XX","TotalNoOfRefChannels"],[25,4171,"XX","DataSizeForScanData"],[25,4178,"XX","ReconPostProcflag"],[25,4183,"XX","CTWaterNumber"],[25,4184,"XX","CTBoneNumber"],[25,4186,"XX","AcquisitionDuration"],[25,4190,"XX","NumberOfChannels"],[25,4191,"XX","IncrementBetweenChannels"],[25,4192,"XX","StartingView"],[25,4193,"XX","NumberOfViews"],[25,4194,"XX","IncrementBetweenViews"],[25,4202,"XX","DependantOnNoViewsProcessed"],[25,4221,"DS","SecondEcho"],[25,4222,"SS","NumberOfEchoes"],[25,4223,"DS","TableDelta"],[25,4225,"SS","Contiguous"],[25,4228,"DS","PeakSAR"],[25,4231,"DS","CardiacRepetitionTime"],[25,4232,"SS","ImagesPerCardiacCycle"],[25,4234,"SS","ActualReceiveGainAnalog"],[25,4235,"SS","ActualReceiveGainDigital"],[25,4237,"DS","DelayAfterTrigger"],[25,4239,"SS","Swappf"],[25,4240,"SS","PauseInterval"],[25,4241,"DS","PulseTime"],[25,4242,"SL","SliceOffsetOnFreqAxis"],[25,4243,"DS","CenterFrequency"],[25,4244,"SS","TransmitGain"],[25,4245,"SS","AnalogReceiverGain"],[25,4246,"SS","DigitalReceiverGain"],[25,4247,"SL","BitmapDefiningCVs"],[25,4251,"SS","PulseSeqMode"],[25,4252,"LO","PulseSeqName"],[25,4253,"DT","PulseSeqDate"],[25,4254,"LO","InternalPulseSeqName"],[25,4255,"SS","TransmittingCoil"],[25,4256,"SS","SurfaceCoilType"],[25,4257,"SS","ExtremityCoilFlag"],[25,4258,"SL","RawDataRunNumber"],[25,4259,"UL","CalibratedFieldStrength"],[25,4260,"SS","SATFatWaterBone"],[25,4263,"DS","UserData01"],[25,4264,"DS","UserData02"],[25,4265,"DS","UserData03"],[25,4266,"DS","UserData04"],[25,4267,"DS","UserData05"],[25,4268,"DS","UserData06"],[25,4269,"DS","UserData07"],[25,4270,"DS","UserData08"],[25,4271,"DS","UserData09"],[25,4272,"DS","UserData10"],[25,4273,"DS","UserData11"],[25,4274,"DS","UserData12"],[25,4275,"DS","UserData13"],[25,4276,"DS","UserData14"],[25,4277,"DS","UserData15"],[25,4278,"DS","UserData16"],[25,4279,"DS","UserData17"],[25,4280,"DS","UserData18"],[25,4281,"DS","UserData19"],[25,4282,"DS","UserData20"],[25,4283,"DS","UserData21"],[25,4284,"DS","UserData22"],[25,4285,"DS","UserData23"],[25,4286,"DS","ProjectionAngle"],[25,4288,"SS","SaturationPlanes"],[25,4290,"SS","SATLocationR"],[25,4291,"SS","SATLocationL"],[25,4292,"SS","SATLocationA"],[25,4293,"SS","SATLocationP"],[25,4294,"SS","SATLocationH"],[25,4295,"SS","SATLocationF"],[25,4296,"SS","SATThicknessR-L"],[25,4297,"SS","SATThicknessA-P"],[25,4298,"SS","SATThicknessH-F"],[25,4299,"SS","PrescribedFlowAxis"],[25,4300,"SS","VelocityEncoding"],[25,4301,"SS","ThicknessDisclaimer"],[25,4302,"SS","PrescanType"],[25,4303,"SS","PrescanStatus"],[25,4306,"SS","ProjectionAlgorithm"],[25,4307,"SH","ProjectionAlgorithm"],[25,4309,"SS","FractionalEcho"],[25,4311,"SS","CardiacPhases"],[25,4312,"SS","VariableEchoflag"],[25,4313,"DS","ConcatenatedSAT"],[25,4319,"DS","UserData"],[25,4320,"DS","UserData"],[25,4322,"DS","VelocityEncodeScale"],[25,4338,"SS","FastPhases"],[25,4345,"DS","TransmissionGain"],[32,0,"UL","RelationshipGroupLength"],[32,13,"UI","StudyInstanceID"],[32,14,"UI","SeriesInstanceID"],[32,16,"IS","StudyID"],[32,17,"IS","SeriesNumber"],[32,18,"IS","AcquisionNumber"],[32,19,"IS","ImageNumber"],[32,32,"IS","PatientOrientation"],[32,50,"DS","ImagePosition"],[32,55,"DS","ImageOrientation"],[32,64,"XX","PositionReferenceIndicator"],[32,65,"XX","SliceLocation"],[32,82,"UI","FrameOfRefefernceID"],[32,96,"XX","Laterality"],[32,4098,"XX","ImagesInAcquision"],[32,4160,"LO","PositionReferenceIndicator"],[32,4161,"DS","SliceLocation"],[32,36950,"XX","StackId"],[32,36951,"XX","InStackPositionNumber"],[33,16,"LO","PrivateCreator"],[33,4099,"XX","SeriesFromWhichPrescribed"],[33,4101,"XX","GenesisVersionNow"],[33,4103,"XX","SeriesRecordChecksum"],[33,4120,"XX","GenesisVersionNow"],[33,4121,"XX","AcqreconRecordChecksum"],[33,4128,"XX","TableStartLocation"],[33,4149,"XX","SeriesFromWhichPrescribed"],[33,4150,"XX","ImageFromWhichPrescribed"],[33,4151,"XX","ScreenFormat"],[33,4170,"XX","AnatomicalReferenceForScout"],[33,4175,"XX","LocationsInAcquisition"],[33,4176,"XX","GraphicallyPrescribed"],[33,4177,"XX","RotationFromSourceXRot"],[33,4178,"XX","RotationFromSourceYRot"],[33,4179,"XX","RotationFromSourceZRot"],[33,4180,"XX","ImagePosition"],[33,4181,"XX","ImageOrientation"],[33,4182,"XX","IntegerSlop"],[33,4183,"XX","IntegerSlop"],[33,4184,"XX","IntegerSlop"],[33,4185,"XX","IntegerSlop"],[33,4186,"XX","IntegerSlop"],[33,4187,"XX","FloatSlop"],[33,4188,"XX","FloatSlop"],[33,4189,"XX","FloatSlop"],[33,4190,"XX","FloatSlop"],[33,4191,"XX","FloatSlop"],[33,4225,"XX","AutoWindowLevelAlpha"],[33,4226,"XX","AutoWindowLevelBeta"],[33,4227,"XX","AutoWindowLevelWindow"],[33,4228,"XX","ToWindowLevelLevel"],[33,4240,"XX","TubeFocalSpotPosition"],[33,4241,"XX","BiopsyPosition"],[33,4242,"XX","BiopsyTLocation"],[33,4243,"XX","BiopsyRefLocation"],[35,16,"LO","PrivateCreator"],[35,4097,"XX","NumberOfSeriesInStudy"],[35,4098,"XX","NumberOfUnarchivedSeries"],[35,4112,"XX","ReferenceImageField"],[35,4176,"XX","SummaryImage"],[35,4208,"XX","StartTimeSecsInFirstAxial"],[35,4212,"SL","NoofUpdatesToHeader"],[35,4221,"SS","IndicatesIfTheStudyHasCompleteInfo"],[35,4224,"LO","CRFilmFormat"],[37,16,"LO","PrivateCreator"],[37,4102,"SS","LastPulseSequenceUsed"],[37,4103,"SL","ImagesInSeries"],[37,4112,"SL","LandmarkCounter"],[37,4113,"SS","NumberOfAcquisitions"],[37,4116,"SL","IndicatesNoofUpdatesToHeader"],[37,4119,"SL","SeriesCompleteFlag"],[37,4120,"SL","NumberOfImagesArchived"],[37,4121,"SL","LastImageNumberUsed"],[37,4122,"SH","PrimaryReceiverSuiteAndHost"],[37,4123,"OB","ProtocolDataBlock"],[39,16,"LO","PrivateCreator"],[39,4102,"XX","ImageArchiveFlag"],[39,4112,"XX","ScoutType"],[39,4124,"XX","VmaMamp"],[39,4125,"XX","VmaPhase"],[39,4126,"XX","VmaMod"],[39,4127,"XX","VmaClip"],[39,4128,"XX","SmartScanOnOffFlag"],[39,4144,"XX","ForeignImageRevision"],[39,4145,"XX","ImagingMode"],[39,4146,"XX","PulseSequence"],[39,4147,"XX","ImagingOptions"],[39,4149,"XX","PlaneType"],[39,4150,"XX","ObliquePlane"],[39,4160,"XX","RASLetterOfImageLocation"],[39,4161,"XX","ImageLocation"],[39,4162,"XX","CenterRCoordOfPlaneImage"],[39,4163,"XX","CenterACoordOfPlaneImage"],[39,4164,"XX","CenterSCoordOfPlaneImage"],[39,4165,"XX","NormalRCoord"],[39,4166,"XX","NormalACoord"],[39,4167,"XX","NormalSCoord"],[39,4168,"XX","RCoordOfTopRightCorner"],[39,4169,"XX","ACoordOfTopRightCorner"],[39,4170,"XX","SCoordOfTopRightCorner"],[39,4171,"XX","RCoordOfBottomRightCorner"],[39,4172,"XX","ACoordOfBottomRightCorner"],[39,4173,"XX","SCoordOfBottomRightCorner"],[39,4176,"XX","TableStartLocation"],[39,4177,"XX","TableEndLocation"],[39,4192,"FL","ImageDimensionX"],[39,4193,"FL","ImageDimensionY"],[39,4194,"FL","NumberOfExcitations"],[40,0,"UL","ImagePresentationGroupLength"],[40,2,"US","SamplesPerPixel"],[40,4,"CS","PhotometricInterpretation"],[40,6,"US","Planar\u200bConfiguration"],[40,8,"XX","NumberOfFrames"],[40,16,"US","Rows"],[40,17,"US","Columns"],[40,48,"DS","PixelSpacing"],[40,256,"US","BitsAllocated"],[40,257,"US","BitsStored"],[40,258,"US","HighBit"],[40,259,"US","PixelRepresentation"],[40,262,"XX","SmallestImagePixelValue"],[40,263,"XX","LargestImagePixelValue"],[40,288,"US","PixelAddingValue"],[40,769,"CS","BurnderInAnnotation"],[40,771,"CS","Longitudinal\u200bTemporal\u200bInformation\u200bModified"],[40,4176,"DS","WindowCenter"],[40,4177,"DS","WindowWidth"],[40,4178,"DS","RescaleIntercept"],[40,4179,"DS","RescaleSlope"],[40,4180,"LO","RescaleType"],[40,4181,"LO","Window\u200bCenter\u200bWidth\u200bExplanation"],[41,16,"LO","PrivateCreator"],[41,4117,"SL","LowerRangeOfPixels1h"],[41,4118,"SL","LowerRangeOfPixels1i"],[41,4119,"SL","LowerRangeOfPixels2"],[41,4120,"SL","UpperRangeOfPixels2"],[41,4134,"SS","VersionOfTheHdrStruct"],[41,4145,"LO","PrivateTag"],[41,4146,"UL","PrivateTag"],[41,4147,"UL","PrivateTag"],[41,4148,"SL","AdvantageCompOverflow"],[41,4149,"SL","AdvantageCompUnderflow"],[50,0,"UL","StudyGroupLength"],[50,12,"XX","StrudyPriorityId"],[50,4128,"XX","ScheduledStudyLocation"],[50,4144,"XX","ReasonForStudy"],[50,4192,"XX","RequestedProcedureDescription"],[56,16,"XX","AdmissionId"],[56,80,"XX","SpecialNeeds"],[56,1280,"XX","PatientState"],[64,0,"UL","TextGroupLength"],[64,578,"XX","PerformedStationName"],[64,579,"XX","PerformedLocation"],[64,580,"XX","PerformedProcedureStepStartDate"],[64,581,"XX","PerformedProcedureStepStartTime"],[64,595,"XX","PerformedProcedureStepId"],[64,596,"XX","PerformedProcedureStepDescription"],[64,597,"LO","PerformedProcedureTypeDescription"],[64,640,"XX",'"CommentsOnPerformedProcedureStep'],[64,801,"XX","FilmConsumptionSequence"],[64,4097,"XX","RequestedProcedureId"],[64,4098,"XX","Unknown"],[64,4099,"XX","Unknown"],[64,4100,"XX","PatientTransportArrangments"],[64,4101,"XX","RequestedProcedureLocation"],[64,4112,"XX","NamesOfIntendentRecipientsOfResults"],[64,5120,"XX","RequestedProcedureComments"],[64,9216,"XX","ImagingServiceRequestComments"],[64,12289,"XX","Unknown"],[67,16,"LO","PrivateCreator"],[67,4097,"XX","BitmapOfPrescanOptions"],[67,4098,"XX","GradientOffsetInX"],[67,4099,"XX","GradientOffsetInY"],[67,4100,"XX","GradientOffsetInZ"],[67,4101,"XX","ImgIsOriginalOrUnoriginal"],[67,4102,"XX","NumberOfEPIShots"],[67,4103,"XX","ViewsPerSegment"],[67,4104,"XX","RespiratoryRateBpm"],[67,4105,"XX","RespiratoryTriggerPoint"],[67,4106,"XX","TypeOfReceiverUsed"],[67,4107,"XX","PeakRateOfChangeOfGradientField"],[67,4108,"XX","LimitsInUnitsOfPercent"],[67,4109,"XX","PSDEstimatedLimit"],[67,4110,"XX","PSDEstimatedLimitInTeslaPerSecond"],[67,4111,"XX","Saravghead"],[67,4112,"XX","WindowValue"],[67,4113,"XX","TotalInputViews"],[67,4114,"XX","XRayChain"],[67,4115,"XX","DeconKernelParameters"],[67,4116,"XX","CalibrationParameters"],[67,4117,"XX","TotalOutputViews"],[67,4118,"XX","NumberOfOverranges"],[67,4119,"XX","IBHImageScaleFactors"],[67,4120,"XX","BBHCoefficients"],[67,4121,"XX","NumberOfBBHChainsToBlend"],[67,4122,"XX","StartingChannelNumber"],[67,4123,"XX","PpscanParameters"],[67,4124,"XX","GEImageIntegrity"],[67,4125,"XX","LevelValue"],[67,4126,"XX","DeltaStartTime"],[67,4127,"XX","MaxOverrangesInAView"],[67,4128,"XX","AvgOverrangesAllViews"],[67,4129,"XX","CorrectedAfterGlowTerms"],[67,4133,"XX","ReferenceChannels"],[67,4134,"XX","NoViewsRefChansBlocked"],[67,4135,"XX","ScanPitchRatio"],[67,4136,"XX","UniqueImageIden"],[67,4137,"XX","HistogramTables"],[67,4138,"XX","UserDefinedData"],[67,4139,"XX","PrivateScanOptions"],[67,4140,"XX","EffectiveEchoSpacing"],[67,4141,"XX","StringSlopField1"],[67,4142,"XX","StringSlopField2"],[67,4143,"XX","RawDataType"],[67,4144,"XX","RawDataType"],[67,4145,"XX","RACordOfTargetReconCenter"],[67,4146,"XX","RawDataType"],[67,4147,"XX","NegScanspacing"],[67,4148,"XX","OffsetFrequency"],[67,4149,"XX","UserUsageTag"],[67,4150,"XX","UserFillMapMSW"],[67,4151,"XX","UserFillMapLSW"],[67,4152,"XX","User25_48"],[67,4153,"XX","SlopInt6_9"],[67,4160,"XX","TriggerOnPosition"],[67,4161,"XX","DegreeOfRotation"],[67,4162,"XX","DASTriggerSource"],[67,4163,"XX","DASFpaGain"],[67,4164,"XX","DASOutputSource"],[67,4165,"XX","DASAdInput"],[67,4166,"XX","DASCalMode"],[67,4167,"XX","DASCalFrequency"],[67,4168,"XX","DASRegXm"],[67,4169,"XX","DASAutoZero"],[67,4170,"XX","StartingChannelOfView"],[67,4171,"XX","DASXmPattern"],[67,4172,"XX","TGGCTriggerMode"],[67,4173,"XX","StartScanToXrayOnDelay"],[67,4174,"XX","DurationOfXrayOn"],[67,4192,"XX","SlopInt10_17"],[67,4193,"XX","ScannerStudyEntityUID"],[67,4194,"XX","ScannerStudyID"],[67,4207,"XX","ScannerTableEntry"],[67,4221,"US","ReconModeFlagWord "],[67,4224,"LO","CoilIDData"],[67,4225,"LO","GECoilName"],[67,4226,"LO","SystemConfigurationInformation"],[67,4227,"DS","AssetRFactors"],[67,4228,"LO","AdditionalAssetData"],[67,4233,"LO","GoverningBodyAndSARDefinition"],[67,4234,"CS","PrivateInPlanePhaseEncodingDirection"],[67,4240,"LO","SARDefinition"],[67,4241,"DS","SARValue"],[67,4245,"LO","PrescanReuseString"],[67,4246,"CS","ContentQualification"],[67,4247,"LO","ImageFilteringParameters"],[67,4250,"IS","RxStackIdentification"],[67,4266,"LO","AdditionalFilteringParameters"],[67,4273,"SS","ExcitationMode"],[69,16,"LO","PrivateCreator"],[69,4097,"XX","NumberOfMacroRowsInDetector"],[69,4098,"XX","MacroWidthAtISOCenter"],[69,4099,"XX","DASType"],[69,4100,"XX","DASGain"],[69,4102,"XX","TableDirectionInOrOut"],[69,4103,"XX","ZSmoothingFactor"],[69,4104,"XX","ViewWeightingMode"],[69,4105,"XX","SigmaRowNumberWhichRowsWereUsed"],[69,4106,"XX","MinimumDasValueFoundInTheScanData"],[69,4107,"XX","MaximumOffsetShiftValueUsed"],[69,4108,"XX","NumberOfViewsShifted"],[69,4109,"XX","ZTrackingFlag"],[69,4110,"XX","MeanZError"],[69,4111,"XX","ZTrackingMaximumError"],[69,4112,"XX","StartingViewForRow2a"],[69,4113,"XX","NumberOfViewsInRow2a"],[69,4114,"XX","StartingViewForRow1a"],[69,4115,"XX","SigmaMode"],[69,4116,"XX","NumberOfViewsInRow1a"],[69,4117,"XX","StartingViewForRow2b"],[69,4118,"XX","NumberOfViewsInRow2b"],[69,4119,"XX","StartingViewForRow1b"],[69,4120,"XX","NumberOfViewsInRow1b"],[69,4129,"XX","PrivateTag"],[69,4130,"XX","PrivateTag"],[69,4146,"XX","PrivateTag"],[83,16,"LO","PrivateCreator"],[83,4128,"XX","PrivateTag"],[83,4160,"XX","PrivateTag"],[83,4161,"XX","PrivateTag"],[83,4162,"XX","PrivateTag"],[83,4163,"XX","PrivateTag"],[83,4194,"XX","PrivateTag"],[136,320,"XX","StorageMediaFileSetUid"],[136,512,"XX","IconImageSequence"],[8193,4099,"XX","Unknown"],[8193,4106,"XX","Unknown"],[8193,4206,"XX","Unknown"],[8197,18,"XX","Unknown"],[8197,19,"XX","Unknown"],[8197,20,"XX","Unknown"],[8197,4627,"XX","Unknown"],[8197,5126,"XX","Unknown"],[21811,4611,"XX",'"Unknown'],[21811,21777,"XX",'"Unknown'],[32736,0,"IM","PixelDataGroupLength"],[32736,16,"IM","PixelData"]]}return Object(h.a)(e,[{key:"getVr",value:function(e,t){for(var i="",a=this.TAGS.length,r=0;r<a;r++)this.TAGS[r][0]===e&&this.TAGS[r][1]===t&&(i=this.TAGS[r][2]);return 0===t&&(i="UL"),i}},{key:"getTextDesc",value:function(e,t){for(var i="?",a=this.TAGS.length,r=0;r<a;r++)this.TAGS[r][0]===e&&this.TAGS[r][1]===t&&(i=this.TAGS[r][3]);return i}}]),e}(),gt=function e(){Object(u.a)(this,e),this.m_patientName="",this.m_patientDateOfBirth="",this.m_studyDescr="",this.m_studyDate="",this.m_seriesTime="",this.m_seriesDescr="",this.m_bodyPartExamined="",this.m_institutionName="",this.m_operatorsName="",this.m_physicansName="",this.m_patientId="",this.m_patientGender="",this.m_acquisionTime="",this.m_manufacturerName="",this.m_sliceInfo=[]},St=[2,16],xt=[2,0],bt=[32736,16],yt=function(){function e(t,i,a,r,s,o,n,l){Object(u.a)(this,e),this.m_group=t,this.m_element=i,this.m_vr=a,this.m_value=r,this.m_offsetStart=s,this.m_offsetValue=o,this.m_offsetEnd=n,this.m_littleEndian=l}return Object(h.a)(e,[{key:"value",value:function(){return this.m_value}},{key:"isTransformSyntax",value:function(){return this.m_group===St[0]&&this.m_element===St[1]}},{key:"isMetaLength",value:function(){return this.m_group===xt[0]&&this.m_element===xt[1]}},{key:"isPixelData",value:function(){return this.m_group===bt[0]&&this.m_element===bt[1]}}]),e}(),Tt=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,null,[{key:"getHash",value:function(e){for(var t=e.length,i=53*t,a=0;a<t;a++){i=(i*=137211941^e.charCodeAt(a))<<27|i>>5,i&=1073741823}return i}}]),e}(),Dt=function(){function e(){Object(u.a)(this,e),this.m_image=null,this.m_sliceNumber=0,this.m_sliceLocation=0,this.m_patientName="",this.m_studyDescr="",this.m_studyDate="",this.m_seriesTime="",this.m_seriesDescr="",this.m_bodyPartExamined="",this.m_hash=0,this.m_xDim=0,this.m_yDim=0}return Object(h.a)(e,[{key:"buildHash",value:function(){var e=this.m_patientName+this.m_studyDescr+this.m_studyDate+this.m_seriesTime+this.m_seriesDescr+this.m_bodyPartExamined;this.m_hash=Tt.getHash(e)}}]),e}(),Ot=function(){function e(t){Object(u.a)(this,e),console.assert(void 0!==t),console.assert("number"===typeof t,"hash shold be number"),this.m_hash=t,this.m_slices=[],this.m_minSlice=555555555555.5,this.m_maxSlice=-555555555555.5}return Object(h.a)(e,[{key:"addSlice",value:function(e){console.assert(void 0!==e),console.assert(e instanceof Dt,"added slice should be DicomSlice object"),this.m_slices.push(e),this.m_minSlice=e.m_sliceNumber<this.m_minSlice?e.m_sliceNumber:this.m_minSlice,this.m_maxSlice=e.m_sliceNumber>this.m_maxSlice?e.m_sliceNumber:this.m_maxSlice}}]),e}(),Rt=function(){function e(){Object(u.a)(this,e),this.m_series=[]}return Object(h.a)(e,[{key:"destroy",value:function(){this.m_series=[]}},{key:"getSeries",value:function(){return this.m_series}},{key:"addSlice",value:function(e){console.assert(void 0!==e),console.assert(e instanceof Dt,"should be DicomSlice object"),console.assert(void 0!==e.m_hash),console.assert(0!==e.m_hash);var t=this.getSerieIndex(e);if(t<0){var i=new Ot(e.m_hash);this.m_series.push(i),t=this.m_series.length-1}this.m_series[t].addSlice(e)}},{key:"getSerieIndex",value:function(e){for(var t=this.m_series.length,i=0;i<t;i++){if(this.m_series[i].m_hash===e.m_hash)return i}return-1}}]),e}(),wt=function e(){Object(u.a)(this,e),this.m_sliceName="",this.m_fileName="",this.m_tags=[]},Et=function e(){Object(u.a)(this,e),this.m_tag="",this.m_attrName="",this.m_attrValue=""},jt=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,[{key:"isValidUrl",value:function(e){var t=e.match(/^((ftp|http|https):\/\/)?(([\S]+)\.)?([\S]+)\.([A-z]{2,})(:\d{1,6})?\/[\S]+/),i=e.match(/(ftp|http|https):\/\/([\d]+)\.([\d]+)\.([\d]+)\.([\d]+)(:([\d]+))?\/([\S]+)/);return null!==t||null!==i}},{key:"getFileNameFromUrl",value:function(e){var t=e.lastIndexOf("/");if(t<0&&(t=e.lastIndexOf("\\")),t<0)return console.log("getFileNameFromUrl: wrong URL!"),"";var i=e.substring(t+1);return i=i.length<=40?i:i.substring(0,40)}},{key:"getFolderNameFromUrl",value:function(e){var t=e.lastIndexOf("/");return t<0&&(t=e.lastIndexOf("\\")),t<0?(console.log("getFolderNameFromUrl: wrong URL!"),""):e.substring(0,t)}},{key:"isUrlExists",value:function(e){var t=null;window.XMLHttpRequest&&(t=new XMLHttpRequest);t.open("GET",e,!0),t.send();return 404!==t.status}},{key:"encodeUrl",value:function(e){for(var t="",i=!1,a=e.length,r=0;r<a;r++){var s=e[r];if(i&&!("/"===s||"."===s||"-"===s||"_"===s)){var o=e.charCodeAt(r);t+=String.fromCharCode(o+1)}else t+=s;i="."===s||i}return t}},{key:"decodeUrl",value:function(e){for(var t="",i=!1,a=e.length,r=0;r<a;r++){var s=e[r];if(i&&!("/"===s||"."===s||"-"===s||"_"===s)){var o=e.charCodeAt(r);t+=String.fromCharCode(o-1)}else t+=s;i="."===s||i}return console.log("".concat(t)),t}}]),e}(),Mt=!1,At=[68,73,67,77],It=4294967295,Ct=1073741823,Xt=[32,19],Ft=[32736,16],kt=[40,256],Ut=[40,16],Nt=[40,17],Vt=[40,258],Lt=[40,262],Pt=[40,263],Bt=[40,288],zt=[40,48],Gt=[40,4176],Wt=[40,4177],Ht=[40,4178],qt=[40,4179],Yt=[40,4180],Zt=[40,259],Kt=[32,50],Qt=[32,4161],Jt=[40,2],$t=[8,4158],ei=[8,49],ti=[65534,57357],ii=[65534,57565],ai=[32,17],ri=[24,80],si=[24,21],oi="1.2.840.10008.1.2.4",ni="1.2.840.10008.1.2.4.57",li="1.2.840.10008.1.2.4.70",mi="1.2.840.10008.1.2.4.50",ui='"1.2.840.10008.1.2.4.51',hi="1.2.840.10008.1.2.4.90",ci="1.2.840.10008.1.2.4.91",di="1.2.840.10008.1.2.5",_i=[16,16],fi=[16,32],vi=[16,48],pi=[16,64],gi=[8,32],Si=[8,4144],xi=[8,50],bi=[8,128],yi=[8,144],Ti=[8,112],Di=[8,4208],Oi=function(){function e(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];Object(u.a)(this,e),this.m_xDim=-1,this.m_yDim=-1,this.m_zDim=t,this.m_needScaleDownTexture=i,this.m_folder=null,this.m_isLoadedSuccessfull=!1,this.m_dataSize=0,this.m_dataArray=null,this.m_dictionary=new pt,this.m_imageNumber=-1,this.m_errors=[],this.m_transformSyntax="",this.m_loaders=[],this.m_xDim=-1,this.m_yDim=-1,this.m_bitsPerPixel=-1,this.m_padValue=-1073741823,this.m_windowCenter=Ct,this.m_windowWidth=Ct,this.m_rescaleIntercept=0,this.m_rescaleSlope=1,this.m_rescaleHounsfield=!1,this.m_pixelRepresentaionSigned=!1,this.m_littleEndian=!0,this.m_samplesPerPixel=1,this.m_seriesNumber=-1,this.m_seriesDescr="",this.m_boxSize={x:1,y:1,z:1},this.m_nonEmptyBoxMin={x:0,y:0,z:0},this.m_nonEmptyBoxMax={x:1,y:1,z:1},this.m_slicesVolume=new Rt,this.m_newTagEvent=new CustomEvent("newTag",{detail:{group:null,element:null,desc:null,value:null,imageNumber:null,fileName:null}}),this.m_dicomInfo=new gt,this.m_pixelSpacing={x:0,y:0,z:0},this.m_filesLoadedCounter=0,this.m_numLoadedFiles=t,this.m_imagePosMin={x:1e12,y:1e12,z:1e12},this.m_imagePosMax={x:-1e12,y:-1e12,z:-1e12},this.m_sliceLocMin=1e12,this.m_sliceLocMax=-1e12,this.runLoader=this.runLoader.bind(this)}return Object(h.a)(e,[{key:"getBoxSize",value:function(){return this.m_boxSize}},{key:"getNonEmptyBoxMin",value:function(){return this.m_nonEmptyBoxMin}},{key:"getNonEmptyBoxMax",value:function(){return this.m_nonEmptyBoxMax}},{key:"getDicomInfo",value:function(){return this.m_dicomInfo}},{key:"createVolumeFromSlices",value:function(e,t,i){console.assert(null!=e,"Null volume"),console.assert(e instanceof Ei,"Should be volume set"),console.assert("number"===typeof t,"index should be number"),console.assert("number"===typeof i,"index should be number");var a=null;t<e.getNumVolumes()?a=e.getVolume(t):(a=new at,e.addVolume(a),a=e.getVolume(t),console.assert(null!==a));for(var r=this.m_slicesVolume.m_series.length,s=-1,o=0;o<r;o++)if(this.m_slicesVolume.m_series[o].m_hash===i){s=o;break}console.assert(s>=0);var n=this.m_slicesVolume.m_series[s],l=n.m_slices[0],m=n.m_slices.length;this.m_xDim=l.m_xDim,this.m_yDim=l.m_yDim,this.m_zDim=n.m_slices.length;var u,h,c=this.m_xDim*this.m_yDim,d={x:this.m_imagePosMax.x-this.m_imagePosMin.x,y:this.m_imagePosMax.y-this.m_imagePosMin.y,z:this.m_imagePosMax.z-this.m_imagePosMin.z},_=1e-5;Math.abs(this.m_pixelSpacing.z)>_?u=this.m_pixelSpacing.z*this.m_zDim:(u=d.z,Math.abs(u)<_&&(u=d.x,Math.abs(u)<_&&(u=d.y))),u<_&&(u=1),this.m_pixelSpacing.x*this.m_pixelSpacing.y<_&&(this.m_pixelSpacing.x=1,this.m_pixelSpacing.y=1),this.m_pixelSpacing.z=u/this.m_zDim,this.m_boxSize.z=this.m_zDim*this.m_pixelSpacing.z,this.m_boxSize.x=this.m_xDim*this.m_pixelSpacing.x,this.m_boxSize.y=this.m_yDim*this.m_pixelSpacing.y,console.log("createVolumeFromSlices. Volume local phys dim: ".concat(this.m_boxSize.x," * ").concat(this.m_boxSize.y," * ").concat(this.m_boxSize.z));var f,v=null;if(!this.m_littleEndian)for(var p=0;p<r;p++){var g=this.m_slicesVolume.m_series[p];if(g.m_hash===i)for(var S=0;S<m;S++){var x=g.m_slices[S],b=x.m_image;for(c=x.m_xDim*x.m_yDim,h=0;h<c;h++){var y=b[h];b[h]=y>>8|y<<8&65535}}}for(var T=0;T<r;T++){var D=this.m_slicesVolume.m_series[T];if(D.m_hash===i)for(var O=0;O<m;O++){var R=D.m_slices[O];for(c=R.m_xDim*R.m_yDim,h=0;h<c;h++){var w=R.m_image[h];w===this.m_padValue&&(w=0),R.m_image[h]=w}}}for(var E=-1073741823,j=1073741823,M=0;M<r;M++){var A=this.m_slicesVolume.m_series[M];if(A.m_hash===i)for(var I=0;I<m;I++){var C=A.m_slices[I],X=C.m_image;for(c=C.m_xDim*C.m_yDim,h=0;h<c;h++){var F=X[h]*this.m_rescaleSlope+this.m_rescaleIntercept;j=F<j?F:j,E=F>E?F:E}}}console.log("Build Volume. min/max value=".concat(j,"/").concat(E,". Volume dim = ").concat(this.m_xDim,"*").concat(this.m_yDim,"*").concat(this.m_zDim)),console.log("Min slice number = ".concat(n.m_minSlice)),console.log("Max slice number = ".concat(n.m_maxSlice)),E=E-j>0?E:E+1;var k=Math.floor((1<<19)/(E-j));if(k<=4)return console.log("Bad scaling: image will be 0"),rt.ERROR_SCALING;var U=n.m_slices,N=n.m_maxSlice-n.m_minSlice+1;N!==m&&console.log("Sort by location! N slices by tags = ".concat(N,", but N readed slices = ").concat(m));for(var V=U[0].m_sliceNumber,L=U[0].m_sliceNumber,P=0;P<m;P++){var B=U[P].m_sliceNumber;V=B<V?B:V,L=B>L?B:L}L-V>0?U.sort((function(e,t){return e.m_sliceNumber-t.m_sliceNumber})):U.sort((function(e,t){return e.m_sliceLocation-t.m_sliceLocation}));for(var z=0,G=0;G<m;G++)U[G].m_sliceNumber=z,z++;if(this.m_zDim=m,f=this.m_xDim*this.m_yDim*this.m_zDim,null===(v=new Uint8Array(f)))return console.log("no memory"),rt.ERROR_NO_MEMORY;for(h=0;h<f;h++)v[h]=0;for(var W=0;W<m;W++){var H=U[W];c=H.m_xDim*H.m_yDim;var q=H.m_image,Y=H.m_sliceNumber;if(Y>=n.m_slices.length&&((Y=H.m_sliceNumber-n.m_minSlice)<0||Y>=this.m_zDim))return console.log("Invalid z slice reference"),rt.ERROR_INVALID_SLICE_INDEX;if(null!==q){var Z=Y*c;if(this.m_windowCenter!==Ct&&this.m_windowWidth!==Ct){var K=this.m_windowCenter-.5*this.m_windowWidth;for(h=0;h<c;h++){var Q=q[h]*this.m_rescaleSlope+this.m_rescaleIntercept,J=0;J=(J=(J=this.m_rescaleHounsfield?Math.floor(255*(Q-K)/this.m_windowWidth):Math.floor(127+128*(Q-this.m_windowCenter)/(this.m_windowWidth/2)))>=0?J:0)<255?J:255,v[Z+h]=J}}else for(h=0;h<c;h++){var $=(q[h]*this.m_rescaleSlope+this.m_rescaleIntercept-j)*k>>11;$=$<=255?$:255,v[Z+h]=$}}}var ee=this.m_xDim*this.m_yDim*this.m_zDim;if(this.m_needScaleDownTexture&&ee>67108864){var te=512,ie=this.m_xDim<=te?this.m_xDim:te,ae=this.m_yDim<=te?this.m_yDim:te;v=VolumeTools.scaleTextureDown(this,v,ie,ae,120),c=this.m_xDim*this.m_yDim,console.log("Volume scaled down to: ".concat(ie," * ").concat(ae," * ").concat(120,"."))}if(this.m_zDim>4){var re,se,oe,ne,le,me=(oe=0)*this.m_xDim*this.m_yDim,ue=(oe=this.m_zDim-1)*this.m_xDim*this.m_yDim;for(se=0;se<this.m_yDim;se++)for(ne=se*this.m_xDim,re=0;re<this.m_xDim;re++)v[me+ne+re]=0,v[ue+ne+re]=0;var he=re=0,ce=re=this.m_xDim-1;for(oe=0;oe<this.m_zDim;oe++)for(le=oe*this.m_xDim*this.m_yDim,se=0;se<this.m_yDim;se++)v[le+(ne=se*this.m_xDim)+he]=0,v[le+ne+ce]=0;var de=(se=0)*this.m_xDim,_e=(se=this.m_yDim-1)*this.m_xDim;for(oe=0;oe<this.m_zDim;oe++)for(le=oe*this.m_xDim*this.m_yDim,re=0;re<this.m_xDim;re++)v[le+re+de]=0,v[le+re+_e]=0}var fe=6403,ve={m_pixelWidth:this.m_xDim,m_pixelHeight:this.m_yDim,m_pixelDepth:this.m_zDim,m_glType:5121,m_glTypeSize:1,m_glFormat:fe,m_glInternalFormat:fe,m_glBaseInternalFormat:fe},pe=this.m_callbackComplete;pe&&pe(rt.SUCCESS,ve,f,v);return a.m_xDim=this.m_xDim,a.m_yDim=this.m_yDim,a.m_zDim=this.m_zDim,a.m_dataArray=v,a.m_dataSize=f,a.m_bytesPerVoxel=1,a.m_boxSize.x=this.m_boxSize.x,a.m_boxSize.y=this.m_boxSize.y,a.m_boxSize.z=this.m_boxSize.z,a.m_patientName=this.m_dicomInfo.m_patientName,a.m_patientBirth=this.m_dicomInfo.m_patientDateOfBirth,a.m_seriesDescr=this.m_dicomInfo.m_seriesDescr,a.m_studyDescr=this.m_dicomInfo.m_studyDescr,a.m_studyDate=this.m_dicomInfo.m_studyDate,a.m_seriesTime=this.m_dicomInfo.m_seriesTime,a.m_bodyPartExamined=this.m_dicomInfo.m_bodyPartExamined,a.m_institutionName=this.m_dicomInfo.m_institutionName,a.m_operatorsName=this.m_dicomInfo.m_operatorsName,a.m_physicansName=this.m_dicomInfo.m_physicansName,a.createIcon(),rt.SUCCESS}},{key:"getNextTag",value:function(t,i){if(i>=t.byteLengh)return null;var a=!0,r=0,s=0,o=0,n=i,l="";this.m_metaFinished?(a=this.m_littleEndian,r=t.getUint16(i,a)):(r=t.getUint16(i,1),-1!==this.m_metaFinishedOffset&&i>=this.m_metaFinishedOffset||2!==r?(this.m_metaFinished=1,a=this.m_littleEndian,r=t.getUint16(i,a)):a=!0),this.m_metaFound||2!==r||(this.m_metaFound=!0),i+=2,s=t.getUint16(i,a),i+=2,this.m_explicit||!this.m_metaFinished?(l=e.getStringAt(t,i,2),!this.m_metaFound&&this.m_metaFinished&&-1===e.getVrsStringIndex(l)?(l=pt.getVr(r,s),o=t.getUint32(i,a),i+=4,this.m_explicit=!1):(i+=2,-1!==e.getDataVrsStringIndex(l)?(i+=2,o=t.getUint32(i,a),i+=4):(o=t.getUint16(i,a),i+=2))):(l=this.m_dictionary.getVr(r,s),(o=t.getUint32(i,a))===It&&(l="SQ"),i+=4);var m=i,u=null;if("SQ"===l){if(o===It){for(var h=0,c=0;h!==ii[0]||c!==ii[1];){h=t.getUint16(i,a),i+=2,c=t.getUint16(i,a),i+=2;var d=t.getUint32(i,a);if(i+=4,d===It){for(;!(h===ti[0]&&c===ti[1]||h===ii[0]&&c===ii[1]);){i=this.getNextTag(t,i).m_offsetEnd,h=t.getUint16(i,a),c=t.getUint16(i+2,a)}i+=8}else i+=d}o=0}}else o>0&&(o===It&&r===Ft[0]&&s===Ft[1]&&(o=t.byteLength-i),u=t.buffer.slice(i,i+o));if(4294967295===o)return null;var _=new yt(r,s,l,u,n,m,i+=o,this.m_littleEndian);if(_&&(this.m_newTagEvent.detail.group=r.toString(16),this.m_newTagEvent.detail.element=s.toString(16),this.m_newTagEvent.detail.desc=this.m_dictionary.getTextDesc(r,s),this.m_newTagEvent.detail.value=e.getAttrValueAsString(_),this.m_newTagEvent.detail.imageNumber=r===Xt[0]&&s===Xt[1]?parseInt(this.m_newTagEvent.detail.value,10):-1,dispatchEvent(this.m_newTagEvent)),_.isTransformSyntax()){var f=_.m_value.byteLength,v=new DataView(_.m_value),p=e.getStringAt(v,0,f);"1.2.840.10008.1.2"===p?(this.m_explicit=!1,this.m_littleEndian=!0):"1.2.840.10008.1.2.2"===p?(this.m_explicit=!0,this.m_littleEndian=!1):"1.2.840.10008.1.2.1.99"===p?(this.m_needsDeflate=!0,this.m_explicit=!0,this.m_littleEndian=!0):p==oi?this.m_transformSyntax=oi:p==li?this.m_transformSyntax=li:p==ni?this.m_transformSyntax=ni:p==mi?this.m_transformSyntax=mi:p==ui?this.m_transformSyntax=ui:p==hi?this.m_transformSyntax=hi:p==ci?this.m_transformSyntax=ci:p==di?this.m_transformSyntax=di:(this.m_explicit=!0,this.m_littleEndian=!0)}else _.isMetaLength()&&(this.m_metaFinishedOffset=_.m_value[0]+i);return _}},{key:"readFromGoogleBuffer",value:function(t,i,a,r,s,o){var n=new DataView(r),l=(n.byteLength,e.getStringAt(n,64,32));if("Content-Type: application/dicom;"===l){var m=r.slice(136);new DataView(m);return this.readFromBuffer(t,i,a,m,s,o)}return console.log("readFromGoogleBuffer. bad content type = ".concat(l)),rt.BAD_HEADER}},{key:"readFromBuffer",value:function(t,i,a,r,s,o){"number"!==typeof t&&console.log("LoaderDicom.readFromBuffer: bad indexFile argument"),"string"!==typeof i&&console.log("LoaderDicom.readFromBuffer: bad fileName argument"),"object"!==typeof r&&console.log("LoaderDicom.readFromBuffer: bad arrBuf argument");var n=this.m_dicomInfo,l=new wt,m="Slice "+t.toString();l.m_sliceName=m,l.m_fileName=i,l.m_tags=[],n.m_sliceInfo.push(l);var u=new DataView(r);if(null===u)return console.log("No memory"),rt.ERROR_NO_MEMORY;if(u.byteLength<144)return this.m_error=rt.ERROR_TOO_SMALL_DATA_SIZE,void 0!==o&&o(rt.ERROR_TOO_SMALL_DATA_SIZE),rt.ERROR_TOO_SMALL_DATA_SIZE;for(var h=0;h<4;h++){if(u.getUint8(128+h)!==At[h])return this.m_errors[t]=-1,console.log("Dicom readFromBuffer. Wrong header in file: ".concat(i)),void 0!==o&&o(rt.WRONG_HEADER_MAGIC),rt.WRONG_HEADER_MAGIC}var c=128;c+=4,this.m_littleEndian=!0,this.m_explicit=!0,this.m_metaFound=!1,this.m_metaFinished=!1,this.m_metaFinishedOffset=-1,this.m_needsDeflate=!1,this.m_imageNumber=-1,this.m_xDim=-1,this.m_yDim=-1,this.m_bitsPerPixel=-1,this.m_windowCenter=-1,this.m_windowWidth=-1;var d,_=0,f=0,v=!1;for(d=this.getNextTag(u,c);null!==d;){if(d.isPixelData()){v=!0;break}if(c=d.m_offsetEnd,null===(d=this.getNextTag(u,c)))break;var p=this.m_dicomInfo,g=p.m_sliceInfo.length,S=p.m_sliceInfo[g-1],x=new Et;x.m_tag="("+e.numberToHexString(d.m_group)+","+e.numberToHexString(d.m_element)+")";var b=this.m_dictionary.getTextDesc(d.m_group,d.m_element);x.m_attrName=b.length>1?b:"";var y=e.getAttrValueAsString(d);if(y=null!==y?y:"",x.m_attrValue=y,S.m_tags.push(x),d.m_group===Xt[0]&&d.m_element===Xt[1]){var T=d.m_value.byteLength,D=new DataView(d.m_value),O=e.getStringAt(D,0,T);this.m_imageNumber=parseInt(O,10)-1}if(d.m_group===Ut[0]&&d.m_element===Ut[1]){var R=d.m_value.byteLength,w=new DataView(d.m_value),E=2===R?w.getUint16(0,this.m_littleEndian):w.getUint32(0,this.m_littleEndian);if(this.m_yDim<0)this.m_yDim=E;else if(this.m_yDim!==E)return console.log("Bad image size y"),void 0!==o&&o(rt.WRONG_IMAGE_DIM_Y),rt.WRONG_IMAGE_DIM_Y}if(d.m_group===Nt[0]&&d.m_element===Nt[1]){var j=d.m_value.byteLength,M=new DataView(d.m_value),A=2===j?M.getUint16(0,this.m_littleEndian):M.getUint32(0,this.m_littleEndian);if(this.m_xDim<0)this.m_xDim=A;else if(this.m_xDim!==A)return console.log("Bad image size x"),void 0!==o&&o(rt.WRONG_IMAGE_DIM_X),rt.WRONG_IMAGE_DIM_X}if(d.m_group===kt[0]&&d.m_element===kt[1]){var I=d.m_value.byteLength,C=new DataView(d.m_value);this.m_bitsPerPixel=2===I?C.getUint16(0,this.m_littleEndian):C.getUint32(0,this.m_littleEndian)}if(d.m_group===Gt[0]&&d.m_element===Gt[1]&&null!=d.m_value&&d.m_value.byteLength>0){var X=d.m_value.byteLength,F=new DataView(d.m_value),k=e.getStringAt(F,0,X);this.m_windowCenter=parseInt(k,10)}if(d.m_group===Wt[0]&&d.m_element===Wt[1]&&null!=d.m_value&&d.m_value.byteLength>0){var U=d.m_value.byteLength,N=new DataView(d.m_value),V=e.getStringAt(N,0,U);this.m_windowWidth=parseInt(V,10)}if(d.m_group===Ht[0]&&d.m_element===Ht[1]&&null!=d.m_value&&d.m_value.byteLength>0){var L=d.m_value.byteLength,P=new DataView(d.m_value),B=e.getStringAt(P,0,L);this.m_rescaleIntercept=parseInt(B,10)}if(d.m_group===qt[0]&&d.m_element===qt[1]&&null!=d.m_value&&d.m_value.byteLength>0){var z=d.m_value.byteLength,G=new DataView(d.m_value),W=e.getStringAt(G,0,z);this.m_rescaleSlope=parseInt(W,10)}if(d.m_group===Yt[0]&&d.m_element===Yt[1]&&null!=d.m_value&&d.m_value.byteLength>0){var H=d.m_value.byteLength,q=new DataView(d.m_value);"HU"===e.getStringAt(q,0,H)&&(this.m_rescaleHounsfield=!0)}if(d.m_group===Zt[0]&&d.m_element===Zt[1]&&null!=d.m_value&&d.m_value.byteLength>0){var Y=d.m_value.byteLength,Z=new DataView(d.m_value);1===(2===Y?Z.getUint16(0,this.m_littleEndian):Z.getUint32(0,this.m_littleEndian))&&(this.m_pixelRepresentaionSigned=!0)}if(d.m_group===ai[0]&&d.m_element===ai[1]&&null!=d.m_value&&d.m_value.byteLength>0){var K=d.m_value.byteLength,Q=new DataView(d.m_value),J=e.getStringAt(Q,0,K);this.m_seriesNumber=parseInt(J,10)}if(d.m_group===$t[0]&&d.m_element===$t[1]&&null!==d.m_value){var $=d.m_value.byteLength,ee=new DataView(d.m_value);this.m_seriesDescr=e.getStringAt(ee,0,$)}if(d.m_group===Vt[0]&&d.m_element===Vt[1]){var te=d.m_value.byteLength,ie=new DataView(d.m_value),ae=2===te?ie.getUint16(0,this.m_littleEndian):ie.getUint32(0,this.m_littleEndian);_=(1<<ae+1)-1}if(d.m_group===Lt[0]&&d.m_element===Lt[1]){var re=d.m_value.byteLength,se=new DataView(d.m_value);2===re?se.getInt16(0,this.m_littleEndian):se.getInt32(0,this.m_littleEndian)}if(d.m_group===Pt[0]&&d.m_element===Pt[1]){var oe=d.m_value.byteLength,ne=new DataView(d.m_value);2===oe?ne.getInt16(0,this.m_littleEndian):ne.getInt32(0,this.m_littleEndian)}if(d.m_group===Bt[0]&&d.m_element===Bt[1]){var le=d.m_value.byteLength,me=new DataView(d.m_value);f=2===le?me.getUint16(0,this.m_littleEndian):me.getUint32(0,this.m_littleEndian),this.m_padValue=f}if(d.m_group===zt[0]&&d.m_element===zt[1]){var ue=d.m_value.byteLength,he=new DataView(d.m_value),ce=e.getStringAt(he,0,ue).split("\\");2===ce.length&&(this.m_pixelSpacing.x=parseFloat(ce[0]),this.m_pixelSpacing.y=parseFloat(ce[1]))}if(d.m_group===Kt[0]&&d.m_element===Kt[1]){var de=d.m_value.byteLength,_e=new DataView(d.m_value),fe=e.getStringAt(_e,0,de).split("\\");if(3===fe.length){var ve=parseFloat(fe[0]),pe=parseFloat(fe[1]),ge=parseFloat(fe[2]);this.m_imagePosMin.x=ve<this.m_imagePosMin.x?ve:this.m_imagePosMin.x,this.m_imagePosMin.y=pe<this.m_imagePosMin.y?pe:this.m_imagePosMin.y,this.m_imagePosMin.z=ge<this.m_imagePosMin.z?ge:this.m_imagePosMin.z,this.m_imagePosMax.x=ve>this.m_imagePosMax.x?ve:this.m_imagePosMax.x,this.m_imagePosMax.y=pe>this.m_imagePosMax.y?pe:this.m_imagePosMax.y,this.m_imagePosMax.z=ge>this.m_imagePosMax.z?ge:this.m_imagePosMax.z}}if(d.m_group===ri[0]&&d.m_element===ri[1]){var Se=d.m_value.byteLength,xe=new DataView(d.m_value),be=e.getStringAt(xe,0,Se);this.m_pixelSpacing.z=parseFloat(be)}if(d.m_group===Qt[0]&&d.m_element===Qt[1]){var ye=d.m_value.byteLength,Te=new DataView(d.m_value),De=e.getStringAt(Te,0,ye),Oe=parseFloat(De);this.m_sliceLocation=Oe,this.m_sliceLocMin=Oe<this.m_sliceLocMin?Oe:this.m_sliceLocMin,this.m_sliceLocMax=Oe>this.m_sliceLocMax?Oe:this.m_sliceLocMax}if(d.m_group===Jt[0]&&d.m_element===Jt[1]){var Re=d.m_value.byteLength,we=new DataView(d.m_value);this.m_samplesPerPixel=2===Re?we.getUint16(0,this.m_littleEndian):we.getUint32(0,this.m_littleEndian)}if(d.m_group===$t[0]&&d.m_element===$t[1]&&null!==d.m_value){var Ee=d.m_value.byteLength,je=new DataView(d.m_value),Me=e.getStringAt(je,0,Ee);this.m_dicomInfo.m_seriesDescr=Me}if(d.m_group===ei[0]&&d.m_element===ei[1]&&null!==d.m_value){var Ae=d.m_value.byteLength,Ie=new DataView(d.m_value),Ce=e.getStringAt(Ie,0,Ae),Xe=Ce.substring(0,2),Fe=Ce.substring(2,4),ke=Ce.substring(4,Ce.length),Ue="".concat(Xe,":").concat(Fe,":").concat(ke);this.m_dicomInfo.m_seriesTime=Ue}if(d.m_group===_i[0]&&d.m_element===_i[1]&&null!==d.m_value){var Ne=d.m_value.byteLength,Ve=new DataView(d.m_value);this.m_dicomInfo.m_patientName=e.getUtf8StringAt(Ve,0,Ne),this.m_dicomInfo.m_patientName=this.m_dicomInfo.m_patientName.trim()}if(d.m_group===fi[0]&&d.m_element===fi[1]&&null!==d.m_value){var Le=d.m_value.byteLength,Pe=new DataView(d.m_value);this.m_dicomInfo.m_patientId=e.getStringAt(Pe,0,Le)}if(d.m_group===pi[0]&&d.m_element===pi[1]&&null!==d.m_value){var Be=d.m_value.byteLength,ze=new DataView(d.m_value);this.m_dicomInfo.m_patientGender=e.getStringAt(ze,0,Be)}if(d.m_group===vi[0]&&d.m_element===vi[1]&&null!==d.m_value){var Ge=d.m_value.byteLength,We=new DataView(d.m_value),He=e.getStringAt(We,0,Ge),qe=He.substring(0,4),Ye=He.substring(4,6),Ze=He.substring(6);this.m_dicomInfo.m_patientDateOfBirth="".concat(Ze,"/").concat(Ye,"/").concat(qe)}if(d.m_group===gi[0]&&d.m_element===gi[1]&&null!==d.m_value){var Ke=d.m_value.byteLength,Qe=new DataView(d.m_value),Je=e.getStringAt(Qe,0,Ke),$e=Je.substring(0,4),et=Je.substring(4,6),tt=Je.substring(6);this.m_dicomInfo.m_studyDate="".concat(tt,"/").concat(et,"/").concat($e)}if(d.m_group===Si[0]&&d.m_element===Si[1]&&null!==d.m_value){var it=d.m_value.byteLength,at=new DataView(d.m_value),st=e.getStringAt(at,0,it);this.m_dicomInfo.m_studyDescr=st,this.m_dicomInfo.m_studyDescr=this.m_dicomInfo.m_studyDescr.trim()}if(d.m_group===si[0]&&d.m_element===si[1]&&null!==d.m_value){var ot=d.m_value.byteLength,nt=new DataView(d.m_value);this.m_dicomInfo.m_bodyPartExamined=e.getStringAt(nt,0,ot)}if(d.m_group===xi[0]&&d.m_element===xi[1]&&null!==d.m_value){var lt=d.m_value.byteLength,mt=new DataView(d.m_value);this.m_dicomInfo.m_acquisionTime=e.getStringAt(mt,0,lt)}if(d.m_group===bi[0]&&d.m_element===bi[1]&&null!==d.m_value){var ut=d.m_value.byteLength,ht=new DataView(d.m_value);this.m_dicomInfo.m_institutionName=e.getUtf8StringAt(ht,0,ut),this.m_dicomInfo.m_institutionName=this.m_dicomInfo.m_institutionName.trim()}if(d.m_group===Di[0]&&d.m_element===Di[1]&&null!==d.m_value){var ct=d.m_value.byteLength,dt=new DataView(d.m_value);this.m_dicomInfo.m_operatorsName=e.getUtf8StringAt(dt,0,ct),this.m_dicomInfo.m_operatorsName=this.m_dicomInfo.m_operatorsName.trim()}if(d.m_group===yi[0]&&d.m_element===yi[1]&&null!==d.m_value){var _t=d.m_value.byteLength,ft=new DataView(d.m_value);this.m_dicomInfo.m_physicansName=e.getUtf8StringAt(ft,0,_t),this.m_dicomInfo.m_physicansName=this.m_dicomInfo.m_physicansName.trim()}if(d.m_group===Ti[0]&&d.m_element===Ti[1]&&null!==d.m_value){var vt=d.m_value.byteLength,pt=new DataView(d.m_value);this.m_dicomInfo.m_manufacturerName=e.getStringAt(pt,0,vt),this.m_dicomInfo.m_manufacturerName=this.m_dicomInfo.m_manufacturerName.trim()}}if(!v)return void 0!==o&&o(rt.ERROR_PIXELS_TAG_NOT_FOUND),rt.ERROR_PIXELS_TAG_NOT_FOUND;if(this.m_transformSyntax.length>1)return void 0!==o&&o(rt.ERROR_COMPRESSED_IMAGE_NOT_SUPPORTED),rt.ERROR_COMPRESSED_IMAGE_NOT_SUPPORTED;var gt=Math.floor(this.m_xDim*this.m_yDim*(this.m_bitsPerPixel/8)*this.m_samplesPerPixel);if(gt!==d.m_value.byteLength||0===_)return console.log("Wrong image pixels size. Readed ".concat(d.m_value.byteLength,", but expected ").concat(gt)),void 0!==o&&o(rt.ERROR_COMPRESSED_IMAGE_NOT_SUPPORTED),rt.WRONG_HEADER_DATA_SIZE;var St=this.m_xDim*this.m_yDim,xt=new Dt;if(null===xt)return console.log("No memory"),rt.ERROR_NO_MEMORY;if(this.m_pixelRepresentaionSigned?xt.m_image=new Int16Array(St):xt.m_image=new Uint16Array(St),null===xt.m_image)return console.log("No memory"),rt.ERROR_NO_MEMORY;xt.m_sliceNumber=this.m_imageNumber,xt.m_sliceLocation=this.m_sliceLocation,xt.m_patientName=this.m_dicomInfo.m_patientName,xt.m_studyDescr=this.m_dicomInfo.m_studyDescr,xt.m_studyDate=this.m_dicomInfo.m_studyDate,xt.m_seriesTime=this.m_dicomInfo.m_seriesTime,xt.m_seriesDescr=this.m_dicomInfo.m_seriesDescr,xt.m_bodyPartExamined=this.m_dicomInfo.m_bodyPartExamined,xt.m_institutionName=this.m_dicomInfo.m_institutionName,xt.m_operatorsName=this.m_dicomInfo.m_operatorsName,xt.m_physicansName=this.m_dicomInfo.m_physicansName,xt.buildHash(),xt.m_xDim=this.m_xDim,xt.m_yDim=this.m_yDim;var bt=xt.m_image,yt=new DataView(d.m_value);if(null===yt)return console.log("No memory"),rt.ERROR_NO_MEMORY;var Tt;if(8===this.m_bitsPerPixel){if(1===this.m_samplesPerPixel)for(Tt=0;Tt<St;Tt++){var Ot=yt.getUint8(Tt);bt[Tt]=Ot}else if(3===this.m_samplesPerPixel){var Rt=0;for(Tt=0;Tt<St;Tt++,Rt+=3){var jt=yt.getUint8(Rt+0),Mt=yt.getUint8(Rt+1),It=yt.getUint8(Rt+2);bt[Tt]=Math.floor((jt+Mt+It)/3)}}}else if(16===this.m_bitsPerPixel){var Ct=0;for(Tt=0;Tt<St;Tt++){var Ft=yt.getUint16(Ct,this.m_littleEndian);Ct+=2,bt[Tt]=Ft}}else console.log("TODO: need to implement reading non-8 and non-16 bit dicom images");return this.m_error=0,this.m_slicesVolume.addSlice(xt),void 0!==o&&o(rt.SUCCESS),rt.SUCCESS}},{key:"readFromUrl",value:function(e,t,i,a){var r=this;console.assert(null!=e,"Null volume"),console.assert(e instanceof Ei,"Should be volume set"),console.assert(null!=t,"Null string url"),console.assert("string"===typeof t,"Should be string in url");var s=new jt;if(!s.isValidUrl(t))return console.log("readFromUrl: not vaild URL = = ".concat(t," ")),!1;this.m_folder=s.getFolderNameFromUrl(t);var o=this.m_folder+"/file_list.txt";console.log("readFromUrl: load file = ".concat(o," "));var n=new nt(o);return this.m_callbackComplete=a,this.m_callbackProgress=i,this.m_fileListCounter=0,n.readFile((function(t){return r.m_fileListCounter+=1,1!==r.m_fileListCounter||r.readReadyFileList(e,t,i,a)}),(function(e){return console.log("Error read file: ".concat(e)),a(rt.ERROR_CANT_OPEN_URL,null,0,null),!1})),!0}},{key:"readReadyFileList",value:function(e,t,i,a){console.assert(null!=e,"Null volume"),console.assert(e instanceof Ei,"Should be volume set"),console.assert(null!=t,"Null array"),console.assert("ArrayBuffer"===t.constructor.name,"Should be ArrayBuf in arrBuf");var r=new Uint8Array(t),s=String.fromCharCode.apply(null,r),o=s.substr(0,64);console.log("Loaded file list. Started with:  ".concat(o," ..."));for(var n=s.split("\n"),l=n.length,m=l-1;m>=0;m--)n[m].endsWith("\r")&&(n[m]=n[m].substring(0,n[m].length-1)),n[m].length<4&&n.pop();l=n.length,this.m_zDim=l,console.log("Loaded file list. ".concat(l," files will be loaded. 1st file in list is = ").concat(n[0])),console.log("Loaded file list. Last file in list is = ".concat(n[l-1]));for(var u=0;u<l;u++)this.m_errors[u]=-1,this.m_loaders[u]=null;this.m_pixelSpacing={x:0,y:0,z:0},this.m_filesLoadedCounter=0,this.m_numFailsLoad=0,this.m_numLoadedFiles=l,this.m_imagePosMin={x:1e12,y:1e12,z:1e12},this.m_imagePosMax={x:-1e12,y:-1e12,z:-1e12},this.m_sliceLocMin=1e12,this.m_sliceLocMax=-1e12;for(var h=0;h<this.m_numLoadedFiles&&this.m_numFailsLoad<1;h++){var c="".concat(this.m_folder,"/").concat(n[h]);this.m_loaders[h]=new nt(c);var d=this.m_loaders[h];if(!this.runLoader(e,n[h],d,h,i,a,!1))return!1}return!0}},{key:"runLoader",value:function(e,t,i,a,r,s,o){var n=this;return this.m_fromGoogle=o,i.readFile((function(i){var o,l=n.m_filesLoadedCounter/n.m_numLoadedFiles;if(void 0!==r&&0===(7&n.m_filesLoadedCounter)&&r(l),void 0!==r&&n.m_filesLoadedCounter+1===n.m_numLoadedFiles&&r(1),n.m_newTagEvent.detail.fileName=t,(o=n.m_fromGoogle?n.readFromGoogleBuffer(a,t,l,i,r,s):n.readFromBuffer(a,t,l,i,r,s))!==rt.SUCCESS&&0===n.m_numFailsLoad&&(n.m_numFailsLoad+=1,null!==s))return s(o,null,0,null,t),!1;if(n.m_filesLoadedCounter+=1,n.m_filesLoadedCounter===n.m_numLoadedFiles){Mt;var m,u={x:n.m_imagePosMax.x-n.m_imagePosMin.x,y:n.m_imagePosMax.y-n.m_imagePosMin.y,z:n.m_imagePosMax.z-n.m_imagePosMin.z},h=1e-5;Math.abs(n.m_pixelSpacing.z)>h?m=n.m_pixelSpacing.z*n.m_zDim:(m=u.z,Math.abs(m)<h&&(m=u.x,Math.abs(m)<h&&(m=u.y))),m<h&&(m=1),n.m_pixelSpacing.z=m/n.m_zDim,n.m_boxSize.z=n.m_zDim*n.m_pixelSpacing.z,n.m_boxSize.x=n.m_xDim*n.m_pixelSpacing.x,n.m_boxSize.y=n.m_yDim*n.m_pixelSpacing.y,console.log("Volume local phys dim: ".concat(n.m_boxSize.x," * ").concat(n.m_boxSize.y," * ").concat(n.m_boxSize.z));var c=n.m_slicesVolume.getSeries();0===c.length&&(n.m_slicesVolume.buildSeriesInfo(),c=n.m_slicesVolume.getSeries());var d=c[0].m_hash,_=n.createVolumeFromSlices(e,0,d);if(null!==s)return s(_),!0}return!0}),(function(e){return console.log("Error read file: ".concat(e)),!1})),!0}}],[{key:"getVrsStringIndex",value:function(e){for(var t=["AE","AS","AT","CS","DA","DS","DT","FL","FD","IS","LO","LT","OB","OD","OF","OW","PN","SH","SL","SS","ST","TM","UI","UL","UN","US","UT"],i=t.length,a=0;a<i;a++)if(t[a]===e)return a;return-1}},{key:"getDataVrsStringIndex",value:function(e){for(var t=["OB","OW","OF","SQ","UT","UN"],i=t.length,a=0;a<i;a++)if(t[a]===e)return a;return-1}},{key:"getStringAt",value:function(e,t,i){for(var a="",r=0;r<i;r++){var s=e.getUint8(t+r);0!==s&&(a+=String.fromCharCode(s))}return a}},{key:"getUtf8StringAt",value:function(e,t,i){for(var a="",r=0;r<i;){var s=e.getUint8(t+r);switch(r++,94==s&&(s=32),s>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:a+=String.fromCharCode(s);break;case 12:case 13:var o=e.getUint8(t+r);r++,a+=String.fromCharCode((31&s)<<6|63&o);break;case 14:var n=e.getUint8(t+r);r++;var l=e.getUint8(t+r);r++,a+=String.fromCharCode((15&s)<<12|(63&n)<<6|(63&l)<<0)}}return a}},{key:"getAttrValueAsString",value:function(t){if(null===t.m_value)return"SQ"===t.m_vr?"(Sequence Data)":null;var i=new DataView(t.m_value),a=null,r=null,s=0;switch(t.m_vr){case"AE":return e.getStringAt(i,0,t.m_value.byteLength);case"AS":switch(a=e.getStringAt(i,0,t.m_value.byteLength),r=Number(a.slice(0,3)).toString(),a[3]){case"D":return"".concat(r," days");case"W":return"".concat(r," weeks");case"M":return"".concat(r," months");case"Y":return"".concat(r," years");default:return null}case"CS":return e.getStringAt(i,0,t.m_value.byteLength);case"DA":return a=e.getStringAt(i,0,t.m_value.byteLength),new Date("".concat(a.slice(0,4),"-").concat(a.slice(4,6),"-").concat(a.slice(6,8))).toLocaleDateString();case"DS":case"DT":return e.getStringAt(i,0,t.m_value.byteLength);case"FL":for(r=i.getFloat32(0,t.m_littleEndian).toString(),s=4;s+4<=i.byteLength;)r="".concat(r," \\ ").concat(i.getFloat32(s,t.m_littleEndian).toString()),s+=4;return r;case"FD":for(r=i.getFloat64(0,t.m_littleEndian).toString(),s=8;s+4+4<=i.byteLength;)r="".concat(r," \\ ").concat(i.getFloat64(s,t.m_littleEndian).toString()),s+=8;return r;case"IS":case"LO":case"LT":case"PN":case"SH":return e.getStringAt(i,0,t.m_value.byteLength);case"SL":for(r=i.getInt32(0,t.m_littleEndian).toString(),s=4;s+2<=i.byteLength;)r="".concat(r," \\ ").concat(i.getInt16(s,t.m_littleEndian).toString()),s+=4;return r;case"SS":for(r=i.getInt16(0,t.m_littleEndian).toString(),s=2;s+2<=i.byteLength;)r="".concat(r," \\ ").concat(i.getInt16(s,t.m_littleEndian).toString()),s+=2;return r;case"ST":return e.getStringAt(i,0,t.m_value.byteLength);case"TM":return a=e.getStringAt(i,0,t.m_value.byteLength),t.m_value.byteLength>=2&&(r="".concat(Number(a.slice(0,2)),"h")),t.m_value.byteLength>=4&&(r="".concat(r," ").concat(Number(a.slice(2,4)),"m")),t.m_value.byteLength>4&&(r="".concat(r," ").concat(parseFloat(a.slice(4,t.m_value.byteLength)),"s")),r;case"UI":return e.getStringAt(i,0,t.m_value.byteLength);case"UL":for(r=i.getUint32(0,t.m_littleEndian).toString(),s=4;s+4<=i.byteLength;)r="".concat(r," \\ ").concat(i.getUint32(s,t.m_littleEndian).toString()),s+=4;return r;case"US":for(r=i.getUint16(0,t.m_littleEndian).toString(),s=2;s+2<=i.byteLength;)r="".concat(r," \\ ").concat(i.getUint16(s,t.m_littleEndian).toString()),s+=2;return r;case"UT":return e.getStringAt(i,0,t.m_value.byteLength);default:return null}}},{key:"numberToHexString",value:function(e){for(var t=e.toString(16),i=4-t.length,a="",r=0;r<i;r++)a+="0";return"0x"+a+t}}]),e}(),Ri=function(){function e(){Object(u.a)(this,e),this.m_file=null,this.m_reader=null,this.m_request=null}return Object(h.a)(e,[{key:"readLocal",value:function(e){var t=this;return new Promise((function(i){t.m_file=e,t.m_reader=new FileReader,t.m_reader.addEventListener("load",(function(e){var t=e.target.result;i&&i(t)})),t.m_reader.readAsArrayBuffer(t.m_file)}))}},{key:"readFromUrl",value:function(e){var t=this;return new Promise((function(i,a){t.m_url=e,t.m_request=null;if(t.m_request=new XMLHttpRequest,!("withCredentials"in t.m_request))return t.m_request=null,void console.log("This browser cant support CORS requests");t.m_request.open("GET",t.m_url,!0),t.m_request.responseType="arraybuffer",t.m_request.addEventListener("load",(function(e){var t=e.target.response;null===t?console.log("Bad response type. Expect object type in response."):i(t)}),!1),t.m_request.addEventListener("error",(function(e){var t="Error event happend for XMLHttpRequest: loaded = ".concat(e.loaded,", total = ").concat(e.total);console.log(t),a(t)}),!1),t.m_request.send()}))}}]),e}(),wi=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,[{key:"readFromBufferHeader",value:function(t,i,a,r){console.assert(null!=t,"Null volume"),console.assert(t instanceof at,"Should be volume"),console.assert(null!=i,"Null array"),console.assert("ArrayBuffer"===i.constructor.name,"Should be ArrayBuf in arrBuf");var s=new Uint8Array(i);if(348!==s.length)return r&&r(rt.WRONG_HEADER_DATA_SIZE,null,0,null),!1;var o=0,n=e.readIntFromBuffer(s,o);if(o+=4,348!==n)return console.log("Hdr first int wrong: ".concat(n,", but should be ").concat(348)),r&&r(rt.BAD_HEADER,null,0,null),!1;var l=e.getStringAt(s,o,10);if(o+=10,t.m_dataType=0,"CHAR"===l&&(t.m_dataType=2,t.m_bytesPerVoxel=1),"SHORT"===l&&(t.m_dataType=4,t.m_bytesPerVoxel=2),0===t.m_dataType)return console.log("Hdr wrong data type. Should be CHAR or SHORT, but found: ".concat(l)),r&&r(rt.BAD_HEADER,null,0,null),!1;console.log("Hdr read data type = ".concat(l));o+=18;var m=e.readIntFromBuffer(s,o);o+=4;if(16384!==m)return console.log("Hdr wrong extents in header. Should be ".concat(16384,", but found: ").concat(m)),r&&r(rt.BAD_HEADER,null,0,null),!1;o+=2;var u=e.readByteFromBuffer(s,o);o+=1;if(114!==u)return console.log("Hdr wrong regular in header. Should be ".concat(114,", but found: ").concat(u)),r&&r(rt.BAD_HEADER,null,0,null),!1;o+=1,o+=2;var h=e.readShortFromBuffer(s,o);o+=2;var c=e.readShortFromBuffer(s,o);o+=2;var d=e.readShortFromBuffer(s,o);o+=2,t.m_xDim=h,t.m_yDim=c,t.m_zDim=d,console.log("HDR: volume dim = ".concat(t.m_xDim," * ").concat(t.m_yDim," * ").concat(t.m_zDim," "));o+=8;o+=4;o+=8,o+=2;var _=e.readShortFromBuffer(s,o);if(o+=2,2===t.m_dataType&&2!==_)return console.log("Wrong data tye for char typed header"),!1;if(4===t.m_dataType&&4!==_)return console.log("Wrong data tye for signed short typed header"),!1;var f=e.readShortFromBuffer(s,o);if(o+=2,2===t.m_dataType&&8!==f)return console.log("Wrong bits pix for char typed header"),!1;if(4===t.m_dataType&&16!==f)return console.log("Wrong bits pix for word typed header"),!1;o+=2,o+=4;var v=e.readFloatFromBuffer(s,o);o+=4;var p=e.readFloatFromBuffer(s,o);o+=4;var g=e.readFloatFromBuffer(s,o);o+=4;return o+=16,t.m_boxSize.x=t.m_xDim*v,t.m_boxSize.y=t.m_yDim*p,t.m_boxSize.z=t.m_zDim*g,console.log("HDR: physic size = ".concat(t.m_boxSize.x," * ").concat(t.m_boxSize.y," * ").concat(t.m_boxSize.z," ")),!0}},{key:"readFromBufferImage",value:function(e,t,i,a){console.assert(null!=e,"Null volume"),console.assert(e instanceof at,"Should be volume"),console.assert(null!=t,"Null array"),console.assert("ArrayBuffer"===t.constructor.name,"Should be ArrayBuf in arrBuf");var r=new Uint8Array(t).length;return r<8?(a&&a(rt.ERROR_TOO_SMALL_DATA_SIZE,null,0,null),!1):r>=241172480?(a&&a(rt.ERROR_TOO_LARGE_DATA_SIZE,null,0,null),!1):(e.m_imageBufferSize=r,e.m_arrBuf=t,console.log("readFromBufferImage complete with ".concat(r," bytes in image ")),!0)}},{key:"createVolumeFromHeaderAndImage",value:function(e){console.assert(null!=e,"Null volume"),console.assert(e instanceof at,"Should be volume");var t=0;2===e.m_dataType&&(t=1),4===e.m_dataType&&(t=2);var i=e.m_xDim*e.m_yDim*e.m_zDim,a=i*t;if(a!==e.m_imageBufferSize)return console.log("HDR: wrong IMG data size. Read: ".concat(e.m_imageBufferSize,", but expected ").concat(a," ")),!1;var r=e.m_arrBuf;if(4===e.m_dataType){var s,o=new Uint16Array(r);e.m_dataArray=new Uint8Array(i);var n=0;for(s=0;s<i;s++)n=o[s]>n?o[s]:n;n++;for(s=0;s<i;s++)e.m_dataArray[s]=Math.floor(255*o[s]/n)}else if(2===e.m_dataType){var l=new Uint8Array(r);e.m_dataArray=l}return e.m_bytesPerVoxel=1,e.m_dataSize=e.m_imageBufferSize,!0}},{key:"createRoiVolumeFromHeaderAndImage",value:function(e,t){console.assert(null!=e,"Null volume"),console.assert(e instanceof at,"Should be volume"),console.assert(null!=t,"Null volume"),console.assert(t instanceof at,"Should be volume");if(1!==e.m_bytesPerVoxel)return console.log("createRoiVolumeFromHeaderAndImage: bad volDst. m_bytesPerVoxel should be 1"),!1;if(1!==t.m_bytesPerVoxel)return console.log("createRoiVolumeFromHeaderAndImage: bad volRoi"),!1;if(e.m_xDim!==t.m_xDim||e.m_yDim!==t.m_yDim||e.m_zDim!==t.m_zDim)return console.log("createRoiVolumeFromHeaderAndImage: different volumes sizes"),!1;for(var i=e.m_xDim*e.m_yDim*e.m_zDim,a=new Uint8Array(4*i),r=t.m_arrBuf,s=new Uint8Array(r),o=0,n=0;n<i;n++,o+=4)a[o+0]=e.m_dataArray[n],a[o+1]=0,a[o+2]=0,a[o+3]=s[n];e.m_dataArray=a;return e.m_bytesPerVoxel=4,console.log("createRoiVolumeFromHeaderAndImage: success"),!0}},{key:"readFromUrl",value:function(e,t,i,a){console.log("readFromUrl. going to read from ".concat(t," ..."));var r=new jt;if(!r.isValidUrl(t))return console.log("readFromUrl: not vaild URL = = ".concat(t," ")),!1;this.m_folder=r.getFolderNameFromUrl(t);var s=r.getFileNameFromUrl(t),o=/(\w+)_intn.(h|hdr)/.exec(s);if(3!==o.length)return console.log("LoaderHdr.readFromUrl: bad URL name = ".concat(t,". Should be in template NNN_intn.h ")),!1;var n=o[1],l=this.m_folder+"/"+n+"_intn.h",m=this.m_folder+"/"+n+"_intn.img",u=this.m_folder+"/"+n+"_mask.h",h=this.m_folder+"/"+n+"_mask.img",c=[];return c.push(l),c.push(m),c.push(u),c.push(h),this.readFromUrls(c,e,i,a)}},{key:"readFromUrls",value:function(e,t,i,a){var r=this;console.assert(null!=t,"Null volume set"),console.assert(t instanceof Ei,"Should be volume set");var s=e.length;if(2===s){var o=e[0],n=e[1],l=new Ri,m=new Ri,u=o.indexOf(".h");if(-1===u&&(u=o.indexOf(".hdr")),-1===u){var h=o;o=n,n=h}var c=t.getVolume(0);l.readFromUrl(o).then((function(e){r.readFromBufferHeader(c,e,a,i),console.log("Load success HDR file: ".concat(o)),m.readFromUrl(n).then((function(e){r.readFromBufferImage(c,e,a,i),console.log("Load success IMG file: ".concat(n)),r.createVolumeFromHeaderAndImage(c),a(rt.SUCCESS)}))}),(function(e){return console.log("HDR File read error",e),a(rt.ERROR_CANT_OPEN_URL,null,0,null),!1}))}else{if(4!==s)return console.log("Error read hdr files. Should be ".concat(2," files")),!1;var d=e[0],_=e[1],f=e[2],v=e[3],p=new Ri,g=new Ri,S=new Ri,x=new Ri,b=new at,y=t.getVolume(0);p.readFromUrl(d).then((function(e){r.readFromBufferHeader(y,e,a,i),console.log("Load success HDR file: ".concat(d)),g.readFromUrl(_).then((function(e){r.readFromBufferImage(y,e,a,i),console.log("Load success IMG file: ".concat(_)),S.readFromUrl(f).then((function(e){r.readFromBufferHeader(b,e,a,i),x.readFromUrl(v).then((function(e){r.readFromBufferImage(b,e,a,i),r.createVolumeFromHeaderAndImage(y),r.createRoiVolumeFromHeaderAndImage(y,b),a(rt.SUCCESS)}))}))}))}),(function(e){return console.log("HDR File read error",e),!1}))}return!0}}],[{key:"readByteFromBuffer",value:function(e,t){return e[t]}},{key:"readIntFromBuffer",value:function(e,t){return e[t+0]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24}},{key:"readShortFromBuffer",value:function(e,t){return e[t+0]|e[t+1]<<8}},{key:"readFloatFromBuffer",value:function(e,t){var i=new ArrayBuffer(4),a=new DataView(i);a.setUint8(0,e[t+0]),a.setUint8(1,e[t+1]),a.setUint8(2,e[t+2]),a.setUint8(3,e[t+3]);return a.getFloat32(0,!0)}},{key:"getStringAt",value:function(e,t,i){for(var a="",r=0;r<i;r++){var s=e[t+r];if(0===s)break;a+=String.fromCharCode(s)}return a}}]),e}(),Ei=function(e){Object(S.a)(i,e);var t=Object(x.a)(i);function i(e){var a;return Object(u.a)(this,i),(a=t.call(this,e)).m_numVolumes=0,a.m_volumes=[],a.m_patientName="",a.m_patientBirth="",a.m_seriesDescr="",a.m_studyDescr="",a.m_studyDate="",a.m_seriesTime="",a.m_bodyPartExamined="",a.m_institutionName="",a.m_operatorsName="",a.m_physicansName="",a}return Object(h.a)(i,[{key:"addVolume",value:function(e){console.assert(e instanceof at,"VolumeSet.addVolume: arg must be Volume"),this.m_volumes.push(e),this.m_numVolumes++}},{key:"getNumVolumes",value:function(){return this.m_numVolumes}},{key:"getVolume",value:function(e){return console.assert(Number.isInteger(e),"VolumeSet.getVolume: arg must be number"),console.assert(e<this.m_numVolumes,"index of volume should be in range"),console.assert(e>=0,"index of volume should be non negative"),e<0||e>=this.m_numVolumes?null:this.m_volumes[e]}},{key:"checkVolume",value:function(){var e=this.m_numVolumes;if(e<=1)return console.log("volumes is less than or equal to one: ",e),!0;for(var t=new Array(e),i=0;i<e;i++){var a=this.getVolume(i);if(null===a)return!1;t[i]=a.m_dataArray.length}for(var r=1;r<e;r++)if(console.assert(t[r-1]===t[r],"volume size mismatch. Phase ",r-1," size is ",t[r-1]," and phase ",r," size is ",t[r]),t[r-1]!==t[r])return!1;for(var s=1;s<e;s++){var o=this.getVolume(s-1),n=this.getVolume(s);console.log(o,n);for(var l=0;l<t[s];l++)if(o.m_dataArray[l]!==n.m_dataArray[l])return console.log("volumes for phases ",s-1," and ",s," are different at pixel: ",l," with values: ",o.m_dataArray[l]," and ",n.m_dataArray[l]),!1}return console.log("volumes are the same"),!0}},{key:"render",value:function(){return null}},{key:"readFromKtx",value:function(e,t,i){console.assert(null!=e),console.assert("ArrayBuffer"===e.constructor.name,"Should be ArrayBuf in arrBuf");var a=new ht,r=this.getVolume(0);return a.readFromBuffer(r,e,t,i)}},{key:"readFromKtxUrl",value:function(e,t,i){var a=new ht,r=this.getVolume(0);a.readFromUrl(r,e,t,i)}},{key:"readFromNiiUrl",value:function(e,t,i){var a=new vt,r=this.getVolume(0);return a.readFromUrl(r,e,t,i)}},{key:"readFromDicomUrl",value:function(e,t,i){return new Oi(0).readFromUrl(this,e,t,i)}},{key:"readFromHdrUrl",value:function(e,t,i){return(new wi).readFromUrl(this,e,t,i)}},{key:"readFromNifti",value:function(e,t,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,r=new vt,s=r.readShortFromBuffer(e,40);if(console.log(this.getNumVolumes(),s),4===s){var o=r.readShortFromBuffer(e,48);for(console.log(o);this.getNumVolumes()<o;)this.addVolume(new at)}return null!==a?r.readFromBuffer(this.m_volumes,e,t,i,a):r.readFromBuffer(this.m_volumes,e,t,i)}},{key:"readFromDicom",value:function(e,t,i,a){return e.readFromBuffer(0,"file???",0,t,i,a)}},{key:"readSingleSliceFromDicom",value:function(e,t,i,a,r,s,o){return e.readFromBuffer(t,i,a,r,s,o)}}]),i}(s.a.Component),ji={socket:it.socket,showLoader:!1,fileName:"brain.ktx",notification:{body:"",header:"",isVisible:!1,status:null,icon:null,spin:!1,timer:null},doctorView:{isLoaded:!1,loadedScan:"",patients:[],status:"Bleeding",rateOfLeakage:.31,volumeOfLeakage:-1,timeOfStroke:7320,title:"CT Head or Brain W/O&W",date:new Date(2006,9,6),phaseTimes:[4,6,8,10,12,14,16,18,20,22,24,26,28,33,38,43,48,53],zoom:.9},nurseView:{isLoaded:!1,patients:[],status:"Not Bleeding",rateOfLeakage:-1,volumeOfLeakage:-1,timeOfStroke:0,title:"CT Head or Brain W/O&W",date:new Date(2006,9,6)},visState:{volumeSet:new Ei({}),spotColor:new E.U(1,1,1),showVenousStructure:!0,loadingBarRatio:50,volumeIndex:0,texture3d:null,modeView:y.VIEW_3D_LIGHT,mode2d:T.TRANSVERSE,slider2d:.5,slider3d_r:.09,slider3d_g:.3,slider3d_b:.46,mode3d:D.RAYCAST,mode3droi:O.RAYCAST,sliderOpacity:.53,sliderIsosurface:.46,sliderBrightness:.56,sliderCut:1,sliderQuality:.35,sliderErRadius:50,sliderErDepth:50,volumeRenderer:null,indexTools2d:0,render2dZoom:1,render2dxPos:0,render2dyPos:0,graphics2d:null,uiApp:null,dicomInfo:null,isTool3D:!1,volumeOpacity:1,sliderContrast3D:0,arrErrors:[],dicomSeries:[],loaderDicom:null},options:{moduleOne:{processTimingData:!0,build4d:!0,build3d:!0,compute4dSummary:!0,saveAvailableData:!0,reloadTimingIndices:!0,stopIfOptionsChange:!1,autoSelectLargest:!0,autoSelectFirstLargest:!1,autoSelectLastLargest:!0,setTimeSeparationMin:"0",setTimeSeparationMax:"60",imageSetIndex:"0"},moduleTwo:{dataOutput:"C:\\Workspaces\\carl",modality:"CT",vendor:"Toshiba",scanner:"320",process:"DCE",region:"Brain",study:"ICH",restartEnabled:!0,minimum3d:"0.125",includeMinThreshold:!0,includeMaxThreshold:!1,useMorphologicalOperations:!0,strfiDisk:"5",strfi3d:"2",imageRegion:"Minimum",minimumConnected:"0.2",coarseRadius:"20",strfiRadius:"1.5",imageIndexRange:"All"},moduleThree:{minimumNumber:"50",numberOfBins:"400",distributionTail:"0.01",feature:"Median Value",medianMin:"0.3",medianMax:"0.4",peakRangeMin:"0.3",peakRangeMax:"0.4",probabilityMin:"0",probabilityMax:"0.97",nonNegativeValues:!0,nonZeroValues:!0},moduleFour:{enableRestart:!0,vascularMaskDirectory:"",outputDataDirectory:""}}},Mi=function(e){return e.map((function(t){return{scanId:t[0],startTime:t[1]?new Date(t[1]):new Date,endTime:t[2]?new Date(t[2]):new Date,currentModule:t[3],progress:t[4],mlStatus:t[5],failed:t[6],initiator:e[7],outputLocation:t[8],phases:t[9],patientName:t[10],patientAge:t[11],patientSex:t[12],scanTime:t[13]?new Date(t[13]):new Date}}))},Ai=function(e){return e.map((function(e){return{scanId:e[0],marker:e[1],value:e[2],postTime:e[3]?new Date(e[3]):new Date}}))},Ii=function(e){var t=e.toLocaleDateString(),i="".concat(e.getHours().toString().padStart(2,"0"),":").concat(e.getMinutes().toString().padStart(2,"0"));return"".concat(t," ").concat(i)},Ci=function(e,t){var i=t[0],a=e.nurseView.patients.findIndex((function(e){return e.scanId===i.scanId})),r=e.doctorView.patients.findIndex((function(e){return e.scanId===i.scanId})),s=Object(p.a)(e.nurseView.patients),o=Object(p.a)(e.doctorView.patients);return 5===i.currentModule?a>=0?(s.splice(a,1),o.push(i)):r>=0?o[r]=i:o.push(i):a>=0?s[a]=i:r>=0?(o.splice(r,1),s.push(i)):s.push(i),[s,o]},Xi=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ji,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case b.SET_IS_LOADED:return Object(w.a)(Object(w.a)({},e),{},{doctorView:Object(w.a)(Object(w.a)({},e.doctorView),{},{isLoaded:t.isLoaded})});case b.SET_LOADER:return Object(w.a)(Object(w.a)({},e),{},{showLoader:t.showLoader});case b.SET_SPOT_COLOR:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{spotColor:[t.r,t.g,t.b]})});case b.SET_VOLUME_OPACITY:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{volumeOpacity:t.volumeOpacity})});case b.SET_SHOW_VENOUS_STRUCTURE:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{showVenousStructure:t.showVenousStructure})});case b.SET_SCANID:return Object(w.a)(Object(w.a)({},e),{},{doctorView:Object(w.a)(Object(w.a)({},e.doctorView),{},{loadedScan:t.loadedScan})});case b.SET_VOLUME_SET:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{volumeSet:t.volumeSet})});case b.SET_TEXTURE3D:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{texture3d:t.texture3d})});case b.SET_VOLUME_INDEX:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{volumeIndex:t.volumeIndex})});case b.SET_MODE_VIEW:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{modeView:t.modeView})});case b.SET_MODE_2D:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{mode2d:t.mode2d})});case b.SET_SLIDER_2D:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{slider2d:t.slider2d})});case b.SET_MODE_3D:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{mode3d:t.mode3d})});case b.SET_MODE_3Droi:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{mode3droi:t.mode3droi})});case b.SET_SLIDER_3DR:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{slider3d_r:t.slider3d_r})});case b.SET_SLIDER_3DB:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{slider3d_b:t.slider3d_b})});case b.SET_SLIDER_3DG:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{slider3d_g:t.slider3d_g})});case b.SET_SLIDER_Opacity:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{sliderOpacity:t.sliderOpacity})});case b.SET_SLIDER_Isosurface:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{sliderIsosurface:t.sliderIsosurface})});case b.SET_SLIDER_ErRadius:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{sliderErRadius:t.sliderErRadius})});case b.SET_SLIDER_ErDepth:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{sliderErDepth:t.sliderErDepth})});case b.SET_VOLUME_Renderer:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{volumeRenderer:t.volumeRenderer})});case b.SET_SLIDER_Brightness:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{sliderBrightness:t.sliderBrightness})});case b.SET_SLIDER_Cut:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{sliderCut:t.sliderCut})});case b.SET_SLIDER_Quality:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{sliderQuality:t.sliderQuality})});case b.SET_2D_TOOLS_INDEX:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{indexTools2d:t.indexTools2d})});case b.SET_2D_X_POS:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{render2dxPos:t.render2dxPos})});case b.SET_2D_ZOOM:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{render2dZoom:t.render2dZoom})});case b.SET_2D_Y_POS:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{render2dyPos:t.render2dyPos})});case b.SET_UI_APP:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{uiApp:t.uiApp})});case b.SET_DICOM_INFO:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{dicomInfo:t.dicomInfo})});case b.SET_IS_TOOL3D:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{isTool3D:t.isTool3D})});case b.SET_GRAPHICS_2D:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{graphics2d:t.graphics2d})});case b.SET_SLIDER_Contrast3D:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{sliderContrast3D:t.sliderContrast3D})});case b.SET_ERR_ARRAY:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{arrErrors:t.arrErrors})});case b.SET_DICOM_SERIES:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{dicomSeries:t.dicomSeries})});case b.SET_LOADER_DICOM:return Object(w.a)(Object(w.a)({},e),{},{visState:Object(w.a)(Object(w.a)({},e.visState),{},{loaderDicom:t.loaderDicom})});case b.SET_3D_ZOOM:return Object(w.a)(Object(w.a)({},e),{},{doctorView:Object(w.a)(Object(w.a)({},e.doctorView),{},{zoom:t.zoom})});case b.SET_PATIENT_DATA:var i=Mi(t.payload);return Object(w.a)(Object(w.a)({},e),{},{doctorView:Object(w.a)(Object(w.a)({},e.doctorView),{},{patients:i.filter((function(e){return 5===e.currentModule}))}),nurseView:Object(w.a)(Object(w.a)({},e.nurseView),{},{patients:i.filter((function(e){return 5!==e.currentModule}))})});case b.UPDATE_PATIENT_DATA:var a=Mi([t.payload]),r=Ci(e,a),s=Object(l.a)(r,2),o=s[0],n=s[1];return Object(w.a)(Object(w.a)({},e),{},{doctorView:Object(w.a)(Object(w.a)({},e.doctorView),{},{patients:n}),nurseView:Object(w.a)(Object(w.a)({},e.nurseView),{},{patients:o})});case b.UPDATE_BIOMARKER_DATA:var m=Ai([t.payload])[0];return console.log(m),"V0"===m.marker?e.doctorView.volumeOfLeakage=m.value:"K1"===m.marker&&(e.doctorView.rateOfLeakage=m.value),-1!==e.doctorView.rateOfLeakage&&-1!==e.doctorView.volumeOfLeakage&&(e.doctorView.timeOfStroke=Math.round(e.doctorView.volumeOfLeakage/e.doctorView.rateOfLeakage*100)/100,e.doctorView.status="Bleeding"),Object(w.a)({},e);case b.SET_NOTIFICATION:return Object(w.a)(Object(w.a)({},e),{},{notification:t.payload});case b.SET_PHASETIMES:return Object(w.a)(Object(w.a)({},e),{},{doctorView:Object(w.a)(Object(w.a)({},e.doctorView),{},{phaseTimes:t.payload})});case b.SET_INPUT:var u=t.payload,h=u.module,c=u.name,d=u.value,_=Object(w.a)(Object(w.a)({},e),{},{options:Object(w.a)({},e.options)});return _.options.moduleOne=Object(w.a)({},e.options.moduleOne),_.options.moduleTwo=Object(w.a)({},e.options.moduleTwo),_.options.moduleThree=Object(w.a)({},e.options.moduleThree),_.options.moduleFour=Object(w.a)({},e.options.moduleFour),_.options[h][c]=d,_;default:return Object(w.a)({},e)}},Fi=Object(r.createContext)({}),ki=function(e){var t=Object(r.useReducer)(Xi,ji),i=Object(l.a)(t,2),s=i[0],o=i[1];return Object(a.jsx)(Fi.Provider,{value:[s,o],children:e.children})},Ui=i(26),Ni=i.n(Ui),Vi=i(43),Li=i(44),Pi=function(){function e(){Object(u.a)(this,e),this.m_texture=-1}return Object(h.a)(e,[{key:"createFromRawVolume",value:function(e){this.m_texture=new E.l(e.m_dataArray,e.m_xDim,e.m_yDim,e.m_zDim)}}]),e}();!function(e){e.SUCCESS="success",e.FAILURE="failure"}(st||(st={}));var Bi=i(130),zi=i.n(Bi),Gi=i.p+"static/media/module4demoSubset_fake.nii.ce5cdb22.gz",Wi=function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,[{key:"getFileName",value:function(){var e=Object(Vi.a)(Ni.a.mark((function e(t){return Ni.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,zi.a.get(Gi,{responseType:"blob",params:{scan_id:t,tc:(new Date).getTime()}});case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",e.t0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()},{key:"getTiming",value:function(){var e=Object(Vi.a)(Ni.a.mark((function e(t){return Ni.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",JSON.parse("[\n      5e-05,\n      2.1e-05,\n      2e-05,\n      3e-05,\n      2e-05,\n      2e-05,\n      2e-05,\n      3e-05,\n      2e-05,\n      2.1e-05,\n      3e-05,\n      2e-05,\n      2e-05,\n      6e-05,\n      6.1e-05,\n      5e-05,\n      6e-05,\n      6.1e-05\n    ]"));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function Hi(){return new Worker(i.p+"static/js/file-worker.6dc4a3ec.worker.js")}var qi=function(){var e=Object(Vi.a)(Ni.a.mark((function e(t,i){var a,r,s,o,n,l;return Ni.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=new Wi,t({type:b.SET_NOTIFICATION,payload:{body:"",header:"Loading 4D Image",isVisible:!0,icon:Li.d,spin:!0,timer:null}}),e.next=4,a.getFileName(i);case 4:if(!((r=e.sent)instanceof Error)){e.next=8;break}return t({type:b.SET_NOTIFICATION,payload:{body:"Couldn't find an image",header:"Loading failed",isVisible:!1,status:st.FAILURE,icon:Li.e,timer:4e3}}),e.abrupt("return");case 8:console.log(r),(s=new Hi).postMessage({data:r.data,scanId:i}),s.onerror=function(e){s.terminate(),t({type:b.SET_NOTIFICATION,payload:{body:"An error occurred while loading the image.",header:"Loading failed",isVisible:!1,status:st.FAILURE,icon:Li.e,timer:4e3}}),console.log(e)},l=[],s.onmessage=function(e){var a=e.data,r=a.status,m=a.volume,u=a.volumeSet,h=a.tex3d,c=a.data;switch(r){case"start":o=Object.assign(new Pi,JSON.parse(h)),console.log("Volume loaded, transferring from worker...");break;case"vol":var d=Object.assign(new Pi,JSON.parse(m));d.m_dataArray=c,l.push(d),console.log("   Got volume ".concat(l.length));break;case"end":(n=Object.assign(new Ei({}),JSON.parse(u))).m_volumes=l;var _=Object.assign(new Ei({}),n);t({type:b.SET_LOADER,showLoader:!0}),t({type:b.SET_VOLUME_SET,volumeSet:_}),t({type:b.SET_VOLUME_INDEX,volumeIndex:l.length-1}),t({type:b.SET_IS_LOADED,isLoaded:!0}),t({type:b.SET_SCANID,loadedScan:i}),t({type:b.SET_ERR_ARRAY,arrErrors:[]}),t({type:b.SET_TEXTURE3D,texture3d:o}),t({type:b.SET_MODE_VIEW,modeView:y.VIEW_2D}),t({type:b.SET_MODE_3D,mode3d:D.RAYCAST}),t({type:b.SET_NOTIFICATION,payload:{body:"",header:"Success",isVisible:!1,status:st.SUCCESS,icon:Li.a,timer:4}}),console.log("Volume transferring finished."),s.terminate();break;case"fail":default:s.terminate()}};case 14:case"end":return e.stop()}}),e)})));return function(t,i){return e.apply(this,arguments)}}();function Yi(e){var t=e.progress,i=e.radius,r=e.stroke,s=i-2*r,o=2*s*Math.PI,n=o-t/100*o;return Object(a.jsx)("svg",{height:2*i,width:2*i,children:Object(a.jsx)("circle",{stroke:"lightgreen",fill:"transparent",strokeWidth:r,strokeDasharray:o+" "+o,style:{strokeDashoffset:n},r:s,cx:i,cy:i})})}i(163);function Zi(e){var t=e.isNurse,i=Object(r.useContext)(Fi),s=Object(l.a)(i,2),o=s[0],n=s[1],m=t?o.nurseView.patients:o.doctorView.patients,u=function(e){switch(e){case 0:return"Initializing";case 1:return"Preprocessing";case 2:return"Extract Brain Region";case 3:return"Vascular Segmentation";case 4:return"Dynamic Spot Selection";case 5:return"Completed"}},h=function(){var e=Object(Vi.a)(Ni.a.mark((function e(t){return Ni.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o.doctorView.loadedScan===t){e.next=6;break}return e.next=3,qi(n,t);case 3:return e.abrupt("return",e.sent);case 6:return e.abrupt("return",n({type:b.SET_IS_LOADED,isLoaded:!0}));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(a.jsx)("div",{className:"file-list fill",children:Object(a.jsx)("div",{className:"col-12 px-0 py-4 flex center top",children:Object(a.jsxs)("div",{className:"col-8 p-0 flex center top ",children:[Object(a.jsx)("h3",{className:"header",children:"Patient Files"}),!m.length&&Object(a.jsx)("div",{className:"col-12 flex space-around",children:Object(a.jsxs)("div",{className:"col-12",style:{color:"grey"},children:["No ",t?"in-progress":"completed"," scans."]})}),!!m.length&&m.map((function(e){return Object(a.jsxs)("div",{className:"col-12 flex space-between file-item",onClick:Object(Vi.a)(Ni.a.mark((function t(){return Ni.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,h(e.scanId);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))),children:[Object(a.jsx)("div",{className:"col-5 flex left",children:e.patientName||e.scanId}),Object(a.jsx)("div",{className:"col-3 flex left",children:Ii(e.startTime)}),Object(a.jsxs)("div",{className:"col-4 p-0 flex right",children:[Object(a.jsxs)("div",{className:"pr-1",children:["(",u(e.currentModule),")"]}),e.progress,"%",Object(a.jsx)(Yi,{radius:10,stroke:2,progress:e.progress})]})]},e.scanId)}))]})})})}var Ki=i(95),Qi=i.n(Ki),Ji=i(72),$i=i.n(Ji);i(182),i(106);var ea=function(){var e=Object(r.useContext)(Fi),t=Object(l.a)(e,2),i=t[0],o=t[1],n=Object(r.useState)(!1),m=Object(l.a)(n,2),f=m[0],p=m[1],g=Object(r.useState)("Loading..."),S=Object(l.a)(g,2),x=S[0],y=S[1],T=Object(r.useState)(0),O=Object(l.a)(T,2),R=O[0],w=O[1],E=Object(r.useState)(!1),j=Object(l.a)(E,2),M=j[0],A=j[1],I=["Anterior Axial","Coronal"],C=Object(r.useState)(0),X=Object(l.a)(C,2),F=X[0],k=X[1],U=s.a.useRef(null),N=s.a.useRef(null),V=s.a.useRef(null),L=s.a.useRef(null),P=i.visState.volumeSet,B=[i.visState.volumeIndex],z=(i.visState.volumeOpacity,i.visState.mode3d===D.RAYCAST),G=i.visState.showVenousStructure,W=0;null!==P&&void 0!==P&&(W=P.getNumVolumes()),Object(r.useEffect)((function(){var e=new(function(){function e(){Object(u.a)(this,e)}return Object(h.a)(e,[{key:"doHideProgressBar",value:function(){p(!1)}},{key:"doShowProgressBar",value:function(e){y(e),p(!0)}},{key:"doSetProgressBarRatio",value:function(e){e>=0&&e<=99&&(f||p(!0),w(e))}}]),e}());o({type:b.SET_UI_APP,uiApp:e}),o({type:b.SET_VOLUME_INDEX,volumeIndex:W-1})}),[]);var H,q=Object(a.jsx)("div",{className:"col-12 flex center",style:{marginTop:"auto"},children:Object(a.jsxs)(c.a,{xs:!0,xl:!0,sm:!0,md:!0,lg:"12",style:{width:"100%",color:"whitesmoke"},children:[x,Object(a.jsx)(d.a,{animated:!0,variant:"success",now:R,label:"".concat(R,"%")})]})}),Y=function(e,t){e/=10,e=Number.parseFloat(e.toFixed(1)),void 0!==t&&(e=1===t?(e+=.1)>2?2:e:(e-=.1)<.5?.5:e),o({type:b.SET_3D_ZOOM,zoom:e}),i.visState.volumeRenderer.orbitControl.setZoom(e)};return Object(a.jsxs)("div",{className:"col-12 p-0 flex fill",children:[!i.doctorView.isLoaded&&Object(a.jsx)(Zi,{isNurse:!1}),i.doctorView.isLoaded&&Object(a.jsxs)("div",{className:"overlay flex",children:[Object(a.jsxs)("div",{className:"col-3 p-3 flex left",children:[Object(a.jsx)("div",{className:"col-12 p-0 flex left data-header",children:"Status"}),Object(a.jsx)("h3",{className:"data-large",children:i.doctorView.status}),Object(a.jsx)("div",{className:"col-12 p-0 flex left data-header",children:"Est. Rate of Leakage"}),Object(a.jsxs)("h3",{className:"data-large",children:[i.doctorView.rateOfLeakage," ml/min"]}),Object(a.jsx)("div",{className:"col-12 p-0 flex left data-header",children:"Est. Time of Stroke"}),Object(a.jsxs)("h3",{className:"data-large",children:[i.doctorView.timeOfStroke/60," min"]}),Object(a.jsx)("div",{className:"col-12 p-0 flex left",children:Object(a.jsx)("button",{className:"button-main",style:{background:z?"":"dimgrey"},onClick:function(){o(z?{type:b.SET_MODE_3D,mode3d:D.RAYFAST}:{type:b.SET_MODE_3D,mode3d:D.RAYCAST})},children:"Reveal SPOT"})}),i.visState.volumeRenderer&&Object(a.jsx)("div",{className:"col-12 p-0 flex left",children:Object(a.jsx)("button",{className:"button-main",style:{background:M?"dimgrey":""},onClick:function(){return A(i.visState.volumeRenderer.setAutoSpin(!M))},children:"Auto rotate"})}),Object(a.jsx)("div",{className:"col-12 p-0 flex left",children:Object(a.jsx)("button",{className:"button-main",style:{background:G?"dimgrey":""},onClick:function(){o({type:b.SET_SHOW_VENOUS_STRUCTURE,showVenousStructure:!G})},children:"Show Venous Structure"})}),Object(a.jsxs)("div",{className:"col-12 p-0 flex left",children:[Object(a.jsx)("div",{className:"data-header",children:"Orientation"}),Object(a.jsxs)(_.a,{className:"dropdown",id:"dropdown-basic-button",onSelect:function(e,t){var a=Number.parseInt(t.target.id);i.visState.volumeRenderer&&(i.visState.volumeRenderer.setPresetView(a),k(a))},children:[Object(a.jsx)(_.a.Toggle,{id:JSON.stringify(Math.random()),children:I[F]}),Object(a.jsx)(_.a.Menu,{children:I.map((function(e,t){return Object(a.jsx)(_.a.Item,{id:t,children:e})}))})]})]}),Object(a.jsxs)("div",{className:"col-auto p-0 flex column small-slider vertical",children:[Object(a.jsx)("i",{className:"fas fa-search-plus mb-3",style:{color:"white",cursor:"pointer"},onClick:function(){return Y(L.current.slider.get(),0)}}),Object(a.jsx)(v.a,{onSlide:function(e){return Y(e)},range:{min:5,max:20},animate:!1,ref:L,orientation:"vertical",width:10,start:10*i.doctorView.zoom,connect:[!1,!0],step:1,tooltips:!1,format:Qi()({decimals:1})}),Object(a.jsx)("i",{className:"fas fa-search-minus  mt-3",style:{color:"white",cursor:"pointer"},onClick:function(){return Y(L.current.slider.get(),1)}})]})]}),Object(a.jsx)("div",{className:"col-6 p-0"}),Object(a.jsxs)("div",{className:"col-3 p-4 flex right top",children:[Object(a.jsx)("div",{className:"col-12 p-0 data-header flex right",children:"John Doe"}),Object(a.jsx)("div",{className:"col-12 p-0 data-header flex right",children:i.doctorView.title}),Object(a.jsx)("div",{className:"col-12 p-0 data-header flex right",children:(H=i.doctorView.date,H.toDateString())}),Object(a.jsx)("div",{className:"col-12 p-0 data-header flex right",children:"Age: 72"}),Object(a.jsx)("div",{className:"col-12 p-0 data-header flex right",children:"Sex: M"}),Object(a.jsx)("div",{className:"col-12 p-0",children:Object(a.jsx)("button",{className:"button-main",onClick:function(){return o({type:b.SET_LOADER,showLoader:!1}),void o({type:b.SET_IS_LOADED,isLoaded:!1})},children:"Close"})}),Object(a.jsx)("div",{className:"col-12 pt-2 px-0 flex data-header right",children:Object(a.jsxs)("b",{children:["Volume Opacity: ",(100*i.visState.volumeOpacity).toFixed(0),"%"]})}),Object(a.jsx)("div",{className:"col-auto p-0 flex small-slider vertical",children:Object(a.jsx)(v.a,{onSlide:function(e){o({type:b.SET_VOLUME_OPACITY,volumeOpacity:e/100})},range:{min:0,max:100},ref:V,direction:"rtl",start:100*i.visState.volumeOpacity,connect:[!0,!1],orientation:"vertical",step:1})})]}),Object(a.jsx)("div",{className:"col-12 p-0 flex center slider-container",children:Object(a.jsxs)("div",{className:"col-8 p-4 slider",children:[W>1&&Object(a.jsx)(v.a,{onSet:function(e){return t=e,void(U.current&&U.current.isLoaded?o({type:b.SET_VOLUME_INDEX,volumeIndex:Number.parseInt(t[0])}):N.current&&N.current.set(i.visState.volumeIndex));var t},range:{min:0,max:W-1},ref:N,style:{height:100,cursor:"pointer"},start:B,connect:[!0,!1],step:1,tooltips:!0,format:Qi()({decimals:0})}),i.doctorView.phaseTimes.length>0&&W>1&&Object(a.jsxs)("div",{className:"col-12 p-0 flex space-between",children:[Object(a.jsxs)("div",{className:"data-header flex center column tick",children:[Object(a.jsx)("div",{className:"tick-line"}),Object(a.jsx)("h5",{children:"0s"})]}),i.doctorView.phaseTimes.map((function(e){return Object(a.jsxs)("div",{className:"data-header flex center column tick",children:[Object(a.jsx)("div",{className:"tick-line"}),Object(a.jsxs)("h5",{children:[e,"s"]})]})}))]})]})})]}),Object(a.jsx)("div",{className:"loader-container",children:Object(a.jsx)($i.a,{type:"ThreeDots",color:"#95afcd",height:250,width:250,visible:i.showLoader})}),i.doctorView.isLoaded&&Object(a.jsx)("div",{className:"flex col-12",children:Object(a.jsx)("div",{className:"col-12 flex graphics-center",children:Object(a.jsx)(tt,{ref:U,store:i,dispatch:o})})}),f?q:null]})},ta=i(132),ia=i(23);function aa(){return Object(a.jsxs)("div",{className:"col-12 p-0 flex fill center",children:[Object(a.jsx)("h2",{className:"header",children:"I am a"}),Object(a.jsxs)("div",{className:"col-12 p-0 flex center",children:[Object(a.jsxs)(ta.a,{className:"m-2 button-main button-large",children:[" ",Object(a.jsx)(ia.b,{to:"/doctor",children:"Doctor"})]}),Object(a.jsxs)(ta.a,{className:"m-2 button-main button-large",children:[" ",Object(a.jsx)(ia.b,{to:"/nurse",children:"Nurse"})," "]}),Object(a.jsxs)(ta.a,{className:"m-2 button-main button-large",children:[" ",Object(a.jsx)(ia.b,{to:"/radiologist",children:"Radiologist"})," "]})]})]})}function ra(){var e=Object(r.useContext)(Fi),t=Object(l.a)(e,2),i=t[0],o=t[1],n=(Object(m.f)(),s.a.useRef(null)),u=i.visState.volumeSet;null!==u&&void 0!==u&&u.getNumVolumes();var h;return Object(a.jsxs)("div",{className:"col-12 p-0 flex fill",children:[!i.doctorView.isLoaded&&Object(a.jsx)(Zi,{isNurse:!0}),i.doctorView.isLoaded&&Object(a.jsxs)("div",{className:"overlay flex",children:[Object(a.jsxs)("div",{className:"col-3 p-3 flex left",children:[Object(a.jsx)("div",{className:"col-12 p-0 flex left data-header",children:"Status"}),Object(a.jsx)("h3",{className:"data-large",children:i.doctorView.status}),Object(a.jsx)("div",{className:"col-12 p-0 flex left data-header",children:"Est. Rate of Leakage"}),Object(a.jsxs)("h3",{className:"data-large",children:[i.doctorView.rateOfLeakage," ml/s"]}),Object(a.jsx)("div",{className:"col-12 p-0 flex left data-header",children:"Est. Time of Stroke"}),Object(a.jsxs)("h3",{className:"data-large",children:[i.doctorView.timeOfStroke," s"]})]}),Object(a.jsx)("div",{className:"col-6 p-0"}),Object(a.jsxs)("div",{className:"col-3 p-4 flex right top",children:[Object(a.jsx)("div",{className:"col-12 p-0 data-header flex right",children:i.doctorView.title}),Object(a.jsx)("div",{className:"col-12 p-0 data-header flex right",children:(h=i.doctorView.date,h.toDateString())}),Object(a.jsx)("button",{className:"button-main",onClick:function(){return o({type:b.SET_LOADER,showLoader:!1}),void o({type:b.SET_IS_LOADED,isLoaded:!1})},children:"Close"})]})]}),Object(a.jsx)("div",{className:"loader-container",children:Object(a.jsx)($i.a,{type:"ThreeDots",color:"#95afcd",height:250,width:250,visible:i.showLoader})}),i.doctorView.isLoaded&&Object(a.jsx)("div",{className:"col-12 flex graphics-center",children:Object(a.jsx)(tt,{ref:n,store:i,dispatch:o})})]})}var sa=i(217);function oa(e){var t=e.label,i=e.reset,s=e.defaultValue,o=e.module,n=e.name,m=Object(r.useContext)(Fi),u=Object(l.a)(m,2),h=u[0],c=u[1],d=h.options[o][n];Object(r.useEffect)((function(){console.log(i),i&&_(s)}),[i]);var _=function(e){c({type:b.SET_INPUT,payload:{module:o,name:n,value:e}})};return Object(a.jsx)(sa.a.Group,{controlId:"formBasicPassword",className:"flex left",children:Object(a.jsx)(sa.a.Check,{type:"checkbox",checked:d,label:t,onChange:function(e){_(!d)}})})}function na(e){var t=e.label,i=e.reset,s=e.defaultValue,o=e.placeholder,n=e.module,m=e.name,u=Object(r.useContext)(Fi),h=Object(l.a)(u,2),c=h[0],d=h[1],_=c.options[n][m];Object(r.useEffect)((function(){i&&f(s)}),[i]);var f=function(e){d({type:b.SET_INPUT,payload:{module:n,name:m,value:e}})};return Object(a.jsx)("div",{className:"flex",children:Object(a.jsxs)(sa.a.Group,{controlId:_,className:"flex left",children:[Object(a.jsx)(sa.a.Label,{children:t}),Object(a.jsx)(sa.a.Control,{value:_,type:"email",placeholder:o,onChange:function(e){return function(e){console.log(e),f(e.target.value)}(e)}})]})})}var la=i(78),ma=function(e){var t=Object(r.useState)(!0),i=Object(l.a)(t,2),s=i[0],o=i[1];return Object(a.jsxs)("div",{className:"module-container col-12 p-1",children:[Object(a.jsxs)("h5",{className:"space-between header pointer col-12 p-0 flex",onClick:function(){return o(!s)},children:[e.title,Object(a.jsx)("i",{children:Object(a.jsx)(la.a,{icon:s?Li.b:Li.c})})]}),!s&&Object(a.jsx)("div",{className:"flex text",children:e.children})]})};function ua(e){var t=e.reset,i=Object(r.useContext)(Fi);Object(l.a)(i,2)[1];return Object(a.jsx)(ma,{title:"Dynamic Spot Extraction Options (Module 4)",children:Object(a.jsxs)("div",{className:"flex column fill col-12",children:[Object(a.jsx)("b",{className:"fit p-0 flex",children:"General Options"}),Object(a.jsx)(oa,{label:"Restart Enabled",defaultValue:!0,reset:t,name:"enableRestart",module:"moduleFour"}),Object(a.jsx)(na,{label:"Vascular Mask Data Directory",defaultValue:"C:\\Workspaces\\carl",reset:t,placeholder:"Your path goes here",name:"vascularMaskDirectory",module:"moduleTwo"}),Object(a.jsx)(na,{label:"Output Data Directory",defaultValue:"C:\\Workspaces\\carl",reset:t,placeholder:"Your path goes here",name:"outputDataDirectory",module:"moduleTwo"})]})})}function ha(e){var t=e.reset,i=Object(r.useContext)(Fi);Object(l.a)(i,2)[1];return Object(a.jsx)(ma,{title:"Preprocessing Options (Module 1)",children:Object(a.jsxs)("div",{className:"flex fill",children:[Object(a.jsxs)("div",{className:"col-6",children:[Object(a.jsx)(oa,{label:"Process Timing Data",defaultValue:!0,reset:t,name:"processTimingData",module:"moduleOne"}),Object(a.jsx)(oa,{label:"Build 4D Image Data Set",defaultValue:!0,reset:t,name:"build4d",module:"moduleOne"}),Object(a.jsx)(oa,{label:"Build 3D Image Data Set",defaultValue:!0,reset:t,name:"build3d",module:"moduleOne"}),Object(a.jsx)(oa,{label:"Compute 4D Summary",defaultValue:!0,reset:t,name:"compute4dSummary",module:"moduleOne"}),Object(a.jsx)(oa,{label:"Save available data",defaultValue:!0,reset:t,name:"saveAvailableData",module:"moduleOne"})]}),Object(a.jsxs)("div",{className:"col-6",children:[Object(a.jsx)(oa,{label:"Reload timing indices",defaultValue:!0,reset:t,name:"reloadTimingIndices",module:"moduleOne"}),Object(a.jsx)(oa,{label:"Stop if options change",defaultValue:!1,reset:t,name:"stopIfOptionsChange",module:"moduleOne"}),Object(a.jsx)(oa,{label:"Auto select largest",defaultValue:!0,reset:t,name:"autoSelectLargest",module:"moduleOne"}),Object(a.jsx)(oa,{label:"Auto select first largest",defaultValue:!1,reset:t,name:"autoSelectFirstLargest",module:"moduleOne"}),Object(a.jsx)(oa,{label:"Auto select last largest",defaultValue:!0,reset:t,name:"autoSelectLastLargest",module:"moduleOne"})]}),Object(a.jsxs)("div",{className:"col-12 flex left",children:[Object(a.jsx)("b",{className:"col-12 p-0 flex left",children:"Set time Separation"}),Object(a.jsxs)("div",{className:"col-12 p-0 flex",children:[Object(a.jsx)(na,{label:"Min",defaultValue:"0",reset:t,placeholder:"",name:"setTimeSeparationMin",module:"moduleOne"}),Object(a.jsx)(na,{label:"Max",defaultValue:"60",reset:t,placeholder:"",name:"setTimeSeparationMax",module:"moduleOne"})]}),Object(a.jsx)(na,{label:"Specify image set index",defaultValue:"0",reset:t,placeholder:"",name:"imageSetIndex",module:"moduleOne"})]})]})})}function ca(e){var t=e.label,i=e.reset,s=e.defaultValue,o=e.options,n=e.module,m=e.name,u=Object(r.useContext)(Fi),h=Object(l.a)(u,2),c=h[0],d=h[1],f=c.options[n][m];Object(r.useEffect)((function(){i&&v(o[s])}),[i]);var v=function(e){d({type:b.SET_INPUT,payload:{module:n,name:m,value:e}})};return Object(a.jsxs)("div",{className:"flex left column mr-2",children:[t,Object(a.jsxs)(_.a,{id:"dropdown-basic-button",onSelect:function(e,t){var i;console.log(t),(null===t||void 0===t||null===(i=t.target)||void 0===i?void 0:i.text)&&v(t.target.text)},children:[Object(a.jsx)(_.a.Toggle,{id:JSON.stringify(Math.random()),children:f}),Object(a.jsx)(_.a.Menu,{children:o.map((function(e,t){return Object(a.jsx)(_.a.Item,{href:"#/action-".concat(t),children:e})}))})]})]})}function da(e){var t=e.reset,i=Object(r.useContext)(Fi);Object(l.a)(i,2)[1];return Object(a.jsx)(ma,{title:"Adaptive Vascular Model Options (Module 3)",children:Object(a.jsxs)("div",{className:"flex fill col-12",children:[Object(a.jsxs)("div",{className:"col-12 flex column py-2 px-0",children:[Object(a.jsx)("b",{className:"fit p-0 flex",children:"Binning Options"}),Object(a.jsx)(na,{label:"Minimum number of bins",defaultValue:"50",reset:t,placeholder:"Your path goes here",name:"minimumNumber",module:"moduleThree"}),Object(a.jsx)(na,{label:"Number of bins",defaultValue:"400",reset:t,placeholder:"Your path goes here",name:"numberOfBins",module:"moduleThree"}),Object(a.jsx)(na,{label:"Distribution Tail",defaultValue:"0.01",reset:t,placeholder:"Your path goes here",name:"minimumNumber",module:"moduleThree"}),Object(a.jsx)(ca,{label:"Feature",defaultValue:0,reset:t,options:["Median Value","Mode Value","Cumulative Probability"],name:"feature",module:"moduleThree"})]}),Object(a.jsxs)("div",{className:"col-12 flex column py-2 px-0",children:[Object(a.jsx)("b",{className:"fit p-0 flex",children:"Distribution Feature Range"}),Object(a.jsx)(na,{label:"Median Min",defaultValue:"0.3",reset:t,name:"medianMin",module:"moduleThree"}),Object(a.jsx)(na,{label:"Median Max",defaultValue:"0.4",reset:t,name:"medianMax",module:"moduleThree"}),Object(a.jsx)(oa,{label:"Non-negative values",defaultValue:!0,reset:t,name:"nonNegativeValues",module:"moduleThree"}),Object(a.jsx)(oa,{label:"Non-zero values",defaultValue:!0,reset:t,name:"nonZeroValues",module:"moduleThree"})]})]})})}function _a(e){var t=e.reset,i=Object(r.useContext)(Fi);Object(l.a)(i,2)[1];return Object(a.jsx)(ma,{title:"Brain Segmentation Options (Module 2)",children:Object(a.jsxs)("div",{className:"flex fill col-12 ",children:[Object(a.jsxs)("div",{className:"col-12 flex column py-2 px-0",children:[Object(a.jsx)("b",{className:"fit p-0 flex",children:"General Options"}),Object(a.jsx)(na,{label:"Data Output Path",defaultValue:"C:\\Workspaces\\carl",reset:t,placeholder:"Your path goes here",name:"dataOutput",module:"moduleTwo"}),Object(a.jsx)(oa,{label:"Restart Enabled",defaultValue:!0,reset:t,name:"restartEnabled",module:"moduleTwo"}),Object(a.jsx)(na,{label:"Minimum 3D",defaultValue:"0.125",reset:t,placeholder:"",name:"minimum3d",module:"moduleTwo"})]}),Object(a.jsxs)("div",{className:"col-12 flex py-2 px-0",children:[Object(a.jsx)("b",{className:"col-12 p-0 flex",children:"Data Source"}),Object(a.jsx)(ca,{label:"Modality",defaultValue:0,reset:t,options:["CT","MR"],name:"modality",module:"moduleTwo"}),Object(a.jsx)(ca,{label:"Vendor",defaultValue:0,reset:t,options:["Toshiba","GE"],name:"vendor",module:"moduleTwo"}),Object(a.jsx)(ca,{label:"Scanner",defaultValue:0,reset:t,options:["320","LS"],name:"scanner",module:"moduleTwo"}),Object(a.jsx)(ca,{label:"Process",defaultValue:0,reset:t,options:["DCE","Single"],name:"process",module:"moduleTwo"}),Object(a.jsx)(ca,{label:"Region",defaultValue:0,reset:t,options:["Brain"],name:"region",module:"moduleTwo"}),Object(a.jsx)(ca,{label:"Study",defaultValue:0,reset:t,options:["ICH","dCTA","CTP"],name:"study",module:"moduleTwo"})]}),Object(a.jsxs)("div",{className:"col-12 flex column py-2 px-0",children:[Object(a.jsx)("b",{className:"fit p-0 flex",children:"Image Set Time Series Thresholding"}),Object(a.jsx)(oa,{label:"Include Maximum Threshold",defaultValue:!0,reset:t,name:"includeMinThreshold",module:"moduleTwo"}),Object(a.jsx)(oa,{label:"Include Minimum Threshold",defaultValue:!0,reset:t,name:"includeMaxThreshold",module:"moduleTwo"})]}),Object(a.jsxs)("div",{className:"col-12 flex column py-2 px-0",children:[Object(a.jsx)("b",{className:"fit p-0 flex",children:"Tissue Mask Generation"}),Object(a.jsx)(oa,{label:"Use morphological operations",defaultValue:!0,reset:t,name:"useMorphologicalOperations",module:"moduleTwo"}),Object(a.jsx)(na,{label:"STRFI disk",defaultValue:"5",reset:t,name:"strfiDisk",module:"moduleTwo"}),Object(a.jsx)(na,{label:"STRFI 3D",defaultValue:"2",reset:t,name:"strfi3d",module:"moduleTwo"})]}),Object(a.jsxs)("div",{className:"col-12 flex column py-2 px-0",children:[Object(a.jsx)("b",{className:"fit p-0 flex",children:"Brain Selection Algorithm Parameters"}),Object(a.jsx)(na,{label:"Image index range",defaultValue:"All",reset:t,placeholder:"",name:"imageIndexRange",module:"moduleTwo"}),Object(a.jsx)(na,{label:"Image index region",defaultValue:"Minimum",reset:t,placeholder:"",name:"imageRegion",module:"moduleTwo"}),Object(a.jsx)(na,{label:"minimumConnected",defaultValue:"0.2",reset:t,placeholder:"",name:"minimumConnected",module:"moduleTwo"}),Object(a.jsx)(na,{label:"Coarse radius",defaultValue:"20",reset:t,placeholder:"",name:"coarseRadius",module:"moduleTwo"}),Object(a.jsx)(na,{label:"STRFI radius",defaultValue:"1.5",reset:t,placeholder:"",name:"strfiRadius",module:"moduleTwo"})]})]})})}i(191);function fa(){var e=Object(r.useState)(!1),t=Object(l.a)(e,2),i=t[0],s=t[1];return Object(r.useEffect)((function(){i&&s(!1)}),[i]),Object(a.jsxs)("div",{className:"flex center page",children:[Object(a.jsx)("div",{className:"col-2"}),Object(a.jsxs)("div",{className:"col-8 py-3 px-0 flex options-container",children:[Object(a.jsxs)("h4",{className:"header col-12 flex space-between",children:["Options",Object(a.jsx)(ta.a,{variant:"light",onClick:function(){s(!0)},children:"Reset to Default"})]}),Object(a.jsx)(ha,{reset:i}),Object(a.jsx)(_a,{reset:i}),Object(a.jsx)(da,{reset:i}),Object(a.jsx)(ua,{reset:i})]}),Object(a.jsx)("div",{className:"col-2"})]})}var va=i(218),pa=i(222),ga=i(214),Sa=i(216),xa=i(215),ba=i(134),ya=i(86),Ta=function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(t){return!1}},Da=i(210),Oa=i(211),Ra=i(219),wa=i(212),Ea=i(213),ja=function(e){Object(S.a)(i,e);var t=Object(x.a)(i);function i(e){var a;return Object(u.a)(this,i),(a=t.call(this,e)).onModalShow=a.onModalShow.bind(Object(g.a)(a)),a.onModalHide=a.onModalHide.bind(Object(g.a)(a)),a.onButton0=a.onButton0.bind(Object(g.a)(a)),a.onButton1=a.onButton1.bind(Object(g.a)(a)),a.onButton2=a.onButton2.bind(Object(g.a)(a)),a.onButton3=a.onButton3.bind(Object(g.a)(a)),a.onButton4=a.onButton4.bind(Object(g.a)(a)),a.onButton5=a.onButton5.bind(Object(g.a)(a)),a.onButton6=a.onButton6.bind(Object(g.a)(a)),a.onButton7=a.onButton7.bind(Object(g.a)(a)),a.onDemo=a.onDemo.bind(Object(g.a)(a)),a.state={showModalDemo:!1},a}return Object(h.a)(i,[{key:"onModalShow",value:function(){this.setState({showModalDemo:!0})}},{key:"onModalHide",value:function(){this.setState({showModalDemo:!1})}},{key:"onDemo",value:function(e){var t=this.props.onSelectDemo;(0,this.props.onHide)(),t(e)}},{key:"onButton0",value:function(){this.onDemo(0)}},{key:"onButton1",value:function(){this.onDemo(1)}},{key:"onButton2",value:function(){this.onDemo(2)}},{key:"onButton3",value:function(){this.onDemo(3)}},{key:"onButton4",value:function(){this.onDemo(4)}},{key:"onButton5",value:function(){this.onDemo(5)}},{key:"onButton6",value:function(){this.onDemo(6)}},{key:"onButton7",value:function(){this.onDemo(7)}},{key:"render",value:function(){var e=this.props.stateVis,t=this.props.onHide,i=[{tooltip:"Lungs 20101108 from ktx",image:"images/thumb_lungs.png",alt:"lungs",func:this.onButton0},{tooltip:"Brain set from ktx",image:"images/thumb_brain.png",alt:"lungs",func:this.onButton1},{tooltip:"Grandmother (gm3) from nifti",image:"images/thumb_gm3_512_512_165.png",alt:"gm3",func:this.onButton2},{tooltip:"Woman pelvis from dicom",image:"images/thumb_woman_pelvis.png",alt:"woman_pelvis",func:this.onButton3},{tooltip:"Lungs 00cba...957e from dicom",image:"images/thumb_ocb.png",alt:"lungs_ocb",func:this.onButton4},{tooltip:"CT 256^3 from ktx",image:"images/thumb_ct_256.png",alt:"ct_256",func:this.onButton5},{tooltip:"Lungs 256^3 from ktx",image:"images/thumb_lungs_256.png",alt:"lungs_256",func:this.onButton6},{tooltip:"Brain with ROI (colored) from Hdr+Img",image:"images/thumb_set.png",alt:"hdr_set_roi",func:this.onButton7}];return Object(a.jsxs)(Sa.a,{show:e,onHide:t,children:[Object(a.jsx)(Sa.a.Header,{closeButton:!0,children:Object(a.jsx)(Sa.a.Title,{children:"Load demo data"})}),Object(a.jsx)(Sa.a.Body,{children:Object(a.jsx)(Da.a,{children:Object(a.jsx)(Oa.a,{children:i.map((function(e,t){var i="id_".concat(t),r=e.tooltip,s=e.image,o=e.alt,n=e.func;return Object(a.jsx)(c.a,{xs:6,md:4,children:Object(a.jsx)(Ra.a,{placement:"top",delay:{show:150,hide:300},overlay:Object(a.jsx)(wa.a,{id:i,children:r}),children:Object(a.jsx)(ta.a,{variant:"light",onClick:n,children:Object(a.jsx)(Ea.a,{src:s,alt:o,thumbnail:!0})})})},i)}))})})})]})}}]),i}(s.a.Component),Ma=i(221),Aa=function(e){Object(S.a)(i,e);var t=Object(x.a)(i);function i(e){var a;return Object(u.a)(this,i),(a=t.call(this,e)).onModalShow=a.onModalShow.bind(Object(g.a)(a)),a.onModalHide=a.onModalHide.bind(Object(g.a)(a)),a.onClick=a.onClick.bind(Object(g.a)(a)),a.onDemo=a.onDemo.bind(Object(g.a)(a)),a.state={showModalDemo:!1},a}return Object(h.a)(i,[{key:"onModalShow",value:function(){this.setState({showModalDemo:!0})}},{key:"onModalHide",value:function(){this.setState({showModalDemo:!1})}},{key:"onDemo",value:function(e){var t=this.props.onSelectDemo;(0,this.props.onHide)(),t(e)}},{key:"logObject",value:function(e,t){var i="";for(var a in t)i.length>0&&(i+="\n"),i+=a+" = "+t[a];console.log("".concat(e,"\n").concat(i))}},{key:"onClick",value:function(e){this.m_onHideFunc();var t=e.target.innerHTML,a=i.getIndex(this.m_arrMenu,t);a>=0&&void 0!==this.m_funcDemo&&this.m_funcDemo(a)}},{key:"render",value:function(){var e=this,t=this.props.arrMenu;this.m_arrMenu=t;var i=this.props.stateVis;return this.m_onHideFunc=this.props.onHide,this.m_funcDemo=this.props.onSelectDemo,Object(a.jsxs)(Sa.a,{show:i,onHide:this.m_onHideFunc,children:[Object(a.jsx)(Sa.a.Header,{closeButton:!0,children:Object(a.jsx)(Sa.a.Title,{children:"Load from Google cloud"})}),Object(a.jsx)(Sa.a.Body,{children:Object(a.jsx)(Ma.a,{children:t.map((function(t,i){var r="id_".concat(i),s=t.tooltip;return Object(a.jsx)(Ra.a,{placement:"top",delay:{show:150,hide:300},overlay:Object(a.jsx)(wa.a,{id:r,children:s}),children:Object(a.jsx)(Ma.a.Item,{onClick:e.onClick,children:t.text},r)},r)}))})})]})}}],[{key:"getIndex",value:function(e,t){for(var i=e.length,a=0;a<i;a++)if(e[a].text===t)return a;return-1}}]),i}(s.a.Component),Ia=(i(192),1073741823),Ca=function(e){Object(S.a)(i,e);var t=Object(x.a)(i);function i(e){var a;return Object(u.a)(this,i),(a=t.call(this,e)).m_objCanvas=null,a.m_dataMin=Ia,a.m_dataMax=Ia,a.onButtonCancel=a.onButtonCancel.bind(Object(g.a)(a)),a.onButtonApply=a.onButtonApply.bind(Object(g.a)(a)),a.state={showModalWindowCenterWidth:!1,windowMin:-350,windowMax:1650},a}return Object(h.a)(i,[{key:"onModalHide",value:function(){this.setState({showModalWindowCenterWidth:!1})}},{key:"reset",value:function(){this.m_dataMin=Ia,this.m_dataMax=Ia,this.setState({windowMin:-350}),this.setState({windowMax:1650})}},{key:"onButtonCancel",value:function(){this.reset(),(0,this.props.onHide)(!1)}},{key:"onButtonApply",value:function(){this.reset();var e=this.props,t=e.loaderDicom,i=e.volumeSet;t.m_windowCenter=.5*(this.state.windowMin+this.state.windowMax),t.m_windowWidth=this.state.windowMax-this.state.windowMin;for(var a=t.m_slicesVolume.getSeries(),r=a.length,s=0;s<r;s++){var o=a[s].m_hash;t.createVolumeFromSlices(i,s,o)}(0,this.props.onHide)(!0)}},{key:"componentDidMount",value:function(){this.props.onRef(this),this.renderPreview()}},{key:"componentWillUnmount",value:function(){this.props.onRef(void 0)}},{key:"componentDidUpdate",value:function(){this.renderPreview()}},{key:"drawSlice",value:function(e,t,i,a,r,s,o){for(var n=s[0].m_slices,l=n.length,m=n[0].m_sliceNumber,u=n[0].m_sliceNumber,h=0;h<l;h++){var c=n[h].m_sliceNumber;m=c<m?c:m,u=c>u?c:u}u-m>0?n.sort((function(e,t){return e.m_sliceNumber-t.m_sliceNumber})):n.sort((function(e,t){return e.m_sliceLocation-t.m_sliceLocation}));for(var d=0,_=0;_<l;_++)n[_].m_sliceNumber=d,d++;o.m_zDim=l;var f,v=n[Math.floor(l/2)],p=v.m_image,g=v.m_xDim,S=v.m_yDim,x=-1073741823,b=1073741823,y=g*S;for(f=0;f<y;f++){var T=p[f];if(!o.m_littleEndian)T=T>>8|T<<8&65535;var D=(T=T===o.m_padValue?0:T)*o.m_rescaleSlope+o.m_rescaleIntercept;b=D<b?D:b,x=D>x?D:x}var O=this.state.windowMin,R=this.state.windowMax,w=Math.floor(.5*(R+O)),E=R-O;if(Math.floor((1<<19)/(x-b))<=4)console.log("Bad scaling: image will be 0");else{var j=new Uint8Array(y),M=w-.5*E;for(f=0;f<y;f++){var A=p[f];if(!o.m_littleEndian)A=A>>8|A<<8&65535;var I=(A=A===o.m_padValue?0:A)*o.m_rescaleSlope+o.m_rescaleIntercept,C=0;C=(C=(C=o.m_rescaleHounsfield?Math.floor(255*(I-M)/E):Math.floor(127+128*(I-w)/(E/2)))>=0?C:0)<255?C:255,j[0+f]=C}for(var X=0,F=g/t,k=S/i,U=0,N=0;N<i;N++,U+=k)for(var V=Math.floor(U)*g,L=0,P=0;P<t;P++,L+=F){var B=j[0+V+Math.floor(L)];r[X+0]=B,r[X+1]=B,r[X+2]=B,r[X+3]=255,X+=4}e.putImageData(a,0,0)}}},{key:"renderPreview",value:function(){var e=this.m_objCanvas;if(null!==e){var t=e.clientWidth,i=e.clientHeight,a=e.getContext("2d"),r=this.props;a.fillStyle="rgb(40, 40, 40)",a.fillRect(0,0,t,i);var s=a.createImageData(t,i),o=s.data,n=r.loaderDicom;if(null!==n){var l=n.m_slicesVolume.m_series;0!==l.length&&this.drawSlice(a,t,i,s,o,l,n)}}}},{key:"onSliderWindowRange",value:function(){var e=this.refs.sliderRange.slider.get(),t=parseInt(e[0]),i=parseInt(e[1]);this.setState({windowMin:t}),this.setState({windowMax:i})}},{key:"getDataMinMax",value:function(e,t){var i=t.m_slicesVolume.m_series;if(0!==i.length){var a,r=i[0].m_slices[0],s=r.m_image,o=-1073741823,n=1073741823,l=r.m_xDim*r.m_yDim;for(a=0;a<l;a++){var m=s[a];if(!t.m_littleEndian)m=m>>8|m<<8&65535;var u=(m=m===t.m_padValue?0:m)*t.m_rescaleSlope+t.m_rescaleIntercept;n=u<n?u:n,o=u>o?u:o}this.m_dataMin=n,this.m_dataMax=o}}},{key:"initWindowRange",value:function(){var e=this.props,t=e.loaderDicom;if(null!==t){var i=!0;if(i=t.m_windowCenter!==Ia&&i,i=t.m_windowWidth!==Ia&&i,i=!(t.m_windowWidth<=0)&&i){var a=Math.floor(t.m_windowCenter-t.m_windowWidth/2),r=Math.floor(t.m_windowCenter+t.m_windowWidth/2);this.setState({windowMin:a}),this.setState({windowMax:r})}this.getDataMinMax(e,t)}}},{key:"render",value:function(){var e=this,t=this.props.stateVis,i=this.props.onHide,r=Object(a.jsx)("canvas",{ref:function(t){e.m_objCanvas=t},style:{width:"500px",height:"400px"},width:"500px",height:"400px"}),s=0,o=5e3,n=o-s,l=50;this.m_dataMin!==Ia&&(s=this.m_dataMin,n=(o=this.m_dataMax)-s,l=Math.floor(n/32));var m={min:Math.floor(s-n/4),max:Math.floor(o+n/4)},u=[Math.floor(this.state.windowMin),Math.floor(this.state.windowMax)];return Object(a.jsxs)(Sa.a,{show:t,onHide:i,size:"xl",children:[Object(a.jsx)(Sa.a.Header,{closeButton:!0,children:Object(a.jsx)(Sa.a.Title,{children:"Select window center and width to display Dicom"})}),Object(a.jsx)(Sa.a.Body,{children:Object(a.jsxs)(Da.a,{children:[Object(a.jsx)(Oa.a,{children:Object(a.jsx)(c.a,{xs:!0,md:!0,lg:"12",ref:function(t){e.m_objCol=t},children:Object(a.jsx)("p",{className:"text-center",children:r})})}),Object(a.jsxs)(Ma.a,{children:[Object(a.jsxs)(Ma.a.Item,{children:["Window range ",Object(a.jsx)("p",{children:" "})]}),Object(a.jsx)(Ma.a.Item,{children:Object(a.jsx)(v.a,{onSlide:this.onSliderWindowRange.bind(this),ref:"sliderRange",range:m,start:u,step:l,connect:!0,tooltips:!0})})]}),Object(a.jsxs)(Oa.a,{children:[Object(a.jsx)(c.a,{xs:!0,md:!0,lg:"5"}),Object(a.jsx)(c.a,{xs:!0,md:!0,lg:"2",children:Object(a.jsx)(ta.a,{onClick:this.onButtonApply,children:"Apply"})}),Object(a.jsx)(c.a,{xs:!0,md:!0,lg:"5"})]})]})})]})}}]),i}(s.a.Component),Xa=function(){function e(t){Object(u.a)(this,e),this.m_store=t,this.m_arrFileNames=null,this.m_errors=[],this.m_loaders=[],this.m_loaderDicom=null,this.callbackReadProgress=this.callbackReadProgress.bind(this),this.callbackReadComplete=this.callbackReadComplete.bind(this),this.m_fileName="???"}return Object(h.a)(e,[{key:"callbackReadProgress",value:function(e){var t=Math.floor(100*e),i=this.m_store.uiApp;0===t&&i.doShowProgressBar("Loading..."),t>=99?i.doHideProgressBar():i.doSetProgressBarRatio(t)}},{key:"callbackReadComplete",value:function(e){if(e!==rt.SUCCESS){console.log("onCompleteFromUrlKtx. Bad result: ".concat(e));var t=[],i=rt.getResultString(e);return t.push(i),void this.finalizeFailedLoadedVolume(this.m_volume,this.m_fileName,t)}this.finalizeSuccessLoadedVolume(this.m_volume,this.m_fileName)}},{key:"finalizeFailedLoadedVolume",value:function(e,t,i){var a=this.m_store;a.dispatch({type:b.SET_IS_LOADED,isLoaded:!1}),a.dispatch({type:b.SET_VOLUME,volume:null}),a.dispatch({type:b.SET_ERR_ARRAY,arrErrors:i}),a.dispatch({type:b.SET_FILENAME,fileName:t}),a.uiApp.doHideProgressBar()}},{key:"finalizeSuccessLoadedVolume",value:function(e,t){if(null!==e.m_dataArray){e.makeDimensions4x();var i=this.m_store;i.dispatch({type:b.SET_VOLUME,volume:e}),i.dispatch({type:b.SET_IS_LOADED,isLoaded:!0}),i.dispatch({type:b.SET_FILENAME,fileName:t}),i.dispatch({type:b.SET_ERR_ARRAY,arrErrors:[]});var a=new Pi;a.createFromRawVolume(e),i.dispatch({type:b.SET_TEXTURE3D,texture3d:a}),i.dispatch({type:b.SET_MODE_VIEW,modeView:y.VIEW_2D}),i.dispatch({type:b.SET_MODE_3D,mode3d:D.RAYCAST})}}},{key:"loadFromUrlArray",value:function(e,t){void 0===e&&console.log("LoaderUrlDicom: no argument in constr");var i=typeof e;"object"!==i&&console.log("LoaderUrlDicom: bad argument type: ".concat(i,", but expected object")),this.m_arrFileNames=e;var a,r=new jt,s=this.m_arrFileNames.length;console.log("LoaderUrlDicom.loadFromUrlArray: start loading: ".concat(s," files")),console.log("LoaderUrlDicom.loadFromUrlArray: from ".concat(e[0]," .. to ").concat(e[s-1],"  ")),this.m_loaderDicom=new Oi(s,!1),this.m_volume=new at;var o=this.callbackReadProgress,n=this.callbackReadComplete;o(0),this.m_loaderDicom.m_numLoadedFiles=s,this.m_loaderDicom.m_filesLoadedCounter=0,this.m_loaderDicom.m_numFailsLoad=0;for(var l=0;l<s;l++)this.m_loaderDicom.m_errors[l]=-1,this.m_loaderDicom.m_loaders[l]=null;for(this.m_loaderDicom.m_zDim=s,a=0;a<s;a++){var m=this.m_arrFileNames[a];if(!r.isValidUrl(m))return console.log("LoaderUrlDicom.loadFromUrlArray: url is not valid = ".concat(m)),!1;0===a&&(this.m_fileName=r.getFileNameFromUrl(m)),this.m_loaders[a]=new nt(m);var u=this.m_loaders[a];if(!this.m_loaderDicom.runLoader(this.m_volume,m,u,a,o,n,t))return!1}return!0}}]),e}(),Fa=i(9),ka=i.n(Fa),Ua=function(){function e(){Object(u.a)(this,e),this.m_loaderDicom=null}return Object(h.a)(e,[{key:"loadDicomfir",value:function(e,t){var i=new DataView(t),a=null;try{a=ka.a.Series.parseImage(i)}catch(f){return console.log("error parse dcm file buffer"),rt.BAD_DICOM}if(void 0===a||null===a)return rt.BAD_DICOM;var r,s=[4,4640];r=ka.a.Utils.dec2hex(s[0])+ka.a.Utils.dec2hex(s[1]);var o=a.tags[r];if(void 0!==o)for(var n=o.value.length,l=0;l<n;l++){var m=o.value[l];if(57344===m.element&&65534===m.group)for(var u=m.value.length,h=0;h<u;h++){var c=m.value[h];if(5168===c.element&&c.group,5376===c.element&&4===c.group){var d=c.value[0],_=c.value[1];console.log("image nm = ".concat(d," / ").concat(_))}}}return rt.SUCCESS}},{key:"loadSingleSlice",value:function(e,t,i){var a=new DataView(i),r=null;try{r=ka.a.Series.parseImage(a)}catch(_e){return console.log("error parse dcm file buffer"),rt.BAD_DICOM}if(void 0===r||null===r)return rt.BAD_DICOM;var s=r.getRows(),o=r.getCols(),n=r.getBitsAllocated();8!==n&&16!==n&&console.log("Parse Dicom data. Strange bits per pixel = "+n.toString());var l=r.getPatientName(),m=r.getImageDescription(),u=r.getStudyDate(),h=r.getStudyTime(),c=r.getSeriesDescription(),d=this.m_loaderDicom.m_dicomInfo,_=new Dt;_.m_sliceNumber=e,_.m_sliceLocation=-1,_.m_patientName=l,_.m_studyDescr=m,_.m_studyDate=u,_.m_seriesTime=h,_.m_seriesDescr=c,_.m_bodyPartExamined="NonExistInDiakonReader",_.buildHash(),this.m_loaderDicom.m_minSlice=0,this.m_loaderDicom.m_maxSlice=0,this.m_loaderDicom.m_pixelSpacing.x=0,this.m_loaderDicom.m_pixelSpacing.y=0,this.m_loaderDicom.m_pixelSpacing.z=0,this.m_loaderDicom.m_xDim=o,this.m_loaderDicom.m_yDim=s,e<this.m_loaderDicom.m_slicesVolume.m_minSlice&&(this.m_loaderDicom.m_slicesVolume.m_minSlice=e),e>this.m_loaderDicom.m_slicesVolume.m_maxSlice&&(this.m_loaderDicom.m_slicesVolume.m_maxSlice=e),this.m_loaderDicom.m_newTagEvent.detail.fileName=t;var f=new wt,v="Slice "+e.toString();f.m_sliceName=v,f.m_fileName=t,f.m_tags=[],d.m_sliceInfo.push(f);var p=[ka.a.Tag.TAG_ROWS,ka.a.Tag.TAG_COLS,ka.a.Tag.TAG_ACQUISITION_MATRIX,ka.a.Tag.TAG_NUMBER_OF_FRAMES,ka.a.Tag.TAG_NUMBER_TEMPORAL_POSITIONS,ka.a.Tag.TAG_PIXEL_SPACING,ka.a.Tag.TAG_SLICE_THICKNESS,ka.a.Tag.TAG_SLICE_GAP,ka.a.Tag.TAG_TR,ka.a.Tag.TAG_FRAME_TIME,ka.a.Tag.TAG_BITS_ALLOCATED,ka.a.Tag.TAG_BITS_STORED,ka.a.Tag.TAG_PIXEL_REPRESENTATION,ka.a.Tag.TAG_HIGH_BIT,ka.a.Tag.TAG_PHOTOMETRIC_INTERPRETATION,ka.a.Tag.TAG_SAMPLES_PER_PIXEL,ka.a.Tag.TAG_PLANAR_CONFIG,ka.a.Tag.TAG_PALETTE_RED,ka.a.Tag.TAG_PALETTE_GREEN,ka.a.Tag.TAG_PALETTE_BLUE,ka.a.Tag.TAG_DATA_SCALE_SLOPE,ka.a.Tag.TAG_DATA_SCALE_INTERCEPT,ka.a.Tag.TAG_DATA_SCALE_ELSCINT,ka.a.Tag.TAG_PIXEL_BANDWIDTH,ka.a.Tag.TAG_IMAGE_MIN,ka.a.Tag.TAG_IMAGE_MAX,ka.a.Tag.TAG_WINDOW_CENTER,ka.a.Tag.TAG_WINDOW_WIDTH,ka.a.Tag.TAG_PATIENT_NAME,ka.a.Tag.TAG_PATIENT_ID,ka.a.Tag.TAG_STUDY_DATE,ka.a.Tag.TAG_STUDY_TIME,ka.a.Tag.TAG_STUDY_DES,ka.a.Tag.TAG_IMAGE_TYPE,ka.a.Tag.TAG_IMAGE_COMMENTS,ka.a.Tag.TAG_SEQUENCE_NAME,ka.a.Tag.TAG_MODALITY,ka.a.Tag.TAG_FRAME_OF_REF_UID,ka.a.Tag.TAG_STUDY_UID,ka.a.Tag.TAG_SERIES_DESCRIPTION,ka.a.Tag.TAG_SERIES_INSTANCE_UID,ka.a.Tag.TAG_SERIES_NUMBER,ka.a.Tag.TAG_ECHO_NUMBER,ka.a.Tag.TAG_TEMPORAL_POSITION,ka.a.Tag.TAG_IMAGE_NUM,ka.a.Tag.TAG_SLICE_LOCATION,ka.a.Tag.TAG_IMAGE_ORIENTATION,ka.a.Tag.TAG_IMAGE_POSITION,ka.a.Tag.TAG_SLICE_LOCATION_VECTOR,ka.a.Tag.TAG_LUT_SHAPE,[40,288]],g=[16,48],S=[24,21],x=[8,128],b=[8,4208],y=[8,144];d.m_patientName=r.getPatientName(),d.m_patientDateOfBirth=ka.a.Image.getSingleValueSafely(r.getTag(g[0],g[1]),0),d.m_seriesDescr=c,d.m_studyDescr=m,d.m_studyDate=u,d.m_seriesTime=h,d.m_bodyPartExamined=ka.a.Image.getSingleValueSafely(r.getTag(S[0],S[1]),0),d.m_institutionName=ka.a.Image.getSingleValueSafely(r.getTag(x[0],x[1]),0),d.m_operatorsName=ka.a.Image.getSingleValueSafely(r.getTag(b[0],b[1]),0),d.m_physicansName=ka.a.Image.getSingleValueSafely(r.getTag(y[0],y[1]),0);for(var T,D=p.length,O=0;O<D;O++){var R=ka.a.Utils.dec2hex(p[O][0])+ka.a.Utils.dec2hex(p[O][1]),w=r.tags[R];if(void 0!==w){var E=w.value,j=w.group,M=w.element,A=new Oi;A.m_tag="("+Oi.numberToHexString(j)+","+Oi.numberToHexString(M)+")";var I=this.m_loaderDicom.m_dictionary.getTextDesc(j,M);A.m_attrName=I.length>1?I:"";var C="";null!==E&&(C=E.toString()),A.m_attrValue=C,f.m_tags.push(A)}}T=ka.a.Utils.dec2hex(ka.a.Tag.TAG_SLICE_LOCATION[0])+ka.a.Utils.dec2hex(ka.a.Tag.TAG_SLICE_LOCATION[1]);var X=r.tags[T];if(void 0!==X){var F=X.value[0];_.m_sliceLocation=F,this.m_sliceLocMin=F<this.m_sliceLocMin?F:this.m_sliceLocMin,this.m_sliceLocMax=F>this.m_sliceLocMax?F:this.m_sliceLocMax}T=ka.a.Utils.dec2hex(ka.a.Tag.TAG_IMAGE_NUM[0])+ka.a.Utils.dec2hex(ka.a.Tag.TAG_IMAGE_NUM[1]);var k=r.tags[T];if(void 0!==k&&null!==k.value){var U=k.value[0];_.m_sliceNumber=U}T=ka.a.Utils.dec2hex(ka.a.Tag.TAG_SAMPLES_PER_PIXEL[0])+ka.a.Utils.dec2hex(ka.a.Tag.TAG_SAMPLES_PER_PIXEL[1]);var N=r.tags[T];if(void 0!==N){var V=N.value[0];this.m_loaderDicom.m_samplesPerPixel=V}T=ka.a.Utils.dec2hex(40)+ka.a.Utils.dec2hex(288);var L=r.tags[T];if(void 0!==L){var P=L.value[0];P<0&&(P=-(65535^P)-1),this.m_loaderDicom.m_padValue=P}T=ka.a.Utils.dec2hex(ka.a.Tag.TAG_WINDOW_CENTER[0])+ka.a.Utils.dec2hex(ka.a.Tag.TAG_WINDOW_CENTER[1]);var B=r.tags[T];void 0!==B&&(this.m_loaderDicom.m_windowCenter=B.value[0]),T=ka.a.Utils.dec2hex(ka.a.Tag.TAG_WINDOW_WIDTH[0])+ka.a.Utils.dec2hex(ka.a.Tag.TAG_WINDOW_WIDTH[1]);var z=r.tags[T];void 0!==z&&(this.m_loaderDicom.m_windowWidth=z.value[0]),T=ka.a.Utils.dec2hex(ka.a.Tag.TAG_DATA_SCALE_INTERCEPT[0])+ka.a.Utils.dec2hex(ka.a.Tag.TAG_DATA_SCALE_INTERCEPT[1]);var G=r.tags[T];void 0!==G&&(this.m_loaderDicom.m_rescaleIntercept=G.value[0]),T=ka.a.Utils.dec2hex(ka.a.Tag.TAG_DATA_SCALE_SLOPE[0])+ka.a.Utils.dec2hex(ka.a.Tag.TAG_DATA_SCALE_SLOPE[1]);var W=r.tags[T];void 0!==W&&(this.m_loaderDicom.m_rescaleSlope=W.value[0]);var H=[40,4180];T=ka.a.Utils.dec2hex(H[0])+ka.a.Utils.dec2hex(H[1]);var q=r.tags[T];void 0!==q&&null!==q.value&&"HU"===q.value[0]&&(this.m_loaderDicom.m_rescaleHounsfield=!0),T=ka.a.Utils.dec2hex(ka.a.Tag.TAG_PIXEL_REPRESENTATION[0])+ka.a.Utils.dec2hex(ka.a.Tag.TAG_PIXEL_REPRESENTATION[1]);var Y=r.tags[T];void 0!==Y&&1===Y.value[0]&&(this.m_loaderDicom.m_pixelRepresentaionSigned=!0),T=ka.a.Utils.dec2hex(ka.a.Tag.TAG_PIXEL_SPACING[0])+ka.a.Utils.dec2hex(ka.a.Tag.TAG_PIXEL_SPACING[1]);var Z=r.tags[T];if(void 0!==Z){var K=Z.value;2===K.length&&(this.m_loaderDicom.m_pixelSpacing.x=parseFloat(K[0]),this.m_loaderDicom.m_pixelSpacing.y=parseFloat(K[1]))}T=ka.a.Utils.dec2hex(ka.a.Tag.TAG_SLICE_THICKNESS[0])+ka.a.Utils.dec2hex(ka.a.Tag.TAG_SLICE_THICKNESS[1]);var Q=r.tags[T];if(void 0!==Q){var J=Q.value;1===J.length&&(this.m_loaderDicom.m_pixelSpacing.z=parseFloat(J[0]))}T=ka.a.Utils.dec2hex(ka.a.Tag.TAG_IMAGE_POSITION[0])+ka.a.Utils.dec2hex(ka.a.Tag.TAG_IMAGE_POSITION[1]);var $=r.tags[T];if(void 0!==$){if(3===$.value.length){var ee=$.value[0],te=$.value[1],ie=$.value[2];this.m_loaderDicom.m_imagePosMin.x=ee<this.m_loaderDicom.m_imagePosMin.x?ee:this.m_loaderDicom.m_imagePosMin.x,this.m_loaderDicom.m_imagePosMin.y=te<this.m_loaderDicom.m_imagePosMin.y?te:this.m_loaderDicom.m_imagePosMin.y,this.m_loaderDicom.m_imagePosMin.z=ie<this.m_loaderDicom.m_imagePosMin.z?ie:this.m_loaderDicom.m_imagePosMin.z,this.m_loaderDicom.m_imagePosMax.x=ee>this.m_loaderDicom.m_imagePosMax.x?ee:this.m_loaderDicom.m_imagePosMax.x,this.m_loaderDicom.m_imagePosMax.y=te>this.m_loaderDicom.m_imagePosMax.y?te:this.m_loaderDicom.m_imagePosMax.y,this.m_loaderDicom.m_imagePosMax.z=ie>this.m_loaderDicom.m_imagePosMax.z?ie:this.m_loaderDicom.m_imagePosMax.z}}T=ka.a.Utils.dec2hex(ka.a.Tag.TAG_TRANSFER_SYNTAX[0])+ka.a.Utils.dec2hex(ka.a.Tag.TAG_TRANSFER_SYNTAX[1]);var ae=r.tags[T];void 0!==ae&&("1.2.840.10008.1.2.2"===ae.value[0]&&(this.m_loaderDicom.m_littleEndian=!1));this.m_loaderDicom.m_slicesVolume.addSlice(_);var re=r.getRawData();if(re.byteLength!==o*s*Math.floor(n/8)*this.m_loaderDicom.m_samplesPerPixel)return console.log("Error read Dicom via Diakon parser"),rt.ERROR_COMPRESSED_IMAGE_NOT_SUPPORTED;this.m_loaderDicom.m_pixelRepresentaionSigned?_.m_image=new Int16Array(o*s):_.m_image=new Uint16Array(o*s);var se=o*s;if(1===this.m_loaderDicom.m_samplesPerPixel)for(var oe=new Uint16Array(re),ne=0;ne<se;ne++)_.m_image[ne]=oe[ne];else if(3===this.m_loaderDicom.m_samplesPerPixel)for(var le=new Uint8Array(re),me=0,ue=0;ue<se;ue++,me+=3){var he=le[me+0],ce=le[me+1],de=le[me+2];_.m_image[ue]=Math.floor((he+ce+de)/3)}return _.m_xDim=o,_.m_yDim=s,rt.SUCCESS}},{key:"readSlice",value:function(e,t,i,a){return this.m_loaderDicom=e,this.loadSingleSlice(t,i,a)}},{key:"readSingleSlice",value:function(e,t,i,a,r){var s;if(this.m_loaderDicom=t,(s=this.loadSingleSlice(i,a,r))!==rt.SUCCESS)return s;var o=this.m_loaderDicom.m_dicomInfo;return e({type:b.SET_DICOM_INFO,dicomInfo:o}),e({type:b.SET_LOADER_DICOM,loaderDicom:this.m_loaderDicom}),s}}]),e}(),Na=function(){function e(){Object(u.a)(this,e),this.m_loaderDaikon=new Ua,this.readReadyFileList=this.readReadyFileList.bind(this)}return Object(h.a)(e,[{key:"readFromUrl",value:function(e,t,i,a){var r=this;console.assert(null!=e,"Null volume"),console.assert(e instanceof Ei,"Should be volume set"),console.assert(null!=t,"Null string url"),console.assert("string"===typeof t,"Should be string in url");var s=new jt;if(!s.isValidUrl(t))return console.log("readFromUrl: not vaild URL = = ".concat(t," ")),!1;this.m_folder=s.getFolderNameFromUrl(t);var o=this.m_folder+"/file_list.txt";console.log("readFromUrl: load file = ".concat(o," ")),a(0);var n=new nt(o);return this.m_fileListCounter=0,n.readFile((function(t){return r.m_fileListCounter+=1,1!==r.m_fileListCounter||r.readReadyFileList(e,t,i,a)}),(function(e){return console.log("Error read file: ".concat(e)),!1})),!0}},{key:"readReadyFileList",value:function(e,t,i,a){var r=this,s=new Uint8Array(t),o=String.fromCharCode.apply(null,s),n=o.substr(0,64);console.log("Loaded file list. Started with:  ".concat(n," ..."));for(var l=o.split("\n"),m=l.length,u=m-1;u>=0;u--)l[u].endsWith("\r")&&(l[u]=l[u].substring(0,l[u].length-1)),l[u].length<4&&l.pop();m=l.length,this.m_loaders=[],this.m_errors=[];for(var h=0;h<m;h++)this.m_errors[h]=-1,this.m_loaders[h]=null;var c=m;console.log("Loaded file list. ".concat(m," files will be loaded. 1st file in list is = ").concat(l[0])),console.log("Loaded file list. Last file in list is = ".concat(l[m-1])),this.m_loaderDaikon.m_loaderDicom=new Oi(m),this.m_loaderDaikon.m_loaderDicom.m_pixelSpacing={x:0,y:0,z:0},this.m_boxSize={x:1,y:1,z:1},this.m_filesLoadedCounter=0,this.m_numFailsLoad=0,this.m_numLoadedFiles=m,this.m_loaderDaikon.m_loaderDicom.m_imagePosMin={x:1e12,y:1e12,z:1e12},this.m_loaderDaikon.m_loaderDicom.m_imagePosMax={x:-1e12,y:-1e12,z:-1e12},this.m_loaderDaikon.m_sliceLocMin=1e12,this.m_loaderDaikon.m_sliceLocMax=-1e12;for(var d=function(t){var s="".concat(r.m_folder,"/").concat(l[t]);r.m_loaders[t]=new nt(s),r.m_loaders[t].readFile((function(o){var n=r.m_filesLoadedCounter/r.m_numLoadedFiles;void 0!==a&&0===(7&r.m_filesLoadedCounter)&&a(n);var l=r.m_loaderDaikon.loadSingleSlice(t,s,o);if(l!==rt.SUCCESS)return l;if(r.m_filesLoadedCounter+=1,r.m_filesLoadedCounter===r.m_numLoadedFiles){false;var m,u={x:r.m_loaderDaikon.m_loaderDicom.m_imagePosMax.x-r.m_loaderDaikon.m_loaderDicom.m_imagePosMin.x,y:r.m_loaderDaikon.m_loaderDicom.y-r.m_loaderDaikon.m_loaderDicom.m_imagePosMin.y,z:r.m_loaderDaikon.m_loaderDicom.m_imagePosMax.z-r.m_loaderDaikon.m_loaderDicom.m_imagePosMin.z},h=1e-5;Math.abs(r.m_loaderDaikon.m_loaderDicom.m_pixelSpacing.z)>h?m=r.m_loaderDaikon.m_loaderDicom.m_pixelSpacing.z*c:(m=u.z,Math.abs(m)<h&&(m=u.x,Math.abs(m)<h&&(m=u.y))),m<h&&(m=1);var d=r.m_loaderDaikon.m_loaderDicom.m_xDim,_=r.m_loaderDaikon.m_loaderDicom.m_yDim;r.m_loaderDaikon.m_loaderDicom.m_pixelSpacing.z=m/c,r.m_boxSize.z=c*r.m_loaderDaikon.m_loaderDicom.m_pixelSpacing.z,r.m_boxSize.x=d*r.m_loaderDaikon.m_loaderDicom.m_pixelSpacing.x,r.m_boxSize.y=_*r.m_loaderDaikon.m_loaderDicom.m_pixelSpacing.y,console.log("LoadDcmUrlDaikon. Volume local phys dim: ".concat(r.m_boxSize.x," * ").concat(r.m_boxSize.y," * ").concat(r.m_boxSize.z));var f=r.m_loaderDaikon.m_loaderDicom.m_slicesVolume.getSeries();0===f.length&&(r.m_loaderDaikon.m_loaderDicom.m_slicesVolume.buildSeriesInfo(),f=r.m_loaderDaikon.m_loaderDicom.m_slicesVolume.getSeries());var v=f[0].m_hash,p=r.m_loaderDaikon.m_loaderDicom.createVolumeFromSlices(e,0,v);if(null!==a&&a(1),null!==i)return i(p),!0}}))},_=0;_<this.m_numLoadedFiles&&this.m_numFailsLoad<1;_++)d(_);return rt.SUCCESS}}]),e}(),Va={demoUrls:[],googleCloudDemoActivce:!1,arrMenuGoogle:[{text:"Demo lungs AA",tooltip:"Load some lungs model"},{text:"Demo head BB",tooltip:"Load some strange head"},{text:"Demo alien CC",tooltip:"Write here smth please"}],demoWomanPelvisPrefix:"",demoWomanPelvisUrls:[],demoLungsPrefix:"",demoLungsUrls:[]},La=function(e){Object(S.a)(i,e);var t=Object(x.a)(i);function i(e){var a;return Object(u.a)(this,i),(a=t.call(this,e)).onButtonLocalFile=a.onButtonLocalFile.bind(Object(g.a)(a)),a.handleFileSelected=a.handleFileSelected.bind(Object(g.a)(a)),a.onFileContentReadSingleFile=a.onFileContentReadSingleFile.bind(Object(g.a)(a)),a.onFileContentReadMultipleDicom=a.onFileContentReadMultipleDicom.bind(Object(g.a)(a)),a.onFileContentReadMultipleHdr=a.onFileContentReadMultipleHdr.bind(Object(g.a)(a)),a.setErrorString=a.setErrorString.bind(Object(g.a)(a)),a.onModalUrlShow=a.onModalUrlShow.bind(Object(g.a)(a)),a.onModalUrlHide=a.onModalUrlHide.bind(Object(g.a)(a)),a.onClickLoadUrl=a.onClickLoadUrl.bind(Object(g.a)(a)),a.callbackReadCompleteUrlKtxNii=a.callbackReadCompleteUrlKtxNii.bind(Object(g.a)(a)),a.onModalDemoOpenShow=a.onModalDemoOpenShow.bind(Object(g.a)(a)),a.onModalDemoOpenHide=a.onModalDemoOpenHide.bind(Object(g.a)(a)),a.onDemoSelected=a.onDemoSelected.bind(Object(g.a)(a)),a.onModalWindowCWHide=a.onModalWindowCWHide.bind(Object(g.a)(a)),a.onModalGoogleShow=a.onModalGoogleShow.bind(Object(g.a)(a)),a.onModalGoogleHide=a.onModalGoogleHide.bind(Object(g.a)(a)),a.onGoogleSelected=a.onGoogleSelected.bind(Object(g.a)(a)),a.onModalDicomSeriesHide=a.onModalDicomSeriesHide.bind(Object(g.a)(a)),a.onDicomSerieSelected=a.onDicomSerieSelected.bind(Object(g.a)(a)),a.callbackReadProgress=a.callbackReadProgress.bind(Object(g.a)(a)),a.callbackReadComplete=a.callbackReadComplete.bind(Object(g.a)(a)),a.callbackReadSingleDicomComplete=a.callbackReadSingleDicomComplete.bind(Object(g.a)(a)),a.callbackReadMultipleComplete=a.callbackReadMultipleComplete.bind(Object(g.a)(a)),a.callbackCompleteMultipleDicom=a.callbackCompleteMultipleDicom.bind(Object(g.a)(a)),a.m_fileNameOnLoad="",a.m_fileName="",a.m_fileIndex=0,a.m_fileReader=null,a.state={strUrl:"",showModalUrl:!1,showModalDemo:!1,showModalGoogle:!1,showModalWindowCW:!1,onLoadCounter:1},a.m_volumeSet=null,a.m_volumeRoi=null,a.m_updateEnable=!0,a.roiMode=!1,a.api=new Wi,a}return Object(h.a)(i,[{key:"finalizeSuccessLoadedVolume",value:function(e,t){var i=this.props,a=i.store,r=i.dispatch;console.assert(e instanceof Ei,"finalizeSuccessLoadedVolume: should be VolumeSet"),console.assert(e.getNumVolumes()>=1,"finalizeSuccessLoadedVolume: should be more or 1 volume");var s=e.getVolume(0);if(console.assert(null!==s,"finalizeSuccessLoadedVolume: should be non zero volume"),null!==s.m_dataArray){console.log("success loaded volume from ".concat(t)),s.makeDimensions4x(),a.isLoaded&&r({type:b.SET_IS_LOADED,isLoaded:!1}),console.log("------------check volume:\n",e.checkVolume()),r({type:b.SET_VOLUME_SET,volumeSet:e}),r({type:b.SET_VOLUME_INDEX,volumeIndex:e.getNumVolumes()-1}),r({type:b.SET_IS_LOADED,isLoaded:!0}),r({type:b.SET_FILENAME,fileName:t}),r({type:b.SET_ERR_ARRAY,arrErrors:[]});var o=new Pi;o.createFromRawVolume(s),r({type:b.SET_TEXTURE3D,texture3d:o}),r({type:b.SET_MODE_VIEW,modeView:y.VIEW_2D}),r({type:b.SET_MODE_3D,mode3d:D.RAYCAST})}}},{key:"setErrorString",value:function(e){var t=this.props.dispatch,i=[];i.push(e),t({type:b.SET_IS_LOADED,isLoaded:!1}),t({type:b.SET_ERR_ARRAY,arrErrors:i}),t({type:b.SET_VOLUME_SET,volume:null})}},{key:"finalizeFailedLoadedVolume",value:function(e,t){console.assert(void 0!==t);var i=this.props,a=i.store,r=i.dispatch;r({type:b.SET_IS_LOADED,isLoaded:!1}),r({type:b.SET_VOLUME_SET,volume:null}),r({type:b.SET_ERR_ARRAY,arrErrors:t}),r({type:b.SET_FILENAME,fileName:e}),a.visState.uiApp.doHideProgressBar()}},{key:"callbackReadProgress",value:function(e){var t=Math.floor(100*e),i=this.props.store.visState.uiApp;null!==i&&(0===t&&i.doShowProgressBar("Loading..."),t>=99?i.doHideProgressBar():i.doSetProgressBarRatio(t))}},{key:"callbackReadComplete",value:function(e){if(void 0===e)console.log("callbackReadComplete. should be errCode");else if(e!==rt.SUCCESS){var t=rt.getResultString(e);this.setErrorString(t)}if(this.props.store.visState.uiApp.doHideProgressBar(),e===rt.SUCCESS)this.finalizeSuccessLoadedVolume(this.m_volumeSet,this.m_fileName);else{console.log("callbackReadComplete failed! reading ".concat(this.m_fileName," file"),e);var i=[],a=rt.getResultString(e);i.push(a),this.finalizeFailedLoadedVolume(this.m_fileName,i)}}},{key:"callbackReadSingleDicomComplete",value:function(e){if(e===rt.SUCCESS){var t=this.props.dispatch;return t({type:b.SET_VOLUME_SET,volumeSet:this.m_volumeSet}),t({type:b.SET_VOLUME_INDEX,volumeIndex:0}),t({type:b.SET_LOADER_DICOM,loaderDicom:this.m_loader}),this.childModalWindowCenterWidth.initWindowRange(),void this.setState({showModalWindowCW:!0})}this.callbackReadComplete(e)}},{key:"callbackReadMultipleComplete",value:function(e){if(e!==rt.SUCCESS){var t=rt.getResultString(e);this.setErrorString(t)}}},{key:"onFileReadSingleUncompressedFile",value:function(e,t,i,a){this.m_fileName.endsWith(".ktx")||this.m_fileName.endsWith(".KTX")?this.m_volumeSet.readFromKtx(e,t,i):this.m_fileName.endsWith(".nii")||this.m_fileName.endsWith(".NII")?this.m_volumeSet.readFromNifti(e,t,i):this.m_fileName.endsWith(".dcm")||this.m_fileName.endsWith(".DCM")?(this.m_loader=new Oi,this.m_loader.m_zDim=1,this.m_loader.m_numFiles=1,this.m_volumeSet.readFromDicom(this.m_loader,e,t,a)):this.m_fileName.endsWith(".hdr")||this.m_fileName.endsWith(".HDR")?console.log("cant read single hdr file: ".concat(this.m_fileName)):this.m_fileName.endsWith(".img")||this.m_fileName.endsWith(".IMG")?console.log("cant read single img file: ".concat(this.m_fileName)):console.log("onFileContentReadSingleFile: unknown file type: ".concat(this.m_fileName))}},{key:"onFileContentReadSingleFile",value:function(){var e=this.m_fileReader.result;this.onFileReadSingleBuffer(e)}},{key:"readSliceDicomViaDaikon",value:function(e,t,i){return(new Ua).readSlice(this.m_loader,e,t,i)}},{key:"onFileReadSingleBuffer",value:function(e){if(this.m_fileName.endsWith(".dcm")||this.m_fileName.endsWith(".DCM")){var t=new Ua,i=this.props.dispatch,a=this.m_fileIndex,r=this.m_fileName;this.m_loader=new Oi(1);var s=t.readSingleSlice(i,this.m_loader,a,r,e);return this.callbackReadSingleDicomComplete(s),s}console.log("webgl available: ",Ta()),console.log("UiOpenMenu. onFileReadSingleBuffer ..."),this.m_volumeSet=new Ei,this.m_volumeSet.addVolume(new at);var o=this.callbackReadProgress,n=this.callbackReadComplete,l=this.callbackReadSingleDicomComplete;if(this.m_fileName.endsWith(".ktx")||this.m_fileName.endsWith(".KTX"))this.m_volumeSet.readFromKtx(e,o,n);else if(this.m_fileName.endsWith(".nii")||this.m_fileName.endsWith(".NII"))this.m_volumeSet.readFromNifti(e,o,n);else if(this.m_fileName.endsWith(".dcm")||this.m_fileName.endsWith(".DCM")){this.m_loader=new Oi,this.m_loader.m_zDim=1,this.m_loader.m_numFiles=1,this.m_volumeSet.readFromDicom(this.m_loader,e,o,l);var m=this.m_loader.m_dicomInfo,u=m.m_sliceInfo[0];u.m_fileName=this.m_fileName,u.m_sliceName="Slice 0",(0,this.props.dispatch)({type:b.SET_DICOM_INFO,dicomInfo:m})}else this.m_fileName.endsWith(".hdr")||this.m_fileName.endsWith(".HDR")?console.log("cant read single hdr file: ".concat(this.m_fileName)):this.m_fileName.endsWith(".img")||this.m_fileName.endsWith(".IMG")?console.log("cant read single img file: ".concat(this.m_fileName)):console.log("onFileContentReadSingleFile: unknown file type: ".concat(this.m_fileName))}},{key:"onFileContentReadMultipleHdr",value:function(){if(2===this.m_numFiles||4===this.m_numFiles){var e=this.m_fileName.endsWith("hdr")||this.m_fileName.endsWith("HDR");console.log("onFileContentReadMultipleHdr: read file ".concat(this.m_fileName,". Ratio=").concat(this.m_fileIndex," / ").concat(this.m_numFiles)),this.m_fileIndex++;var t=this.m_fileIndex/this.m_numFiles,i=this.m_fileReader.result;this.m_fileIndex<=1&&(0===this.m_volumeSet.getNumVolumes()&&this.m_volumeSet.addVolume(new at),this.callbackReadProgress(0)),4===this.m_numFiles&&null===this.m_volumeRoi&&(this.m_volumeRoi=new at);var a=/([\S]+)\.[\S]+/.exec(this.m_fileName),r=!1,s=!1;if(2===a.length){var o=a[1];o.endsWith("_mask")&&(r=!0),o.endsWith("_intn")&&(s=!0)}var n=this.m_volumeSet.getVolume(0);if(this.m_fileIndex>2&&(n=this.m_volumeRoi),s&&(n=this.m_volumeSet.getVolume(0)),r&&(n=this.m_volumeRoi,this.roiMode=!0,4!==this.m_numFiles))console.log("You need to load 4 files, if one of them has _mask in name");else{var l=!1;if(l=e?this.m_loader.readFromBufferHeader(n,i,null,null):this.m_loader.readFromBufferImage(n,i,null,null),n=this.m_volumeSet.getVolume(0),l&&this.m_fileIndex===this.m_numFiles){var m=!1;2===this.m_numFiles?m=this.m_loader.createVolumeFromHeaderAndImage(n):4===this.m_numFiles&&(m=this.m_loader.createVolumeFromHeaderAndImage(n))&&(m=this.m_loader.createRoiVolumeFromHeaderAndImage(n,this.m_volumeRoi)),this.callbackReadProgress(1),m?this.callbackReadComplete(rt.SUCCESS):this.callbackReadComplete(rt.FAIL)}if(this.m_fileIndex<this.m_numFiles){this.callbackReadProgress(t),this.m_fileReader.onloadend=this.onFileContentReadMultipleHdr;var u=this.m_files[this.m_fileIndex];this.m_fileName=u.name,this.m_fileReader.readAsArrayBuffer(u)}}}else console.log("onFileContentReadMultipleHdr: can read ".concat(2," or ").concat(4," files for multiple hdr loader"))}},{key:"callbackCompleteMultipleDicom",value:function(e){if(e!==rt.SUCCESS){var t=rt.getResultString(e);this.setErrorString(t)}}},{key:"onFileContentReadMultipleDicom",value:function(){var e=this.m_fileReader.result;this.m_fileIndex++;var t=this.m_fileIndex/this.m_numFiles;if(this.m_fileIndex<=1){var i=new at;this.m_volumeSet.addVolume(i),this.callbackReadProgress(0)}var a;this.callbackCompleteMultipleDicom;if((a=this.readSliceDicomViaDaikon(this.m_fileIndex-1,this.m_fileName,e))!==rt.SUCCESS&&console.log("onFileContentReadMultipleDicom. Error read individual file"),a===rt.SUCCESS&&this.m_fileIndex===this.m_numFiles){var r=this.props.dispatch;return r({type:b.SET_VOLUME_INDEX,volumeIndex:0}),r({type:b.SET_VOLUME_SET,volumeSet:this.m_volumeSet}),r({type:b.SET_LOADER_DICOM,loaderDicom:this.m_loader}),this.callbackReadProgress(1),this.callbackReadComplete(rt.SUCCESS),this.childModalWindowCenterWidth.initWindowRange(),void this.setState({showModalWindowCW:!0})}if(a===rt.SUCCESS){if(this.m_fileIndex<this.m_numFiles){var s=Math.floor(this.m_numFiles/16);this.m_fileIndex%s===0&&this.callbackReadProgress(t),this.m_fileReader.onloadend=this.onFileContentReadMultipleDicom;var o=this.m_files[this.m_fileIndex];this.m_fileName=o.name,this.m_fileReader.readAsArrayBuffer(o)}}else{var n=[],l=this.props.store.arrErrors[0];n.push(l),this.finalizeFailedLoadedVolume(this.m_fileName,n)}}},{key:"handleFileSelected",value:function(e){var t=this;if(void 0!==e.target.files){var i=e.target.files.length;if(console.log("UiOpenMenu. Trying to open ".concat(i," files")),i<=0)return;if(console.log("UiOpenMenu. handleFileSelected. file[0] = ".concat(e.target.files[0].name)),this.m_volumeSet=new Ei,1===i){var a=e.target.files[0];if(this.m_fileName=a.name,this.m_fileName.endsWith(".gz")){var r=this.props.store;null!==r.visState.uiApp&&r.visState.uiApp.doShowProgressBar("read gzip.."),this.props.dispatch({type:b.SET_LOADER,showLoader:!0}),this.m_unzippedBuffer=null,this.m_fileName=this.m_fileName.slice(0,-3);var s=new FileReader;s.readAsArrayBuffer(a);var o=this;return void(s.onload=function(e){try{var t=performance.now();this.m_unzippedBuffer=ya.a.inflate(e.target.result),console.log("time to unzip: ",performance.now()-t),r.visState.uiApp.doShowProgressBar("render volume..");var i=this.m_unzippedBuffer.length;if(i<128)return void console.log("Too small ungzipped data: "+i.toString()+" bytes. cannot read volume data");for(var a=[0,0,1,92],s=!0,n=0;n<4;n++)this.m_unzippedBuffer[n]!==a[n]&&(s=!1);for(var l=!0,m=0;m<4;m++)this.m_unzippedBuffer[m]!==a[3-m]&&(l=!1);if(!s&&!l)return void console.log("Wrong nifi header, cant read gzipped file");console.log("ungzip done with "+i.toString()+" bytes. Correct nifti header detected"),o.onFileReadSingleBuffer(this.m_unzippedBuffer)}catch(u){console.log(u)}})}this.m_fileReader=new FileReader,this.m_fileReader.onloadend=this.onFileContentReadSingleFile,this.m_fileReader.onerror=function(e){console.log("an error occured",e)},this.m_fileReader.readAsArrayBuffer(a)}else{if(2===i){var n=[e.target.files[0],e.target.files[1]].findIndex((function(e){return e.name.toLowerCase().includes("mask")}));if(-1===n)throw new Error("You need a mask file");var m=e.target.files[1-n],u=e.target.files[n];if(!m.name.endsWith(".gz")||!u.name.endsWith(".gz"))throw new Error("both should be compressed");var h=this.props.store;null!==h.visState.uiApp&&h.visState.uiApp.doShowProgressBar("read gzip..");var c=new FileReader,d=new FileReader;c.readAsArrayBuffer(m),d.readAsArrayBuffer(u);var _=function(e,t){return function(i){try{var a=performance.now(),r=ya.a.inflate(i.target.result);console.log("time to unzip: ",performance.now()-a),h.visState.uiApp.doShowProgressBar("render volume..");var s=r.length;if(s<128)return void console.log("Too small ungzipped data: "+s.toString()+" bytes. cannot read volume data");for(var o=[0,0,1,92],n=!0,l=0;l<4;l++)r[l]!==o[l]&&(n=!1);for(var m=!0,u=0;u<4;u++)r[u]!==o[3-u]&&(m=!1);if(!n&&!m)return void console.log("Wrong nifi header, cant read gzipped file");console.log("ungzip done with "+s.toString()+" bytes. Correct nifti header detected"),e(r)}catch(c){console.log(c),t(c)}}},f=new Promise((function(e,t){c.onload=_(e,t)})),v=new Promise((function(e,t){d.onload=_(e,t)})),p=this;return void Promise.all([f,v]).then((function(e){var i=Object(l.a)(e,2),a=i[0],r=i[1];p.m_volumeSet=new Ei,p.m_volumeSet.addVolume(new at);var s=t.callbackReadProgress,o=t.callbackReadComplete;p.m_volumeSet.readFromNifti(a,s,o,r)})).catch((function(e){console.log("Big OOf",e)}))}if(this.m_files=Array.from(e.target.files),this.m_fileIndex=0,this.m_numFiles=i,this.m_fileReader=new FileReader,this.m_loader=null,e.target.files[0].name.endsWith(".dcm")){for(var g=0,S=i-1;S>=0;S--)this.m_files[S].name.endsWith(".dcm")?g++:this.m_files.splice(S,1);i=g,this.m_numFiles=g,this.m_loader=new Oi(i);var x=this.m_loader.m_dicomInfo,y=this.props.dispatch;y({type:b.SET_DICOM_INFO,dicomInfo:x}),y({type:b.SET_LOADER_DICOM,loaderDicom:this.m_loader}),this.m_fileReader.onloadend=this.onFileContentReadMultipleDicom}else{if(!e.target.files[0].name.endsWith(".hdr")&&!e.target.files[0].name.endsWith(".img")){var T=this.props.store;null!==T.visState.uiApp&&T.visState.uiApp.doShowProgressBar("read gzip.."),this.m_unzippedBuffer=null,this.m_fileName=this.m_fileName.slice(0,-3);var D=new FileReader;D.readAsArrayBuffer(R);var O=this;return void(D.onload=function(e){try{var t=performance.now();this.m_unzippedBuffer=ya.a.inflate(e.target.result),console.log("time to unzip: ",performance.now()-t),T.visState.uiApp.doShowProgressBar("render volume..");var i=this.m_unzippedBuffer.length;if(i<128)return void console.log("Too small ungzipped data: "+i.toString()+" bytes. cannot read volume data");for(var a=[0,0,1,92],r=!0,s=0;s<4;s++)this.m_unzippedBuffer[s]!==a[s]&&(r=!1);for(var o=!0,n=0;n<4;n++)this.m_unzippedBuffer[n]!==a[3-n]&&(o=!1);if(!r&&!o)return void console.log("Wrong nifi header, cant read gzipped file");console.log("ungzip done with "+i.toString()+" bytes. Correct nifti header detected"),O.onFileReadSingleBuffer(this.m_unzippedBuffer)}catch(l){console.log(l)}})}this.m_loader=new wi(i),this.m_fileReader.onloadend=this.onFileContentReadMultipleHdr}this.m_volumeRoi=null;var R=e.target.files[0];this.m_fileName=R.name,this.m_fileReader.readAsArrayBuffer(R)}}}},{key:"buildFileSelector",value:function(){var e=document.createElement("input");return e.setAttribute("type","file"),e.setAttribute("accept",".ktx,.dcm,.nii,.hdr,.h,.img,.gz"),e.setAttribute("multiple",""),e.onchange=this.handleFileSelected,e}},{key:"onButtonLocalFile",value:function(e){e.preventDefault(),this.m_fileSelector.click()}},{key:"onModalUrlShow",value:function(){console.log("onModalUrlShow"),this.setState({strUrl:""}),this.setState({showModalUrl:!0})}},{key:"onModalUrlHide",value:function(){console.log("onModalUrlHide"),this.setState({showModalUrl:!1})}},{key:"onChangeUrlString",value:function(e){var t=e.target.value;this.setState({strUrl:t})}},{key:"callbackReadCompleteUrlKtxNii",value:function(e){if(e!==rt.SUCCESS){console.log("onCompleteFromUrlKtx. Bad result: ".concat(e));var t=[],i=rt.getResultString(e);return t.push(i),void this.finalizeFailedLoadedVolume(this.m_fileName,t)}this.finalizeSuccessLoadedVolume(this.m_volumeSet,this.m_fileName),this.callbackReadComplete(rt.SUCCESS,null,0,null)}},{key:"loadFromUrl",value:function(e){var t=new jt;if(t.isValidUrl(e))if(this.m_url=e,this.m_fileName=t.getFileNameFromUrl(e),this.m_volumeSet=new Ei,this.m_volumeSet.addVolume(new at),e.endsWith(".ktx")){var i=this.callbackReadProgress,a=this.callbackReadCompleteUrlKtxNii;this.callbackReadProgress(0),this.m_volumeSet.readFromKtxUrl(e,i,a)}else if(e.endsWith(".nii")){var r=this.callbackReadProgress,s=this.callbackReadCompleteUrlKtxNii;this.callbackReadProgress(0),this.m_volumeSet.readFromNiiUrl(e,r,s)}else{if(e.endsWith(".dcm"))return(new Na).readFromUrl(this.m_volumeSet,e,this.callbackReadCompleteUrlKtxNii,this.callbackReadProgress);if(e.endsWith(".h")){var o=this.callbackReadProgress,n=this.callbackReadCompleteUrlKtxNii;this.callbackReadProgress(0),this.m_volumeSet.readFromHdrUrl(e,o,n)}else console.log("UiOpenMenu. Unknow file type from URL = ".concat(e))}else{var l="UiOpenMenu. Bad URL = ".concat(e);console.log(l),this.setErrorString(l)}}},{key:"onClickLoadUrl",value:function(){this.setState({showModalUrl:!1});var e=this.state.strUrl;console.log("onClickLoadUrl with strUrl = ".concat(e)),this.loadFromUrl(e)}},{key:"onModalDemoOpenShow",value:function(){this.setState({showModalDemo:!0})}},{key:"onModalDemoOpenHide",value:function(){this.setState({showModalDemo:!1})}},{key:"arrNumToStr",value:function(e){for(var t=e.length,i="",a=0;a<t;a++){var r=e[a];i=i.concat(String.fromCharCode(r))}return i}},{key:"onModalGoogleShow",value:function(){this.setState({showModalGoogle:!0})}},{key:"onModalGoogleHide",value:function(){this.setState({showModalGoogle:!1})}},{key:"onGoogleSelected",value:function(e){console.log("onGoogleSelected(".concat(e,") ... "))}},{key:"onDemoSelected",value:function(e){var t=Va.demoUrls;if(t.length>=8){var i=t[e];return console.log("onDemoSelected: load file ".concat(i,", config[ ").concat(e," ]")),void this.loadFromUrl(i)}var a="";if(0===e){a=(new jt).decodeUrl("https://med3web.pqfotpvsdf.fqbn.dpn/nfe4xfc3131/31212219.luy")}else if(1===e){a=(new jt).decodeUrl("https://med3web.pqfotpvsdf.fqbn.dpn/nfe4xfc3131/tfu11.luy")}else if(2===e){a=(new jt).decodeUrl("https://med3web.pqfotpvsdf.fqbn.dpn/nfe4xfc3131/hn4_623_623_276.ojj")}else if(3===e){var r=Va.demoWomanPelvisUrls.length;if(0!==r){for(var s=Va.demoWomanPelvisPrefix,o=[],n=0;n<r;n++){var l=Va.demoWomanPelvisUrls[n],m="".concat(s).concat(l);o.push(m)}var u=this.props.store;return void new Xa(u).loadFromUrlArray(o,!1)}a=(new jt).decodeUrl("https://med3web.pqfotpvsdf.fqbn.dpn/nfe4xfc3131/xpnbo_qfmwjt/wig.:12.edn")}else if(4===e){var h=Va.demoLungsUrls.length;if(0!==h){var c=Va.demoLungsPrefix;console.log("config. Lungs prefix = ".concat(c));for(var d=[],_=0;_<h;_++){var f=Va.demoLungsUrls[_],v="".concat(c).concat(f);d.push(v)}var p=this.props.store;return void new Xa(p).loadFromUrlArray(d,!1)}a=(new jt).decodeUrl("https://med3web.pqfotpvsdf.fqbn.dpn/nfe4xfc3131/11dcb1:2gb5be73dd4311b768bfc:68f/145784245dcfg6fb26gg:f1d91:1611b.edn")}else if(5===e){a=(new jt).decodeUrl("https://med3web.pqfotpvsdf.fqbn.dpn/nfe4xfc3131/du_367_367_367.luy")}else if(6===e){a=(new jt).decodeUrl("https://med3web.pqfotpvsdf.fqbn.dpn/nfe4xfc3131/mvoht_367_367_367.luy")}else if(7===e){a=(new jt).decodeUrl("https://med3web.pqfotpvsdf.fqbn.dpn/nfe4xfc3131/ies/tfu_jouo.i")}else console.log("onDemoSelected. not implemented for index = ".concat(e));a.length>0&&this.loadFromUrl(a)}},{key:"shouldComponentUpdate",value:function(){return!0}},{key:"onModalDicomSeriesHide",value:function(){(0,this.props.dispatch)({type:b.SET_DICOM_SERIES,dicomSeries:[]})}},{key:"onDicomSerieSelected",value:function(e){var t=this.props,i=t.store,a=t.dispatch,r=i.dicomSeries[e].m_hash;this.m_loader.createVolumeFromSlices(this.m_volumeSet,e,r),this.finalizeSuccessLoadedVolume(this.m_volumeSet,this.m_fileName),console.log("onFileContentReadMultipleDicom read all ".concat(this.m_numFiles," files")),a({type:b.SET_DICOM_SERIES,dicomSeries:[]})}},{key:"onModalWindowCWHide",value:function(e){if(this.setState({showModalWindowCW:!1}),e){this.finalizeSuccessLoadedVolume(this.m_volumeSet,this.m_fileName);var t=this.props,i=t.store,a=t.dispatch,r=null;void 0!==this.m_loader&&(r=this.m_loader.m_slicesVolume.getSeries(),a({type:b.SET_DICOM_SERIES,dicomSeries:r}));var s=i.graphics2d;null!==s&&s.forceUpdate()}}},{key:"componentDidMount",value:function(){this.m_fileSelector=this.buildFileSelector();var e=this.m_fileNameOnLoad;if(e.length>0&&this.state.onLoadCounter>0){this.setState({onLoadCounter:0});setTimeout(this.loadFromUrl(e),50)}}},{key:"render",value:function(){var e=this,t=Va.googleCloudDemoActivce,i=this.props.fileNameOnLoad;this.m_fileNameOnLoad=i;if(i.length>2)return Object(a.jsx)("p",{});var r=t?Object(a.jsxs)(ga.a.Item,{onClick:this.onModalGoogleShow,children:[Object(a.jsx)("i",{className:"fas fa-brain"}),"Google cloud models"]}):Object(a.jsx)("p",{}),s=Object(a.jsxs)(ga.a.Item,{href:"#actionOpenDemo",onClick:this.onModalDemoOpenShow,children:[Object(a.jsx)("i",{className:"fas fa-brain"}),"Demo models Open"]}),o=Object(a.jsx)(ga.a.Divider,{});return Object(a.jsxs)(ga.a,{id:"basic-nav-dropdown",title:Object(a.jsxs)("div",{style:{display:"inline-block"},children:["Open",Object(a.jsx)("i",{className:"fas fa-folder-open ml-1"})]}),children:[Object(a.jsxs)(ga.a.Item,{href:"#actionOpenComputer",onClick:function(t){return e.onButtonLocalFile(t)},children:[Object(a.jsx)("i",{className:"fas fa-desktop"}),"Computer"]}),Object(a.jsxs)(ga.a.Item,{href:"#actionOpenUrl",onClick:this.onModalUrlShow,children:[Object(a.jsx)("i",{className:"fas fa-globe-americas"}),"Url"]}),o,r,s,Object(a.jsxs)(Sa.a,{show:this.state.showModalUrl,onHide:this.onModalUrlHide,children:[Object(a.jsx)(Sa.a.Title,{children:"Load data from external source"}),Object(a.jsx)(Sa.a.Header,{closeButton:!0,children:Object(a.jsx)(Sa.a.Body,{children:Object(a.jsxs)(xa.a,{className:"mb-3",children:[Object(a.jsx)(xa.a.Prepend,{children:Object(a.jsx)(xa.a.Text,{id:"inputGroup-sizing-default",children:"Input URL to open"})}),Object(a.jsx)(ba.a,{placeholder:"Enter URL here","aria-label":"Default","aria-describedby":"inputGroup-sizing-default",onChange:this.onChangeUrlString.bind(this)}),Object(a.jsx)(xa.a.Append,{children:Object(a.jsx)(ta.a,{variant:"outline-secondary",onClick:this.onClickLoadUrl,children:"Load"})})]})})})]}),Object(a.jsx)(ja,{stateVis:this.state.showModalDemo,onHide:this.onModalDemoOpenHide,onSelectDemo:this.onDemoSelected}),Object(a.jsx)(Aa,{stateVis:this.state.showModalGoogle,onHide:this.onModalGoogleHide,onSelectDemo:this.onGoogleSelected,arrMenu:Va.arrMenuGoogle}),Object(a.jsx)(Ca,{stateVis:this.state.showModalWindowCW,volSet:this.m_volumeSet,onHide:this.onModalWindowCWHide,onRef:function(t){return e.childModalWindowCenterWidth=t}})]})}}]),i}(s.a.Component);function Pa(){var e=Object(r.useContext)(Fi),t=Object(l.a)(e,2),i=t[0],s=t[1];Object(m.g)();Object(r.useEffect)((function(){var e="",t=window.location.search;if(t.length>0){var i=t.match(/\\?url=(\S+)/);if(null===i)return void console.log("arguments should be in form: ?url=www.xxx.yy/zz/ww");var a=(e=i[1]).match(/^((ftp|http|https):\/\/)?(([\S]+)\.)?([\S]+)\.([A-z]{2,})(:\d{1,6})?\/[\S]+/),r=e.match(/(ftp|http|https):\/\/([\d]+)\.([\d]+)\.([\d]+)\.([\d]+)(:([\d]+))?\/([\S]+)/);if(null===a&&null===r)return void console.log("Not valid URL = ".concat(e));h(e)}}),[]);var o=Object(r.useState)(""),n=Object(l.a)(o,2),u=n[0],h=n[1];return Object(a.jsxs)(va.a,{expand:"lg",className:"fit",children:[Object(a.jsx)(va.a.Toggle,{"aria-controls":"basic-navbar-nav"}),Object(a.jsxs)(va.a.Collapse,{id:"basic-navbar-nav",children:[Object(a.jsx)(pa.a,{className:"mr-auto",children:Object(a.jsx)(La,{store:i,dispatch:s,fileNameOnLoad:u})}),Object(a.jsx)(ia.c,{className:"p-1",activeStyle:{fontWeight:"bold"},exact:!0,to:"/",children:"Home"}),Object(a.jsx)(ia.c,{className:"p-1",activeStyle:{fontWeight:"bold"},exact:!0,to:"/doctor",children:"Doctor"}),Object(a.jsx)(ia.c,{className:"p-1",activeStyle:{fontWeight:"bold"},exact:!0,to:"/nurse",children:"Nurse"}),Object(a.jsx)(ia.c,{className:"p-1",activeStyle:{fontWeight:"bold"},exact:!0,to:"/radiologist",children:"Options"})]})]})}function Ba(e){var t=e.notification,i=Object(r.useContext)(Fi),s=Object(l.a)(i,2),o=(s[0],s[1]),n=t.header,m=t.body,u=t.isVisible,h=t.timer,c=t.icon,d=t.spin,_=t.status;return h&&setTimeout((function(){o({type:b.SET_NOTIFICATION,payload:{body:"",header:"",isVisible:!1}})}),h),u||h?Object(a.jsxs)("div",{className:"notification flex center column ".concat(_),children:[Object(a.jsxs)("div",{className:"notification-header",children:[c&&Object(a.jsx)(la.a,{icon:c,spin:d,className:"mr-2"}),n]}),Object(a.jsx)("div",{className:"notification-body",children:m})]}):null}var za=function(){var e=Object(r.useContext)(Fi),t=Object(l.a)(e,2),i=t[0],s=t[1];return Object(r.useEffect)((function(){s({type:b.SET_PATIENT_DATA,payload:[["355056963916367154422305871670634494196","2021-03-23T18:44:08-07:00",null,5,100,"0",!1,"C:\\Users\\Keenan\\Git\\carl-server\\data\\Study2",null,null,null,null,null,"2020-01-01T09:00:00-08:00"]]}),s({type:b.UPDATE_BIOMARKER_DATA,payload:[["355056963916367154422305871670634494196","V0",5]]}),s({type:b.UPDATE_BIOMARKER_DATA,payload:[["355056963916367154422305871670634494196","K1",.00148]]})}),[s]),Object(a.jsxs)("div",{className:"App flex column",children:[Object(a.jsx)(Pa,{}),Object(a.jsxs)(m.c,{children:[Object(a.jsx)(m.a,{path:"/doctor",children:Object(a.jsx)(ea,{})}),Object(a.jsx)(m.a,{path:"/radiologist",children:Object(a.jsx)(fa,{})}),Object(a.jsx)(m.a,{path:"/nurse",children:Object(a.jsx)(ra,{})}),Object(a.jsx)(m.a,{exact:!0,path:"/",children:Object(a.jsx)(aa,{})})]}),Object(a.jsx)(Ba,{notification:i.notification})]})};n.a.render(Object(a.jsx)(s.a.StrictMode,{children:Object(a.jsx)(ki,{children:Object(a.jsx)(ia.a,{children:Object(a.jsx)(za,{})})})}),document.getElementById("root"))}},[[205,1,2]]]);
//# sourceMappingURL=main.038f76b6.chunk.js.map